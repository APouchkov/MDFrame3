USE [master]
GO
/****** Object:  Database [Gate.Dev]    Script Date: 16.01.2015 12:15:03 ******/
CREATE DATABASE [Gate.Dev]
 CONTAINMENT = NONE
 ON  PRIMARY 
( NAME = N'Gate', FILENAME = N'G:\MSSQL2014\Data\Gate.Dev.mdf' , SIZE = 22082560KB , MAXSIZE = UNLIMITED, FILEGROWTH = 512000KB )
 LOG ON 
( NAME = N'Gate_log', FILENAME = N'D:\MSSQL2014\Data\Gate.Dev_log.ldf' , SIZE = 513024KB , MAXSIZE = 2048GB , FILEGROWTH = 512000KB )
GO
ALTER DATABASE [Gate.Dev] SET COMPATIBILITY_LEVEL = 110
GO
IF (1 = FULLTEXTSERVICEPROPERTY('IsFullTextInstalled'))
begin
EXEC [Gate.Dev].[dbo].[sp_fulltext_database] @action = 'enable'
end
GO
ALTER DATABASE [Gate.Dev] SET ANSI_NULL_DEFAULT ON 
GO
ALTER DATABASE [Gate.Dev] SET ANSI_NULLS ON 
GO
ALTER DATABASE [Gate.Dev] SET ANSI_PADDING ON 
GO
ALTER DATABASE [Gate.Dev] SET ANSI_WARNINGS ON 
GO
ALTER DATABASE [Gate.Dev] SET ARITHABORT ON 
GO
ALTER DATABASE [Gate.Dev] SET AUTO_CLOSE OFF 
GO
ALTER DATABASE [Gate.Dev] SET AUTO_SHRINK OFF 
GO
ALTER DATABASE [Gate.Dev] SET AUTO_UPDATE_STATISTICS ON 
GO
ALTER DATABASE [Gate.Dev] SET CURSOR_CLOSE_ON_COMMIT OFF 
GO
ALTER DATABASE [Gate.Dev] SET CURSOR_DEFAULT  LOCAL 
GO
ALTER DATABASE [Gate.Dev] SET CONCAT_NULL_YIELDS_NULL ON 
GO
ALTER DATABASE [Gate.Dev] SET NUMERIC_ROUNDABORT OFF 
GO
ALTER DATABASE [Gate.Dev] SET QUOTED_IDENTIFIER ON 
GO
ALTER DATABASE [Gate.Dev] SET RECURSIVE_TRIGGERS ON 
GO
ALTER DATABASE [Gate.Dev] SET  DISABLE_BROKER 
GO
ALTER DATABASE [Gate.Dev] SET AUTO_UPDATE_STATISTICS_ASYNC OFF 
GO
ALTER DATABASE [Gate.Dev] SET DATE_CORRELATION_OPTIMIZATION OFF 
GO
ALTER DATABASE [Gate.Dev] SET TRUSTWORTHY OFF 
GO
ALTER DATABASE [Gate.Dev] SET ALLOW_SNAPSHOT_ISOLATION OFF 
GO
ALTER DATABASE [Gate.Dev] SET PARAMETERIZATION SIMPLE 
GO
ALTER DATABASE [Gate.Dev] SET READ_COMMITTED_SNAPSHOT ON 
GO
ALTER DATABASE [Gate.Dev] SET HONOR_BROKER_PRIORITY OFF 
GO
ALTER DATABASE [Gate.Dev] SET RECOVERY SIMPLE 
GO
ALTER DATABASE [Gate.Dev] SET  MULTI_USER 
GO
ALTER DATABASE [Gate.Dev] SET PAGE_VERIFY TORN_PAGE_DETECTION  
GO
ALTER DATABASE [Gate.Dev] SET DB_CHAINING OFF 
GO
ALTER DATABASE [Gate.Dev] SET FILESTREAM( NON_TRANSACTED_ACCESS = OFF ) 
GO
ALTER DATABASE [Gate.Dev] SET TARGET_RECOVERY_TIME = 0 SECONDS 
GO
ALTER DATABASE [Gate.Dev] SET DELAYED_DURABILITY = DISABLED 
GO
EXEC sys.sp_db_vardecimal_storage_format N'Gate.Dev', N'ON'
GO
USE [Gate.Dev]
GO
/****** Object:  User [VELES-CAPITAL\Serenko]    Script Date: 16.01.2015 12:15:03 ******/
CREATE USER [VELES-CAPITAL\Serenko] FOR LOGIN [VELES-CAPITAL\Serenko] WITH DEFAULT_SCHEMA=[dbo]
GO
/****** Object:  User [VELES-CAPITAL\Gagarkin]    Script Date: 16.01.2015 12:15:03 ******/
CREATE USER [VELES-CAPITAL\Gagarkin] FOR LOGIN [VELES-CAPITAL\Gagarkin] WITH DEFAULT_SCHEMA=[dbo]
GO
/****** Object:  User [VELES-CAPITAL\Fetisov]    Script Date: 16.01.2015 12:15:03 ******/
CREATE USER [VELES-CAPITAL\Fetisov] FOR LOGIN [VELES-CAPITAL\Fetisov] WITH DEFAULT_SCHEMA=[dbo]
GO
/****** Object:  User [Sys_Schema]    Script Date: 16.01.2015 12:15:03 ******/
CREATE USER [Sys_Schema] FOR LOGIN [Sys_Schema] WITH DEFAULT_SCHEMA=[dbo]
GO
/****** Object:  User [Sys_Gate]    Script Date: 16.01.2015 12:15:03 ******/
CREATE USER [Sys_Gate] FOR LOGIN [Sys_Gate] WITH DEFAULT_SCHEMA=[dbo]
GO
/****** Object:  User [Scripter]    Script Date: 16.01.2015 12:15:03 ******/
CREATE USER [Scripter] FOR LOGIN [Scripter] WITH DEFAULT_SCHEMA=[dbo]
GO
/****** Object:  User [Reader]    Script Date: 16.01.2015 12:15:03 ******/
CREATE USER [Reader] FOR LOGIN [Reader] WITH DEFAULT_SCHEMA=[dbo]
GO
/****** Object:  User [Quik_OSL]    Script Date: 16.01.2015 12:15:03 ******/
CREATE USER [Quik_OSL] WITHOUT LOGIN WITH DEFAULT_SCHEMA=[Quik]
GO
/****** Object:  User [Quik_Aton]    Script Date: 16.01.2015 12:15:03 ******/
CREATE USER [Quik_Aton] WITHOUT LOGIN WITH DEFAULT_SCHEMA=[Quik]
GO
/****** Object:  User [MicexGate]    Script Date: 16.01.2015 12:15:03 ******/
CREATE USER [MicexGate] WITHOUT LOGIN WITH DEFAULT_SCHEMA=[dbo]
GO
/****** Object:  User [Micex]    Script Date: 16.01.2015 12:15:03 ******/
CREATE USER [Micex] WITHOUT LOGIN WITH DEFAULT_SCHEMA=[dbo]
GO
/****** Object:  User [Gagarkin]    Script Date: 16.01.2015 12:15:03 ******/
CREATE USER [Gagarkin] FOR LOGIN [Gagarkin] WITH DEFAULT_SCHEMA=[dbo]
GO
/****** Object:  User [Bloomberg]    Script Date: 16.01.2015 12:15:03 ******/
CREATE USER [Bloomberg] FOR LOGIN [Bloomberg] WITH DEFAULT_SCHEMA=[dbo]
GO
/****** Object:  User [BackOffice]    Script Date: 16.01.2015 12:15:04 ******/
CREATE USER [BackOffice] WITHOUT LOGIN WITH DEFAULT_SCHEMA=[dbo]
GO
/****** Object:  User [Askina]    Script Date: 16.01.2015 12:15:04 ******/
CREATE USER [Askina] FOR LOGIN [Askina] WITH DEFAULT_SCHEMA=[dbo]
GO
/****** Object:  DatabaseRole [Quotes_Exporter]    Script Date: 16.01.2015 12:15:04 ******/
CREATE ROLE [Quotes_Exporter]
GO
/****** Object:  DatabaseRole [Grant_ViewDefinition]    Script Date: 16.01.2015 12:15:04 ******/
CREATE ROLE [Grant_ViewDefinition]
GO
/****** Object:  DatabaseRole [Custom_Bloomberg.Loader]    Script Date: 16.01.2015 12:15:04 ******/
CREATE ROLE [Custom_Bloomberg.Loader]
GO
ALTER ROLE [db_owner] ADD MEMBER [VELES-CAPITAL\Gagarkin]
GO
ALTER ROLE [db_datareader] ADD MEMBER [Reader]
GO
ALTER ROLE [db_datareader] ADD MEMBER [Micex]
GO
ALTER ROLE [db_datawriter] ADD MEMBER [Micex]
GO
ALTER ROLE [Custom_Bloomberg.Loader] ADD MEMBER [Bloomberg]
GO
ALTER ROLE [Quotes_Exporter] ADD MEMBER [Askina]
GO
/****** Object:  SqlAssembly [INT.TParams]    Script Date: 16.01.2015 12:15:04 ******/
CREATE ASSEMBLY [INT.TParams]
FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300E088D6520000000000000000E00002210B010800008A00000006000000000000BEA900000020000000C000000000400000200000000200000400000000000000040000000000000000000100000200000000000003004085000010000010000000001000001000000000000010000000000000000000000068A900005300000000C00000180300000000000000000000000000000000000000E000000C000000DCA800001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000C489000000200000008A000000020000000000000000000000000000200000602E727372630000001803000000C0000000040000008C0000000000000000000000000000400000402E72656C6F6300000C00000000E0000000020000009000000000000000000000000000004000004200000000000000000000000000000000A0A900000000000048000000020005002C630000B04500000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000062A0A162A82720100007002720500007072090000706F1200000A7205000070281300000A2A0000033004006500000000000000026F1400000A1000022C0D02720F000070281500000A2C06720F0000702A026F1600000A18321D02166F1700000A1F5B331202026F1600000A17596F1700000A1F5D2E02022A0217026F1600000A18596F1800000A720900007072050000706F1200000A2A000000133002004A00000001000011020A061F0E300B061A2E3B061F0E2E362B36061F155945020000002300000023000000061F1D5945060000000200000004000000020000000200000002000000020000002B02172A162A82721100007002721100007072150000706F1200000A7211000070281300000A2A00033004005D00000000000000026F1400000A100002281900000A2C06720F0000702A026F1600000A18321D02166F1700000A1F22331202026F1600000A17596F1700000A1F222E02022A0217026F1600000A18596F1800000A721500007072110000706F1200000A2A0000001B3009000901000002000011731A00000A0A027B050000046F1B00000A130438D000000011046F1C00000A0B1201281D00000A166F1700000A1F3D3BB40000001201281E00000A282B0000060C0828050000060D06066F1F00000A2C1202283C0000066F2000000A6F2100000A2B05720F000070721B0000701201281D00000A2803000006081F162E2F7231000070081F1D2E0D088C060000016F2200000A2B111201281E00000A6F2300000A6F2400000A282500000A2B05720F000070092D10021201281E00000A16282D0000062B13021201281E00000A16282D0000062806000006282600000A282500000A6F2700000A2611046F2800000A3A24FFFFFFDE0C11042C0711046F2900000ADC066F2200000A2A0000000110000002001300E3F6000C000000001B30060010040000030000110228190000060F01282A00000A2D180F01282B00000A6F1400000A720F000070281500000A2C012A0F01282B00000A02283C0000066F2000000A6F2100000A282500000A0A720F0000700B720F0000700C160D1613041613051613061613071208FE150400001B161309384603000011062C0816130638340300001108130D120D282C00000A2D0C120EFE150500001B110E2B0C120D282D00000A732E00000A130F120F282F00000A2C2B0611096F1700000A13101108131111101211282D00000A330C1211282C00000A16FE012B01173AD9020000066F1600000A110902283C0000066F2000000A6F2100000A6F1600000A58323706110902283C0000066F2000000A6F2100000A6F1600000A6F1800000A02283C0000066F2000000A6F2100000A283000000A39950100000611096F1700000A131211121F3A301411121F223B0E01000011121F3A2E26386E01000011121F3D2E3D11121F5B5945030000006800000052010000B7000000384D01000011052D1611042D120609110909596F1800000A0B110917581304171307382E01000011052D35110416311E06110411091104596F1800000A0C06091104095917596F1800000A0B2B0C0609110909596F1800000A0B11091758130517130738ED00000011052D43110813131213282C00000A2D0C1214FE150500001B11142B0C1213282D00000A732E00000A13151215282F00000A2D0B12081F5D283100000A2B081208FE150400001B171307389E00000011052D271109066F1600000A17592F1306110917586F1700000A1F5D33051713062B081208FE150400001B1713072B6E11052C62110813161216282C00000A2D0C1217FE150500001B11172B0C1216282D00000A732E00000A13181218282F00000A2D0B12081F22283100000A2B271109066F1600000A17592F1306110917586F1700000A1F2233051713062B081208FE150400001B1713072B0317130711072C0816130738E1000000110516317E06110511091105596F1800000A130A0208282C000006130B110B28050000062C09110A2807000006130A02072804000006283200000A02110A110B16282E000006281D000006720F0000700B720F0000700C110917580D161304161305DE7D130C7235000070038C07000001110C6F3300000A283400000A733500000A7A110813191219282C00000A2D0C121AFE150500001B111A2B0C1219282D00000A732E00000A131B121B282F00000A2D2E06096F3600000A6F1400000A720F000070283000000A2C16728B000070038C07000001283700000A733500000A7A1109175813091109066F1600000A3FADFCFFFF1108131C121C282C00000A2D0C121DFE150500001B111D2B0C121C282D00000A732E00000A131E121E282F00000A2C1D7203010070038C0700000111088C0400001B283400000A733500000A7A2A011000000000D3025F32031F3700000103300300E700000000000000027B090000042C012A0314283200000A283800000A25283900000A2D110F01282A00000A283A00000A283B00000A25283900000A2D200F01282B00000A6F2200000A720F000070281500000A283A00000A283B00000A283900000A2C0B7275010070733500000A7A042D280F01282B00000A166F1700000A1F3D331772BB0100700F01282B00000A283700000A733500000A7A042C270F01282B00000A166F1700000A1F3D2E1672B2020070038C07000001283700000A733500000A7A0F01282B00000A725F0300706F3C00000A2C167263030070038C07000001283700000A733500000A7A2AA6027B050000040F01282B00000A6F3D00000A2D02142A027B050000040F01282B00000A6F3E00000A2A0000001B3004007000000004000011027B050000040F01282B00000A6F3D00000A2D067E3F00000A2A027B050000040F01282B00000A6F3E00000A0A0675080000012C0906A5080000010BDE30020616282D000006284000000A0BDE202672E3030070020616282D0000060F01282B00000A283400000A733500000A7A072A0110000000002D00214E002001000001133003004A00000005000011027B050000040F01282B00000A6F3D00000A2D067E4100000A2A027B050000040F01282B00000A6F3E00000A0A0675070000012C0706A5070000012A020616282D000006283200000A2A00001B300400C000000006000011027B050000040F01282B00000A6F3D00000A2D0A1202FE150600001B082A027B050000040F01282B00000A6F3E00000A0A06750A0000012C0E06A50A000001734300000A0BDE7706750B0000012C1606A50B0000010D1203284400000A734300000A0BDE5906750C0000012C1C06A50C000001284500000A13041204284400000A734300000A0BDE35020616282D000006284600000A734300000A0BDE2026726C040070020616282D0000060F01282B00000A283400000A733500000A7A072A01100000000031006D9E0020010000011B3004009500000007000011027B050000040F01282B00000A6F3D00000A2D0A1202FE150700001B082A027B050000040F01282B00000A6F3E00000A0A06750B0000012C1606A50B0000010D1203284700000A734800000A0BDE44020616282D00000602283C000006284900000A13041204284700000A734800000A0BDE202672F7040070020616282D0000060F01282B00000A283400000A733500000A7A072A000000011000000000310042730020010000011B3004007B00000008000011027B050000040F01282B00000A6F3D00000A2D067E4A00000A2A027B050000040F01282B00000A6F3E00000A0A06750C0000012C0906A50C0000010BDE3B020616282D00000602283C000006284900000A284B00000A0BDE20267282050070020616282D0000060F01282B00000A283400000A733500000A7A072A000110000000002D002C590020010000011B3004005B01000009000011027B050000040F01282B00000A6F3D00000A2D067E4C00000A2A027B050000040F01282B00000A6F3E00000A0A06750D0000012C0C06A50D0000010BDD1801000006750E0000012C1406A50E0000010C1202284D00000A0BDDFC00000006750F0000012C1406A50F0000010D1203284E00000A0BDDE00000000675100000012C1506A51000000113041204284F00000A0BDDC30000000675080000012C1506A50800000113051205285000000A0BDDA600000006753A0000012C1506A53A00000113061206285100000A0BDD8900000006753B0000012C1206A53B00000113071207285200000A0BDE6F06753C0000012C1206A53C00000113081208285300000A0BDE5506753D0000012C1206A53D00000113091209285400000A0BDE3B020616282D00000602283C000006285500000A285600000A0BDE20267215060070020616282D0000060F01282B00000A283400000A733500000A7A072A00411C0000000000002D0000000C0100003901000020000000010000011B3004005B0100000A000011027B050000040F01282B00000A6F3D00000A2D067E5700000A2A027B050000040F01282B00000A6F3E00000A0A06750E0000012C0C06A50E0000010BDD1801000006750D0000012C1406A50D0000010C1202285800000A0BDDFC00000006750F0000012C1406A50F0000010D1203285900000A0BDDE00000000675100000012C1506A51000000113041204285A00000A0BDDC30000000675080000012C1506A50800000113051205285B00000A0BDDA600000006753A0000012C1506A53A00000113061206285C00000A0BDD8900000006753B0000012C1206A53B00000113071207285D00000A0BDE6F06753C0000012C1206A53C00000113081208285E00000A0BDE5506753D0000012C1206A53D00000113091209285F00000A0BDE3B020616282D00000602283C000006286000000A286100000A0BDE202672A6060070020616282D0000060F01282B00000A283400000A733500000A7A072A00411C0000000000002D0000000C0100003901000020000000010000011B3004005B0100000B000011027B050000040F01282B00000A6F3D00000A2D067E6200000A2A027B050000040F01282B00000A6F3E00000A0A06750F0000012C0C06A50F0000010BDD1801000006750D0000012C1406A50D0000010C1202286300000A0BDDFC00000006750E0000012C1406A50E0000010D1203286400000A0BDDE00000000675100000012C1506A51000000113041204286500000A0BDDC30000000675080000012C1506A50800000113051205286600000A0BDDA600000006753A0000012C1506A53A00000113061206286700000A0BDD8900000006753B0000012C1206A53B00000113071207286800000A0BDE6F06753C0000012C1206A53C00000113081208286900000A0BDE5506753D0000012C1206A53D00000113091209286A00000A0BDE3B020616282D00000602283C000006286B00000A286C00000A0BDE20267239070070020616282D0000060F01282B00000A283400000A733500000A7A072A00411C0000000000002D0000000C0100003901000020000000010000011B3004005B0100000C000011027B050000040F01282B00000A6F3D00000A2D067E6D00000A2A027B050000040F01282B00000A6F3E00000A0A0675100000012C0C06A5100000010BDD1801000006750D0000012C1406A50D0000010C1202286E00000A0BDDFC00000006750E0000012C1406A50E0000010D1203286F00000A0BDDE000000006750F0000012C1506A50F00000113041204287000000A0BDDC30000000675080000012C1506A50800000113051205287100000A0BDDA600000006753A0000012C1506A53A00000113061206287200000A0BDD8900000006753B0000012C1206A53B00000113071207287300000A0BDE6F06753C0000012C1206A53C00000113081208287400000A0BDE5506753D0000012C1206A53D00000113091209287500000A0BDE3B020616282D00000602283C000006287600000A287700000A0BDE202672C6070070020616282D0000060F01282B00000A283400000A733500000A7A072A00411C0000000000002D0000000C0100003901000020000000010000011B3004008D0000000D000011027B050000040F01282B00000A6F3D00000A2D06287800000A2A027B050000040F01282B00000A6F3E00000A0A0675110000012C090674110000010CDE4D0675070000012C1F06A507000001287900000A737A00000A287B00000A0B07737C00000A0CDE26737D00000A7A267255080070020616282D0000060F01282B00000A283400000A733500000A7A082A0000000110000000002D003E6B0020010000011B300400660000000E000011027B050000040F01282B00000A6F3D00000A2D067E4C00000A2A027B050000040F01282B00000A6F3E00000A0A06750D0000012C0906A50D0000010BDE26737D00000A7A2672DE080070020616282D0000060F01282B00000A283400000A733500000A7A072A00000110000000002D00174400200100000113300400B40000000F000011027B050000040F01282B00000A6F3D00000A2D02142A027B050000040F01282B00000A6F3E00000A0A0675020000022C070674020000022A0675070000012C2902282300000A287E00000A74020000020B0706A507000001287900000A283200000A6F09000006072A0675110000012C19733D0000060C080675110000016F7F00000A6F31000006082A7273090070020616282D0000060F01282B00000A02282300000A6F2400000A282600000A733500000A7A4E027B050000040F01282B00000A6F3D00000A2AB6027B070000042C0B72FC090070733500000A7A027B050000046F8000000A02147D0700000402147D080000042A00001B3003006E00000010000011731A00000A0A027B050000046F1B00000A0C2B3F086F1C00000A0B1201281D00000A166F1700000A1F3D2E2706066F1F00000A2C07725F0300702B05720F0000701201281D00000A282500000A6F2700000A26086F2800000A2DB9DE0A082C06086F2900000ADC066F2200000A2A000001100000020012004B5D000A000000001E02281A0000062A1B3002004F00000011000011738100000A0A027B050000046F1B00000A0C2B25086F1C00000A0B1201281D00000A166F1700000A1F3D2E0D061201281D00000A6F8200000A086F2800000A2DD3DE0A082C06086F2900000ADC062A0001100000020012003143000A000000001B300400A8010000120000110203027B0700000414FE0116FE01280A000006738300000A0A027B060000042C69027B060000046F8400000A13052B4311056F8500000A0B1201288600000A7B100000042C2D1201288600000A7B100000040F01282B00000A6F8700000A6F8800000A16320D061201288900000A6F8A00000A11056F2800000A2DB4DE0C11052C0711056F2900000ADC066F8B00000A13062B6B1206288C00000A0C027B06000004086F8D00000A7B110000040D027B06000004086F8E00000A26096F8F00000A13072B211207289000000A1304021104282A0000062D0E027B0500000411046F9100000A261207289200000A2DD6DE0E1207FE160E00001B6F2900000ADC1206289300000A2D8CDE0E1206FE160D00001B6F2900000ADC027B050000040F01282B00000A6F3D00000A2C48042C1D0475460000012D150475470000012C210474470000016F9400000A2C14027B050000040F01282B00000A6F9100000A262A027B050000040F01282B00000A046F9500000A2A042C300475460000012D280475470000012C0D0474470000016F9400000A2D13027B050000040F01282B00000A046F9600000A2A0128000002002E00507E000C000000000200C3002EF1000E0000000002009200780A010E000000001B3003006B00000013000011032D02172A037B050000046F1B00000A0C2B40086F1C00000A0A027B050000041200281D00000A6F3D00000A2C2502027B050000041200281D00000A6F3E00000A1200281E00000A28220000062D04160BDE16086F2800000A2DB8DE0A082C06086F2900000ADC172A072A0001100000020011004C5D000A000000001B300300BC00000014000011032D08022819000006022A738100000A0A037B050000046F1B00000A0D2B49096F1C00000A0B027B050000041201281D00000A6F3D00000A2C2E02027B050000041201281D00000A6F3E00000A1201281E00000A28220000062C0D061201281D00000A6F8200000A096F2800000A2DAFDE0A092C06096F2900000ADC027B050000046F9700000A17590C2B2A06027B050000046F9800000A086F9900000A6F8800000A162F0C027B05000004086F9A00000A0817590C08162FD2022A0110000002001D005572000A000000001B3003004900000015000011032D02022A037B050000046F1B00000A0B2B20076F1C00000A0A021200281D00000A283200000A1200281E00000A281D000006076F2800000A2DD8DE0A072C06076F2900000ADC022A00000001100000020011002C3D000A00000000A6020316280A000006027B050000040F01282B00000A6F3D00000A2C0C02037E9B00000A281D0000062A0000133004009C0000001600001103282B0000060A04282B0000060B07172E05071F15335F06172E07061F152E02162A0374490000016F9C00000A0474490000016F9C00000A2E02162A160C2B220474490000016F9D00000A08910374490000016F9D00000A08912E02162A0817580C086A0474490000016F9C00000A176A5932CC2B2406172E1E061F152E19020416282D000006020316282D000006283000000A2C04162A162A172A1B3003008900000013000011032D02162A027B050000046F9700000A037B050000046F9700000A2E02162A027B050000046F1B00000A0C2B44086F1C00000A0A037B050000041200281D00000A6F3D00000A2D04160BDE3B02037B050000041200281D00000A6F3E00000A1200281E00000A28220000062D04160BDE16086F2800000A2DB4DE0A082C06086F2900000ADC172A072A0000000110000002002B00507B000A000000001330030065000000170000110E041451150A72AD0A00700405283400000A03739E00000A0B076F9F00000A0C086FA000000A2C3508166FA100000A2C11723E0C007004283700000A733500000A7A08166FA200000A0A08176FA100000A2D0A0E0408176FA300000A51086FA400000A062A0000001B3003008C00000018000011140A036FA500000A0B07726C0C007004283700000A6FA600000A07176FA700000A72940C00701F1D73A800000A0C0872A40C00706FA900000A08176FAA00000A08026FAB00000A076FAC00000A086FAD00000A26076F9F00000A0D096FA000000A2C1609166FA100000A2D0D09166FAE00000A74020000020A096FA400000A061305DE05130411047A11052A011000000000000084840005370000011B300500D20100001900001172C40C007073AF00000A0A066FB000000A02060F01282B00000A72F40C0070120128240000060C0208286C00000A2828000006283900000A2C012A027B060000042D0B0273B100000A7D06000004733F0000060D027B0600000408096FB200000A072D012A027B070000042D0B02738300000A7D07000004027B07000004086F8A00000A020607282500000613041104390901000011047B060000046F8400000A13072B5B11076F8500000A1305027B060000041205288900000A6FB300000A2C25027B060000041205288900000A6F8D00000A1205288600000A7B100000047D100000042B19027B060000041205288900000A1205288600000A6FB200000A11076F2800000A2D9CDE0C11072C0711076F2900000ADC11047B050000046F1B00000A13082B6011086F1C00000A1306027B050000041206281D00000A6F3D00000A2D43021206281D00000A283200000A1206281E00000A281D000006097B110000042D0B09738100000A7D11000004097B110000041206281D00000A6F8700000A6F8200000A11086F2800000A2D97DE0C11082C0711086F2900000ADC027B07000004027B070000046FB400000A17596FB500000A027B070000046FB400000A2D0E02147D0700000402147D080000042A0000011C00000200A300680B010C00000000020025016D92010C000000001B3002009A0000001A000011027B060000042D012A738100000A0A027B050000046F1B00000A0D2B25096F1C00000A0B1201281D00000A166F1700000A1F3D330D061201281D00000A6F8200000A096F2800000A2DD3DE0A092C06096F2900000ADC066F8F00000A13042B151204289000000A0C027B05000004086F9100000A261204289200000A2DE2DE0E1204FE160E00001B6F2900000ADC027B060000046FB600000A2A0000011C000002001B00314C000A0000000002005E002280000E00000000E60F0128B700000A2C0716283A00000A2A027B060000042C1A027B060000040328B800000A6FB300000A2C0717283A00000A2A16283A00000A2A00001B3004000E0100001B000011027B070000042D0B72040D0070733500000A7A0314283200000A283800000A25283900000A2D210F01FE16070000016F2200000A720F000070281500000A283A00000A283B00000A283900000A2C012A0F01282B00000A6F8700000A178D5400000113041104161F2C9D11046FB900000A0A0613051613063885000000110511069A0B027B070000046F8B00000A13072B511207288C00000A0C027B06000004086F8D00000A0D097B100000042D1909738100000A7D10000004097B10000004076F8200000A2B1B097B10000004076F8800000A162F0C097B10000004076F8200000A1207289300000A2DA6DE0E1207FE160D00001B6F2900000ADC110617581306110611058E693F70FFFFFF2A000001100000020090005EEE000E000000001B300200900000001C000011027B060000042D02162A036F8700000A1001027B060000046F8400000A0D2B58096F8500000A0A1200288600000A7B110000042C431200288600000A7B110000046F8F00000A13042B151204289000000A0B0703281500000A2C04170CDE2F1204289200000A2DE2DE0E1204FE160E00001B6F2900000ADC096F2800000A2DA0DE0A092C06096F2900000ADC162A082A011C000002004800226A000E0000000002001E006482000A0000000013300200F60000001D00001102750D0000012C031F142A02750E0000012C031F102A02750F0000012C021E2A0275100000012C02162A0275490000012C031F152A0275080000012C02182A0275070000012C031F162A02750B0000012C1E02A50B00000102A50B0000010A1200284700000A28BA00000A2C031F1F2A02750B0000012C031F212A02750C0000012C021A2A02750A0000012C031F202A02753A0000012C021B2A02753B0000012C021C2A02753C0000012C031F092A02753D0000012C031F0D2A0275550000012C031F0E2A0275110000012C031F192A0275020000022C031F1D2A72B70D0070026F2300000A6F2400000A283700000A733500000A7A00001B300300AD0000001E000011032C0D03720F000070281500000A2C031F162A0302282300000A6F2400000A281500000A2C031F1D2AD00600000128BB00000A031728BC00000AA5060000010AD00600000128BB00000A068C0600000128BD00000A2D06737D00000A7A060C081F13301C081D2E27081F0B2E22081F1259450200000011000000110000002B15081F172E0A081F1E2E05081F223306737D00000A7A060BDE122672B70D007003283700000A733500000A7A072A0000000110000000002900709900120100000113300300CE0400001F00001103282B0000060A04174013020000060B07452200000005000000160000002700000040000000590000007800000089000000250400009B000000AC000000BD00000025040000C9000000D500000044010000E7000000F90000000A01000025040000250400002C0100005A0100006B0100002504000025040000770100002504000025040000250400003D010000250400004C0000001B0100006B000000382004000003A51000000128BE00000A28BF00000A2A0374490000016FC000000A28C100000A2A03A50800000128C200000A2D06721F0E00702A72230E00702A03A507000001287900000A2A03A50B0000011928C300000A2A03A50C000001284500000A1928C300000A2A03A50B0000011928C300000A2A03A53A00000128C400000A28C500000A2A03A53B00000128C600000A6C28C700000A2A03A50F00000128B800000A28C800000A2A03A53C00000128C900000A28C500000A2A03A507000001287900000A2A03A507000001287900000A2A03A53D00000128CA00000A6C28C700000A2A03A50C000001284500000A1928C300000A2A03A50E00000128CB00000A28CC00000A2A03A53C00000128C900000A28C500000A2A03A50A0000018C0A00000128CD00000A2A03A50D00000128CE00000A28CF00000A2A036F2200000A2A03A55500000128D000000A28D100000A6F8700000A2A0374490000016FC000000A28C100000A2A03A507000001287900000A2A0374110000016FD200000A2A043A9C020000060C084522000000050000001C0000002D000000440000007F000000A8000000BF0000000C020000D7000000EE000000050100000C0200001B01000031010000C30100004901000060010000770100000C0200000C020000A5010000D9010000EA0100000C0200000C020000000200000C0200000C0200000C020000BC0100000C020000590000008E01000096000000380702000003A51000000128BE00000A02283C00000628D300000A2A0374490000016FC000000A28C100000A2A03A50800000128C200000A02283C00000628D400000A2A03A5070000010D1203FE16070000016F2200000A2A03A50B0000011304120402283C0000066FD500000A6FD600000A02283C00000628D700000A2A03A50C000001284500000A02283C00000628D800000A2A03A50B00000102283C00000628D800000A2A03A53A00000128C400000A02283C00000628D900000A2A03A53B00000128C600000A6C02283C00000628DA00000A2A03A50F00000128B800000A02283C00000628DB00000A2A03A53C00000128C900000A02283C00000628D900000A2A03A50700000113051205FE16070000016F2200000A2A03A50700000113061206FE16070000016F2200000A2A03A53D00000128CA00000A6C02283C00000628DA00000A2A03A50C000001284500000A02283C00000628D800000A2A03A50E00000128CB00000A02283C00000628DC00000A2A03A53C00000128C900000A02283C00000628D900000A2A03A50A0000018C0A00000102283C00000628DD00000A2A03A50D00000128CE00000A02283C00000628DE00000A2A036F2200000A2A03A55500000113071207FE16550000016F2200000A2A0374490000016FC000000A28C100000A2A03A50700000113081208FE16070000016F2200000A2A0374110000016FD200000A2A72270E0070733500000A7A00001B3004000E06000020000011051740C302000004130711074522000000050000001C0000002E00000045000000730000009E000000B50000004A050000CC000000E3000000FA0000004A0500000C0100001E010000DD010000350100004D010000640100004A0500004A0500009A010000F4010000060200004A0500004A050000180200004A0500004A0500004A050000B10100004A050000570000007B0100008B00000038450500000328DF00000A73E000000A8C100000011306DD560500000328E100000A73E200000A1306DD440500000328E300000A73E400000A8C080000011306DD2D0500000373E500000A8C070000011306DD1B050000031928E600000A13081208284700000A8C0B0000011306DDFF040000031928E600000A73E700000A8C0C0000011306DDE7040000031928E600000A8C0B0000011306DDD40400000328E800000A73E900000A8C3A0000011306DDBD0400000328EA00000A73EB00000A8C3B0000011306DDA60400000328EC00000A73ED00000A8C0F0000011306DD8F0400000328E800000A73EE00000A8C3C0000011306DD780400000373E500000A8C070000011306DD660400000373E500000A8C070000011306DD540400000328EA00000A73EF00000A8C3D0000011306DD3D040000031928E600000A73E700000A8C0C0000011306DD250400000328F000000A73F100000A8C0E0000011306DD0E0400000328E800000A73EE00000A8C3C0000011306DDF703000003120028F200000A2D080328F300000A2B01068C0A0000011306DDD80300000328F400000A73F500000A8C0D0000011306DDC103000002282300000A287E00000A74020000020B03737A00000A287B00000A0C07086F31000006071306DD950300000328F600000A73F700000A8C550000011306DD7E0300000328E100000A73E200000A1306DD6C0300000373E500000A8C070000011306DD5A03000003737A00000A287B00000A0D09737C00000A1306DD41030000053A13030000041309110945220000000500000022000000340000004600000084000000CF000000EC000000810200000A01000027010000440100008102000056010000680100003C02000086010000AE010000CB0100008102000081020000FA0100004B0200005A020000810200008102000069020000810200008102000081020000170200008102000058000000E8010000AC000000387C0200000302283C000006287600000A287700000A8C100000011306DD870200000328E100000A73E200000A1306DD7502000003284000000A8C080000011306DD630200000373E500000A8C070000011306DD5102000003027B0300000402283C000006208000000028F800000A130A120A284700000A8C0B0000011306DD2502000003027B0300000402283C000006208000000028F800000A284B00000A8C0C0000011306DDFD01000003027B0300000402283C000006208000000028F800000A8C0B0000011306DDDA0100000302283C00000628F900000A28FA00000A8C3A0000011306DDBD0100000302283C00000628FB00000A6C28FC00000A8C3B0000011306DD9F0100000302283C000006286B00000A286C00000A8C0F0000011306DD820100000302283C00000628F900000A28FD00000A8C3C0000011306DD650100000373E500000A8C070000011306DD530100000373E500000A8C070000011306DD410100000302283C00000628FB00000A6B28FE00000A8C3D0000011306DD2301000003027B0300000402283C000006208000000028F800000A284B00000A8C0C0000011306DDFB00000003027B04000004286000000A286100000A8C0E0000011306DDDE0000000302283C00000628F900000A28FD00000A8C3C0000011306DDC100000003284600000A8C0A0000011306DDAF0000000302283C000006285500000A285600000A8C0D0000011306DD9200000002282300000A287E00000A74020000021304110403283200000A6F0900000611041306DE6D0328FF00000A8C550000011306DE5E0328E100000A73E200000A1306DE4F0373E500000A8C070000011306DE4003737A00000A287B00000A13051105737C00000A1306DE2872270E0070733500000A7A2672490E007003048C060000016F2200000A283400000A733500000A7A11062A0000411C00000000000000000000EE050000EE0500001D0000000100000132036F0101000A733500000A7A000000133004006E01000021000011037E0A0000042D1114FE063E000006730201000A800A0000047E0A000004280301000A0B280401000A730501000A0A076F0601000A166F0701000A74660000010C086F0801000A74680000010D096F0901000A6F0A01000A163E0E010000096F0901000A6F0B01000A1304720F000070130538D300000011046F0C01000A746B000001130611066F0D01000A280E01000A130711066F0F01000A6F1001000A72B10E0070281500000A2C1F0611070211066F0F01000A6F1101000A282C0000066F1201000A388000000011066F1301000A2C6511066F1301000A6F1401000A756F0000012C5211066F1301000A6F1401000A746F0000016F1501000A6F1001000A72B10E0070281500000A2C2B0611070211066F1301000A6F1401000A746F0000016F1501000A6F1101000A282C0000066F1201000A2B12721B0F00701107283700000A733500000A7A11046F1601000A3A21FFFFFF1105720F000070283000000A2C081105733500000A7A062A00001B300600B50000002200001102177D09000004160A389000000003066F1701000A036F1801000A72670F0070283000000A2C73036F1801000A281901000A0B042D1E0207283200000A036F1A01000A73E500000A8C07000001281D0000062B4604076F1B01000A2C220207283200000A02036F1A01000A04076F1C01000A17282E000006281D0000062B1B0207283200000A02036F1A01000A1F1617282E000006281D0000060617580A06036F1D01000A3F64FFFFFFDE0802167D09000004DC2A0000000110000002000000ACAC0008000000001B3004001F02000023000011140A027B050000046F8000000A3893010000036F1E01000A174087010000036F1801000A72730F0070281500000A2C0D0203282F0000060A3868010000036F1801000A72890F0070281500000A394B0100003839010000036F1801000A72890F0070281500000A2C0D036F1E01000A1F0F3B2F010000036F1801000A72990F0070281500000A3905010000027B060000042D0B0273B100000A7D06000004733F0000060B0372AB0F00706F1F01000A2C5B0372AB0F00706F1F01000A178D5400000113051105161F2C9D11056FB900000A13061613072B18110611079A0C077B11000004086F8200000A110717581307110711068E6932E0077B110000046F2001000A2D0707147D110000040372C10F00706F1F01000A2C5B0372C10F00706F1F01000A178D5400000113081108161F2C9D11086FB900000A130916130A2B181109110A9A0D077B10000004096F8200000A110A1758130A110A11098E6932E0077B100000046F2001000A2D0707147D10000004027B060000040372D30F00706F1F01000A282101000A076FB200000A036F2201000A3ABCFEFFFF2B080203062830000006036F2201000A3A62FEFFFF027B050000042C66027B050000046F1B00000A130B2B40110B6F1C00000A13041204281D00000A166F1700000A1F3D3326021204281D00000A282A0000062D1772BB0100701204281D00000A283700000A733500000A7A110B6F2800000A2DB7DE0C110B2C07110B6F2900000ADC2A00011000000200C5014D12020C000000000A142A001B3005004E010000150000110372E50F007072ED0F007072FB0F00706F2301000A0372670F0070723D1000701472B10E00706F2401000A03724F100070726F1000706F2501000A0372E50F0070727D10007072FB0F00706F2301000A03728B10007072B10E00706F2501000A03729F10007072BD1000706F2501000A036F2601000A0372E50F0070724211007072FB0F00706F2301000A037252110070726F1000706F2501000A0372E50F0070725C11007072FB0F00706F2301000A027B050000046F1B00000A0B2B69076F1C00000A0A0372E50F0070727411007072FB0F00706F2301000A0372521100701200281D00000A280E01000A6F2501000A03728811007072921100701200281E00000A282B0000068C060000016F2200000A6F2701000A282500000A6F2501000A036F2601000A076F2800000A2D8FDE0A072C06076F2900000ADC036F2601000A036F2601000A036F2601000A2A0000011000000200BC007531010A000000001B300400770000001500001103726F1000706F2801000A0372670F0070726F1000706F2501000A027B050000046F1B00000A0B2B33076F1C00000A0A031200281D00000A280E01000A6F2901000A03021200281E00000A17282D0000066F2A01000A036F2B01000A076F2800000A2DC5DE0A072C06076F2900000ADC036F2601000A2A0001100000020027003F66000A000000001B3003008501000024000011027B050000046F9700000A2D012A0203283300000602032834000006027B06000004395D0100000372890F00706F2801000A027B060000046F8400000A1304382001000011046F8500000A0A0372990F00706F2801000A0372D30F00701200288900000A13051205282C01000A6F2501000A720F0000700B1200288600000A7B110000046F8F00000A13062B291206289000000A0C0707720F000070281500000A2D07725F0300702B05720F00007008281300000A0B1206289200000A2DCEDE0E1206FE160E00001B6F2900000ADC07720F000070283000000A2C0C0372AB0F0070076F2501000A720F0000700B1200288600000A7B100000046F8F00000A13072B291207289000000A0D0707720F000070281500000A2D07725F0300702B05720F00007009281300000A0B1207289200000A2DCEDE0E1207FE160E00001B6F2900000ADC07720F000070283000000A2C0C0372C10F0070076F2501000A036F2601000A11046F2800000A3AD4FEFFFFDE0C11042C0711046F2900000ADC036F2601000A2A000000414C0000020000008B00000036000000C10000000E00000000000000020000000101000036000000370100000E00000000000000020000003F00000033010000720100000C00000000000000133002004500000025000011036F2D01000A0A068D040000020B062D02072A160C2B2807088F04000002036F2E01000A7D0E00000407088F04000002036F2F01000A7D0F0000040817580C080632D4072A000000133004008003000026000011036F2D01000A0A062D012A160B3866030000140C04078F040000027B0F000004130711074522000000050000001B000000340000004A0000008A000000BB000000D100000077020000E7000000FD00000013010000770200003D01000067010000080200007D01000093010000A90100007702000077020000D50100001E0200003402000077020000770200005B020000770200007702000077020000EB0100007702000074000000BF010000A50000003872020000036F3001000A73E000000A8C100000010C388D020000036F2D01000A0D03096F3101000A73E200000A0C3874020000036F3201000A73E400000A8C080000010C385E020000036F2D01000A1305036F2D01000A1304036F2E01000A11041105733301000A8C070000010C3834020000036F3001000A283401000A8C0B0000010C381E020000036F3001000A283401000A73E700000A8C0C0000010C3803020000036F3001000A283401000A8C0B0000010C38ED010000036F3501000A73E900000A8C3A0000010C38D7010000036F3601000A73EB00000A8C3B0000010C38C1010000036F2D01000A73ED00000A8C0F0000010C38AB010000036F3501000A73EE00000A8C3C0000010C3895010000036F2D01000A1305036F2D01000A1304036F2E01000A11041105733301000A8C070000010C386B010000036F2D01000A1305036F2D01000A1304036F2E01000A11041105733301000A8C070000010C3841010000036F3601000A73EF00000A8C3D0000010C382B010000036F3001000A283401000A8C0B0000010C3815010000036F2F01000A73F100000A8C0E0000010C38FF000000036F3501000A73EE00000A8C3C0000010C38E9000000036F3001000A283701000A8C0A0000010C38D3000000036F3801000A73F500000A8C0D0000010C38BD00000002282300000A287E00000A0C087502000001036F3901000A38A0000000036F2E01000A733A01000A8C550000010C388A000000036F2D01000A0D03096F3101000A73E200000A0C2B74036F2D01000A1305036F2D01000A1304036F2E01000A11041105733301000A8C070000010C2B4D036F2E01000A737A00000A287B00000A13061106737C00000A0C2B3172A611007004078F040000027B0F0000048C060000016F2200000A02282300000A6F2400000A283400000A733500000A7A082C18027B0500000404078F040000027B0E000004086F9600000A0717580B07063F93FCFFFF2A133003004501000027000011020328360000060A0203062837000006036F2D01000A0B072D0C02147D0600000438990000000273B100000A7D06000004160C3880000000036F2D01000A0D733F0000061304036F2D01000A130511051631231613062B1811047B10000004036F2E01000A6F8200000A1106175813061106110532E2036F2D01000A130511051631231613072B1811047B11000004036F2E01000A6F8200000A1107175813071107110532E2027B060000040911046FB200000A0817580C08073F79FFFFFF036F2D01000A0B072D0902147D070000042B2C02738300000A7D070000041613082B17027B07000004036F2D01000A6F8A00000A11081758130811080732E4036F2D01000A0B072D0902147D080000042B2C02738100000A7D080000041613092B17027B08000004036F2E01000A6F8200000A11091758130911090732E4036F2D01000A262A0000001B3002006B0000002800001103027B050000046F9700000A6F3B01000A027B050000046F9700000A2D012A027B050000046F1B00000A0C2B29086F1C00000A0A031200281D00000A6F3C01000A1200281E00000A282B0000060B0307686F3D01000A086F2800000A2DCFDE0A082C06086F2900000ADC2A000110000002002B003560000A000000001B300400CE0400002900001103027B050000046F9700000A6F3B01000A027B050000046F9700000A2D012A027B050000046F1B00000A1306388204000011066F1C00000A0A1200281E00000A282B0000060B0713071107452200000005000000210000006800000084000000DD0000002601000046010000B50300006601000086010000A6010000B5030000DF01000019020000F20200003A020000630200007F020000B5030000B5030000BF0200002103000065030000B5030000B50300009C030000B5030000B5030000B5030000DB020000B5030000BD0000009F0200000601000038B0030000031200281E00000AA51000000128BE00000A6F3E01000A38BA030000031200281E00000A74490000016F9C00000A696F3B01000A031200281E00000A74490000016F9D00000A161200281E00000A74490000016F9C00000A696F3F01000A3873030000031200281E00000AA50800000128C200000A6F4001000A38570300001200281E00000AA5070000010C031202284101000A6F3B01000A031202284201000A6F3B01000A031202282B00000A6F3C01000A381E030000031200281E00000AA50B00000113081208284301000A6F3E01000A38FE020000031200281E00000AA50C00000113091209284401000A130A120A284301000A6F3E01000A38D5020000031200281E00000AA50B000001130B120B284301000A6F3E01000A38B5020000031200281E00000AA53A000001130C120C284501000A6F4601000A3895020000031200281E00000AA53B000001130D120D284701000A6F4801000A3875020000031200281E00000AA50F000001130E120E284901000A6F3B01000A3855020000031200281E00000AA53C000001130F120F284A01000A6F4601000A38350200001200281E00000AA5070000010D031203284101000A6F3B01000A031203284201000A6F3B01000A031203282B00000A6F3C01000A38FC0100001200281E00000AA5070000011304031204284101000A6F3B01000A031204284201000A6F3B01000A031204282B00000A6F3C01000A38C2010000031200281E00000AA53D00000113101210284B01000A6C6F4801000A38A1010000031200281E00000AA50C00000113111211284401000A13121212284301000A6F3E01000A3878010000031200281E00000AA50E00000128CB00000A6F3D01000A385C010000031200281E00000AA53C00000113131213284A01000A6F4601000A383C010000031200281E00000AA50A00000113141214284C01000A6F3E01000A381C010000031200281E00000AA50D00000128CE00000A6F4D01000A38000100001200281E00000A7502000001036F4E01000A38E9000000031200281E00000AA55500000113151215284F01000A13161216FE165B0000016F2200000A6F3C01000A38BA000000031200281E00000A74490000016F9C00000A696F3B01000A031200281E00000A74490000016F9D00000A161200281E00000A74490000016F9C00000A696F3F01000A2B761200281E00000AA5070000011305031205284101000A6F3B01000A031205284201000A6F3B01000A031205282B00000A6F3C01000A2B3F031200281E00000A74110000016FD200000A6F3C01000A2B267241120070078C060000016F2200000A02282300000A6F2400000A283400000A733500000A7A11066F2800000A3A72FBFFFFDE0C11062C0711066F2900000ADC2A0000411C0000020000002C00000095040000C10400000C000000000000001B300200050200002A000011020328390000060203283A000006027B060000042C0D027B060000046F5001000A2B01160A03066F3B01000A063917010000027B060000046F8400000A130638EB00000011066F8500000A0B031201288900000A6F3B01000A1201288600000A7B100000042C131201288600000A7B100000046F2001000A2B01160A03066F3B01000A0616313D1201288600000A7B100000046F8F00000A13072B0F1207289000000A0C03086F3C01000A1207289200000A2DE8DE0E1207FE160E00001B6F2900000ADC1201288600000A7B110000042C131201288600000A7B110000046F2001000A2B01160A03066F3B01000A0616313D1201288600000A7B110000046F8F00000A13082B0F1208289000000A0D03096F3C01000A1208289200000A2DE8DE0E1208FE160E00001B6F2900000ADC11066F2800000A3A09FFFFFFDE0C11062C0711066F2900000ADC027B070000042C0D027B070000046FB400000A2B01160A03066F3B01000A062C39027B070000046F8B00000A13092B111209288C00000A13040311046F3B01000A1209289300000A2DE6DE0E1209FE160D00001B6F2900000ADC027B080000042C0D027B080000046F2001000A2B01160A03066F3B01000A062C39027B080000046F8F00000A130A2B11120A289000000A13050311056F3C01000A120A289200000A2DE6DE0E120AFE160E00001B6F2900000ADC03166F3B01000A2A0000000140000002009A001CB6000E00000000020005011C21010E0000000002003F00FE3D010C00000000020077011E95010E000000000200D1011EEF010E00000000033004007400000000000000027B040000042D650272DA12007016735101000A7D04000004027B040000046FD500000A72E61200706F5201000A027B040000046FD500000A72FC1200706F5301000A027B040000046F5401000A721E1300706F5501000A027B040000046F2000000A725F0300706F5601000A027B040000042A13300400650000002B000011021E8D2E0000010A06167222130070A2061772E6120070A20618725A130070A20619728E130070A2061A72A0130070A2061B72D4130070A2061C72E6130070A2061D7216140070A2067D0300000402280401000A735701000A7D0500000402285801000A2A7602738100000A7D1000000402738100000A7D1100000402285801000A2A0042534A4201000100000000000C00000076322E302E35303732370000000005006C0000005C120000237E0000C81200007012000023537472696E6773000000003825000024140000235553005C3900001000000023475549440000006C390000440C000023426C6F620000000000000002000001571FA2090902000000FA253300160000010000007400000005000000110000003F00000040000000020000005901000004000000100000002B0000000100000002000000020000001000000001000000040000000300000000000A00010000000000060063005C000A00910076000E00C600AD000600D7005C000600DC005C000A0038016A000A0084016F010A00AD016F010600C8015C000600D3015C000600E3015C000A00F3016F010A000A026F010A001C026F010A0030026F010A003F026F010A0051026F010600B5029A020A0025030F031200D4039A020E00E703A2000E00270415040E003B04A200060076046C0406009C046C040600EA04D504120012059A0206001D06FE0506006306510606007A0651060600970651060600B60651060600CF0651060600E806510606000307510606001E07510606003707FE0506004B07FE050600590751060600720751060600A2078F07A700B60700000600E507C50706000508C50706002F085C00060045085C000600A50899080600B3089A020600C1089A020600FC08D504060024095C0006003109510606006609530906007B095C000600C8095C000A001C0A76000600520A5C000A006C0A6F010A00770A6F010A00810A6F010A008A0A6F010600940A5C000600A40A5C000600B50A5C000600C60A5C000600D50A6C040600E20A6C040600F40A5C004B002E0B00000600400B5C000A00470B6F010600640B9A020A00840B6F010A00980B0F030A00A30B0F030A00D20BBF0B0A000F0CBF0B0A00290C6A000A00450C0F030A00620CBF0B0A006E0C6A000A00990C0F030A00CB0CBF0B0600DD0C5C000A00E80C6F010600F00C5C000E001E0DA2000600290D5C000E00400DA20006005D0D5C000600650D5C0006006A0DD5040600180ED5040600320E5C000E00390E15040E006A0E15040600A80EC5070600C30E5C000600E80E9A020E00F40E15040E00180F15040E00280F15040E00390F15040E00560F150406007A0F53090E00890F15040E00A30F15040E00C60FA2000E00F80F15040E000C1015040E00331015040E008610A2000A005B116F010600FD11D50406004C12FE0506006212FE050000000001000000000001000100012010001A002200050001000100020100002A00000011000B003F000A0110003700000015000E003F000200100046000000050010003F005680E6000A005680F8000A002100C50422020100F604260201001F052F0201002405370201003105400201004105470201005A054E021100810EA009060677055A0256807F055D02568084055D02060088050A0006008D056B020600920547020600A105470250200000000086001201FA00010052200000000086081701FE000100552000000000910022010201010078200000000091002D0102010200EC2000000000910042010701030042210000000091004E01020104006421000000009100590102010500D02100000000C60066010D010600F8220000000086008E011101060024270000000081009901170107001728000000008600A3011E0109004428000000008600B80124010A00D028000000008600BE012B010B002829000000008600DC0132010C00042A000000008600EC013D010D00B82A000000008600FF0148010E00502B00000000860012024F010F00D42C000000008600250256011000582E00000000860039025D011100DC2F000000008600480264011200603100000000860058026B0113000C320000000086005E024F01140090320000000086006A0272011500503300000000860073027901160064330000000086007F02FA001700943300000000860085020D011700203400000000860091020D0117002834000000008600BC027F0117009434000000008600C602870117007036000000008600CF028E011900F836000000008600D80294011A00D037000000008600E40294011B003838000000008600F00211011C006438000000008400FC029B011D000C3900000000860008038E011F00B4390000000081003303A1012000283A0000000081004703AB012400D03A000000008600570311012600CC3C0000000086005F03FA002700903D0000000086006903B3012700CC3D000000008600720311012800F83E0000000081008903BA012900B03F0000000096009C03BF012A00B440000000008100A703C5012B008041000000008600B603CB012C005C46000000008600C403D2012E00A44C000000008600F103DB013100204E000000008600FF03E7013200F44E00000000E6010D04F4013400305100000000E6013104FA01350034510000000086004504FF013500A0520000000086005404FF013600345300000000E6016304FF013700145500000000860083040502380068550000000086008C040D023900F45800000000E601970416023B00485A000000008600A9041C023C00D05A000000008600B3041C023D00C85F00000000E601BF041C023E001C6200000000860802052A023F009C620000000086186A05FA003F00944C0000000091004D0E98093F000D630000000086186A05FA00410000000100B20500000100B205000001008D0500000100B20500000100B20500000100B60500000100880500000200B80500000100880500000100880500000100880500000100880500000100880500000100880500000100880500000100880500000100880500000100880500000100880500000100880500000100880500000100880500000100880500000200C70500000100C70500000100C70500000100C70500000100880500000100CD0500000200D40500000100DB0500000100DF0500000200EA0500000300F50502000400C70500000100DF05000002002A0600000100880500000100330600000100C70500000100880500000100C705000001008D0500000100C705000002003C0600000100C705000002008D05000003003C06000001004206000001004206000002004406000001004206000001004A06000001004A06000001004A06000001004206000001004206000002004C06000001004206000001004A06000001004A06000001004A0600000100610E00000200680E0200090002000D00E1006A05FA00E9006A056F02F1006A056F02F9006A056F0201016A056F0209016A056F0211016A056F0219016A056F0221016A056F0229016A05740231016A056F0239016A056F0241016A056F0249016A05790259016A05800261016A05FA0069016A05FA0071014C088502710154088B0271015B080D0171016008920271016C089802710177089C0271018108A10271018B08AC0279016A05FA000C00D008B8021400DE08D6021C00EA08D6021C00F208E30279016C089802D1000509E802910112090D01090066010D0109002909EE02A1013C090D0171015408F40271014509FA0279014C090203A9017209FE00B1018709FA0039001701FE003900F2080D0124008F09FE0024009C09D6022C006A0531032C008F09FE007101AE09920224006A0531033900BC093703B901D2090D01710145093D03B9016A056F0271018108440371014509490339006008B8034100DE09C1034100BC09C7034100E609CD037101F309BA010C00FC09D6030C00080ADC034100110AE3034100160AE7033900110AF303C1016A05FA0034006A05310359002F0A360461003D0A3B045100160A42045900490A63043C006A0531035900160A68046100110A85046100BC0989046900110A96047100620A9A047900620A9A048100620A9A044100620A9A04D101620A9A04D901620A9A04E101620A9A04E901620A9A04F101160A9F046900BC09A7047100110AC7046900990ACB047900990ACB048100990ACB044100990ACB04D101990ACB04D901990ACB04E101990ACB04E901990ACB04F901160AD0047100BC09D8047900110AF8046900AA0AFC047100AA0AFC048100AA0AFC044100AA0AFC04D101AA0AFC04D901AA0AFC04E101AA0AFC04E901AA0AFC040102160A01057900BC0909058100110A29056900BB0A2D057100BB0A2D057900BB0A2D054100BB0A2D05D101BB0A2D05D901BB0A2D05E101BB0A2D05E901BB0A2D050902160A32058100BC093A058900CC0A5A0539003D0A5F0511026A056F02A900ED0A650589006A05F401B9016A05FA002102FE0A7B0589000D0B82050C007F02FA0044006A05FA0044001A0B31034C006A05FA005400D008B8025C00DE08D6026400F208E30271011E0B0D014400260BEE056400EA08D6024C001A0B31034C00D008F4056C00DE08D6025400080ADC035400390BD6034400D008F4057400DE08D6020C00390BD60374007209FE006C007209FE0039021701FE000C00510B0C060C001A0B0C060C005A0B98020C006C0B5B067C00080A6C060C00750B800231027E0BA40649026C08A90649028D0BAD0651026A05BA065102B10BC10661029704FE006102DF0BC7066102E80BCC066102F10B44036102FB0BFA009900010CDB066902190C6F026902350CE10679026A05E8067902520C6F028102810CEF0681028F0CF6065102B00CFB0691021A0B01075902BF0C0A0799006A056F029902D80CFA0054006A05FA0054001A0B0C065400FC09D6034C005A0B98024C00750B800254007F02FA0079001701FE0079003D0A77077101E20C7D0759006008B8079901020DC5072100160ACE072100140DD70781003D0AE807B9026601EE074902F208AD06C102310DF30741003D0AC103B9026601F907D1013D0A0208B90266010B08D9013D0A1208B90266011908B90266011E08E1013D0A2308E9013D0A2C0871003D0A3308B90266013908C10266013E0869003D0A4308B90266014908A9023D0A4E08B902660157088900F2080D01C10266015E08C10266016608D1007D0D6E08E102900D0D01590066017408C10266017C08C10266018508C10266018F08C10266019708C10266019F08C1026601A708C1026601AF08B902A50DCD0881006A05D208C102AD0DD70849026A05DD08B902BE0DAC0241006A05740239006A056F02B902C80DE30861006A05EC08B902D30DF208D1016A05F908B902DD0D0009D9016A050509B902E60D0A0979006A058002E1016A05F908E9016A050509B902EE0D0F0971006A0514095100F60D1909B902FF0D4204B9020A0E210969006A052609B902110E2B09A9026A0532095900270E3909D102160A4709D101BC095109F102160A5A09D901BC096209E101BC096909E901BC097209A902160A790909036A05FA00F902D2090D0101036A05A509B1009704AB091103D20EB50984006A05C309B1000E0FCE092103080AD4093103470FDB0941036B0FCE0949035A0B98022103D008E1095103DE08E70959033C090D01B902B60F02015903D70FED096103EA0F0D0161033C090D0184001A0B0C065903470FF30969032710F90979035210ED0951037209FE00A90063108002A9003C090D01B9022D010201A900F2080D018400FC09D6038400080ADC03A90073109802A90092101E0AA9009F10240A44005A0B98020102160A0A09A9009704FE00B900AC10540AB900BE105B0AB900BE10630AB900D310FA007101E3100D01B900AC106F02B900EB106F02B900FF106F02B9000A11FA00010266010D01C1001C119802C10026110D01C1003111910AC1003B11A906C10045119D0AC1004F11FE0039006A05A30A59006D11AC0AC1007811B20AC1008411B80A51008F11BC0AC1009911C20A110097041602A9026A056F02C900BF048002C900BF046F02C900BF041409C900BF04D208C900BF04FD0AC900BF0474023900A211050B3900B81198025900C111A9066100F2086304D101F208B20AC900BF04F908D901F208B80AC900BF0405097900F2089802E101F208B20AE901F2080B0B5100CA11A906C900BF0426091100BF041C02A902F2080F0B54005A0B9802D1006A05910BE102D4116F02E102E9116F02D1000E12970B91031F126F0291013A126F020C006A05C30909006A05FA0099036A05A20B0E0004000D000E00080076000800300061020800340066022E003300CC0B2E003B00C60B2E008300220C2E001300A90B2E001B00BA0B2E002300C60B2E002B00C60B2E004300C60B2E005300C60B2E005B00D90B2E006B00030C2E007300100C2E007B00190C410103086602C0011302FB03C00703086602A70209034F03ED03F703480471049004AD04DE040F0540056D05750587058F05AE051406440672068E06B206D1060F072207550784079807C007DF07B7088009FF09190A290A690A950AC60AD50AE50A150B5C0B9D0B020001000000700551020000EA04550202000200030002003C000500B102C902DB0225032B032F045C04A805C905CF05D705E505FE0505066506BB0904800000020000000000020000000000000023080000020000000000000000000000010053000000000002000000000000000000000001006A00000000000200000000000000000000000100A2000000000002000000000000000000000001005C00000000000300020004000200050002000000003C4D6F64756C653E00494E542E54506172616D732E646C6C0054506172616D730053716C2E494E540056616C756544625374796C650053716C4462506172616D496E666F00507265706172656444617461006D73636F726C69620053797374656D004F626A6563740053797374656D2E44617461004D6963726F736F66742E53716C5365727665722E536572766572004942696E61727953657269616C697A650053797374656D2E586D6C0053797374656D2E586D6C2E53657269616C697A6174696F6E0049586D6C53657269616C697A61626C6500456E756D0056616C7565547970650053716C54797065734E616D6573706163650053716C54797065734E616D6573706163654C6F636174696F6E00496E6974006765745F49734E756C6C00456E636F64654E616D65004465636F64654E616D650053716C44625479706500497351756F7465547970650051756F746556616C756500556E51756F746556616C756500546F537472696E670053797374656D2E446174612E53716C54797065730053716C537472696E670046726F6D537472696E6700436865636B4E616D6500417356617269616E740053716C426F6F6C65616E00417342697400417356617243686172004E756C6C61626C6560310054696D655370616E00417354696D65004461746554696D65004173446174650053716C4461746554696D650041734461746554696D650053716C4279746500417354696E79496E740053716C496E743136004173536D616C6C496E740053716C496E743332004173496E740053716C496E743634004173426967496E740053716C586D6C004173586D6C00417356617242696E617279004173506172616D7300457869737473506172616D00436C65617200537472696E674E616D6573004765744E616D65730053797374656D2E436F6C6C656374696F6E732E47656E65726963004C6973746031004C6973744E616D657300416464506172616D0043726F7373696E670043726F7373506172616D73004D65726765506172616D730044656C657465506172616D00457175616C56616C75657300457175616C730053797374656D2E446174612E53716C436C69656E740053716C436F6E6E656374696F6E00476574457874656E64656450726F7065727479004578656353514C46756E6374696F6E005072657061726500556E50726570617265005072657061726564005265676973746572446570656E646564506172616D7300497343616C63756C61746564506172616D730047657453716C54797065005479706546726F6D537472696E670056616C7565546F537472696E670056616C756546726F6D537472696E6700536F7274656444696374696F6E617279603200586D6C5265616465720052656164586D6C536368656D610052656164586D6C56616C7565730052656164586D6C0053797374656D2E586D6C2E536368656D6100586D6C536368656D6100476574536368656D6100586D6C577269746572005772697465586D6C536368656D61005772697465586D6C56616C756573005772697465586D6C0053797374656D2E494F0042696E6172795265616465720052656164496E666F005265616456616C75657300526561640042696E617279577269746572005772697465496E666F00577269746556616C756573005772697465004461746554696D65466F726D6174730053797374656D2E476C6F62616C697A6174696F6E0043756C74757265496E666F0063756C74757265496E666F006765745F43756C74757265496E666F00536F727465644C69737460320064617461007072657061726564446174610070726570617265644F626A656374730072656769737465726564446570656E646564506172616D730069676E6F7265436865636B4E616D65002E63746F720049734E756C6C0076616C75655F5F005465787400586D6C006E616D65007479706500646570656E646564506172616D730063616C63756C61746564506172616D73007374720073007072657061726564506172616D730076616C75650076616C7565310076616C7565320061726700636F6E6E656374696F6E006F626A6563744E616D650070726F704E616D650053797374656D2E52756E74696D652E496E7465726F705365727669636573004F75744174747269627574650066756E634E616D65006F626A6563744964007374796C650072007479706573007700696E666F0053797374656D2E5265666C656374696F6E00417373656D626C795469746C6541747472696275746500417373656D626C794465736372697074696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E41747472696275746500417373656D626C79436F6D70616E7941747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C7943756C7475726541747472696275746500436F6D56697369626C65417474726962757465004775696441747472696275746500417373656D626C7956657273696F6E41747472696275746500417373656D626C7946696C6556657273696F6E4174747269627574650053797374656D2E446961676E6F73746963730044656275676761626C6541747472696275746500446562756767696E674D6F6465730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C69747941747472696275746500494E542E54506172616D730053657269616C697A61626C6541747472696275746500537472696E67005265706C61636500436F6E636174005472696D006F705F457175616C697479006765745F4C656E677468006765745F436861727300537562737472696E670049734E756C6C4F72456D7074790053797374656D2E5465787400537472696E674275696C6465720049456E756D657261746F726031004B657956616C756550616972603200476574456E756D657261746F72006765745F43757272656E74006765745F4B6579006765745F56616C75650054657874496E666F006765745F54657874496E666F006765745F4C697374536570617261746F7200547970650047657454797065004D656D626572496E666F006765745F4E616D6500466F726D617400417070656E640053797374656D2E436F6C6C656374696F6E730049456E756D657261746F72004D6F76654E6578740049446973706F7361626C6500446973706F7365006765745F48617356616C75650047657456616C75654F7244656661756C74006F705F496E657175616C697479006F705F496D706C6963697400457863657074696F6E006765745F4D657373616765006F705F54727565006F705F426974776973654F7200436F6E7461696E7300436F6E7461696E734B6579006765745F4974656D004E756C6C0050617273650053716C4D6574686F64417474726962757465006765745F54696D654F66446179006F705F4578706C69636974006765745F446174650049466F726D617450726F766964657200546F53716C427974650053716C446563696D616C0053716C446F75626C650053716C4D6F6E65790053716C53696E676C65004279746500546F53716C496E74313600496E74313600546F53716C496E74333200496E74333200546F53716C496E74363400496E743634006765745F4E756C6C00537472696E6752656164657200546578745265616465720043726561746500416374697661746F7200437265617465496E7374616E6365004372656174655265616465720041646400546F557070657200496E6465784F6600456E756D657261746F720052656D6F76650044424E756C6C00494E756C6C61626C65007365745F4974656D006765745F436F756E7400494C6973746031006765745F4B6579730052656D6F766541740056616C75650053716C4279746573006765745F4275666665720053716C436F6D6D616E640053716C4461746152656164657200457865637574655265616465720053797374656D2E446174612E436F6D6D6F6E0044624461746152656164657200497344424E756C6C00476574496E74333200476574537472696E6700436C6F736500437265617465436F6D6D616E64004462436F6D6D616E64007365745F436F6D6D616E645465787400436F6D6D616E6454797065007365745F436F6D6D616E64547970650053716C506172616D65746572007365745F556474547970654E616D65004462506172616D6574657200506172616D65746572446972656374696F6E007365745F446972656374696F6E007365745F56616C75650053716C506172616D65746572436F6C6C656374696F6E006765745F506172616D65746572730047657453716C56616C7565004462436F6E6E656374696F6E004F70656E00436861720053706C69740053716C477569640052756E74696D655479706548616E646C65004765745479706546726F6D48616E646C65004973446566696E656400586D6C436F6E7665727400436F6E7665727400546F426173653634537472696E6700586D6C4461746554696D6553657269616C697A6174696F6E4D6F646500446563696D616C0047756964004461746554696D65466F726D6174496E666F006765745F4461746554696D65466F726D6174006765745F53686F7274446174655061747465726E00546F496E7436340046726F6D426173653634537472696E6700546F426F6F6C65616E00546F4461746554696D6500546F446563696D616C00546F446F75626C6500546F496E74333200546F496E74313600547279506172736500546F54696D655370616E00546F4279746500546F47756964004461746554696D655374796C6573005061727365457861637400446F75626C650056616C69646174696F6E4576656E7441726773003C52656164586D6C536368656D613E625F5F300073656E64657200650056616C69646174696F6E4576656E7448616E646C6572004353243C3E395F5F436163686564416E6F6E796D6F75734D6574686F6444656C65676174653100436F6D70696C657247656E65726174656441747472696275746500537472696E67436F6D7061726572006765745F4F7264696E616C49676E6F7265436173650049436F6D7061726572603100586D6C536368656D614F626A656374436F6C6C656374696F6E006765745F4974656D7300586D6C536368656D614F626A65637400586D6C536368656D61456C656D656E7400586D6C536368656D6154797065006765745F536368656D615479706500586D6C536368656D61436F6D706C657854797065006765745F4174747269627574657300436F6C6C656374696F6E4261736500586D6C536368656D614F626A656374456E756D657261746F7200586D6C536368656D6141747472696275746500456E636F64654C6F63616C4E616D6500586D6C5175616C69666965644E616D65006765745F536368656D61547970654E616D65006765745F4E616D65737061636500586D6C536368656D6153696D706C655479706500586D6C536368656D6153696D706C6554797065436F6E74656E74006765745F436F6E74656E7400586D6C536368656D6153696D706C65547970655265737472696374696F6E006765745F42617365547970654E616D65004D6F7665546F417474726962757465006765745F417474726962757465436F756E7400586D6C4E6F646554797065006765745F4E6F646554797065004765744174747269627574650057726974655374617274456C656D656E74005772697465417474726962757465537472696E67005772697465456E64456C656D656E7400546F4C6F776572005772697465537461727441747472696275746500577269746556616C7565005772697465456E644174747269627574650052656164496E7433320052656164537472696E670052656164496E7431360052656164496E743634005265616442797465730052656164426F6F6C65616E0053716C436F6D706172654F7074696F6E730046726F6D42696E6172790052656164446563696D616C0052656164446F75626C650046726F6D5469636B73005265616442797465006765745F53716C436F6D706172654F7074696F6E73006765745F4C43494400546F42696E617279006765745F5469636B73007365745F53686F7274446174655061747465726E007365745F4C6F6E6754696D655061747465726E004E756D626572466F726D6174496E666F006765745F4E756D626572466F726D6174007365745F4E756D626572446563696D616C536570617261746F72007365745F4C697374536570617261746F72005374727563744C61796F7574417474726962757465004C61796F75744B696E640000000000035B0000035D0000055D005D0000010003220000052200220000157B0030007D007B0031007D003D007B0032007D0000033A0000551D0435043204350440043D043E04200037043004340430043D043E04200037043D043004470435043D04380435042000540050006100720061006D007300200027007B0030007D0027003A0020007B0031007D0001771D0435043204350440043D043E04200037043004340430043D043E04200037043D043004470435043D04380435042000540050006100720061006D007300200027007B0030007D0027003A0020003E044204410443044204410442043204430435044204200037043D043004470435043D043804350401711D0435043204350440043D043E04200037043004340430043D043E04200037043D043004470435043D04380435042000540050006100720061006D007300200027007B0030007D0027003A0020003E044204410443044204410442043204430435044204200027007B0031007D002700014518043C044F0420003F043004400430043C04350442044004300420003D04350420003C043E04360435044204200031044B0442044C0420003F044304410442044B043C040180F51D0435043204350440043D043E043504200038043C044F0420003F043004400430043C043504420440043004200027007B0030007D0027002C0020003F043004400430043C0435044204400420003D043004470438043D0430044E0449043804390441044F0420004104200027003D00270020003C043E04360435044204200031044B0442044C04200037043004340430043D042800380437043C0435043D0435043D042900200042043E043B044C043A043E04200032042000440443043D043A0446043804380420003F043E04340433043E0442043E0432043A04380420003F043004400430043C043504420440043E0432040180AB1D0435043204350440043D043E043504200038043C044F0420003F043004400430043C043504420440043004200027007B0030007D002700200032042000440443043D043A0446043804380420003F043E04340433043E0442043E0432043A04380420003F043004400430043C043504420440043E0432042C00200034043E043B0436043D043E0420003D043004470438043D04300442044C0441044F0420004104200027003D00270001033B00007F1D0435043204350440043D043E043504200038043C044F0420003F043004400430043C043504420440043004200027007B0030007D0027002C00200038043C044F04200041043E04340435044004360438044204200037043D0430043A042000400430043704340435043B043804420435043B044F04200027002C0027000180871D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D00270020003F043004400430043C043504420440043004200027007B0031007D002700200032042000420438043F0420004200690074000180891D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D00270020003F043004400430043C043504420440043004200027007B0031007D002700200032042000420438043F042000540069006D0065000180891D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D00270020003F043004400430043C043504420440043004200027007B0031007D002700200032042000420438043F04200044006100740065000180911D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D00270020003F043004400430043C043504420440043004200027007B0031007D002700200032042000420438043F0420004400610074006500540069006D00650001808F1D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D00270020003F043004400430043C043504420440043004200027007B0031007D002700200032042000420438043F042000540069006E00790049006E0074000180911D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D00270020003F043004400430043C043504420440043004200027007B0031007D002700200032042000420438043F04200053006D0061006C006C0049006E00740001808B1D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D00270020003F043004400430043C043504420440043004200027007B0031007D002700200032042000420438043F04200049006E0074003300320001808D1D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D00270020003F043004400430043C043504420440043004200027007B0031007D002700200032042000420438043F04200042006900670049006E0074000180871D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D00270020003F043004400430043C043504420440043004200027007B0031007D002700200032042000420438043F04200058006D006C000180931D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D00270020003F043004400430043C043504420440043004200027007B0031007D002700200032042000420438043F042000560061007200420069006E006100720079000180871D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D00270020003F043004400430043C043504420440043004200027007B0031007D002700200032042000420438043F0420007B0032007D000180AF1D0435043B044C0437044F042000380441043F043E043B044C0437043E043204300442044C0420003F0440043E0446043504340443044004430420003E0447043804410442043A04380420003F043004400430043C043504420440043E0432042000270043006C00650061007200270020003204200040043504360438043C04350420003F043E04340433043E0442043E0432043A04380420003F043004400430043C043504420440043E04320401818F530045004C0045004300540020004F0042004A004500430054005F0049004400280027007B0030007D00270029002C0020002800530045004C004500430054002000430041005300540028005B00760061006C00750065005D002000410053002000560041005200430048004100520028004D0041005800290029002000460052004F004D0020005B007300790073005D002E005B0066006E005F006C0069007300740065007800740065006E00640065006400700072006F00700065007200740079005D00200028002700540050006100720061006D0073003A003A007B0031007D0027002C002000270073006300680065006D00610027002C002000500041005200530045004E0041004D004500280027007B0030007D0027002C002000320029002C0020002700460055004E004300540049004F004E0027002C002000500041005200530045004E0041004D004500280027007B0030007D0027002C002000310029002C002000640065006600610075006C0074002C002000640065006600610075006C00740029002900012D1D04350420003D0430043904340435043D0420003E0431044A0435043A044204200027007B0030007D0027000127530045004C0045004300540020007B0030007D002800400050006100720061006D0073002900000F400050006100720061006D007300001F5B00640062006F005D002E005B00540050006100720061006D0073005D00002F63006F006E007400650078007400200063006F006E006E0065006300740069006F006E003D007400720075006500000F50007200650070006100720065000080B11C04350442043E04340420005200650067006900730074006500720044006500700065006E0064006500640050006100720061006D00730020003C043E043604350442042000380441043F043E043B044C0437043E043204300442044C0441044F04200042043E043B044C043A043E04200032042000440443043D043A0446043804380420003F043E04340433043E0442043E0432043A04380420003F043004400430043C043504420440043E0432040167220438043F04200027007B0030007D00270020003D04350420003F043E04340434043504400436043804320430043504420441044F042000420435043A044304490435043904200032043504400441043804350439042000540050006100720061006D00730001033000000331000021210438044104420435043C043D0430044F0420003E044804380431043A04300401671D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D002700200032042000420438043F0420007B0031007D00016968007400740070003A002F002F0073006300680065006D00610073002E006D006900630072006F0073006F00660074002E0063006F006D002F00730071006C007300650072007600650072002F0032003000300034002F00730071006C0074007900700065007300004B1D04350420003F043E043404340435044004360438043204300435043C044B0439042000420438043F0420003F043004400430043C043504420440043004200027007B0030007D002700010B78006D006C006E00730000157800730064003A0073006300680065006D006100000F4F007000740069006F006E0073000011500072006500700061007200650064000015430061006C00630075006C006100740065006400001144006500700065006E0064006500640000114F0062006A00650063007400490064000007780073006400000D73006300680065006D006100004168007400740070003A002F002F007700770077002E00770033002E006F00720067002F0032003000300031002F0058004D004C0053006300680065006D0061000011730071006C0074007900700065007300001F7400610072006700650074004E0061006D00650073007000610063006500000D50006100720061006D007300000D69006D0070006F007200740000136E0061006D00650073007000610063006500001D73006300680065006D0061004C006F0063006100740069006F006E0000808368007400740070003A002F002F0073006300680065006D00610073002E006D006900630072006F0073006F00660074002E0063006F006D002F00730071006C007300650072007600650072002F0032003000300034002F00730071006C00740079007000650073002F00730071006C00740079007000650073002E00780073006400000F65006C0065006D0065006E00740000096E0061006D006500001763006F006D0070006C006500780054007900700065000013610074007400720069006200750074006500000974007900700065000013730071006C00740079007000650073003A000080991D04350432043E0437043C043E0436043D043E0420003F0440043E04470438044204300442044C042000340430043D043D044B0435042C002000420438043F04200027007B0030007D00270020003D04350420003F043E04340434043504400436043804320430043504420441044F042000420435043A0443044904350439042000320435044004410438043504390420007B0031007D000180971D04350432043E0437043C043E0436043D043E042000370430043F0438044104300442044C042000340430043D043D044B0435042C002000420438043F04200027007B0030007D00270020003D04350420003F043E04340434043504400436043804320430043504420441044F042000420435043A0443044904350439042000320435044004410438043504390420007B0031007D00010B65006E002D0055005300011579007900790079002D004D004D002D00640064000121480048003A006D006D003A00730073002E00460046004600460046004600460000032E00003779007900790079002D004D004D002D00640064002000480048003A006D006D003A00730073002E0046004600460046004600460046000133790079002D004D004D002D00640064002000480048003A006D006D003A00730073002E0046004600460046004600460046000111790079002D004D004D002D0064006400013379007900790079004D004D00640064002000480048003A006D006D003A00730073002E004600460046004600460046004600001179007900790079004D004D0064006400002F790079004D004D00640064002000480048003A006D006D003A00730073002E004600460046004600460046004600000D790079004D004D0064006400009452D0DF275746428923E3A0C9A56BF60008B77A5C561934E08902060E6868007400740070003A002F002F0073006300680065006D00610073002E006D006900630072006F0073006F00660074002E0063006F006D002F00730071006C007300650072007600650072002F0032003000300034002F00730071006C0074007900700065007300808268007400740070003A002F002F0073006300680065006D00610073002E006D006900630072006F0073006F00660074002E0063006F006D002F00730071006C007300650072007600650072002F0032003000300034002F00730071006C00740079007000650073002F00730071006C00740079007000650073002E0078007300640003200001032000020400010E0E0500010211190320000E05200101111D06200201111D020520011C111D0620011121111D062001111D111D0A2001151125011129111D0A200115112501112D111D0620011131111D0620011135111D0620011139111D062001113D111D0620011141111D0620011245111D0620011208111D05200102111D072000151249010E06200201111D1C05200102120806200112081208052002021C1C09200408124D0E0E100E0720021208124D0E0620011121113D042001020E05000111191C05200111190E0620020E1C110C0820031C0E1119110C0B2001151251020E111912550C2002011255151251020E1119052001011255042000125905200101125D0720011D111012610820020112611D111005200101126105200101126503061D0E030612690420001269070615126D020E1C080615126D02081214060615124901080606151249010E0206020328000204280012690206080306110C0400000000040100000003061119042001010E0420010102062001011180A904200101080520020E0E0E0600030E0E0E0E050002020E0E0320000804200103080520020E08080407011119040001020E0615126D020E1C102000151280C101151180C502130013010C151280C101151180C5020E1C042000130007151180C5020E1C04200013010520001280C90520001280CD0500020E0E0E0700040E0E1C1C1C0620011280BD0E1B07051280BD151180C5020E1C111902151280C101151180C5020E1C051511250103051511250108052001011300050001111D0E0600030E0E1C1C0420010E080500020E0E1C68071F0E0E0E08080802021511250103080E11191280DD151125010315112501081511250108081511250103031511250103151125010815112501081511250103151125010815112501081511250103151125010815112501081511250103151125010815112501080800021121111D111D050001021121050001112102080002112111211121052001021300062001130113000306112105000111210E0507021C11210306111D0307011C3301000300540E044E616D6506417354696D6554020F497344657465726D696E69737469630154020A4F6E4E756C6C43616C6C00061511250111290420001129060001112D113105000111290E1307051C151125011129151125011129112D112D0615112501112D042000112D080002112D0E1280E51307051C15112501112D15112501112D112D112D030611310600011131112D0507021C1131030611350420001135070002050E1280E505000111350519070A1C11351139113D114111211180E91180ED1180F11180F5030611390420001139070002060E1280E505000111390619070A1C11391135113D114111211180E91180ED1180F11180F50306113D042000113D070002080E1280E5050001113D0819070A1C113D11351139114111211180E91180ED1180F11180F50306114104200011410700020A0E1280E505000111410A19070A1C114111351139113D11211180E91180ED1180F11180F504000012450500010E111D070001125512810D0707031C125512450507021C11350600011C1280CD04200012550707031C120812081807031280BD151180C5020E1C151280C101151180C5020E1C05151249010E1A0703151249010E151180C5020E1C151280C101151180C5020E1C0515124901080715126D020812140D151280C101151180C50208121408151180C50208121405200108130009200015118115011300061511811501080615118115010E07200201130013012F07081512490108151180C50208121408151249010E0E151280C101151180C50208121415118115010815118115010E160703151180C5020E1C02151280C101151180C5020E1C092000151281210113000615128121010E0520011300081B0704151249010E151180C5020E1C08151280C101151180C5020E1C150702151180C5020E1C151280C101151180C5020E1C04061281190320000A0420001D050707031119111908062002010E124D05200012812D042001020804200108080907030812812912812D05200012812906200101118139062002010E111906200101118145042001011C05200012814908200112813D12813D0420011C08120706120812812912813D12812D1280DD1208320709124D0E0812141208151180C502081214151180C5020E1C151280C101151180C502081214151280C101151180C5020E1C210705151249010E151180C5020E1C0E151280C101151180C5020E1C15118115010E05000108113D0620011D0E1D031307081D0E0E0812141D031D0E081511811501081F0705151180C5020812140E02151280C101151180C50208121415118115010E07000202112D112D040701112D0800011280CD1181590800031C1280CD0E02070002021280CD1C0807031119111911190500010A11410400010E0A0500010E1D050800020E112D1181650800011181691180E90600010E1181690600010D1180ED0400010E0D0400010E080800011181691180F10600010C1180F50500010611390400010E060400010E1C0500010511350400010E0508000111816D1181550600010E11816D0700020E0A1280E50700020E021280E50520001281710720020E0E1280E50800020E112D1280E50900020E1181691280E50700020E0D1280E50700020E081280E50700020E061280E50700020E1C1280E50700020E051280E5150709111911191119111D112D111D111D118155111D0400010A0E042001010A0500011D050E052001011D05080002112D0E11816505200101112D0600011181690E062001011181690400010D0E042001010D040001080E040001060E0420010106070002020E101129040001050E042001010506000111816D0E0620010111816D0D0004112D0E1D0E1280E51181750900021181690E1280E50800011180E91181690700020D0E1280E50600011180ED0D0800011180F11181690600011180F50C0600011181550E17070B1129120812551255120812551C1119112D1119112D070002011C12817D0406128181052002011C180900021259125512818105000012818907151251020E11190A2001011512818D0113000520001281910620011281950805200012819D0520001281A90520001281950520001281B10520001281B50520001281B9190708151251020E111912591281991281A11281A90E1281AD0E040702080E0520001181C10420010E0E2A070C151251020E111912140E0E151180C5020E1C1D031D0E081D031D0E08151280C101151180C5020E1C062003010E0E0E072004010E0E0E0E052002010E0E270708151180C5020812140E0E0E151280C101151180C5020812140815118115010E15118115010E03200006070703081D1110080520011D0508082003010E081181C5050001112D0A0520001181690320000D05000111290A032000050E070808081C08081181C5125511190F070A1D111008080812140808080808170703151180C5020E1C1119151280C101151180C5020E1C072003011D0508080520001181C50320000C05200011816D460717151180C5020E1C1119111D111D111D111D151280C101151180C5020E1C1119112D1131112D112D1180E91180ED113D1180F11180F51131112D1180F1112911815511816D34070B08151180C5020812140E0E080E151280C101151180C50208121415118115010E15118115010E15118115010815118115010E052002010E020520001281C90407011D0E062001011181D11001000B494E542E54506172616D7300000B010006506172616D7300000501000000000C01000754506172616D7300002901002465653164313437312D636532612D343964622D393539302D36393936643834636637626600000C010007322E302E302E3200000801000200000000000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F77730100000000000000E088D652000000000200000070000000F8A80000F88A0000525344532077393D8D7C0C41809BF6B54E4C9BA703000000443A5C576F726B5C50726F6A656374735C457874656E6465642053746F7265642050726F636564757265735C53716C2E494E542E54506172616D735C6F626A5C52656C656173655C494E542E54506172616D732E7064620090A900000000000000000000AEA90000002000000000000000000000000000000000000000000000A0A9000000000000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF250020400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058C00000C00200000000000000000000C00234000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000002000200000000000200020000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B00420020000010053007400720069006E006700460069006C00650049006E0066006F000000FC010000010030003000300030003000340062003000000028000700010043006F006D006D0065006E0074007300000050006100720061006D0073000000000040000C000100460069006C0065004400650073006300720069007000740069006F006E000000000049004E0054002E00540050006100720061006D0073000000300008000100460069006C006500560065007200730069006F006E000000000032002E0030002E0030002E003200000040001000010049006E007400650072006E0061006C004E0061006D006500000049004E0054002E00540050006100720061006D0073002E0064006C006C0000002800020001004C006500670061006C0043006F0070007900720069006700680074000000200000004800100001004F0072006900670069006E0061006C00460069006C0065006E0061006D006500000049004E0054002E00540050006100720061006D0073002E0064006C006C000000300008000100500072006F0064007500630074004E0061006D00650000000000540050006100720061006D0073000000340008000100500072006F006400750063007400560065007200730069006F006E00000032002E0030002E0030002E003200000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000032002E0030002E0030002E00320000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000A000000C000000C03900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
WITH PERMISSION_SET = SAFE

GO
/****** Object:  SqlAssembly [UDT.TParams]    Script Date: 16.01.2015 12:15:04 ******/
CREATE ASSEMBLY [UDT.TParams]
FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C0103005F1C28530000000000000000E00002210B010800002000000006000000000000EE3F0000002000000040000000004000002000000002000004000000000000000400000000000000008000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000943F00005700000000400000F002000000000000000000000000000000000000006000000C000000083F00001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000F41F0000002000000020000000020000000000000000000000000000200000602E72737263000000F0020000004000000004000000220000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000002600000000000000000000000000004000004200000000000000000000000000000000D03F00000000000048000000020005008C2200007C1C00000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000133001000E0000000100001173300000060A066F1300000A062A5A02281400000A8C260000016F1500000A281600000A2A1E02281700000A2A00000013300100080000000100001173300000060A062A1E02281800000A2A220203281900000A2A220203281A00000A2A220203281B00000A2A220203281C00000A2A1330020029000000010000110F00281E00000A2C0628040000062A73300000060A060F00281F00000A281600000A6F2000000A062A1E02282100000A2A220203282200000A2A3202282300000A281600000A2A3202282300000A281600000A2A26020304282400000A2A2A020304280F000006022A3A0203048C03000001282400000A2A26020304282400000A2A3A0203048C09000001282400000A2A26020304282400000A2A46020304280F0000060205282B000006022A220203282500000A2A360203282600000A74020000022A260203282700000A262A2A0203282700000A26022A220203282800000A2A260203282800000A022A220203282900000A2A220203282A00000A2A220203282B00000A2A220203282C00000A2A220203282D00000A2A220203282E00000A2A220203282F00000A2A220203283000000A2A220203283100000A2A220203283200000A2A220203283300000A2A360203283400000A74020000022A360203282C00000A733500000A2A220203283600000A2A220203283700000A2A220203283800000A2A260203283800000A022A1E02283900000A2A220203283A00000A2A220203283B00000A2A1E02283C00000A2A000042534A4201000100000000000C00000076322E302E35303732370000000005006C0000005C080000237E0000C80800003006000023537472696E677300000000F80E00000800000023555300000F0000100000002347554944000000100F00006C0D000023426C6F6200000000000000020000014717A2030900000000FA253300160000010000002800000002000000300000002F000000010000003C000000330000000100000001000000030000000300000001000000010000000400000000000A0001000000000006001A0036000A005F004A000A006D004A000E00D800CE000E00EB00CE0012000801FD0012001A01FD000A0073014A000A0081014A000A00F8014A000E001A0213020E00250213020E00350213020A0045024A000A0066024A000A007A024A000A0089024A000A00A4024A000E007F036D030E0096036D030E00B3036D030E00D2036D030E00EB036D030E0004046D030E001F046D030E003A046D030E00720453040E0086046D030E009F046D030E00CF04BC047B00E30400000E001205F2040E003205F204120075055C050A00A10586050A00BD0586050E00C40513020A00DF053E000E00F40513020A00070686050000000001000000000001000100012010001A002200050001000100502000000000960069000A0001006A2000000000960077000F000100812000000000E1097E00150002008C20000000009608B3000A000200A02000000000C600BC0019000200A820000000008600E5001D000200B120000000008600F80023000300BA20000000008600120129000400C32000000000860024012F000500CC200000000096002D0135000600012100000000860033013C000700092100000000860039014000070012210000000086084501460008001F210000000086004F01460008002C2100000000860058014B0008003621000000008600610152000A00412100000000860065015A000C0050210000000086007A0162000E005A2100000000860089016A00100069210000000086009601720012007321000000008600A0017A0014008521000000008600AD01840017008E21000000008600B6018A0018009C21000000008600C20191001900A621000000008600CE018A001A00B121000000008600D40197001B00BA21000000008600E0019D001C00C421000000008600E70184001D00CD21000000008600EE01A4001E00D6210000000086000302AA001F00DF210000000086000902B1002000E8210000000086002E02B8002100F1210000000086003E02C3002200FA210000000086005102CE00230003220000000086005C02D50024000C220000000086006F02DC00250015220000000086008302E30026001E220000000086009202EA00270027220000000086009B029D0028003522000000008600AD02F10029004322000000008600BA02F8002A004C22000000008600C002D5002B005522000000008600CC0297002C005E22000000008600D4029D002D006822000000008600DF023C002E007022000000008600E902FF002E007922000000008600F20297002F00822200000000861809033C003000000001004003000001004603000001004D03000001004D03000001004603000001004D03000001005103000001005103000002004003000001005103000002004003000001005103000002004003000001005103000002004003000001005103000002004003000001005103000002004003000001005103000002004003000003005603000001004003000001004003000001004003000001004003000001005103000001005103000001005F03000001005103000001005103000001005103000001005103000001005103000001005103000001005103000001005103000001005103000001005103000001005103000001005103000001005103000001005103000001005103000001005103000001006403000001004003020009001100A8001500990009031401A10009031401A90009031401B10009031401B90009031401C10009031401C90009031401D10009031401D90009031901E10009031401E90009031401F10009031E01010109032401090109033C00110109031401190109033501290109033C000900DA053C000900E9057C013901BC0019001900FB0583010900A80015000900BC0019000900E5001D000900F8002300090012012900090024012F00410109033C001900A800150019001A061900090024069700090033013C0009003901400009004F011900090058014B000900AD01DC040900B60115050900C20115050900D40197000900E701DC040900EE01A40009000302AA0009000902B10009002E02B80009003E02C30009005102CE0009005C02D50009006F02DC0009008302E30009009202EA0009009B02DC089100090397000900BA02F8000900C002D5000900CC0297000900DF023C000900E902FF000900F2029700090009033C002E0053001A0D2E0063002D0D2E006B003A0D2E0043001A0D2E001300090D2E007300430D2E007B004C0D2E0023001A0D2E003B001A0D2E001B001A0D2E002B001A0D2E003300200D43008B003C014300830029014001EB0089016001EB00A9018001EB00C901C001EB00EF01E001EB0032020002EB0062022002EB008D024002EB00C2026002EB00F0028002EB002403A002EB005503C002EB00AC04E002EB00E2040003EB001C052003EB004F054003EB007C056003EB00AF058003EB00DD05A003EB00FE05C003EB004206E003EB0082060004EB00C6062004EB0007074004EB0048076004EB008D078004EB00D107A004EB001608C004EB005608E004EB0099080005EB00E3082005EB002A094005EB006A096005EB00B0098005EB00020BA005EB00570CC005EB00880CE005EB00CB0C77010200010000000F030601000035030A0100003A030F0102000300030002000400050002000D0007000200060003000480000002000000000002000000000000005005000002000000000002000000000000002A000000000002000000000000000000000001003E00000000000200000000000000000000000100C500000000000200000000000000000000000100FD000000000000000000003C4D6F64756C653E005544542E54506172616D732E646C6C0054506172616D730053716C2E55445400494E542E54506172616D730053716C2E494E540053797374656D2E446174610053797374656D2E446174612E53716C547970657300494E756C6C61626C65004E65770053716C537472696E6700547970654F660053797374656D2E446174612E53716C54797065732E494E756C6C61626C652E6765745F49734E756C6C006765745F49734E756C6C006765745F4E756C6C00546F537472696E67006D73636F726C69620053797374656D2E494F0042696E6172795772697465720057726974650042696E61727952656164657200526561640053797374656D2E586D6C00586D6C5265616465720052656164586D6C00586D6C577269746572005772697465586D6C00506172736500436C65617200457869737473506172616D006765745F4E616D6573004765744E616D657300416464506172616D0041646400416464566172436861724D61780053716C586D6C00416464586D6C0053716C427974650041646456617242696E61727900416464506172616D730050726570617265506172616D0043726F7373696E670043726F7373506172616D73004D65726765506172616D73004D657267650044656C657465506172616D0044656C65746500457175616C7300417356617269616E740053716C426F6F6C65616E004173426974004173566172436861720053797374656D004E756C6C61626C656031004461746554696D65004173446174650054696D655370616E00417354696D650053716C4461746554696D650041734461746554696D6500417354696E79496E740053716C496E743136004173536D616C6C496E740053716C496E743332004173496E740053716C496E743634004173426967496E74004173506172616D730053716C4368617273004173566172436861724D6178004173586D6C00417356617242696E6172790050726570617265004E65775072657061726500556E50726570617265005072657061726564005265676973746572446570656E646564506172616D73002E63746F720053797374656D2E446174612E53716C54797065732E494E756C6C61626C652E49734E756C6C004E756C6C004E616D65730076616C75650054617267657400537263006E616D650066756E634E616D650061726773006F626A65637449640053797374656D2E5265666C656374696F6E00417373656D626C795469746C6541747472696275746500417373656D626C794465736372697074696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E41747472696275746500417373656D626C79436F6D70616E7941747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C7943756C747572654174747269627574650053797374656D2E52756E74696D652E496E7465726F70536572766963657300436F6D56697369626C6541747472696275746500417373656D626C7956657273696F6E41747472696275746500417373656D626C7946696C6556657273696F6E4174747269627574650053797374656D2E446961676E6F73746963730044656275676761626C6541747472696275746500446562756767696E674D6F6465730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C697479417474726962757465005544542E54506172616D730053797374656D2E586D6C2E53657269616C697A6174696F6E00586D6C526F6F74417474726962757465004D6963726F736F66742E53716C5365727665722E5365727665720053716C55736572446566696E65645479706541747472696275746500466F726D61740053657269616C697A61626C6541747472696275746500496E69740053716C4462547970650047657453716C54797065004F626A656374006F705F496D706C696369740053716C4D6574686F64417474726962757465006765745F56616C75650046726F6D537472696E6700000003200000000000E3CC9C80BAEA934C9AAD8E5FC9B506550008B77A5C561934E0890400001208050001110D1C032000020320000E05200101121105200101121505200101121905200101121D0600011208110D0320000105200102110D042000110D06200201110D1C0720021208110D1C07200201110D110D07200201110D122107200201110D112507200201110D12080920031208110D1C110D0520010212080620011208120805200101120805200101110D0620011208110D0520011C110D0620011129110D062001110D110D0A200115112D011131110D0A200115112D011135110D0620011139110D0620011125110D062001113D110D0620011141110D0620011145110D0620011249110D0620011221110D06200111291141032800020408001208042800110D042001010E042001010205200101117D04200101080B010006506172616D730000062001011180913A010002000000030054020D4973427974654F7264657265640154080B4D61784279746553697A65FFFFFFFF540E044E616D650754506172616D7304070112080600011180991C050001110D0E1F01000200540E044E616D6505506172736554020A4F6E4E756C6C43616C6C001F01000200540E044E616D6505436C65617254020A4F6E4E756C6C43616C6C002501000200540E044E616D650B457869737473506172616D54020A4F6E4E756C6C43616C6C014201000400540E044E616D65084765744E616D657354020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C002F01000300540E044E616D6508416464506172616D54020949734D757461746F720154020A4F6E4E756C6C43616C6C012A01000300540E044E616D650341646454020949734D757461746F720054020A4F6E4E756C6C43616C6C013401000300540E044E616D650D416464566172436861724D617854020949734D757461746F720154020A4F6E4E756C6C43616C6C012D01000300540E044E616D6506416464586D6C54020949734D757461746F720154020A4F6E4E756C6C43616C6C013301000300540E044E616D650C41646456617242696E61727954020949734D757461746F720154020A4F6E4E756C6C43616C6C013001000300540E044E616D6509416464506172616D7354020949734D757461746F720154020A4F6E4E756C6C43616C6C01815501000500540E044E616D650C50726570617265506172616D54020949734D757461746F720054020A4F6E4E756C6C43616C6C015455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730100000054557F4D6963726F736F66742E53716C5365727665722E5365727665722E53797374656D446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038391053797374656D44617461416363657373010000002F01000300540E044E616D650843726F7373696E6754020949734D757461746F720054020A4F6E4E756C6C43616C6C010520010212053201000300540E044E616D650B43726F7373506172616D7354020949734D757461746F720054020A4F6E4E756C6C43616C6C00062001120512053201000300540E044E616D650B4D65726765506172616D7354020949734D757461746F720154020A4F6E4E756C6C43616C6C012C01000300540E044E616D65054D6572676554020949734D757461746F720054020A4F6E4E756C6C43616C6C013201000300540E044E616D650B44656C657465506172616D54020949734D757461746F720154020A4F6E4E756C6C43616C6C002D01000300540E044E616D650644656C65746554020949734D757461746F720054020A4F6E4E756C6C43616C6C002001000200540E044E616D6506457175616C7354020A4F6E4E756C6C43616C6C014301000400540E044E616D6509417356617269616E7454020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C003F01000400540E044E616D6505417342697454020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C004301000400540E044E616D650941735661724368617254020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C004001000400540E044E616D650641734461746554020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C004001000400540E044E616D6506417354696D6554020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C004401000400540E044E616D650A41734461746554696D6554020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C004301000400540E044E616D6509417354696E79496E7454020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C004401000400540E044E616D650A4173536D616C6C496E7454020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C003F01000400540E044E616D65054173496E7454020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C004201000400540E044E616D65084173426967496E7454020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C004201000400540E044E616D65084173506172616D7354020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C000620011205110D4601000400540E044E616D650C4173566172436861724D617854020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C003F01000400540E044E616D65054173586D6C54020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C004501000400540E044E616D650B417356617242696E61727954020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C00815001000500540E044E616D65075072657061726554020949734D757461746F720154020A4F6E4E756C6C43616C6C005455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730100000054557F4D6963726F736F66742E53716C5365727665722E5365727665722E53797374656D446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038391053797374656D4461746141636365737301000000815301000500540E044E616D650A4E65775072657061726554020949734D757461746F720054020A4F6E4E756C6C43616C6C005455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730100000054557F4D6963726F736F66742E53716C5365727665722E5365727665722E53797374656D446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038391053797374656D44617461416363657373010000003001000300540E044E616D6509556E5072657061726554020949734D757461746F720154020A4F6E4E756C6C43616C6C014201000400540E044E616D6508507265706172656454020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C013D01000300540E044E616D65165265676973746572446570656E646564506172616D7354020949734D757461746F720154020A4F6E4E756C6C43616C6C011001000B5544542E54506172616D7300000501000000000C01000754506172616D7300000C010007322E302E302E3200000801000200000000000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F77730100000000005F1C2853000000000200000070000000243F000024210000525344535A61464AF986B245ACAFF8F33BFAECE306000000443A5C576F726B5C50726F6A656374735C457874656E6465642053746F7265642050726F636564757265735C53716C2E5544542E54506172616D735C6F626A5C52656C656173655C5544542E54506172616D732E70646200BC3F00000000000000000000DE3F0000002000000000000000000000000000000000000000000000D03F00000000000000000000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF250020400000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058400000980200000000000000000000980234000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000002000200000000000200020000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004F8010000010053007400720069006E006700460069006C00650049006E0066006F000000D4010000010030003000300030003000340062003000000040000C000100460069006C0065004400650073006300720069007000740069006F006E00000000005500440054002E00540050006100720061006D0073000000300008000100460069006C006500560065007200730069006F006E000000000032002E0030002E0030002E003200000040001000010049006E007400650072006E0061006C004E0061006D00650000005500440054002E00540050006100720061006D0073002E0064006C006C0000002800020001004C006500670061006C0043006F0070007900720069006700680074000000200000004800100001004F0072006900670069006E0061006C00460069006C0065006E0061006D00650000005500440054002E00540050006100720061006D0073002E0064006C006C000000300008000100500072006F0064007500630074004E0061006D00650000000000540050006100720061006D0073000000340008000100500072006F006400750063007400560065007200730069006F006E00000032002E0030002E0030002E003200000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000032002E0030002E0030002E00320000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000C000000F03F00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
WITH PERMISSION_SET = SAFE

GO
/****** Object:  SqlAssembly [UDT.TParams.XmlSerializers]    Script Date: 16.01.2015 12:15:04 ******/
CREATE ASSEMBLY [UDT.TParams.XmlSerializers]
FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300601C28530000000000000000E00002210B010800001000000006000000000000AE2E0000002000000040000000004000002000000002000004000000000000000400000000000000008000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000602E00004B00000000400000F002000000000000000000000000000000000000006000000C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000B40E0000002000000010000000020000000000000000000000000000200000602E72737263000000F0020000004000000004000000120000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000001600000000000000000000000000004000004200000000000000000000000000000000902E000000000000480000000200050098220000C80B00000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000E602280700000A032D11027201000070720F000070280800000A2A02280900000A0203740E0000017201000070720F0000701717280A00000A2A062A1E02280B00000A2A133003006A00000001000011140A02280C00000A6F0D00000A2602280C00000A6F0E00000A17334002280C00000A6F0F00000A027B02000004332602280C00000A6F1000000A027B01000004331302731100000A281200000A740E0000010A2B1302281300000A7A02147211000070281400000A062A062ADE0202280C00000A6F1500000A720F0000706F1600000A7D010000040202280C00000A6F1500000A72010000706F1600000A7D020000042A1E02281700000A2A1A73070000062A1A73030000062A1E02281800000A2A46037201000070720F0000706F1900000A2A36047402000002036F010000062A320374030000026F040000062A1E02280A0000062A1A73070000062A1A73030000062A000000133003003400000002000011027B030000042D25731A00000A0A067221000070725D0000706F1B00000A027B030000042D0702067D03000004027B030000042A133003003400000002000011027B040000042D25731A00000A0A06722100007072770000706F1B00000A027B040000042D0702067D04000004027B040000042A133003003400000002000011027B050000042D25731A00000A0A067221000070730E0000066F1C00000A027B050000042D0702067D05000004027B050000042A4603D00E000001281D00000A3302172A162A5603D00E000001281D00000A3306730E0000062A142A1E02281E00000A2A42534A4201000100000000000C00000076322E302E35303732370000000005006C00000008040000237E0000740400007405000023537472696E677300000000E809000094000000235553007C0A00001000000023475549440000008C0A00003C01000023426C6F6200000000000000020000015715A2010900000000FA0133001600000100000013000000060000000500000016000000070000001E0000000500000002000000010000000500000005000000010000000300000000000A000100000000000600EE00D50006000501D50006001C01D50006002A01D5000600AB01CA000A000C02F9010A007D0276020600D502D5000A000503F3020A002E031E030A004B031E030A00910371030A00B10371030E0037042F0406003F04D50006006204CA000A00B90476020600EA04CA000A005005760200000000010000000000010001000100100029004700050001000100010010007500470009000100040081001000930047000D000300080001011000A2004700100003000B0001001000B4004700110003000F0001007501170001007E011700010016023700010032023700010050023700502000000000860046010A0001008A2000000000C40054010F0002008C2000000000861862010F00020094200000000086006801130002000A2100000000C40054010F0002000C2100000000C40089010F000200442100000000861862010F0002004C2100000000C40091011A000200532100000000C4009E011F0002005A2100000000841862010F000200622100000000C600B50124000200742100000000C400C4012A000300822100000000C400CE01310005008F2100000000861862010F000600972100000000C608DA011A0006009E2100000000C608E5011F000600A82100000000C60822023B000600E82100000000C6083F023B000600282200000000C60861023B000600682200000000C6008202400006007A2200000000C6008F0246000700902200000000861862010F00080000000100EA03000001000905000001002205000002003405000001003B05000001004B05000001004B05410062010F00490062015C00510062010F00590062010F00610062016100690062010F000900EC030F000900FF036600090013040F00090050046C00090062010F001100DA01760029006E047B0029007C047B00290089048000290097048000710062010F001100A80484001100C3048B001100DE0490002900F7049A00910005059F00110062010F00190062010F0029001305A400310062010F0031004205AA0031000505AA0039006205B500210062010F002E000B00BC002E001B000C012E0023000C012E002B0011012E0033001A019600B0000600010000009D024D000000A40252000000AB0257000000B70257000000C402570002000F000300020010000500020011000700020012000900020013000B00048000000200000000000200000000000000CF0300000200000000000000000000000100CA00000000000200000000000000000000000100F00100000000020000000000020000000000000023040000000000000000003C4D6F64756C653E005544542E54506172616D732E586D6C53657269616C697A6572732E646C6C00586D6C53657269616C697A6174696F6E57726974657254506172616D73004D6963726F736F66742E586D6C2E53657269616C697A6174696F6E2E47656E657261746564417373656D626C7900586D6C53657269616C697A6174696F6E52656164657254506172616D7300586D6C53657269616C697A6572310054506172616D7353657269616C697A657200586D6C53657269616C697A6572436F6E74726163740053797374656D2E586D6C0053797374656D2E586D6C2E53657269616C697A6174696F6E00586D6C53657269616C697A6174696F6E57726974657200586D6C53657269616C697A6174696F6E52656164657200586D6C53657269616C697A657200586D6C53657269616C697A6572496D706C656D656E746174696F6E005772697465315F506172616D7300496E697443616C6C6261636B73002E63746F720052656164315F506172616D73006964325F4974656D006964315F506172616D7300496E6974494473004372656174655265616465720043726561746557726974657200586D6C5265616465720043616E446573657269616C697A650053657269616C697A6500446573657269616C697A65006765745F526561646572006765745F577269746572006D73636F726C69620053797374656D2E436F6C6C656374696F6E7300486173687461626C6500726561644D6574686F6473006765745F526561644D6574686F64730077726974654D6574686F6473006765745F57726974654D6574686F647300747970656453657269616C697A657273006765745F547970656453657269616C697A6572730053797374656D00547970650043616E53657269616C697A650047657453657269616C697A6572005265616465720057726974657200526561644D6574686F64730057726974654D6574686F647300547970656453657269616C697A65727300586D6C53657269616C697A657256657273696F6E4174747269627574650053797374656D2E5265666C656374696F6E00417373656D626C7956657273696F6E4174747269627574650053797374656D2E53656375726974790053656375726974795472616E73706172656E7441747472696275746500416C6C6F775061727469616C6C795472757374656443616C6C6572734174747269627574650053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C697479417474726962757465005544542E54506172616D732E586D6C53657269616C697A657273006F0057726974655374617274446F63756D656E740057726974654E756C6C5461674C69746572616C00546F704C6576656C456C656D656E74005544542E54506172616D730053716C2E5544540054506172616D730049586D6C53657269616C697A61626C6500577269746553657269616C697A61626C6500586D6C4E6F646554797065004D6F7665546F436F6E74656E74006765745F4E6F646554797065006765745F4C6F63616C4E616D65006765745F4E616D657370616365555249005265616453657269616C697A61626C6500457863657074696F6E00437265617465556E6B6E6F776E4E6F6465457863657074696F6E00556E6B6E6F776E4E6F646500586D6C4E616D655461626C65006765745F4E616D655461626C650041646400786D6C5265616465720049735374617274456C656D656E74006F626A656374546F53657269616C697A650077726974657200726561646572007365745F4974656D00747970650052756E74696D655479706548616E646C65004765745479706546726F6D48616E646C6500000D50006100720061006D0073000001000F3A0050006100720061006D007300003B530071006C002E005500440054002E00540050006100720061006D0073003A003A0050006100720061006D0073003A0054007200750065003A000019520065006100640031005F0050006100720061006D007300001B5700720069007400650031005F0050006100720061006D0073000000053AE65CB974B940B26A6FB598157E260008B77A5C561934E089042001011C032000010320001C02060E04200012090420001205052001021215062002011C12050520011C120903061219042000121905200102121D062001120D121D042800120904280012050428001219042001010E0420010108052002010E0E09200501123D0E0E0202042000121504200011410320000E062001123D123D0420001245052002011C0E0307011C04200012490420010E0E052002020E0E052002011C1C0407011219060001121D114D4F01000200540E10506172656E74417373656D626C7949642538303963636365332D656162612D346339332D396161642D3865356663396235303635352C540E0756657273696F6E07322E302E302E3004010000000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F777301000000882E000000000000000000009E2E0000002000000000000000000000000000000000000000000000902E00000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF2500204000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058400000940200000000000000000000940234000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000002000200000000000200020000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004F4010000010053007400720069006E006700460069006C00650049006E0066006F000000D001000001003000300030003000300034006200300000002C0002000100460069006C0065004400650073006300720069007000740069006F006E000000000020000000300008000100460069006C006500560065007200730069006F006E000000000032002E0030002E0030002E003200000060001F00010049006E007400650072006E0061006C004E0061006D00650000005500440054002E00540050006100720061006D0073002E0058006D006C00530065007200690061006C0069007A006500720073002E0064006C006C00000000002800020001004C006500670061006C0043006F00700079007200690067006800740000002000000068001F0001004F0072006900670069006E0061006C00460069006C0065006E0061006D00650000005500440054002E00540050006100720061006D0073002E0058006D006C00530065007200690061006C0069007A006500720073002E0064006C006C0000000000340008000100500072006F006400750063007400560065007200730069006F006E00000032002E0030002E0030002E003200000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000032002E0030002E0030002E0032000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C000000B03E00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
WITH PERMISSION_SET = SAFE

GO
/****** Object:  SqlAssembly [UDF.Pubs]    Script Date: 16.01.2015 12:15:04 ******/
CREATE ASSEMBLY [UDF.Pubs]
FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C0103001347A7510000000000000000E00002210B0108000048000000060000000000002E66000000200000008000000000400000200000000200000400000000000000040000000000000000C000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000E06500004B00000000800000480300000000000000000000000000000000000000A000000C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E7465787400000034460000002000000048000000020000000000000000000000000000200000602E72737263000000480300000080000000040000004A0000000000000000000000000000400000402E72656C6F6300000C00000000A0000000020000004E0000000000000000000000000000400000420000000000000000000000000000000010660000000000004800000002000500B03F0000302600000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000133004006D000000010000110F00280F00000A2D180F00281000000A6F1100000A7201000070281200000A2C02142A0F00281000000A6F1100000A0A731300000A0B170C160C2B2612030608176F1400000A7D010000041203081758687D0200000407096F1500000A081758680C08066F1600000A32D1072AB60302A5030000027B01000004281700000A81050000010402A5030000027B02000004281800000A81060000012A00133004001C010000020000110F00280F00000A2D200F00281000000A6F1100000A7201000070281200000A2D08036F1900000A2C02142A0F00281000000A036F1A00000A6F1B00000A0A731C00000A0B731D00000A0C170D06130616130738B8000000110611079A130511057201000070281200000A3A9A00000012041105281700000A7D040000041204097D030000040812047C04000004281000000A6F1E00000A6F1F00000A1632470F00281000000A6F1600000A20E80300003117720300007011057227000070282000000A732100000A7A72030000701105723D00007002282200000A282300000A732100000A7A0711046F2400000A0812047C04000004281000000A6F1E00000A6F2500000A0917580D110717581307110711068E693F3DFFFFFF072AA20302A5040000027B0400000481050000010402A5040000027B03000004282600000A81080000012A0000001330040086010000030000110F00280F00000A2D200F00281000000A6F1100000A7201000070281200000A2D08036F1900000A2C02142A0F00281000000A036F1A00000A6F1B00000A0A732700000A0B731D00000A0C170D0613071613083822010000110711089A130511057201000070281200000A3A04010000110572570000706F2800000A186F2900000A130611068E69173FE60000001204097D0500000412041106169A281700000A7D0600000411068E69172E101106179A7201000070281200000A2C0F120414281700000A7D070000042B1012041106179A281700000A7D070000040812047C06000004281000000A6F1E00000A6F1F00000A16325B0F00281000000A6F1600000A20E80300003121720300007012047C06000004281000000A7227000070282000000A732100000A7A720300007012047C06000004281000000A723D00007002282200000A282300000A732100000A7A0711046F2A00000A0812047C06000004281000000A6F1E00000A6F2500000A0917580D110817581308110811078E693FD3FEFFFF072AE60302A5050000027B0600000481050000010402A5050000027B0700000481050000010502A5050000027B05000004282600000A81080000012A13300400F6010000040000110F00280F00000A2D280F00281000000A6F1100000A7201000070281200000A2D10036F1900000A2D08046F1900000A2C02142A0F00281000000A036F1A00000A6F1B00000A0A732B00000A0B731D00000A0C170D06130916130A388A0100001109110A9A130511057201000070281200000A3A6C010000110572570000706F2800000A186F2900000A130611068E69183F4E0100001106179A046F1A00000A186F2900000A1307198D1B000001130B110B161106169AA2110B171107169AA2110B181107179AA2110B130811088E69193F0E0100001204097D0800000412041108169A281700000A7D090000041108179A7201000070281200000A2C0F120414281700000A7D0A0000042B1012041108179A281700000A7D0A0000041108189A7201000070281200000A2C0F120414281700000A7D0B0000042B1012041108189A281700000A7D0B0000040812047C09000004281000000A6F1E00000A6F1F00000A16325B0F00281000000A6F1600000A20E80300003121720300007012047C09000004281000000A7227000070282000000A732100000A7A720300007012047C09000004281000000A723D00007002282200000A282300000A732100000A7A0711046F2C00000A0812047C09000004281000000A6F1E00000A6F2500000A0917580D110A1758130A110A11098E693F6BFEFFFF072A0000033002004B000000000000000302A5060000027B0900000481050000010402A5060000027B0A00000481050000010502A5060000027B0B00000481050000010E0402A5060000027B08000004282600000A81080000012A00133004002D020000050000110F00280F00000A2D280F00281000000A6F1100000A7201000070281200000A2D10036F1900000A2D08046F1900000A2C02142A732D00000A0A0F00281000000A036F1A00000A6F1B00000A0B731D00000A0C170D07130916130A38C10100001109110A9A130511057201000070281200000A3AA3010000110572570000706F2800000A186F2900000A130611068E69183F850100001106179A046F1A00000A196F2900000A13071A8D1B000001130B110B161106169AA2110B171107169AA2110B181107179AA2110B191107189AA2110B130811088E691A3F3D0100001204097D0C00000412041108169A281700000A7D0D0000041108179A7201000070281200000A2C0F120414281700000A7D0E0000042B1012041108179A281700000A7D0E0000041108189A7201000070281200000A2C0F120414281700000A7D0F0000042B1012041108189A281700000A7D0F0000041108199A7201000070281200000A2C0F120414281700000A7D100000042B1012041108199A281700000A7D100000040812047C0D000004281000000A6F1E00000A6F1F00000A16325B0F00281000000A6F1600000A20E80300003121720300007012047C0D000004281000000A7227000070282000000A732100000A7A720300007012047C0D000004281000000A723D00007002282200000A282300000A732100000A7A0611046F2E00000A0812047C0D000004281000000A6F1E00000A6F2500000A0917580D110A1758130A110A11098E693F34FEFFFF062A000000033002005D000000000000000302A5070000027B0D00000481050000010402A5070000027B0E00000481050000010502A5070000027B0F00000481050000010E0402A5070000027B1000000481050000010E0502A5070000027B0C000004282600000A81080000012A0000001330040097000000060000110F00280F00000A2D200F00281000000A6F1100000A7201000070281200000A2D08046F1900000A2C0714281700000A2A0F00281000000A046F1A00000A6F1B00000A0A068E69282600000A03282F00000A25283000000A2D1F060F01283100000A17599A7201000070283200000A283300000A283400000A283500000A2C11060F01283100000A17599A281700000A2A14281700000A2A0013300300B5000000070000110F00280F00000A2D200F00281000000A6F1100000A7201000070281200000A2D08046F1900000A2C0714281700000A2A0F00281000000A046F1A00000A6F1B00000A0A160B0613051613062B56110511069A0C087201000070281200000A2D3D0872570000706F2800000A186F2900000A0D09169A6F1E00000A0F01281000000A6F1E00000A281200000A2C0C09179A281700000A1304DE190717580B110617581306110611058E6932A214281700000A2A11042A000000133004006901000008000011056F1900000A2D0A056F3600000A176A2E0B725B000070732100000A7A056F3700000A13061206281000000A0A0F00280F00000A2D090F00281000000A2B01140B0F01280F00000A2D090F01281000000A2B01140C0F02280F00000A2D090F02281000000A2B01140D07283800000A2D08056F1900000A2C1208725700007009282000000A733900000A2A0607283A00000A06087257000070282000000A176F3B00000A13041104163F8900000007161104086F1600000A5872570000706F1600000A586F1400000A076F1600000A086F1600000A58096F1600000A58733C00000A13051105096F3D00000A2607061104086F1600000A5872570000706F1600000A586F3E00000A1304110416321B1105066F3D00000A26110507110417586F3F00000A6F3D00000A2611056F1100000A281700000A2A1B8D1B000001130711071607A211071706A211071808A21107197257000070A211071A09A21107284000000A281700000A2A000000133004003001000009000011027E4100000A6F4200000A2D0D037E4100000A6F4200000A2C067E4100000A2A026F4300000A036F4300000A2E067E4100000A2A027422000001036F4400000A0A0F02281000000A250B39DB000000FE137E180000042D611D734600000A25725700007016284700000A2572A700007017284700000A2572AD00007018284700000A2572B300007019284700000A2572B70000701A284700000A2572BB0000701B284700000A2572C10000701C284700000AFE138018000004FE137E18000004071202284800000A2C60084507000000020000000A000000120000001A000000230000002C000000350000002B3C062D02052A0E042A062C02052A0E042A062C02052A0E042A06163102052A0E042A06162F02052A0E042A06163202052A0E042A06163002052A0E042A7E4100000A2A13300800760500000A0000110F00280F00000A2D090F01284900000A2C0A1200FE1509000001062A0F00281000000A250B3935050000FE137E190000043ACC0100001F23734600000A2572C700007016284700000A2572D100007017284700000A2572D700007018284700000A2572E100007019284700000A2572F10000701A284700000A2572F70000701B284700000A2572FB0000701C284700000A2572070100701D284700000A25720D0100701E284700000A2572110100701F09284700000A2572250100701F0A284700000A25722B0100701F0B284700000A25722F0100701F0C284700000A2572370100701F0D284700000A25723D0100701F0E284700000A2572410100701F0F284700000A25724B0100701F10284700000A2572510100701F11284700000A2572570100701F12284700000A2572670100701F13284700000A25726D0100701F14284700000A2572710100701F15284700000A25727B0100701F16284700000A2572810100701F17284700000A25728F0100701F18284700000A2572950100701F19284700000A2572990100701F1A284700000A2572A70100701F1B284700000A2572AD0100701F1C284700000A2572B10100701F1D284700000A2572C90100701F1E284700000A2572CF0100701F1F284700000A2572E70100701F20284700000A2572EF0100701F21284700000A2572050200701F22284700000AFE138019000004FE137E19000004071202284800000A39490300000845230000000500000005000000050000001C0000001C0000001C0000004B0000004B0000004B0000007200000072000000720000008A0000008A0000008A000000C0000000C0000000C000000009010000090100000901000032010000320100007A0100007A0100007A010000D1010000D1010000D10100003702000037020000B3020000B3020000B5020000B502000038B20200000F01284A00000A0D1203284B00000A1717734C00000A2A0F01284A00000A13041204284B00000A0F01284A00000A13051205284D00000A1858195B195A185917734C00000A2A0F01284A00000A13061206284B00000A0F01284A00000A13071207284D00000A17734C00000A2A0F01284A00000A13081208284B00000A1717734C00000A2A0F01284A00000A13091209284E00000A734F00000A2A0F01284A00000A130A120A23000000000000F0BF285000000A285100000A10010F01284A00000A130B120B285200000A1733CD0F01284A00000A130C120C284E00000A734F00000A2A0F01284A00000A130D120D23000000000000F0BF285000000A285100000A10010F01284A00000A130E120E285200000A1733CD0F01284A00000A130F120F284E00000A734F00000A2A0F01284A00000A13101210284B00000A0F01284A00000A13111211284D00000A0F01284A00000A13121212285300000A0F01284A00000A13131213285400000A1616735500000A2A0F01284A00000A13141214284B00000A0F01284A00000A13151215284D00000A0F01284A00000A13161216285300000A0F01284A00000A13171217285400000A0F01284A00000A13181218285600000A16735500000A2A0F01284A00000A13191219284B00000A0F01284A00000A131A121A284D00000A0F01284A00000A131B121B285300000A0F01284A00000A131C121C285400000A0F01284A00000A131D121D285600000A0F01284A00000A131E121E285700000A735500000A2A0F01284A00000A131F121F284B00000A0F01284A00000A13201220284D00000A0F01284A00000A13211221285300000A0F01284A00000A13221222285400000A0F01284A00000A13231223285600000A0F01284A00000A13241224285700000A0F01284A00000A13251225285800000A20E80300005A735900000A2A032A032A720B0200700F00281000000A285A00000A735B00000A7A000013300800BC0600000B0000110F00280F00000A2D090F01284900000A2C0A1200FE1509000001062A0F00281000000A250B397B060000FE137E1A0000043ACC0100001F23734600000A2572C700007016284700000A2572D100007017284700000A2572D700007018284700000A2572E100007019284700000A2572F10000701A284700000A2572F70000701B284700000A2572FB0000701C284700000A2572070100701D284700000A25720D0100701E284700000A2572110100701F09284700000A2572250100701F0A284700000A25722B0100701F0B284700000A25722F0100701F0C284700000A2572370100701F0D284700000A25723D0100701F0E284700000A2572410100701F0F284700000A25724B0100701F10284700000A2572510100701F11284700000A2572570100701F12284700000A2572670100701F13284700000A25726D0100701F14284700000A2572710100701F15284700000A25727B0100701F16284700000A2572810100701F17284700000A25728F0100701F18284700000A2572950100701F19284700000A2572990100701F1A284700000A2572A70100701F1B284700000A2572AD0100701F1C284700000A2572B10100701F1D284700000A2572C90100701F1E284700000A2572CF0100701F1F284700000A2572E70100701F20284700000A2572EF0100701F21284700000A2572050200701F22284700000AFE13801A000004FE137E1A000004071202284800000A398F0400000845230000000500000005000000050000001E0000001E0000001E0000004D0000004D0000004D000000760000007600000076000000900000009000000090000000D8000000D8000000D80000003201000032010000320100006C0100006C010000B6010000B6010000B60100000F0200000F0200000F0200007702000077020000F9020000F90200007B0300007B03000038F80300000F01284A00000A0D1203284B00000A17581717734C00000A2A0F01284A00000A13041204284B00000A0F01284A00000A13051205284D00000A1858195B195A175817734C00000A2A0F01284A00000A13061206284B00000A0F01284A00000A13071207284D00000A175817734C00000A2A0F01284A00000A13081208284B00000A17581717734C00000A2A0F01284A00000A13091209284E00000A130A120A23000000000000F03F285000000A734F00000A2A0F01284A00000A130B120B23000000000000F03F285000000A285100000A10010F01284A00000A130C120C285200000A2DCE0F01284A00000A130D120D284E00000A130E120E23000000000000F03F285000000A734F00000A2A0F01284A00000A130F120F23000000000000F03F285000000A285100000A10010F01284A00000A13101210285200000A2DCE0F01284A00000A13111211284E00000A1312121223000000000000F03F285000000A734F00000A2A0F01284A00000A13131213284B00000A0F01284A00000A13141214284D00000A0F01284A00000A13151215285300000A0F01284A00000A13161216285400000A17581616735500000A2A0F01284A00000A13171217284B00000A0F01284A00000A13181218284D00000A0F01284A00000A13191219285300000A0F01284A00000A131A121A285400000A0F01284A00000A131B121B285600000A175816735500000A2A0F01284A00000A131C121C284B00000A0F01284A00000A131D121D284D00000A0F01284A00000A131E121E285300000A0F01284A00000A131F121F285400000A0F01284A00000A13201220285600000A0F01284A00000A13211221285700000A1758735500000A2A0F01284A00000A13221222284B00000A0F01284A00000A13231223284D00000A0F01284A00000A13241224285300000A0F01284A00000A13251225285400000A0F01284A00000A13261226285600000A0F01284A00000A13271227285700000A0F01284A00000A13281228285800000A20E80300005A20B80B000058735900000A2A0F01284A00000A13291229284B00000A0F01284A00000A132A122A284D00000A0F01284A00000A132B122B285300000A0F01284A00000A132C122C285400000A0F01284A00000A132D122D285600000A0F01284A00000A132E122E285700000A0F01284A00000A132F122F285800000A20E80300005A20B80B000058735900000A2A0F01284A00000A13301230284B00000A0F01284A00000A13311231284D00000A0F01284A00000A13321232285300000A0F01284A00000A13331233285400000A0F01284A00000A13341234285600000A0F01284A00000A13351235285700000A0F01284A00000A13361236285800000A20E80300005A20B80B000058735900000A2A720B0200700F00281000000A285A00000A735B00000A7A0330030069000000000000000F00280F00000A2D180F00281000000A6F1100000A7201000070281200000A2C02142A036F1900000A2D17036F1A00000A6F1100000A7201000070281200000A2C140F00281000000A036F1A00000A176F2900000A2A0F00281000000A036F1A00000A6F1B00000A2A4A03026F1100000A281700000A81050000012A6A02285C00000A2D10021F5B2E0B021F5D2E06021F5FFE012A172A8A2B0603254A175854034A026F1600000A2F0F02034A6F5D00000A285E00000A2DE12A0000133005006E0000000C0000110204281400000602044A6F5D00000A1F5B2E05031451162A044A0A160B2B1C02044A6F5D00000A1F5D33070716FE010B2B03072D1004254A175854044A026F1600000A32DA072D17727302007002066F3F00000A285A00000A735B00000A7A030206044A06596F1400000A51172A0000133005008C0000000D00001102042814000006044A026F1600000A2E0C02044A6F5D00000A1F282E05031451162A044A0A160B2B2B02044A6F5D00000A1F2833040717580B02044A6F5D00000A1F2933060717590B2B03072C1004254A175854044A026F1600000A32CB07163117727302007002066F3F00000A285A00000A735B00000A7A0302061758044A065918596F1400000A51172A13300500790000000E00001102052814000006041451020405281600000626054A026F1600000A3305031451162A02030528150000062C02172A054A0A2B1502054A6F5D00000A28130000062C1005254A175854054A026F1600000A32E1030206054A06596F1400000A5103507201000070281200000A2C03031451035014FE0116FE012A00000013300300570000000F00001102042814000006044A026F1600000A2E2702044A6F5D00000A28130000062D1802044A6F5D00000A1F282E0C02044A6F5D00000A1F293305031451162A0302044A6F5D00000A0A1200285F00000A5104254A175854172A001330040036010000100000110F00280F00000A2D1D0F00281000000A6F1100000A6F6000000A7201000070281200000A2C02142A736100000A0A0F00281000000A0B160C080D17130438E6000000080D071206120228180000062D2411042C0972E102007013062B1772E502007007096F3F00000A285A00000A735B00000A7A071207120228180000062D0F11042C0B1106130772E102007013060712051208120228170000062C7111062D1772E502007007096F3F00000A285A00000A735B00000A7A1209FE15080000021209066F6200000A17587D11000004120911057D14000004120911072C0411072B0572E10200707D13000004120911067D12000004120911087D150000040611096F6300000A1413061413052B1772E502007007096F3F00000A285A00000A735B00000A7A16130408076F1600000A3F0EFFFFFF062A00000330020071000000000000000302A5080000027B14000004281700000A81050000010402A5080000027B11000004282600000A81080000010502A5080000027B12000004281700000A81050000010E0402A5080000027B13000004281700000A81050000010E0502A5080000027B15000004281700000A81050000012A1E02286400000A2A5E02736800000A7D160000040272010000707D170000042A0000000330040069000000000000000F01280F00000A2D090F02280F00000A2C012A027B160000046F6900000A2D15027B160000040F01281000000A6F3D00000A262B26027B160000040F01FE16050000016F1100000A160F02281000000A6F6A00000A6F3D00000A26020F02281000000A7D170000042A000000033004005D0000000000000002037B170000047D17000004027B160000046F6900000A2C12027B170000047E6B00000A281200000A2C13027B16000004037B160000046F6C00000A262A027B16000004037B1600000416027B170000046F6D00000A6F6C00000A262AEA027B160000042C2B027B160000046F6900000A16311D027B1600000416027B160000046F6900000A6F6E00000A281700000A2A14281700000A2AB2032D0B721D030070736F00000A7A02036F7000000A737100000A7D1600000402036F7000000A7D170000042AB2032D0B726D010070736F00000A7A03027B160000046F1100000A6F7200000A03027B170000046F7200000A2A1E02286400000A2A000042534A4201000100000000000C00000076322E302E35303732370000000005006C000000340A0000237E0000A00A00005009000023537472696E677300000000F0130000240300002355530014170000100000002347554944000000241700000C0F000023426C6F620000000000000002000001571702080902000000FA253300160000010000002E0000000A0000001A0000002200000053000000010000007200000019000000100000000800000001000000020000000600000000000A0001000000000006007C0075000600830075000A00B40099000600D800C5000A00F900E4000A000F01E4000A002B01E4000A004201E4000A000C02E4000600F502E90206005003460306006203460306009D037E030600720460040600890460040600A60460040600C50460040600DE0460040600F704600406001205600406002D056004060046057E0306005A0560040600930573050600B30573050A00DA05990006000D06750006003B0620060600770675000A009F06E40006000707750006001F07750006002D07750006003A0775000600950773050600B00720060600F107750006001E0875000600740875000600A50275000600C8087E030600DE087E030600E90875000A00FF0899000A006D08990006002D097500000000000100000000000100010001001000170000000500010001000B0110001B000000090001001C000B01100023000000090003001C000B0110002D000000090005001C000B0110003C000000090008001C000B0110004C00000009000C001C000A0110005C000000090011001C000120100065000000050016001C0000000000500700000500180023000600A502E4000600AA02E7000600AA02EA000600B002ED000600AA02EA000600B602ED000600B002ED000600AA02EA000600B602ED000600B902ED000600C002ED000600AA02EA000600B602ED000600B902ED000600C002ED000600C702ED000600AA02EA000600CE02E4000600D802E4000600DD02E4000600E202E40001000303F10001001603E4001300BD07D5081300DD07D50813007E08D508502000000000960003010A000100C920000000009600180111000200F82000000000960034011C00050020220000000096004B01250007004C220000000096005C011C000A00DE230000000096006F0130000C00182400000000960085013E0010001C260000000096009901490013007426000000009600B0013E001800B028000000009600C4015A001B001C29000000009600DB016E002100C029000000009600E80179002400842A000000009600FA0184002700FC2B000000009600080291002B00382D00000000960018029B003000BC3200000000960024029B00320084390000000096002E021C003400F9390000000096003402A40036000C3A0000000091003D02AC003800273A0000000091004902B10039004C3A0000000091005302B8003B00C83A0000000091006202B8003E00603B0000000091007002C1004100E83B0000000091007D02B80045004C3C0000000096008F020A004800903D0000000096009502CC0049000D3E0000000086189F02E0004F00153E0000000086002603E0004F00303E0000000086002B03F5004F00A83E0000000086003603FD005100113F0000000086003C03030152004C3F00000000E6015D0308015200793F00000000E6016F030E015300A63F0000000086189F02E0005400000001007503000001007A0302000200A50202000300AA0200000100750300000200AA03000001007A0302000200B40302000300B80300000100750300000200AA03000001007A0302000200C00302000300C30302000400B80300000100750300000200AA0300000300C903000001007A0302000200C00302000300D80302000400DF0302000500B80300000100750300000200AA0300000300C903000001007A0302000200C00302000300D80302000400DF0302000500E60302000600B80300000100750300000200AA0200000300AA0300000100750300000200ED0300000300AA0300000100750300000200ED0300000300B00200000400AA0300000100F20300000200F70300000300FC03000004000604000005001004000001001B04000002002404000001001B0400000200240400000100750300000200AA03000001007A0302000200C30300000100290400000100B403000002002C0400000100B403020002003004000003002C0400000100B403020002003004000003002C0400000100B403020002003704020003003C04000004002C0400000100B403020002004204000003002C04000001007503000001007A0302000200DD0202000300AA0202000400CE0202000500D80202000600E20200000100C303000002004C04000001005604000001005C04000001005E0409000D0069009F02E00071009F02140179009F02140181009F02140189009F02140191009F02140199009F021401A1009F021401A9009F021401B1009F021901B9009F021401C1009F021E01C9009F02E000D1009F02E0002900EF0522022900FA052602090004062602D90014062A020C009F02E000D900420637020C004C063D02D9005006430229005B06540231005B065A023900EF0522023900FA055B03D9002E02600314009F02E0001C009F02E000D900670626021C006F067403D90065007A03E9009F021401290087068103D9006500870314004C063D021C004C063D0241005B06A60324009F02E000D90093065B03D9002E02C80424004C063D022C009F02E0002C004C063D0234009F02E00034004C063D024100AA064908F100C00652084100FA054302D900C9062A02F1005B065808F100D7065E08F100E5065208390050067A083900ED060301D900F9067E0829009F021401D90065008308D9006F06890851009F029008510018079608D9006F069C08D9004206A208D9006500A7080101B002BB0809002607C00809003207C50811014607CB0819019F02E0003C009F021E013C004C06E6083C00D107EE084900EF0522024900FA05C2092901FA07430249009F02C80929010308430229010D08C20949009F02CF0929011608D60949005B06DD0929012808E50929013608430229013E08430249009F02EB0929014708430229015208430229015D08430249009F02F509D9006D08000A39019F02140141019208AC00D900A208C40C4101AC08AC00410104062602D900B908260244009F02E0004400BE08430244004C063D0209009F02E00049019F022E0E59019F02E00061019F02350E51009F02E000510050064302D90020099E0ED9002709E40051001807A40E51002009AA0E51000406370271019F02140159004309260251009F02140161006F0314012000730023012E005300C30E2E006B00EA0E2E004300C30E2E006300E10E2E002300C30E2E003B00C90E2E001B00C30E2E001300B10E2E002B00C30E2E003300B10E600073006002A0007300AC03E0007300E904200173003C0623013B033C0E43012B02D00860017300A50780017300A507A0017300A507C0017300A507E0017300FD0800027300760A20027300DD0B20037300DB0C47028F03D0041D06860767086C08AD08F708060A390BC90CCE0CD30CD70C1B0E300267036E03C10416067F07DE08140E048000000100000022136974000000000000D105000002000000000000000000000001006C000000000002000000000000000000000001008D000000000003000200040002000500020006000200070002000800020000000000003C4D6F64756C653E005544462E507562732E646C6C005075620043686172526F7700537472696E67526F7700537472696E67526F774E616D656400537472696E67526F774E616D65643200537472696E67526F774E616D65643300436F646573526F7700436F6E636174006D73636F726C69620053797374656D004F626A6563740056616C7565547970650053797374656D2E44617461004D6963726F736F66742E53716C5365727665722E536572766572004942696E61727953657269616C697A650053797374656D2E436F6C6C656374696F6E730049456E756D657261626C650053797374656D2E446174612E53716C54797065730053716C537472696E6700466F7265616368436861720053716C496E74313600537472696E67546F43686172536574526F770053716C4368617273004172726179546F526F775365740053716C496E743332004172726179546F526F77536574526F77004172726179546F526F775365744E616D6564004172726179546F526F775365744E616D6564526F77004172726179546F526F775365744E616D656432004172726179546F526F775365744E616D6564526F7732004172726179546F526F775365744E616D656433004172726179546F526F775365744E616D6564526F7733004578747261637456616C756500457874726163744E616D656456616C7565005365744E616D656456616C7565004949460053716C4461746554696D6500506572696F64426567696E00506572696F64456E640053706C69740053706C6974526F770049734964656E744368617200536B6970537061636500547279506172736551756F746564005472795061727365506172616D005472795061727365436F64650054727950617273654F7065726174696F6E00436F64657300436F646573526F7773002E63746F72004368617200496E6465780056616C75650049640056616C7565310056616C7565320056616C756533004F7065726174696F6E005369676E00436F646500506172616D730053797374656D2E5465787400537472696E674275696C64657200696E7465726D656469617465526573756C7400736570617261746F72526573756C7400496E697400416363756D756C617465004D65726765005465726D696E6174650053797374656D2E494F0042696E61727952656164657200526561640042696E617279577269746572005772697465005465787400726F770053797374656D2E52756E74696D652E496E7465726F705365727669636573004F757441747472696275746500536570617261746F720073747200736F72745F69640069640076616C75650056616C7565536570617261746F720076616C7565310076616C7565320076616C756533004E616D650041726731004172673200436F6E646974696F6E005472756556616C75650046616C736556616C7565006461746570617274006461746500636800706F7300726573756C7400636F646500706172616D006F7065726174696F6E00736570617261746F72006F74686572007200770053797374656D2E5265666C656374696F6E00417373656D626C795469746C6541747472696275746500417373656D626C794465736372697074696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E41747472696275746500417373656D626C79436F6D70616E7941747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C7943756C7475726541747472696275746500436F6D56697369626C6541747472696275746500417373656D626C7956657273696F6E4174747269627574650053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C697479417474726962757465005544462E507562730053716C46756E6374696F6E417474726962757465006765745F49734E756C6C006765745F56616C756500546F537472696E6700537472696E67006F705F457175616C6974790053797374656D2E436F6C6C656374696F6E732E47656E65726963004C697374603100537562737472696E6700416464006765745F4C656E677468006F705F496D706C6963697400546F557070657200496E6465784F660053797374656D457863657074696F6E006F705F4578706C6963697400546F4368617241727261790053716C426F6F6C65616E006F705F477265617465725468616E4F72457175616C006F705F46616C7365006F705F496E657175616C697479006F705F42697477697365416E64006F705F5472756500546F53716C537472696E670049734E756C6C4F72456D70747900537472696E67436F6D70617269736F6E00417070656E640044424E756C6C00457175616C73005479706500476574547970650049436F6D70617261626C6500436F6D70617265546F003C50726976617465496D706C656D656E746174696F6E44657461696C733E7B38424638353946312D443833432D343637422D383535392D4533373933453541344538367D00436F6D70696C657247656E6572617465644174747269627574650044696374696F6E61727960320024246D6574686F643078363030303030652D310054727947657456616C75650024246D6574686F643078363030303030662D31004461746554696D65006765745F59656172006765745F4D6F6E7468006765745F446174650041646444617973004461794F665765656B006765745F4461794F665765656B006765745F446179006765745F486F7572006765745F4D696E757465006765745F5365636F6E64006765745F4D696C6C697365636F6E6400466F726D617400457863657074696F6E0024246D6574686F643078363030303031302D310049734C65747465724F724469676974006765745F436861727300497357686974655370616365005472696D006765745F436F756E74005374727563744C61796F7574417474726962757465004C61796F75744B696E640053657269616C697A61626C654174747269627574650053716C55736572446566696E656441676772656761746541747472696275746500496E7365727400456D70747900417267756D656E744E756C6C457863657074696F6E0052656164537472696E670000000001002344006F00750062006C006900630061007400650020006900640020003D002000270001152700200069006E0020006100720072006100790001192700200069006E002000610072007200610079003A00200001033D00004B570072006F006E0067002000760061006C0075006500200066006F007200200070006100720061006D0065007400650072002000270053006500700061007200610074006F007200270001053C003E00000521003D0000033E0000033C0000053E003D0000053C003D000009790065006100720000057900790000097900790079007900000F710075006100720074006500720000057100710000037100000B6D006F006E007400680000056D006D0000036D0000136400610079006F00660079006500610072000005640079000003790000076400610079000005640064000003640000097700650065006B00000577006B00000577007700000F7700650065006B0064006100790000056400770000037700000968006F0075007200000568006800000D6D0069006E0075007400650000056D00690000036E00000D7300650063006F006E0064000005730073000003730000176D0069006C006C0069007300650063006F006E00640000056D00730000176D006900630072006F007300650063006F006E00640000076D006300730000156E0061006E006F007300650063006F006E00640000056E007300006727007B0030007D00270020003D04350420004F0432043B044F043504420441044F0420003804370432043504410442043D044B043C0420003F043004400430043C043504420440043E043C04200050006500720069006F00640042006500670069006E002E00016D55006E0063006C006F007300650064002000710075006F0074006100740069006F006E0020006D00610072006B0020006100660074006500720020007400680065002000630068006100720061006300740065007200200073007400720069006E00670020007B0030007D0000032B00003749006E0063006F00720072006500630074002000730079006E0074006100780020006E00650061007200200027007B0030007D0027000103720000000000F159F88B3CD87B468559E3793E5A4E860008B77A5C561934E089060001121111150A0003011C10111510111908000212111115121D0A0003011C1011151011210D0004011C1011151011151011210A000312111115121D121D100005011C101115101115101115101121130006011C1011151011151011151011151011210A0003111511151121121D0A0003111511151115121D0C00041115111511151115121D0900051C1C1C11151C1C080002112511151125070002011C1011150400010203060002010E1008080003020E100E10080A0004020E100E100E1008130006011C1011151011211011151011151011150320000102060E02060602060803061115030612290720020111151115052001011224042000111505200101122D052001011231042001010E0420010102042001010880FD01000400540E1146696C6C526F774D6574686F644E616D6512537472696E67546F43686172536574526F775455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A4461746141636365737300000000540E0F5461626C65446566696E6974696F6E215B636861725D206E636861722831292C205B696E6465785D20736D616C6C696E7454020F497344657465726D696E697374696301032000020320000E050002020E0E0615127101110C0520020E0808052001011300032000080C07040E15127101110C06110C05000111150E05000111190680F901000400540E1146696C6C526F774D6574686F644E616D65104172726179546F526F77536574526F775455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A4461746141636365737300000000540E0F5461626C65446566696E6974696F6E1F6964206E76617263686172286D6178292C205B736F72745F69645D20696E7454020F497344657465726D696E6973746963010420001D030620011D0E1D030615127101111005151271010E0520010813000600030E0E0E0E0500010E11150700040E0E0E0E0E1607081D0E151271011110151271010E0811100E1D0E08050001112108811301000400540E1146696C6C526F774D6574686F644E616D65154172726179546F526F775365744E616D6564526F775455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A4461746141636365737300000000540E0F5461626C65446566696E6974696F6E344E616D65206E76617263686172286D6178292C2056616C7565206E76617263686172286D6178292C205B496E6465785D20696E7454020F497344657465726D696E697374696301061512710111140720021D0E1D03081807091D0E151271011114151271010E0811140E1D0E1D0E08812B01000400540E1146696C6C526F774D6574686F644E616D65164172726179546F526F775365744E616D6564526F77325455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A4461746141636365737300000000540E0F5461626C65446566696E6974696F6E4B6964206E76617263686172286D6178292C2076616C756531206E76617263686172286D6178292C2076616C756532206E76617263686172286D6178292C205B736F72745F69645D20696E7454020F497344657465726D696E697374696301061512710111181E070C1D0E151271011118151271010E0811180E1D0E1D0E1D0E1D0E081D0E814101000400540E1146696C6C526F774D6574686F644E616D65164172726179546F526F775365744E616D6564526F77335455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A4461746141636365737300000000540E0F5461626C65446566696E6974696F6E616964206E76617263686172286D6178292C2076616C756531206E76617263686172286D6178292C2076616C756532206E76617263686172286D6178292C2076616C756533206E76617263686172286D6178292C205B736F72745F69645D20696E7454020F497344657465726D696E6973746963010615127101111C1E070C15127101111C1D0E151271010E08111C0E1D0E1D0E1D0E1D0E081D0E80A2010002005455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730000000054020F497344657465726D696E6973746963010800021179112111210500010211790500011179020800021179117911790407011D0E0D07071D0E080E1D0E11151D0E080320000A040001020E0500020E0E0E062002080E117D052002010E0805200112290E052002080E080420010E080500010E1D0E0D07080E0E0E0E08122911151D0E0406128081042001021C052000128085042001081C0401000000080615128091020E080715128091020E080720020113001301082002021300101301050703080E0880C301000400540E044E616D650C506572696F6420426567696E54020F497344657465726D696E697374696301540209497350726563697365015455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730000000005200011809506200301080808062001011180950620011180950D0700011125118095052000118099092006010808080808080A200701080808080808080500020E0E1C6F072611250E0811809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809580C101000400540E044E616D650A506572696F6420456E6454020F497344657465726D696E697374696301540209497350726563697365015455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730000000080A2073711250E0811809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809511809580E501000400540E1146696C6C526F774D6574686F644E616D650853706C6974526F775455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A4461746141636365737300000000540E0F5461626C65446566696E6974696F6E1376616C7565206E76617263686172286D61782954020F497344657465726D696E6973746963010420010308040702080204070208080307010803070103813701000400540E1146696C6C526F774D6574686F644E616D6509436F646573526F77735455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A4461746141636365737300000000540E0F5461626C65446566696E6974696F6E645B436F64655D206E76617263686172286D6178292C205B496E6465785D20696E742C205B4F7065726174696F6E5D206E766172636861722831292C205369676E206E766172636861722831292C205B506172616D735D206E76617263686172286D61782954020F497344657465726D696E6973746963010615127101112012070A1512710111200E0808020E0E0E0E1120062001011180A9062001011180B56101000200000004005402124973496E76617269616E74546F4E756C6C73015402174973496E76617269616E74546F4475706C696361746573005402124973496E76617269616E74546F4F726465720054080B4D61784279746553697A65FFFFFFFF0520020E080E05200112291C0620021229080E1101000C53716C2E5544462E50756273000005010000000017010012436F7079726967687420C2A920203230313000000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F7773010000000866000000000000000000001E660000002000000000000000000000000000000000000000000000106600000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF25002040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058800000F00200000000000000000000F00234000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000001006974221300000100697422133F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B00450020000010053007400720069006E006700460069006C00650049006E0066006F0000002C020000010030003000300030003000340062003000000044000D000100460069006C0065004400650073006300720069007000740069006F006E0000000000530071006C002E005500440046002E0050007500620073000000000040000F000100460069006C006500560065007200730069006F006E000000000031002E0030002E0034003800390038002E0032003900380030003100000000003C000D00010049006E007400650072006E0061006C004E0061006D00650000005500440046002E0050007500620073002E0064006C006C00000000004800120001004C006500670061006C0043006F007000790072006900670068007400000043006F0070007900720069006700680074002000A900200020003200300031003000000044000D0001004F0072006900670069006E0061006C00460069006C0065006E0061006D00650000005500440046002E0050007500620073002E0064006C006C00000000003C000D000100500072006F0064007500630074004E0061006D00650000000000530071006C002E005500440046002E0050007500620073000000000044000F000100500072006F006400750063007400560065007200730069006F006E00000031002E0030002E0034003800390038002E00320039003800300031000000000048000F00010041007300730065006D0062006C0079002000560065007200730069006F006E00000031002E0030002E0034003800390038002E00320039003800300031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000C000000303600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
WITH PERMISSION_SET = SAFE

GO
/****** Object:  SqlAssembly [UDF.Pubs2]    Script Date: 16.01.2015 12:15:04 ******/
CREATE ASSEMBLY [UDF.Pubs2]
FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C01030063525A520000000000000000E00002210B010800001A000000060000000000006E390000002000000040000000004000002000000002000004000000000000000400000000000000008000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000203900004B000000004000002803000000000000000000000000000000000000006000000C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E746578740000007419000000200000001A000000020000000000000000000000000000200000602E72737263000000280300000040000000040000001C0000000000000000000000000000400000402E72656C6F6300000C000000006000000002000000200000000000000000000000000000400000420000000000000000000000000000000050390000000000004800000002000500242B0000FC0D0000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000046027201000070280D00000A2D02022A142A0000133004007500000001000011150A160B2B6A03040617586F0E00000A0B071632110306175807065917596F0F00000A0C2B0A030617586F1000000A0C087203000070280D00000A2C0B7207000070731100000A7A086F1200000A16311D0250040804281300000A6F1400000A162F0B0225500804281300000A51070A07162F922A000000133003003000000002000011160A2B220306176F0F00000A0B0250076F1400000A162F0A02025007281500000A510617580A06036F1200000A32D52A13300400E2000000030000110F00281700000A2D0E0F00281800000A28010000062B01140A0F01281700000A2D0E0F01281800000A28010000062B01140B046F1900000A0D1203281800000A0C08281A00000A2D09086F1200000A172E0B7241000070731100000A7A06281A00000A2D1106086F1B00000A2D0807281A00000A2C0716281C00000A2A0672030000706F1B00000A2C0717281C00000A2A0616176F0F00000A08281D00000A2C080806281500000A0A06066F1200000A1759176F0F00000A08281D00000A2C080608281500000A0A06080708281300000A6F1400000A16FE0416FE01281C00000A2A00001330040007010000030000110F00281700000A2D0E0F00281800000A28010000062B01140A0F01281700000A2D0E0F01281800000A28010000062B01140B046F1900000A0D1203281800000A0C08281A00000A2D09086F1200000A172E0B7241000070731100000A7A07281A00000A2D0907086F1B00000A2C0706731E00000A2A06281A00000A2D0906086F1B00000A2C0707731E00000A2A0672030000706F1B00000A2D0D0772030000706F1B00000A2C0B7203000070731E00000A2A0616176F0F00000A08281D00000A2C080806281500000A0A06066F1200000A1759176F0F00000A08281D00000A2C080608281500000A0A1200070828020000060617066F1200000A18596F0F00000A731E00000A2A00133002005F000000040000110F00281700000A2D0E0F00281800000A28010000062B01140A0F01281700000A2D0E0F01281800000A28010000062B01140B07281A00000A2C0706731E00000A2A06281A00000A2C0707731E00000A2A120007280300000606731E00000A2A001330040057010000050000110F00281700000A2D090F00281800000A2B01140A0F01281700000A2D090F01281800000A2B01140B046F1900000A13071207281800000A0C08281A00000A2D09086F1200000A172E0B7241000070731100000A7A06281A00000A2D1A07281A00000A2D1206086F1B00000A2D0907086F1B00000A2C0714281F00000A2A0672030000706F1B00000A2C0707731E00000A2A0772030000706F1B00000A2C0706731E00000A2A066F1200000A076F1200000A58732000000A0D080708281300000A0B1513041613052B6D0608110417586F0E00000A130511051632150611041758110511045917596F0F00000A13062B0C06110417586F1000000A130611066F1200000A16312C0708110608281300000A6F1400000A16321A096F2100000A16310809086F2200000A260911066F2200000A26110513041105162F8E096F2100000A16310C096F2300000A731E00000A2A14281F00000A2A001330030092000000060000110F00281700000A2D090F00281800000A2B01140A0F01281700000A2D090F01281800000A2B01140B06281A00000A2D0807281A00000A2C0714281F00000A2A72010000701304160C2B210608176F0F00000A0D07096F1400000A16320A110409281500000A13040817580C08066F1200000A32D611046F1200000A16310D11046F2300000A731E00000A2A14281F00000A2A0000133004005C010000050000110F00281700000A2D090F00281800000A2B01140A0F01281700000A2D090F01281800000A2B01140B046F1900000A13071207281800000A0C08281A00000A2D09086F1200000A172E0B7241000070731100000A7A07281A00000A2D0907086F1B00000A2C02022A06281A00000A2D1606086F1B00000A2D0D0772030000706F1B00000A2C0714281F00000A2A0672030000706F1B00000A2C02022A066F1200000A076F1200000A3008076F1200000A2B06066F1200000A732000000A0D080708281300000A0B1513041613052B6D0608110417586F0E00000A130511051632150611041758110511045917596F0F00000A13062B0C06110417586F1000000A130611066F1200000A16312C0708110608281300000A6F1400000A162F1A096F2100000A16310809086F2200000A260911066F2200000A26110513041105162F8E096F2100000A16310C096F2300000A731E00000A2A14281F00000A2A1330040016010000070000110F00281700000A2D090F00281800000A2B01140A0F01281700000A2D090F01281800000A2B01140B046F1900000A13061206281800000A0C08281A00000A2D09086F1200000A172E0B7241000070731100000A7A06281A00000A2D1A07281A00000A2D1206086F1B00000A2D0907086F1B00000A2C0716281C00000A2A0672030000706F1B00000A2C0717732400000A2A0772030000706F1B00000A2C0717732400000A2A080708281300000A0B150D1613042B5506080917586F0E00000A13041104163213060917581104095917596F0F00000A13052B0B060917586F1000000A130511056F1200000A1631190708110508281300000A6F1400000A16320717281C00000A2A11040D1104162FA616281C00000A2A1E02282500000A2A7A0272010000707D010000040272010000707D0200000402167D030000042A00000013300300BC000000080000110F01281700000A2C012A0F02281700000A2D090F02281800000A2B01140A06281A00000A2D09066F1200000A172E0B7241000070731100000A7A027B020000046F1200000A2D1502067D0200000402027B020000047D010000042B19027B0200000406281D00000A2C0B728D000070731100000A7A027B030000042D3E0F01281800000A7203000070280D00000A2C130272010000707D0100000402177D030000042A027C010000040F01281800000A027B0200000428020000062A033003008D00000000000000037B020000046F1200000A2D012A027B020000046F1200000A2D1902037B020000047D0200000402037B010000047D010000042A027B02000004037B02000004281D00000A2C0B728D000070731100000A7A027B030000042D32037B030000042C130272010000707D0100000402177D030000042A027C01000004037B01000004027B0200000428020000062A000000033004004F00000000000000027B030000042C0B7203000070281F00000A2A027B010000042C2D027B010000046F1200000A18311F027B0100000417027B010000046F1200000A18596F0F00000A281F00000A2A14281F00000A2ACE032D0B7203010070732800000A7A02036F2900000A7D0300000402036F2A00000A7D0100000402036F2A00000A7D020000042ACE032D0B7207010070732800000A7A03027B030000046F2B00000A03027B010000046F2C00000A03027B020000046F2C00000A2A1E02282500000A2A320272010000707D040000042A760F01281700000A2C012A027C040000040F01281800000A28030000062A4A027C04000004037B0400000428030000062AA6027B040000042C1A027B040000046F1200000A16310C027B04000004281F00000A2A14281F00000A2A6E032D0B7203010070732800000A7A02036F2A00000A7D040000042A6E032D0B7207010070732800000A7A03027B040000046F2C00000A2A1E02282500000A2A0042534A4201000100000000000C00000076322E302E35303732370000000005006C00000040050000237E0000AC050000D804000023537472696E677300000000840A00000C01000023555300900B0000100000002347554944000000A00B00005C02000023426C6F620000000000000002000001571702000900000000FA253300160000010000001B00000004000000040000001900000022000000020000002C0000001300000008000000010000000200000000000A00010000000000060045003E000A00730058000A00C800B3000A00D300B3000A00DD00B300060088017E0106009A017E0106000F02FD0106002602FD0106004302FD0106006202FD0106007B02FD0106009402FD010600AF02FD010600CA02FD0106000203E30206001603FD0106004F032F0306006F032F03060097033E000600BC033E000A00DE03580006004F04430406006D043E000A00830458000A00A40458000600AB043E0000000000010000000000010001000100100018000000050001000100012010001C000000050001000C00012010002500000005000400130001004601410001004E014100010059014400010046014100502000000000910084000A000100642000000000960090000F000200E8200000000096009E00170005002421000000009600E6001E0007001422000000009600EE0029000A002823000000009600FA0034000D009423000000009600070129000F00F82400000000960012013400120098250000000096001E012900140000270000000096002D011E001700222800000000861840013D001A002A280000000086005E013D001A004C28000000008600630147001A0014290000000086006E014F001C00B029000000008600740155001D000B2A00000000E60195015A001D003F2A00000000E601A70160001E00732A00000000861840013D001F007B2A0000000086005E013D001F00882A000000008600630166001F00A62A0000000086006E016C002000B92A000000008600740155002100E32A00000000E60195015A002100FF2A00000000E601A701600022001B2B00000000861840013D00230000000100AD0100000100B30100000200C10100000300C90100000100D40100000200C10100000100DC0100000200E30100000300C90100000100D40100000200C10100000300C90100000100D40100000200C10100000100D40100000200C10100000300C90100000100D40100000200C10100000100D40100000200C10100000300C90100000100D40100000200C10100000300C90100000100EC0100000200C90100000100F30100000100F90100000100FB0100000100EC0100000100F30100000100F90100000100FB010300090004000900410040017200490040017200510040017200590040017200610040017200690040017200710040017200790040017200810040017700890040017200910040017C00990040013D00A1009E038100A100AA038700A100B2038D00A100B2039300A90040017200A100CC039800A100D7039C00A100AA03A300A100D703AE00B10040013D002100F3035D012100FE036101290008045500A10014046501A10022046A01190029046F01A10035048100210040017200210029048201B90040017C00B900CC039800B9005D048801090064046101190040017700090040013D00C10040013D00C9004001AE01D900400172003100C1045D013100CD0461013900A70177003900A70172002E000B001A022E0063003C022E002B001A022E005B0033022E001B002D022E0023002D022E0013002D022E0033002D022E003B002D022E004B002D0263003B01B4018000B300B90083003B01B401A000B300B900C000B300B900E000B300B9000001B300B9002001B300B9004001B300B900A800B40075017D018E019B01A30116020480000001000000AA1311540000000000008D030000020000000000000000000000010035000000000002000000000000000000000001004C00000000000000003C4D6F64756C653E005544462E50756273322E646C6C00507562004D6572676541676700436861725365744D65726765416767006D73636F726C69620053797374656D004F626A6563740053797374656D2E44617461004D6963726F736F66742E53716C5365727665722E536572766572004942696E61727953657269616C697A65004E756C6C4966456D70747900496E7465726E616C4D6572676500496E7465726E616C436861725365744D657267650053797374656D2E446174612E53716C54797065730053716C426F6F6C65616E0053716C537472696E670053716C436861727300496E4172726179004172726179734D6572676500436861725365744D65726765004172726179734A6F696E00436861725365744A6F696E00417272617973416E74694A6F696E00417272617973506F7369746976654A6F696E002E63746F72004F526573756C74004F536570617261746F72004F416E7900496E697400416363756D756C617465004D65726765005465726D696E6174650053797374656D2E494F0042696E61727952656164657200526561640042696E6172795772697465720057726974650056616C7565004151756F74656441727261793100414172726179320041536570617261746F720041417272617931004141727261790041456C656D656E74004156616C7565004F74686572007200770053797374656D2E5265666C656374696F6E00417373656D626C795469746C6541747472696275746500417373656D626C794465736372697074696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E41747472696275746500417373656D626C79436F6D70616E7941747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C7943756C747572654174747269627574650053797374656D2E52756E74696D652E496E7465726F70536572766963657300436F6D56697369626C6541747472696275746500417373656D626C7956657273696F6E4174747269627574650053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C697479417474726962757465005544462E507562733200537472696E67006F705F457175616C69747900496E6465784F6600537562737472696E670053797374656D457863657074696F6E006765745F4C656E67746800436F6E6361740053716C46756E6374696F6E417474726962757465006765745F49734E756C6C006765745F56616C756500546F53716C537472696E670049734E756C6C4F72456D70747900457175616C73006F705F496D706C69636974006F705F496E657175616C6974790053797374656D2E5465787400537472696E674275696C64657200417070656E6400546F537472696E670053657269616C697A61626C654174747269627574650053716C55736572446566696E656441676772656761746541747472696275746500466F726D617400417267756D656E744E756C6C457863657074696F6E0052656164426F6F6C65616E0052656164537472696E6700000100032A000039570072006F006E00670020006100720072006100790020006900740065006D002000760061006C007500650020003D00200027002A002700014B570072006F006E0067002000760061006C0075006500200066006F007200200070006100720061006D0065007400650072002000270053006500700061007200610074006F0072002700017550006100720061006D0065007400650072002000270053006500700061007200610074006F00720027002000630061006E006E006F00740020006200650020006300680061006E006700650064002000730069006E0063006500200069007400200063006F006D00700069006C00650064002E0001037200000377000000C7D69853071D23419B2D77DEF428B80A0008B77A5C561934E0890400010E0E07000301100E0E0E06000201100E0E0A0003110D1111111112150A000311111111111112150800021111111111110320000102060E020602072002011111111105200101120C042000111105200101121905200101121D052001011111052001011210042001010E04200101020420010108050002020E0E052002080E080520020E08080420010E08032000080600030E0E0E0E042001080E05070308080E0500020E0E0E040702080E80A2010002005455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730000000054020F497344657465726D696E697374696301032000020320000E040001020E042001020E050001110D020707040E0E0E11110407020E0E05000111110E052001125D0E0C07080E0E0E125D08080E11110707050E0E080E0E0A07070E0E0E08080E11110520010111696101000200000004005402124973496E76617269616E74546F4E756C6C73015402174973496E76617269616E74546F4475706C696361746573005402124973496E76617269616E74546F4F726465720054080B4D61784279746553697A65FFFFFFFF0307010E1201000D53716C2E5544462E507562733200000501000000000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F777301004839000000000000000000005E390000002000000000000000000000000000000000000000000000503900000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF2500204000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058400000D00200000000000000000000D00234000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000001001154AA13000001001154AA133F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B00430020000010053007400720069006E006700460069006C00650049006E0066006F0000000C020000010030003000300030003000340062003000000044000E000100460069006C0065004400650073006300720069007000740069006F006E0000000000530071006C002E005500440046002E0050007500620073003200000040000F000100460069006C006500560065007200730069006F006E000000000031002E0030002E0035003000330034002E0032003100350032003100000000003C000E00010049006E007400650072006E0061006C004E0061006D00650000005500440046002E00500075006200730032002E0064006C006C0000002800020001004C006500670061006C0043006F00700079007200690067006800740000002000000044000E0001004F0072006900670069006E0061006C00460069006C0065006E0061006D00650000005500440046002E00500075006200730032002E0064006C006C0000003C000E000100500072006F0064007500630074004E0061006D00650000000000530071006C002E005500440046002E0050007500620073003200000044000F000100500072006F006400750063007400560065007200730069006F006E00000031002E0030002E0035003000330034002E00320031003500320031000000000048000F00010041007300730065006D0062006C0079002000560065007200730069006F006E00000031002E0030002E0035003000330034002E003200310035003200310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000C000000703900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
WITH PERMISSION_SET = SAFE

GO
/****** Object:  SqlAssembly [UDF.RegExp]    Script Date: 16.01.2015 12:15:04 ******/
CREATE ASSEMBLY [UDF.RegExp]
FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C01030015A7A4500000000000000000E00002210B0108000016000000060000000000005E340000002000000040000000004000002000000002000004000000000000000400000000000000008000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000083400005300000000400000B803000000000000000000000000000000000000006000000C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E7465787400000064140000002000000016000000020000000000000000000000000000200000602E72737263000000B8030000004000000004000000180000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000001C000000000000000000000000000040000042000000000000000000000000000000004034000000000000480000000200050004240000041000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000C202280E00000A02036F0F00000A7D0100000402167D0200000403281000000A2C012A02020328020000067D020000042A0000001B3003005A00000001000011160A037201000070281100000A0B070D1613042B3C0911049A0C06D003000002281200000A086F1300000A281400000AA504000001600ADE1226720500007008281500000A731600000A7A1104175813041104098E6932BD062A00000110000000001A001F3900121D0000011E027B010000042A1E027B020000042A1330030071000000020000110F01281800000A2D130F01281900000A7E1A00000A281B00000A2C0B7253000070731600000A7A0F02281800000A2D090F02281900000A2B0572B10000700A0673010000060B0F00FE16060000016F0F00000A0F01FE16060000016F0F00000A076F04000006281C00000A281D00000A2A000000133004007E000000020000110F01281800000A2D130F01281900000A7E1A00000A281B00000A2C0B7253000070731600000A7A0F03281800000A2D090F03281900000A2B0572B10000700A0673010000060B0F00FE16060000016F0F00000A0F01FE16060000016F0F00000A0F02FE16060000016F0F00000A076F04000006281E00000A281F00000A2A1E02280E00000A2A00001B3003003F01000003000011732000000A0A0F01281800000A2D130F01281900000A7E1A00000A281B00000A2C02062A0F02281800000A2D090F02281900000A2B0572B10000700B0773010000060C0F00FE16060000016F0F00000A0F01FE16060000016F0F00000A086F04000006282100000A13041203167D0E00000411046F2200000A1307389A00000011076F2300000A742200000113051203257B0E0000041758687D0E0000041613062B67120311067D0F000004120311056F2400000A11066F2500000A6F2600000A7D10000004120311056F2400000A11066F2500000A6F2700000A17587D11000004120311056F2400000A11066F2500000A6F2800000A7D1200000406096F2900000A11061758D21306110611056F2400000A6F2A00000A328911076F2B00000A3A5AFFFFFFDE1511077526000001130811082C0711086F2C00000ADC062A000110000002007B00AD280115000000000330020071000000000000000302A5060000027B0E000004282D00000A81080000010402A5060000027B0F000004282E00000A81090000010502A5060000027B10000004281F00000A81060000010E0402A5060000027B11000004282F00000A810A0000010E0502A5060000027B12000004282F00000A810A0000012A1E02280E00000A2A00000042534A4201000100000000000C00000076322E302E35303732370000000005006C00000038050000237E0000A40500003C06000023537472696E677300000000E00B0000B400000023555300940C0000100000002347554944000000A40C00006003000023426C6F620000000000000002000001571DA2090902000000FA253300160000010000002800000006000000120000000A00000012000000300000000A0000000D000000030000000100000002000000020000000100000001000000030000000200000000000A0001000000000006008800810006008F0081000600940081000A00C600A7000E00DB01C6010E00E601C60106001D020A020E003602C6010E003F02C6010E004702C6010600C702A8020600E602D4020600FD02D40206001A03D40206003903D40206005203D40206006B03D40206008603D4020600A103D4020600BA03A8020600CE03D40206000704E70306002704E7030600580481000A006D04A70006007904810006007E0481000600B70481000600C10481000E00EE04D3040600610546050A006805A700060080050A020A007702A7000A00A605A7000A00C105A7000A00D005A70006000406810006001806A80206002E06A80200000000010000000000010001000100100018002B0005000100010003010000390000000900030005000100100045002B0005000E0005000100100055002B0005000E0008000B0110006A0000000D000E000B0001009E000A000100D3000D0006062C012E0056803401310056803F01310056804901310056805401310056806101310056807101310056807A01310056809201310056809E0131005680A9013100060061029D0006006C02A000060077020A0006007D022E00060083022E005020000000008618E100110001008420000000008100E70016000200FC20000000008608F0001C0003000421000000008608FC00200003000C21000000009600F001620003008C21000000009600FD016D0006001622000000008618E1007A000A00202200000000960029027E000A007C23000000009600500289000D00F923000000008618E1007A001300000001001201000001001201000001008A02000002009002000003001201000001008A02000002009002000003009802000004001201000001008A0200000200900200000300120100000100A402020002006102020003006C02020004007702020005007D020200060083025900E1007A006100E10011006900E10011007100E10011007900E10011008100E10011008900E10011009100E10011009900E1001100A100E100A300A900E1001100B100E100A800B900E1007A000900E1007A0009004F041C00C1005F04AD00C9007304B200D1009004B900C100A2041C001100AA04C000C100B004C700E100E1001100F100E1007A0031000305FD0031000E051C00C10018050A00C1001E050101C9002A050701290032050F01C9003E051B013100320524010C00E1007A00C9007805690201018C05730209019A0579021101B6057D021901C705830229010E051C002901D8058A022901E2058A020C00ED058E021901F1058A020901FB05FD00310110067A0041003205AF0249003205B50251003205BB023901E100C102080010003500080014003A00080018003F0008001C003F00080020004400080024004900080028004E0008002C005300080030005800080034005D002E002B000E032E006B003F032E001300C8022E001B00DB022E00230008032E003300C8022E003B0019032E00430008032E00530008032E0063003603A000BB00D800C000BB00D8000001BB002A01CD00150194020200010000001201250000001A012900020003000300020004000500620204800000010001000000000000000000000045040000020000000000000000000000010078000000000002000000000000000000000001008100000000000200000000000000000000000100BA010000000003000200060005000000003C4D6F64756C653E005544462E52656745782E646C6C0052656745784F7074696F6E735061727365720053716C2E5544462E5265674578004F7074696F6E734B657973005363616C617246756E6374696F6E73005461626C6556616C75656446756E6374696F6E730052656745784D61746368526F77006D73636F726C69620053797374656D004F626A65637400456E756D0056616C756554797065005F6F7074696F6E730053797374656D2E546578742E526567756C617245787072657373696F6E730052656765784F7074696F6E73005F72656765784F7074696F6E73002E63746F72005472795061727365006765745F4F7074696F6E73006765745F52656765784F7074696F6E7356616C7565004F7074696F6E730052656765784F7074696F6E7356616C75650076616C75655F5F0069676E6F726563617365006D756C74696C696E650073696E676C656C696E650072656765784F7074696F6E73006578706C696369746361707475726500636F6D70696C65640069676E6F72657061747465726E77686974657370616365007269676874746F6C6566740065636D617363726970740063756C74757265696E76617269616E740053797374656D2E446174610053797374656D2E446174612E53716C54797065730053716C426F6F6C65616E0053716C537472696E6700526567457849734D617463680052656745785265706C6163650053797374656D2E436F6C6C656374696F6E730049456E756D657261626C650052656745784D6174636865730053716C496E7431360053716C427974650053716C496E7433320052656745784D617463686573526F7773004D61746368496E6465780047726F7570496E646578004D6174636800496E646578004C656E67746800496E707574005061747465726E005265706C6163656D656E74006F626A0053797374656D2E52756E74696D652E496E7465726F705365727669636573004F75744174747269627574650053797374656D2E5265666C656374696F6E00417373656D626C795469746C6541747472696275746500417373656D626C794465736372697074696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E41747472696275746500417373656D626C79436F6D70616E7941747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C7943756C7475726541747472696275746500436F6D56697369626C6541747472696275746500417373656D626C7956657273696F6E4174747269627574650053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C697479417474726962757465005544462E526567457800546F537472696E6700537472696E670049734E756C6C4F72456D7074790052656765780053706C697400547970650052756E74696D655479706548616E646C65004765745479706546726F6D48616E646C6500546F4C6F77657200506172736500436F6E63617400457863657074696F6E00417267756D656E74457863657074696F6E004D6963726F736F66742E53716C5365727665722E5365727665720053716C46756E6374696F6E417474726962757465006765745F49734E756C6C006765745F56616C756500456D707479006F705F457175616C6974790049734D61746368006F705F496D706C69636974005265706C6163650053797374656D2E436F6C6C656374696F6E732E47656E65726963004C6973746031004D61746368436F6C6C656374696F6E004D6174636865730049456E756D657261746F7200476574456E756D657261746F72006765745F43757272656E740047726F7570436F6C6C656374696F6E006765745F47726F7570730047726F7570006765745F4974656D0043617074757265006765745F496E646578006765745F4C656E67746800416464006765745F436F756E74004D6F76654E6578740049446973706F7361626C6500446973706F7365005374727563744C61796F7574417474726962757465004C61796F75744B696E640000000000032C00004D1F04350440043504340430043D0420003D0435043804370432043504410442043D044B04390420003F043004400430043C0435044204400420004F007000740069006F006E0073003A002000015D1F043004400430043C0435044204400420005000610074007400650072006E0020003D04350420003C043E04360435044204200031044B0442044C0420004E0055004C004C00200038043B043804200045006D007000740079002E0001010000A23FFF37983BDA458EB4C106136460AB0008B77A5C561934E08902060E03061111042001010E05200111110E0320000E04200011110328000E04280011110206080306110C0401000000040200000004100000000404000000040800000004200000000440000000040001000004000200000A000311151119111911190C000411191119111911191119032000010A0003121D111911191119130006011C10112110112510111910112910112902060602060504200101020420010108040001020E0600021D0E0E0E0600011269116D0600021C12690E0500020E0E0E0A070511111D0E0E1D0E08240100020054020F497344657465726D696E6973746963015402094973507265636973650103200002050002020E0E070003020E0E11110500011115020507020E12080800040E0E0E0E111105000111190E813601000400540E1146696C6C526F774D6574686F644E616D651052656745784D617463686573526F77735455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A4461746141636365737301000000540E0F5461626C65446566696E6974696F6E5C5B4D61746368496E6465785D20736D616C6C696E742C205B47726F7570496E6465785D2074696E79696E742C205B546578745D206E76617263686172286D6178292C205B496E6465785D20696E742C205B4C656E6774685D20696E7454020F497344657465726D696E6973746963010615127D0111180900031280810E0E11110520001280850320001C05200012808D06200112809108032000080520010113001A070915127D0111180E1208111812808112808905128085128099050001112106050001112505050001112908062001011180A11201000D53716C2E5544462E526567457800002C01002753514C2053657276657220417373656D626C7920524547756C61722045587072657373696F6E7300000501000000000A01000546696E616D00001C010017436F7079726967687420C2A92046696E616D203230313100000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F77730100003034000000000000000000004E3400000020000000000000000000000000000000000000000000004034000000000000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF25002040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058400000600300000000000000000000600334000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100010001000000000001000100000000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004C0020000010053007400720069006E006700460069006C00650049006E0066006F0000009C020000010030003000300030003000340062003000000068002800010043006F006D006D0065006E00740073000000530051004C002000530065007200760065007200200041007300730065006D0062006C007900200052004500470075006C00610072002000450058007000720065007300730069006F006E00730000002C000600010043006F006D00700061006E0079004E0061006D00650000000000460069006E0061006D00000044000E000100460069006C0065004400650073006300720069007000740069006F006E0000000000530071006C002E005500440046002E00520065006700450078000000300008000100460069006C006500560065007200730069006F006E000000000031002E0031002E0030002E00300000003C000E00010049006E007400650072006E0061006C004E0061006D00650000005500440046002E00520065006700450078002E0064006C006C0000005400170001004C006500670061006C0043006F007000790072006900670068007400000043006F0070007900720069006700680074002000A9002000460069006E0061006D00200032003000310031000000000044000E0001004F0072006900670069006E0061006C00460069006C0065006E0061006D00650000005500440046002E00520065006700450078002E0064006C006C0000003C000E000100500072006F0064007500630074004E0061006D00650000000000530071006C002E005500440046002E00520065006700450078000000340008000100500072006F006400750063007400560065007200730069006F006E00000031002E0031002E0030002E003000000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000031002E0031002E0030002E0030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000C000000603400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
WITH PERMISSION_SET = SAFE

GO
/****** Object:  SqlAssembly [UDT.TLink]    Script Date: 16.01.2015 12:15:04 ******/
CREATE ASSEMBLY [UDT.TLink]
FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C010300A6EBBD500000000000000000E00002210B010800000E000000060000000000001E2D0000002000000040000000004000002000000002000004000000000000000400000000000000008000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000D02C00004B00000000400000B803000000000000000000000000000000000000006000000C00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000240D000000200000000E000000020000000000000000000000000000200000602E72737263000000B8030000004000000004000000100000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000001400000000000000000000000000004000004200000000000000000000000000000000002D0000000000004800000002000500C8220000080A00000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000BE0228020000062D21027B010000048C170000017201000070027B020000048C18000001281000000A2A72050000702A0A162A1A28060000062A00001330020052000000010000110F00281100000A2C0628060000062A1200FE150200000212000F00281200000A7D010000040F01281300000A2D0A0F01281400000A16300A1200167D020000042B0E12000F01281400000A7D02000004062A00001330040076000000020000110F00281500000A2C0628060000062A0F00281600000A0A066F1700000A172E0B7207000070731800000A7A1201FE150200000212010616176F1900000A16281A00000AD27D010000040F01281300000A2D0A0F01281400000A16300A1201167D020000042B0E12010F01281400000A7D02000004072A0000133001000A000000010000111200FE1502000002062A00001330040088000000030000110F00281500000A2C0628060000062A0F00281600000A0A067205000070281B00000A2C0628060000062A0672010000706F1C00000A0B07162F0628060000062A1202FE150200000212020616076F1900000A281D00000A7D0100000407066F1700000A17592F171202060717586F1E00000A281F00000A7D020000042B081202167D02000004082A32027B01000004282000000A2A3A020F01281200000A7D010000042A46027B01000004282100000A282200000A2A56020F01281600000A16281A00000AD27D010000042A6E027B020000041630067E2300000A2A027B02000004282400000A2AA60F01281300000A2D0A0F01281400000A16300802167D020000042A020F01281400000A7D020000042A86027B010000040F017B010000043310027B020000040F017B02000004FE012A162A42534A4201000100000000000C00000076322E302E35303732370000000005006C000000D8030000237E000044040000E003000023537472696E67730000000024080000500000002355530074080000100000002347554944000000840800008401000023426C6F6200000000000000020000015717A2010900000000FA253300160000010000001B00000002000000020000000E0000000900000001000000240000000B00000003000000010000000500000008000000010000000200000000000A00010000000000060032002B000A005D0048000A008C0048000A00940048000A00AA00480006005C014A01060079014A01060096014A010600B5014A010600CE014A010600E7014A01060002024A0106001D024A01060055023602060069024A010600A20282020600C20282020600EE022B000A001F0304030A003B030403060042033602060058033602060063032B00060068032B0006006E032B00060087032B0006009B032B000000000001000000000001000100092110001C000000050001000100010067000A0001006D000D00502000000000C600740010000100802000000000E6097D001400010083200000000096008800180001008C200000000096009D001D000100EC20000000009600B400260003007021000000009608C100180005008821000000009600CA002F0005001C22000000008608D000360006002922000000008608D9003B0006003822000000008608E200410007004A22000000008608EB00460007006022000000008608F4004C0008007C22000000008608FE0051000800A622000000008600080157000900000001002B01000002003101000001003801000002003101000001003E0100000100400100000100400100000100400100000100460102000900310073017500390073017500410073017500490073017500510073017500590073017500610073017500690073017500710073017A00790073017500810073017F00890073018400910073018400990073018800A90073019700C90075039D0019007D0014001900F400A40021007D0014002100F400A80029007D0014002900F4001000C9007C03A800D10073017500C9009103B100D900A003B700C900AF03C300C900BB03C900B900CA00CE00C9009103D300C100CA00D8001900C303E400D900CF03EA002900C303EF0021001601F5002100C303F9002E002B00FF002E00630065012E0013000A012E001B000A012E00230010012E000B00FF002E0033002D012E003B000A012E004B000A012E005B005C01430073008E00AC00BD00DD000200010000000F015D0000001601610000001B016600000020016B0000002501700002000200030002000600050001000900070002000800070001000B00090002000A00090002000C000B0001000D000B00048000000100000071127373000000000000E0020000020000000000000000000000010022000000000002000000000000000000000001003C00000000000000003C4D6F64756C653E0053514C2E5544542E544C696E6B2E646C6C00544C696E6B006D73636F726C69620053797374656D0056616C7565547970650053797374656D2E446174610053797374656D2E446174612E53716C547970657300494E756C6C61626C65005F54797065005F56616C756500546F537472696E67006765745F49734E756C6C004E65770053716C427974650053716C496E743332004372656174654279547970650053716C537472696E67004372656174654279436F6465006765745F4E756C6C005061727365006765745F54797065007365745F54797065006765745F436F6465007365745F436F6465006765745F56616C7565007365745F56616C756500457175616C730049734E756C6C004E756C6C005479706500436F64650056616C7565004154797065004156616C75650041436F646500730076616C7565006172670053797374656D2E5265666C656374696F6E00417373656D626C795469746C65417474726962757465002E63746F7200417373656D626C794465736372697074696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E41747472696275746500417373656D626C79436F6D70616E7941747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C7943756C747572654174747269627574650053797374656D2E52756E74696D652E496E7465726F70536572766963657300436F6D56697369626C6541747472696275746500417373656D626C7956657273696F6E4174747269627574650053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C6974794174747269627574650053514C2E5544542E544C696E6B0053657269616C697A61626C65417474726962757465004D6963726F736F66742E53716C5365727665722E5365727665720053716C55736572446566696E65645479706541747472696275746500466F726D6174005374727563744C61796F7574417474726962757465004C61796F75744B696E64004279746500496E74333200537472696E6700436F6E636174006765745F4C656E67746800457863657074696F6E00537562737472696E67004368617200436F6E76657274546F5574663332006F705F457175616C69747900496E6465784F66006F705F496D706C6963697400436F6E7665727446726F6D55746633320000033A000001004749006E00760061006C006900640020006C0065006E00670074006800200066006F007200200070006100720061006D0065007400650072002000270043006F006400650027000100F5E95ECBAB0E714896E6F81D1B3939BA0008B77A5C561934E0890206050206080320000E0320000204000011080800021108110D111108000211081115111106000111081115042000110D05200101110D04200011150520010111150420001111052001011111052001021108032800020408001108042800110D04280011150428001111042001010E04200101020420010108032000010520010111510801000100000000000520010111590600030E1C1C1C032000050320000804070111080520020E0808050002080E080507020E1108050002020E0E042001080E040001050E0420010E08040001080E0607030E081108050001110D050400010E0805000111150E030611110500011111080A010005544C696E6B00000501000000001C0100174865776C6574742D5061636B61726420436F6D70616E7900002E010029436F7079726967687420C2A9204865776C6574742D5061636B61726420436F6D70616E79203230313200000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F777301F82C000000000000000000000E2D0000002000000000000000000000000000000000000000000000002D00000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF25002040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058400000600300000000000000000000600334000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000001007373711200000100737371123F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004C0020000010053007400720069006E006700460069006C00650049006E0066006F0000009C020000010030003000300030003000340062003000000050001800010043006F006D00700061006E0079004E0061006D006500000000004800650077006C006500740074002D005000610063006B00610072006400200043006F006D00700061006E0079000000340006000100460069006C0065004400650073006300720069007000740069006F006E000000000054004C0069006E006B00000040000F000100460069006C006500560065007200730069006F006E000000000031002E0030002E0034003700320031002E00320039003500350035000000000044001200010049006E007400650072006E0061006C004E0061006D0065000000530051004C002E005500440054002E0054004C0069006E006B002E0064006C006C0000007800290001004C006500670061006C0043006F007000790072006900670068007400000043006F0070007900720069006700680074002000A90020004800650077006C006500740074002D005000610063006B00610072006400200043006F006D00700061006E00790020003200300031003200000000004C00120001004F0072006900670069006E0061006C00460069006C0065006E0061006D0065000000530051004C002E005500440054002E0054004C0069006E006B002E0064006C006C0000002C0006000100500072006F0064007500630074004E0061006D0065000000000054004C0069006E006B00000044000F000100500072006F006400750063007400560065007200730069006F006E00000031002E0030002E0034003700320031002E00320039003500350035000000000048000F00010041007300730065006D0062006C0079002000560065007200730069006F006E00000031002E0030002E0034003700320031002E003200390035003500350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C000000203D00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
WITH PERMISSION_SET = SAFE

GO
/****** Object:  SqlAssembly [UDT.TParams_EMPTY]    Script Date: 16.01.2015 12:15:04 ******/
CREATE ASSEMBLY [UDT.TParams_EMPTY]
FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C0103005DB580520000000000000000E00002210B010800009C00000006000000000000DEBB00000020000000C000000000400000200000000200000400000000000000040000000000000000000100000200000000000003004085000010000010000000001000001000000000000010000000000000000000000090BB00004B00000000C00000080300000000000000000000000000000000000000E000000C000000F4BA00001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000E49B000000200000009C000000020000000000000000000000000000200000602E727372630000000803000000C0000000040000009E0000000000000000000000000000400000402E72656C6F6300000C00000000E000000002000000A200000000000000000000000000004000004200000000000000000000000000000000C0BB000000000000480000000200050040650000B45500000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000062A0A162A82720100007002720500007072090000706F1200000A7205000070281300000A2A0000033004006500000000000000026F1400000A1000022C0D02720F000070281500000A2C06720F0000702A026F1600000A18321D02166F1700000A1F5B331202026F1600000A17596F1700000A1F5D2E02022A0217026F1600000A18596F1800000A720900007072050000706F1200000A2A000000133002004A00000001000011020A061F0E300B061A2E3B061F0E2E362B36061F155945020000002300000023000000061F1D5945060000000200000004000000020000000200000002000000020000002B02172A162A82721100007002721100007072150000706F1200000A7211000070281300000A2A00033004005D00000000000000026F1400000A100002281900000A2C06720F0000702A026F1600000A18321D02166F1700000A1F22331202026F1600000A17596F1700000A1F222E02022A0217026F1600000A18596F1800000A721500007072110000706F1200000A2A0000001B3009000901000002000011731A00000A0A027B050000046F1B00000A130438D000000011046F1C00000A0B1201281D00000A166F1700000A1F3D3BB40000001201281E00000A282B0000060C0828050000060D06066F1F00000A2C1202283C0000066F2000000A6F2100000A2B05720F000070721B0000701201281D00000A2803000006081F162E2F7231000070081F1D2E0D088C070000016F2200000A2B111201281E00000A6F2300000A6F2400000A282500000A2B05720F000070092D10021201281E00000A16282D0000062B13021201281E00000A16282D0000062806000006282600000A282500000A6F2700000A2611046F2800000A3A24FFFFFFDE0C11042C0711046F2900000ADC066F2200000A2A0000000110000002001300E3F6000C000000001B30060010040000030000110228190000060F01282A00000A2D180F01282B00000A6F1400000A720F000070281500000A2C012A0F01282B00000A02283C0000066F2000000A6F2100000A282500000A0A720F0000700B720F0000700C160D1613041613051613061613071208FE150400001B161309384603000011062C0816130638340300001108130D120D282C00000A2D0C120EFE150500001B110E2B0C120D282D00000A732E00000A130F120F282F00000A2C2B0611096F1700000A13101108131111101211282D00000A330C1211282C00000A16FE012B01173AD9020000066F1600000A110902283C0000066F2000000A6F2100000A6F1600000A58323706110902283C0000066F2000000A6F2100000A6F1600000A6F1800000A02283C0000066F2000000A6F2100000A283000000A39950100000611096F1700000A131211121F3A301411121F223B0E01000011121F3A2E26386E01000011121F3D2E3D11121F5B5945030000006800000052010000B7000000384D01000011052D1611042D120609110909596F1800000A0B110917581304171307382E01000011052D35110416311E06110411091104596F1800000A0C06091104095917596F1800000A0B2B0C0609110909596F1800000A0B11091758130517130738ED00000011052D43110813131213282C00000A2D0C1214FE150500001B11142B0C1213282D00000A732E00000A13151215282F00000A2D0B12081F5D283100000A2B081208FE150400001B171307389E00000011052D271109066F1600000A17592F1306110917586F1700000A1F5D33051713062B081208FE150400001B1713072B6E11052C62110813161216282C00000A2D0C1217FE150500001B11172B0C1216282D00000A732E00000A13181218282F00000A2D0B12081F22283100000A2B271109066F1600000A17592F1306110917586F1700000A1F2233051713062B081208FE150400001B1713072B0317130711072C0816130738E1000000110516317E06110511091105596F1800000A130A0208282C000006130B110B28050000062C09110A2807000006130A02072804000006283200000A02110A110B16282E000006281D000006720F0000700B720F0000700C110917580D161304161305DE7D130C7235000070038C08000001110C6F3300000A283400000A733500000A7A110813191219282C00000A2D0C121AFE150500001B111A2B0C1219282D00000A732E00000A131B121B282F00000A2D2E06096F3600000A6F1400000A720F000070283000000A2C167297000070038C08000001283700000A733500000A7A1109175813091109066F1600000A3FADFCFFFF1108131C121C282C00000A2D0C121DFE150500001B111D2B0C121C282D00000A732E00000A131E121E282F00000A2C1D721C010070038C0800000111088C0400001B283400000A733500000A7A2A011000000000D3025F32031F3800000103300300E700000000000000027B090000042C012A0314283200000A283800000A25283900000A2D110F01282A00000A283A00000A283B00000A25283900000A2D200F01282B00000A6F2200000A720F000070281500000A283A00000A283B00000A283900000A2C0B729A010070733500000A7A042D280F01282B00000A166F1700000A1F3D331772E00100700F01282B00000A283700000A733500000A7A042C270F01282B00000A166F1700000A1F3D2E1672D7020070038C08000001283700000A733500000A7A0F01282B00000A72840300706F3C00000A2C167288030070038C08000001283700000A733500000A7A2AA6027B050000040F01282B00000A6F3D00000A2D02142A027B050000040F01282B00000A6F3E00000A2A0000001B3004007000000004000011027B050000040F01282B00000A6F3D00000A2D067E3F00000A2A027B050000040F01282B00000A6F3E00000A0A0675090000012C0906A5090000010BDE30020616282D000006284000000A0BDE20267208040070020616282D0000060F01282B00000A283400000A733500000A7A072A0110000000002D00214E002001000001133003004A00000005000011027B050000040F01282B00000A6F3D00000A2D067E4100000A2A027B050000040F01282B00000A6F3E00000A0A0675080000012C0706A5080000012A020616282D000006283200000A2A00001B300400C000000006000011027B050000040F01282B00000A6F3D00000A2D0A1202FE150600001B082A027B050000040F01282B00000A6F3E00000A0A06750B0000012C0E06A50B000001734300000A0BDE7706750C0000012C1606A50C0000010D1203284400000A734300000A0BDE5906750D0000012C1C06A50D000001284500000A13041204284400000A734300000A0BDE35020616282D000006284600000A734300000A0BDE20267291040070020616282D0000060F01282B00000A283400000A733500000A7A072A01100000000031006D9E0020010000011B3004009500000007000011027B050000040F01282B00000A6F3D00000A2D0A1202FE150700001B082A027B050000040F01282B00000A6F3E00000A0A06750C0000012C1606A50C0000010D1203284700000A734800000A0BDE44020616282D00000602283C000006284900000A13041204284700000A734800000A0BDE2026721C050070020616282D0000060F01282B00000A283400000A733500000A7A072A000000011000000000310042730020010000011B3004007B00000008000011027B050000040F01282B00000A6F3D00000A2D067E4A00000A2A027B050000040F01282B00000A6F3E00000A0A06750D0000012C0906A50D0000010BDE3B020616282D00000602283C000006284900000A284B00000A0BDE202672A7050070020616282D0000060F01282B00000A283400000A733500000A7A072A000110000000002D002C590020010000011B3004005B01000009000011027B050000040F01282B00000A6F3D00000A2D067E4C00000A2A027B050000040F01282B00000A6F3E00000A0A06750E0000012C0C06A50E0000010BDD1801000006750F0000012C1406A50F0000010C1202284D00000A0BDDFC0000000675100000012C1406A5100000010D1203284E00000A0BDDE00000000675110000012C1506A51100000113041204284F00000A0BDDC30000000675090000012C1506A50900000113051205285000000A0BDDA600000006753B0000012C1506A53B00000113061206285100000A0BDD8900000006753C0000012C1206A53C00000113071207285200000A0BDE6F06753D0000012C1206A53D00000113081208285300000A0BDE5506753E0000012C1206A53E00000113091209285400000A0BDE3B020616282D00000602283C000006285500000A285600000A0BDE2026723A060070020616282D0000060F01282B00000A283400000A733500000A7A072A00411C0000000000002D0000000C0100003901000020000000010000011B3004005B0100000A000011027B050000040F01282B00000A6F3D00000A2D067E5700000A2A027B050000040F01282B00000A6F3E00000A0A06750F0000012C0C06A50F0000010BDD1801000006750E0000012C1406A50E0000010C1202285800000A0BDDFC0000000675100000012C1406A5100000010D1203285900000A0BDDE00000000675110000012C1506A51100000113041204285A00000A0BDDC30000000675090000012C1506A50900000113051205285B00000A0BDDA600000006753B0000012C1506A53B00000113061206285C00000A0BDD8900000006753C0000012C1206A53C00000113071207285D00000A0BDE6F06753D0000012C1206A53D00000113081208285E00000A0BDE5506753E0000012C1206A53E00000113091209285F00000A0BDE3B020616282D00000602283C000006286000000A286100000A0BDE202672CB060070020616282D0000060F01282B00000A283400000A733500000A7A072A00411C0000000000002D0000000C0100003901000020000000010000011B3004005B0100000B000011027B050000040F01282B00000A6F3D00000A2D067E6200000A2A027B050000040F01282B00000A6F3E00000A0A0675100000012C0C06A5100000010BDD1801000006750E0000012C1406A50E0000010C1202286300000A0BDDFC00000006750F0000012C1406A50F0000010D1203286400000A0BDDE00000000675110000012C1506A51100000113041204286500000A0BDDC30000000675090000012C1506A50900000113051205286600000A0BDDA600000006753B0000012C1506A53B00000113061206286700000A0BDD8900000006753C0000012C1206A53C00000113071207286800000A0BDE6F06753D0000012C1206A53D00000113081208286900000A0BDE5506753E0000012C1206A53E00000113091209286A00000A0BDE3B020616282D00000602283C000006286B00000A286C00000A0BDE2026725E070070020616282D0000060F01282B00000A283400000A733500000A7A072A00411C0000000000002D0000000C0100003901000020000000010000011B3004005B0100000C000011027B050000040F01282B00000A6F3D00000A2D067E6D00000A2A027B050000040F01282B00000A6F3E00000A0A0675110000012C0C06A5110000010BDD1801000006750E0000012C1406A50E0000010C1202286E00000A0BDDFC00000006750F0000012C1406A50F0000010D1203286F00000A0BDDE00000000675100000012C1506A51000000113041204287000000A0BDDC30000000675090000012C1506A50900000113051205287100000A0BDDA600000006753B0000012C1506A53B00000113061206287200000A0BDD8900000006753C0000012C1206A53C00000113071207287300000A0BDE6F06753D0000012C1206A53D00000113081208287400000A0BDE5506753E0000012C1206A53E00000113091209287500000A0BDE3B020616282D00000602283C000006287600000A287700000A0BDE202672EB070070020616282D0000060F01282B00000A283400000A733500000A7A072A00411C0000000000002D0000000C0100003901000020000000010000011B3004008D0000000D000011027B050000040F01282B00000A6F3D00000A2D06287800000A2A027B050000040F01282B00000A6F3E00000A0A0675120000012C090674120000010CDE4D0675080000012C1F06A508000001287900000A737A00000A287B00000A0B07737C00000A0CDE26737D00000A7A26727A080070020616282D0000060F01282B00000A283400000A733500000A7A082A0000000110000000002D003E6B0020010000011B300400660000000E000011027B050000040F01282B00000A6F3D00000A2D067E4C00000A2A027B050000040F01282B00000A6F3E00000A0A06750E0000012C0906A50E0000010BDE26737D00000A7A267203090070020616282D0000060F01282B00000A283400000A733500000A7A072A00000110000000002D00174400200100000113300400B40000000F000011027B050000040F01282B00000A6F3D00000A2D02142A027B050000040F01282B00000A6F3E00000A0A0675020000022C070674020000022A0675080000012C2902282300000A287E00000A74020000020B0706A508000001287900000A283200000A6F09000006072A0675120000012C19733D0000060C080675120000016F7F00000A6F31000006082A7298090070020616282D0000060F01282B00000A02282300000A6F2400000A282600000A733500000A7A4E027B050000040F01282B00000A6F3D00000A2AB6027B070000042C0B72210A0070733500000A7A027B050000046F8000000A02147D0700000402147D080000042A00001B3003006E00000010000011731A00000A0A027B050000046F1B00000A0C2B3F086F1C00000A0B1201281D00000A166F1700000A1F3D2E2706066F1F00000A2C0772840300702B05720F0000701201281D00000A282500000A6F2700000A26086F2800000A2DB9DE0A082C06086F2900000ADC066F2200000A2A000001100000020012004B5D000A000000001E02281A0000062A1B3002004F00000011000011738100000A0A027B050000046F1B00000A0C2B25086F1C00000A0B1201281D00000A166F1700000A1F3D2E0D061201281D00000A6F8200000A086F2800000A2DD3DE0A082C06086F2900000ADC062A0001100000020012003143000A000000001B300400A8010000120000110203027B0700000414FE0116FE01280A000006738300000A0A027B060000042C69027B060000046F8400000A13052B4311056F8500000A0B1201288600000A7B100000042C2D1201288600000A7B100000040F01282B00000A6F8700000A6F8800000A16320D061201288900000A6F8A00000A11056F2800000A2DB4DE0C11052C0711056F2900000ADC066F8B00000A13062B6B1206288C00000A0C027B06000004086F8D00000A7B110000040D027B06000004086F8E00000A26096F8F00000A13072B211207289000000A1304021104282A0000062D0E027B0500000411046F9100000A261207289200000A2DD6DE0E1207FE160E00001B6F2900000ADC1206289300000A2D8CDE0E1206FE160D00001B6F2900000ADC027B050000040F01282B00000A6F3D00000A2C48042C1D0475470000012D150475060000012C210474060000016F0100000A2C14027B050000040F01282B00000A6F9100000A262A027B050000040F01282B00000A046F9400000A2A042C300475470000012D280475060000012C0D0474060000016F0100000A2D13027B050000040F01282B00000A046F9500000A2A0128000002002E00507E000C000000000200C3002EF1000E0000000002009200780A010E000000001B3003006B00000013000011032D02172A037B050000046F1B00000A0C2B40086F1C00000A0A027B050000041200281D00000A6F3D00000A2C2502027B050000041200281D00000A6F3E00000A1200281E00000A28220000062D04160BDE16086F2800000A2DB8DE0A082C06086F2900000ADC172A072A0001100000020011004C5D000A000000001B300300BC00000014000011032D08022819000006022A738100000A0A037B050000046F1B00000A0D2B49096F1C00000A0B027B050000041201281D00000A6F3D00000A2C2E02027B050000041201281D00000A6F3E00000A1201281E00000A28220000062C0D061201281D00000A6F8200000A096F2800000A2DAFDE0A092C06096F2900000ADC027B050000046F9600000A17590C2B2A06027B050000046F9700000A086F9800000A6F8800000A162F0C027B05000004086F9900000A0817590C08162FD2022A0110000002001D005572000A000000001B3003004900000015000011032D02022A037B050000046F1B00000A0B2B20076F1C00000A0A021200281D00000A283200000A1200281E00000A281D000006076F2800000A2DD8DE0A072C06076F2900000ADC022A00000001100000020011002C3D000A00000000A6020316280A000006027B050000040F01282B00000A6F3D00000A2C0C02037E9A00000A281D0000062A0000133004009C0000001600001103282B0000060A04282B0000060B07172E05071F15335F06172E07061F152E02162A0374490000016F9B00000A0474490000016F9B00000A2E02162A160C2B220474490000016F9C00000A08910374490000016F9C00000A08912E02162A0817580C086A0474490000016F9B00000A176A5932CC2B2406172E1E061F152E19020416282D000006020316282D000006283000000A2C04162A162A172A1B3003008900000013000011032D02162A027B050000046F9600000A037B050000046F9600000A2E02162A027B050000046F1B00000A0C2B44086F1C00000A0A037B050000041200281D00000A6F3D00000A2D04160BDE3B02037B050000041200281D00000A6F3E00000A1200281E00000A28220000062D04160BDE16086F2800000A2DB4DE0A082C06086F2900000ADC172A072A0000000110000002002B00507B000A000000001330030065000000170000110E041451150A72D20A00700405283400000A03739D00000A0B076F9E00000A0C086F9F00000A2C3508166FA000000A2C11726F0C007004283700000A733500000A7A08166FA100000A0A08176FA000000A2D0A0E0408176FA200000A51086FA300000A062A0000001B3003008C00000018000011140A036FA400000A0B07729D0C007004283700000A6FA500000A07176FA600000A72C50C00701F1D73A700000A0C0872D50C00706FA800000A08176FA900000A08026FAA00000A076FAB00000A086FAC00000A26076F9E00000A0D096F9F00000A2C1609166FA000000A2D0D09166FAD00000A74020000020A096FA300000A061305DE05130411047A11052A011000000000000084840005380000011B300500D20100001900001172010D007073AE00000A0A066FAF00000A02060F01282B00000A72310D0070120128240000060C0208286C00000A2828000006283900000A2C012A027B060000042D0B0273B000000A7D06000004733F0000060D027B0600000408096FB100000A072D012A027B070000042D0B02738300000A7D07000004027B07000004086F8A00000A020607282500000613041104390901000011047B060000046F8400000A13072B5B11076F8500000A1305027B060000041205288900000A6FB200000A2C25027B060000041205288900000A6F8D00000A1205288600000A7B100000047D100000042B19027B060000041205288900000A1205288600000A6FB100000A11076F2800000A2D9CDE0C11072C0711076F2900000ADC11047B050000046F1B00000A13082B6011086F1C00000A1306027B050000041206281D00000A6F3D00000A2D43021206281D00000A283200000A1206281E00000A281D000006097B110000042D0B09738100000A7D11000004097B110000041206281D00000A6F8700000A6F8200000A11086F2800000A2D97DE0C11082C0711086F2900000ADC027B07000004027B070000046FB300000A17596FB400000A027B070000046FB300000A2D0E02147D0700000402147D080000042A0000011C00000200A300680B010C00000000020025016D92010C000000001B3002009A0000001A000011027B060000042D012A738100000A0A027B050000046F1B00000A0D2B25096F1C00000A0B1201281D00000A166F1700000A1F3D330D061201281D00000A6F8200000A096F2800000A2DD3DE0A092C06096F2900000ADC066F8F00000A13042B151204289000000A0C027B05000004086F9100000A261204289200000A2DE2DE0E1204FE160E00001B6F2900000ADC027B060000046FB500000A2A0000011C000002001B00314C000A0000000002005E002280000E00000000E60F0128B600000A2C0716283A00000A2A027B060000042C1A027B060000040328B700000A6FB200000A2C0717283A00000A2A16283A00000A2A00001B3004000E0100001B000011027B070000042D0B72410D0070733500000A7A0314283200000A283800000A25283900000A2D210F01FE16080000016F2200000A720F000070281500000A283A00000A283B00000A283900000A2C012A0F01282B00000A6F8700000A178D5400000113041104161F2C9D11046FB800000A0A0613051613063885000000110511069A0B027B070000046F8B00000A13072B511207288C00000A0C027B06000004086F8D00000A0D097B100000042D1909738100000A7D10000004097B10000004076F8200000A2B1B097B10000004076F8800000A162F0C097B10000004076F8200000A1207289300000A2DA6DE0E1207FE160D00001B6F2900000ADC110617581306110611058E693F70FFFFFF2A000001100000020090005EEE000E000000001B300200900000001C000011027B060000042D02162A036F8700000A1001027B060000046F8400000A0D2B58096F8500000A0A1200288600000A7B110000042C431200288600000A7B110000046F8F00000A13042B151204289000000A0B0703281500000A2C04170CDE2F1204289200000A2DE2DE0E1204FE160E00001B6F2900000ADC096F2800000A2DA0DE0A092C06096F2900000ADC162A082A011C000002004800226A000E0000000002001E006482000A0000000013300200F60000001D00001102750E0000012C031F142A02750F0000012C031F102A0275100000012C021E2A0275110000012C02162A0275490000012C031F152A0275090000012C02182A0275080000012C031F162A02750C0000012C1E02A50C00000102A50C0000010A1200284700000A28B900000A2C031F1F2A02750C0000012C031F212A02750D0000012C021A2A02750B0000012C031F202A02753B0000012C021B2A02753C0000012C021C2A02753D0000012C031F092A02753E0000012C031F0D2A0275550000012C031F0E2A0275120000012C031F192A0275020000022C031F1D2A72F40D0070026F2300000A6F2400000A283700000A733500000A7A00001B300300AD0000001E000011032C0D03720F000070281500000A2C031F162A0302282300000A6F2400000A281500000A2C031F1D2AD00700000128BA00000A031728BB00000AA5070000010AD00700000128BA00000A068C0700000128BC00000A2D06737D00000A7A060C081F13301C081D2E27081F0B2E22081F1259450200000011000000110000002B15081F172E0A081F1E2E05081F223306737D00000A7A060BDE122672F40D007003283700000A733500000A7A072A0000000110000000002900709900120100000113300300CE0400001F00001103282B0000060A04174013020000060B07452200000005000000160000002700000040000000590000007800000089000000250400009B000000AC000000BD00000025040000C9000000D500000044010000E7000000F90000000A01000025040000250400002C0100005A0100006B0100002504000025040000770100002504000025040000250400003D010000250400004C0000001B0100006B000000382004000003A51100000128BD00000A28BE00000A2A0374490000016FBF00000A28C000000A2A03A50900000128C100000A2D0672680E00702A726C0E00702A03A508000001287900000A2A03A50C0000011928C200000A2A03A50D000001284500000A1928C200000A2A03A50C0000011928C200000A2A03A53B00000128C300000A28C400000A2A03A53C00000128C500000A6C28C600000A2A03A51000000128B700000A28C700000A2A03A53D00000128C800000A28C400000A2A03A508000001287900000A2A03A508000001287900000A2A03A53E00000128C900000A6C28C600000A2A03A50D000001284500000A1928C200000A2A03A50F00000128CA00000A28CB00000A2A03A53D00000128C800000A28C400000A2A03A50B0000018C0B00000128CC00000A2A03A50E00000128CD00000A28CE00000A2A036F2200000A2A03A55500000128CF00000A28D000000A6F8700000A2A0374490000016FBF00000A28C000000A2A03A508000001287900000A2A0374120000016FD100000A2A043A9C020000060C084522000000050000001C0000002D000000440000007F000000A8000000BF0000000C020000D7000000EE000000050100000C0200001B01000031010000C30100004901000060010000770100000C0200000C020000A5010000D9010000EA0100000C0200000C020000000200000C0200000C0200000C020000BC0100000C020000590000008E01000096000000380702000003A51100000128BD00000A02283C00000628D200000A2A0374490000016FBF00000A28C000000A2A03A50900000128C100000A02283C00000628D300000A2A03A5080000010D1203FE16080000016F2200000A2A03A50C0000011304120402283C0000066FD400000A6FD500000A02283C00000628D600000A2A03A50D000001284500000A02283C00000628D700000A2A03A50C00000102283C00000628D700000A2A03A53B00000128C300000A02283C00000628D800000A2A03A53C00000128C500000A6C02283C00000628D900000A2A03A51000000128B700000A02283C00000628DA00000A2A03A53D00000128C800000A02283C00000628D800000A2A03A50800000113051205FE16080000016F2200000A2A03A50800000113061206FE16080000016F2200000A2A03A53E00000128C900000A6C02283C00000628D900000A2A03A50D000001284500000A02283C00000628D700000A2A03A50F00000128CA00000A02283C00000628DB00000A2A03A53D00000128C800000A02283C00000628D800000A2A03A50B0000018C0B00000102283C00000628DC00000A2A03A50E00000128CD00000A02283C00000628DD00000A2A036F2200000A2A03A55500000113071207FE16550000016F2200000A2A0374490000016FBF00000A28C000000A2A03A50800000113081208FE16080000016F2200000A2A0374120000016FD100000A2A72700E0070733500000A7A00001B3004000E06000020000011051740C302000004130711074522000000050000001C0000002E00000045000000730000009E000000B50000004A050000CC000000E3000000FA0000004A0500000C0100001E010000DD010000350100004D010000640100004A0500004A0500009A010000F4010000060200004A0500004A050000180200004A0500004A0500004A050000B10100004A050000570000007B0100008B00000038450500000328DE00000A73DF00000A8C110000011306DD560500000328E000000A73E100000A1306DD440500000328E200000A73E300000A8C090000011306DD2D0500000373E400000A8C080000011306DD1B050000031928E500000A13081208284700000A8C0C0000011306DDFF040000031928E500000A73E600000A8C0D0000011306DDE7040000031928E500000A8C0C0000011306DDD40400000328E700000A73E800000A8C3B0000011306DDBD0400000328E900000A73EA00000A8C3C0000011306DDA60400000328EB00000A73EC00000A8C100000011306DD8F0400000328E700000A73ED00000A8C3D0000011306DD780400000373E400000A8C080000011306DD660400000373E400000A8C080000011306DD540400000328E900000A73EE00000A8C3E0000011306DD3D040000031928E500000A73E600000A8C0D0000011306DD250400000328EF00000A73F000000A8C0F0000011306DD0E0400000328E700000A73ED00000A8C3D0000011306DDF703000003120028F100000A2D080328F200000A2B01068C0B0000011306DDD80300000328F300000A73F400000A8C0E0000011306DDC103000002282300000A287E00000A74020000020B03737A00000A287B00000A0C07086F31000006071306DD950300000328F500000A73F600000A8C550000011306DD7E0300000328E000000A73E100000A1306DD6C0300000373E400000A8C080000011306DD5A03000003737A00000A287B00000A0D09737C00000A1306DD41030000053A13030000041309110945220000000500000022000000340000004600000084000000CF000000EC000000810200000A01000027010000440100008102000056010000680100003C02000086010000AE010000CB0100008102000081020000FA0100004B0200005A020000810200008102000069020000810200008102000081020000170200008102000058000000E8010000AC000000387C0200000302283C000006287600000A287700000A8C110000011306DD870200000328E000000A73E100000A1306DD7502000003284000000A8C090000011306DD630200000373E400000A8C080000011306DD5102000003027B0300000402283C000006208000000028F700000A130A120A284700000A8C0C0000011306DD2502000003027B0300000402283C000006208000000028F700000A284B00000A8C0D0000011306DDFD01000003027B0300000402283C000006208000000028F700000A8C0C0000011306DDDA0100000302283C00000628F800000A28F900000A8C3B0000011306DDBD0100000302283C00000628FA00000A6C28FB00000A8C3C0000011306DD9F0100000302283C000006286B00000A286C00000A8C100000011306DD820100000302283C00000628F800000A28FC00000A8C3D0000011306DD650100000373E400000A8C080000011306DD530100000373E400000A8C080000011306DD410100000302283C00000628FA00000A6B28FD00000A8C3E0000011306DD2301000003027B0300000402283C000006208000000028F700000A284B00000A8C0D0000011306DDFB00000003027B04000004286000000A286100000A8C0F0000011306DDDE0000000302283C00000628F800000A28FC00000A8C3D0000011306DDC100000003284600000A8C0B0000011306DDAF0000000302283C000006285500000A285600000A8C0E0000011306DD9200000002282300000A287E00000A74020000021304110403283200000A6F0900000611041306DE6D0328FE00000A8C550000011306DE5E0328E000000A73E100000A1306DE4F0373E400000A8C080000011306DE4003737A00000A287B00000A13051105737C00000A1306DE2872700E0070733500000A7A2672920E007003048C070000016F2200000A283400000A733500000A7A11062A0000411C00000000000000000000EE050000EE0500001D0000000100000132036F0001000A733500000A7A000000133004006E01000021000011037E0A0000042D1114FE063E000006730101000A800A0000047E0A000004280201000A0B280301000A730401000A0A076F0501000A166F0601000A74660000010C086F0701000A74680000010D096F0801000A6F0901000A163E0E010000096F0801000A6F0A01000A1304720F000070130538D300000011046F0B01000A746B000001130611066F0C01000A280D01000A130711066F0E01000A6F0F01000A72FA0E0070281500000A2C1F0611070211066F0E01000A6F1001000A282C0000066F1101000A388000000011066F1201000A2C6511066F1201000A6F1301000A756F0000012C5211066F1201000A6F1301000A746F0000016F1401000A6F0F01000A72FA0E0070281500000A2C2B0611070211066F1201000A6F1301000A746F0000016F1401000A6F1001000A282C0000066F1101000A2B1272640F00701107283700000A733500000A7A11046F1501000A3A21FFFFFF1105720F000070283000000A2C081105733500000A7A062A00001B300600B50000002200001102177D09000004160A389000000003066F1601000A036F1701000A72B00F0070283000000A2C73036F1701000A281801000A0B042D1E0207283200000A036F1901000A73E400000A8C08000001281D0000062B4604076F1A01000A2C220207283200000A02036F1901000A04076F1B01000A17282E000006281D0000062B1B0207283200000A02036F1901000A1F1617282E000006281D0000060617580A06036F1C01000A3F64FFFFFFDE0802167D09000004DC2A0000000110000002000000ACAC0008000000001B3004001F02000023000011140A027B050000046F8000000A3893010000036F1D01000A174087010000036F1701000A72BC0F0070281500000A2C0D0203282F0000060A3868010000036F1701000A72D20F0070281500000A394B0100003839010000036F1701000A72D20F0070281500000A2C0D036F1D01000A1F0F3B2F010000036F1701000A72E20F0070281500000A3905010000027B060000042D0B0273B000000A7D06000004733F0000060B0372F40F00706F1E01000A2C5B0372F40F00706F1E01000A178D5400000113051105161F2C9D11056FB800000A13061613072B18110611079A0C077B11000004086F8200000A110717581307110711068E6932E0077B110000046F1F01000A2D0707147D1100000403720A1000706F1E01000A2C5B03720A1000706F1E01000A178D5400000113081108161F2C9D11086FB800000A130916130A2B181109110A9A0D077B10000004096F8200000A110A1758130A110A11098E6932E0077B100000046F1F01000A2D0707147D10000004027B0600000403721C1000706F1E01000A282001000A076FB100000A036F2101000A3ABCFEFFFF2B080203062830000006036F2101000A3A62FEFFFF027B050000042C66027B050000046F1B00000A130B2B40110B6F1C00000A13041204281D00000A166F1700000A1F3D3326021204281D00000A282A0000062D1772E00100701204281D00000A283700000A733500000A7A110B6F2800000A2DB7DE0C110B2C07110B6F2900000ADC2A00011000000200C5014D12020C000000000A142A001B3005004E0100001500001103722E100070723610007072441000706F2201000A0372B00F007072861000701472FA0E00706F2301000A03729810007072B81000706F2401000A03722E10007072C610007072441000706F2201000A0372D410007072FA0E00706F2401000A0372E810007072061100706F2401000A036F2501000A03722E100070728B11007072441000706F2201000A03729B11007072B81000706F2401000A03722E10007072A511007072441000706F2201000A027B050000046F1B00000A0B2B69076F1C00000A0A03722E10007072BD11007072441000706F2201000A03729B1100701200281D00000A280D01000A6F2401000A0372D111007072DB1100701200281E00000A282B0000068C070000016F2200000A6F2601000A282500000A6F2401000A036F2501000A076F2800000A2D8FDE0A072C06076F2900000ADC036F2501000A036F2501000A036F2501000A2A0000011000000200BC007531010A000000001B30040077000000150000110372B81000706F2701000A0372B00F007072B81000706F2401000A027B050000046F1B00000A0B2B33076F1C00000A0A031200281D00000A280D01000A6F2801000A03021200281E00000A17282D0000066F2901000A036F2A01000A076F2800000A2DC5DE0A072C06076F2900000ADC036F2501000A2A0001100000020027003F66000A000000001B3003008501000024000011027B050000046F9600000A2D012A0203283300000602032834000006027B06000004395D0100000372D20F00706F2701000A027B060000046F8400000A1304382001000011046F8500000A0A0372E20F00706F2701000A03721C1000701200288900000A13051205282B01000A6F2401000A720F0000700B1200288600000A7B110000046F8F00000A13062B291206289000000A0C0707720F000070281500000A2D0772840300702B05720F00007008281300000A0B1206289200000A2DCEDE0E1206FE160E00001B6F2900000ADC07720F000070283000000A2C0C0372F40F0070076F2401000A720F0000700B1200288600000A7B100000046F8F00000A13072B291207289000000A0D0707720F000070281500000A2D0772840300702B05720F00007009281300000A0B1207289200000A2DCEDE0E1207FE160E00001B6F2900000ADC07720F000070283000000A2C0C03720A100070076F2401000A036F2501000A11046F2800000A3AD4FEFFFFDE0C11042C0711046F2900000ADC036F2501000A2A000000414C0000020000008B00000036000000C10000000E00000000000000020000000101000036000000370100000E00000000000000020000003F00000033010000720100000C00000000000000133002004500000025000011036F2C01000A0A068D040000020B062D02072A160C2B2807088F04000002036F2D01000A7D0E00000407088F04000002036F2E01000A7D0F0000040817580C080632D4072A000000133004008003000026000011036F2C01000A0A062D012A160B3866030000140C04078F040000027B0F000004130711074522000000050000001B000000340000004A0000008A000000BB000000D100000077020000E7000000FD00000013010000770200003D01000067010000080200007D01000093010000A90100007702000077020000D50100001E0200003402000077020000770200005B020000770200007702000077020000EB0100007702000074000000BF010000A50000003872020000036F2F01000A73DF00000A8C110000010C388D020000036F2C01000A0D03096F3001000A73E100000A0C3874020000036F3101000A73E300000A8C090000010C385E020000036F2C01000A1305036F2C01000A1304036F2D01000A11041105733201000A8C080000010C3834020000036F2F01000A283301000A8C0C0000010C381E020000036F2F01000A283301000A73E600000A8C0D0000010C3803020000036F2F01000A283301000A8C0C0000010C38ED010000036F3401000A73E800000A8C3B0000010C38D7010000036F3501000A73EA00000A8C3C0000010C38C1010000036F2C01000A73EC00000A8C100000010C38AB010000036F3401000A73ED00000A8C3D0000010C3895010000036F2C01000A1305036F2C01000A1304036F2D01000A11041105733201000A8C080000010C386B010000036F2C01000A1305036F2C01000A1304036F2D01000A11041105733201000A8C080000010C3841010000036F3501000A73EE00000A8C3E0000010C382B010000036F2F01000A283301000A8C0C0000010C3815010000036F2E01000A73F000000A8C0F0000010C38FF000000036F3401000A73ED00000A8C3D0000010C38E9000000036F2F01000A283601000A8C0B0000010C38D3000000036F3701000A73F400000A8C0E0000010C38BD00000002282300000A287E00000A0C087502000001036F3801000A38A0000000036F2D01000A733901000A8C550000010C388A000000036F2C01000A0D03096F3001000A73E100000A0C2B74036F2C01000A1305036F2C01000A1304036F2D01000A11041105733201000A8C080000010C2B4D036F2D01000A737A00000A287B00000A13061106737C00000A0C2B3172EF11007004078F040000027B0F0000048C070000016F2200000A02282300000A6F2400000A283400000A733500000A7A082C18027B0500000404078F040000027B0E000004086F9500000A0717580B07063F93FCFFFF2A133003004501000027000011020328360000060A0203062837000006036F2C01000A0B072D0C02147D0600000438990000000273B000000A7D06000004160C3880000000036F2C01000A0D733F0000061304036F2C01000A130511051631231613062B1811047B10000004036F2D01000A6F8200000A1106175813061106110532E2036F2C01000A130511051631231613072B1811047B11000004036F2D01000A6F8200000A1107175813071107110532E2027B060000040911046FB100000A0817580C08073F79FFFFFF036F2C01000A0B072D0902147D070000042B2C02738300000A7D070000041613082B17027B07000004036F2C01000A6F8A00000A11081758130811080732E4036F2C01000A0B072D0902147D080000042B2C02738100000A7D080000041613092B17027B08000004036F2D01000A6F8200000A11091758130911090732E4036F2C01000A262A0000001B3002006B0000002800001103027B050000046F9600000A6F3A01000A027B050000046F9600000A2D012A027B050000046F1B00000A0C2B29086F1C00000A0A031200281D00000A6F3B01000A1200281E00000A282B0000060B0307686F3C01000A086F2800000A2DCFDE0A082C06086F2900000ADC2A000110000002002B003560000A000000001B300400CE0400002900001103027B050000046F9600000A6F3A01000A027B050000046F9600000A2D012A027B050000046F1B00000A1306388204000011066F1C00000A0A1200281E00000A282B0000060B0713071107452200000005000000210000006800000084000000DD0000002601000046010000B50300006601000086010000A6010000B5030000DF01000019020000F20200003A020000630200007F020000B5030000B5030000BF0200002103000065030000B5030000B50300009C030000B5030000B5030000B5030000DB020000B5030000BD0000009F0200000601000038B0030000031200281E00000AA51100000128BD00000A6F3D01000A38BA030000031200281E00000A74490000016F9B00000A696F3A01000A031200281E00000A74490000016F9C00000A161200281E00000A74490000016F9B00000A696F3E01000A3873030000031200281E00000AA50900000128C100000A6F3F01000A38570300001200281E00000AA5080000010C031202284001000A6F3A01000A031202284101000A6F3A01000A031202282B00000A6F3B01000A381E030000031200281E00000AA50C00000113081208284201000A6F3D01000A38FE020000031200281E00000AA50D00000113091209284301000A130A120A284201000A6F3D01000A38D5020000031200281E00000AA50C000001130B120B284201000A6F3D01000A38B5020000031200281E00000AA53B000001130C120C284401000A6F4501000A3895020000031200281E00000AA53C000001130D120D284601000A6F4701000A3875020000031200281E00000AA510000001130E120E284801000A6F3A01000A3855020000031200281E00000AA53D000001130F120F284901000A6F4501000A38350200001200281E00000AA5080000010D031203284001000A6F3A01000A031203284101000A6F3A01000A031203282B00000A6F3B01000A38FC0100001200281E00000AA5080000011304031204284001000A6F3A01000A031204284101000A6F3A01000A031204282B00000A6F3B01000A38C2010000031200281E00000AA53E00000113101210284A01000A6C6F4701000A38A1010000031200281E00000AA50D00000113111211284301000A13121212284201000A6F3D01000A3878010000031200281E00000AA50F00000128CA00000A6F3C01000A385C010000031200281E00000AA53D00000113131213284901000A6F4501000A383C010000031200281E00000AA50B00000113141214284B01000A6F3D01000A381C010000031200281E00000AA50E00000128CD00000A6F4C01000A38000100001200281E00000A7502000001036F4D01000A38E9000000031200281E00000AA55500000113151215284E01000A13161216FE165B0000016F2200000A6F3B01000A38BA000000031200281E00000A74490000016F9B00000A696F3A01000A031200281E00000A74490000016F9C00000A161200281E00000A74490000016F9B00000A696F3E01000A2B761200281E00000AA5080000011305031205284001000A6F3A01000A031205284101000A6F3A01000A031205282B00000A6F3B01000A2B3F031200281E00000A74120000016FD100000A6F3B01000A2B26728A120070078C070000016F2200000A02282300000A6F2400000A283400000A733500000A7A11066F2800000A3A72FBFFFFDE0C11062C0711066F2900000ADC2A0000411C0000020000002C00000095040000C10400000C000000000000001B300200050200002A000011020328390000060203283A000006027B060000042C0D027B060000046F4F01000A2B01160A03066F3A01000A063917010000027B060000046F8400000A130638EB00000011066F8500000A0B031201288900000A6F3A01000A1201288600000A7B100000042C131201288600000A7B100000046F1F01000A2B01160A03066F3A01000A0616313D1201288600000A7B100000046F8F00000A13072B0F1207289000000A0C03086F3B01000A1207289200000A2DE8DE0E1207FE160E00001B6F2900000ADC1201288600000A7B110000042C131201288600000A7B110000046F1F01000A2B01160A03066F3A01000A0616313D1201288600000A7B110000046F8F00000A13082B0F1208289000000A0D03096F3B01000A1208289200000A2DE8DE0E1208FE160E00001B6F2900000ADC11066F2800000A3A09FFFFFFDE0C11062C0711066F2900000ADC027B070000042C0D027B070000046FB300000A2B01160A03066F3A01000A062C39027B070000046F8B00000A13092B111209288C00000A13040311046F3A01000A1209289300000A2DE6DE0E1209FE160D00001B6F2900000ADC027B080000042C0D027B080000046F1F01000A2B01160A03066F3A01000A062C39027B080000046F8F00000A130A2B11120A289000000A13050311056F3B01000A120A289200000A2DE6DE0E120AFE160E00001B6F2900000ADC03166F3A01000A2A0000000140000002009A001CB6000E00000000020005011C21010E0000000002003F00FE3D010C00000000020077011E95010E000000000200D1011EEF010E00000000033004007400000000000000027B040000042D6502722313007016735001000A7D04000004027B040000046FD400000A722F1300706F5101000A027B040000046FD400000A72451300706F5201000A027B040000046F5301000A72671300706F5401000A027B040000046F2000000A72840300706F5501000A027B040000042A13300400650000002B000011021E8D2F0000010A0616726B130070A20617722F130070A2061872A3130070A2061972D7130070A2061A72E9130070A2061B721D140070A2061C722F140070A2061D725F140070A2067D0300000402280301000A735601000A7D0500000402285701000A2A7602738100000A7D1000000402738100000A7D1100000402285701000A2A00133001000E0000002C000011736B0000060A066F01000006062A5A02282B0000068C070000016F2200000A283200000A2A1E0228020000062A00000013300100080000002C000011736B0000060A062A1E0228080000062A220203283B0000062A22020328380000062A22020328310000062A22020328350000062A13300200290000002C0000110F00282A00000A2C0628430000062A736B0000060A060F00282B00000A283200000A6F09000006062A1E0228190000062A22020328180000062A3202281B000006283200000A2A3202281B000006283200000A2A26020304281D0000062A3A0203048C08000001281D0000062A26020304281D0000062A3A0203048C0E000001281D0000062A26020304281D0000062A46020304284E00000602052867000006022A220203281E0000062A360203281F00000674060000022A360203282000000674060000022A22020328210000062A22020328230000062A220203280B0000062A220203280C0000062A220203280D0000062A220203280F0000062A220203280E0000062A22020328100000062A22020328110000062A22020328120000062A22020328130000062A22020328140000062A360203281700000674060000022A360203280D000006735B01000A2A22020328150000062A22020328160000062A22020328260000062A1E0228270000062A22020328280000062A22020328290000062A1E02283D0000062A42534A4201000100000000000C00000076322E302E35303732370000000005006C000000F0160000237E00005C1700007C13000023537472696E677300000000D82A00007014000023555300483F0000100000002347554944000000583F00005C16000023426C6F620000000000000002000001571FA20B0902000000FA253300160000010000007700000006000000110000006B0000006A000000030000005B01000004000000320000002C000000020000000500000005000000010000001000000001000000040000000300000000000A00010000000000060083007C000A00B10096000E00E600CD000600F7007C000600FC007C000A001B0106010A0077018A000A00AE0106010A00D70106010600F2017C000600FD017C0006000D027C000A001D0206010A00340206010A00460206010A005A0206010A00690206010A007B0206010600DF02C4020A004F0339031200FE03C4020E001104C2000E0051043F040E006504C2000600A00496040600C604960406001405FF0412003C05C4020A006306060106001507F60606006B07590706008207590706009F0759070600BE0759070600D70759070600F007590706000B08590706002608590706003F08F60606005308590706006C08590706009C088908AB00B00800000600DF08BF080600FF08BF0806002F097C00060045097C000600A50999090600B309C4020600C109C4020600FC09FF040600240A7C000600310A59070600660A530A06007B0A7C000600C80A7C000A00110B96000600470B7C000A00610B06010A006C0B06010A00760B06010A007F0B06010600890B7C000600990B7C000600AA0B7C000600BB0B7C000600C10B96040600CE0B96040600E00B7C004F001A0C000006002C0C7C000600460CC4020A00660C06010A007A0C39030A00850C39030A00B40CA10C0A00F10CA10C0A000B0D8A000A00270D39030A00440DA10C0A00500D8A000A007B0D39030A00AD0DA10C0600BF0D7C000A00CA0D06010600D20D7C000E00000EC20006000B0E7C000E00220EC20006003F0E7C000600470E7C0006004C0EFF040600FA0EFF040600140F7C000E001B0F3F040E004C0F3F0406008A0FBF080600A50F7C000600CA0FC4020E00D60F3F040E00FA0F3F040E000A103F040E001B103F040E0038103F0406005C10530A0E006B103F040E0085103F040E00A810C2000E00DA103F040E00EE103F040E0015113F040E006811C2000A003D1206010600DF12FF0406002E13F60606004413F6060E004F13CD000A00601396000A00450A960000000000010000000000010001000120100020002E00050001000100020100003C00000011000B003F000A0110004900000015000E003F000200100058000000050010003F000120100020006500080012004000568025010A00568037010A002100EF042202010020052602010049052F0201004E05370201005B05400201006B054702010084054E021100630F060A0606A1055A025680A9055D025680AE055D020600B2050A000600B7056B020600BC0547020600CB05470250200000000086005101FA00010052200000000086085601FE000100552000000000910061010201010078200000000091006C0102010200EC2000000000910081010701030042210000000091008D01020104006421000000009100980102010500D02100000000C600A5010D010600F822000000008600B801110106002427000000008100C301170107001728000000008600CD011E0109004428000000008600E20124010A00D028000000008600E8012B010B002829000000008600060232010C00042A00000000860016023D010D00B82A000000008600290248010E00502B0000000086003C024F010F00D42C0000000086004F0256011000582E00000000860063025D011100DC2F000000008600720264011200603100000000860082026B0113000C3200000000860088024F011400903200000000860094027201150050330000000086009D02790116006433000000008600A902FA0017009433000000008600AF020D0117002034000000008600BB020D0117002834000000008600E6027F0117009434000000008600F002870117007036000000008600F9028E011900F836000000008600020394011A00D0370000000086000E0394011B0038380000000086001A0311011C00643800000000840026039B011D000C3900000000860032038E011F00B4390000000081005D03A1012000283A0000000081007103AB012400D03A000000008600810311012600CC3C0000000086008903FA002700903D0000000086009303B3012700CC3D0000000086009C0311012800F83E000000008100B303BA012900B03F000000009600C603BF012A00B440000000008100D103C5012B008041000000008600E003CB012C005C46000000008600EE03D2012E00A44C0000000086001B04DB013100204E0000000086002904E7013200F44E00000000E6013704F4013400305100000000E6015B04FA01350034510000000086006F04FF013500A0520000000086007E04FF013600345300000000E6018D04FF0137001455000000008600AD04050238006855000000008600B6040D023900F45800000000E601C10416023B00485A000000008600D3041C023C00D05A000000008600DD041C023D00C85F00000000E601E9041C023E001C620000000086082C052A023F009C620000000086189405FA003F00944C0000000091002F0FFE093F000D630000000086189405FA0041002C63000000009600DC056F0241004663000000009600E005740241005D6300000000E109E705FE004200686300000000960811066F0242007C6300000000C600A5010D0142008463000000008600E9041C0242008D63000000008600C1041602430096630000000086003704F40144009F630000000086008D04FF014500A8630000000096001A067A024600DD63000000008600A902FA004700E5630000000086009D0279014700EE63000000008608200681024800FB63000000008600BB02810248000864000000008600F0028701480012640000000086002A0686024A00216400000000860038068E024C002B640000000086003F0696024E003A640000000086004C069E02500044640000000086005606A60252005664000000008600F902B00255005F640000000086000203B60256006D640000000086000E03B60257007B640000000086001A031101580084640000000086003203B00259008D64000000008600CD011E015A009664000000008600E20124015B009F64000000008600E8012B015C00A86400000000860016023D015D00B164000000008600060232015E00BA64000000008600290248015F00C3640000000086003C024F016000CC640000000086004F0256016100D56400000000860063025D016200DE64000000008600720264016300E7640000000086009402BD026400F5640000000086006C06C4026500036500000000860082026B0166000C6500000000860088024F01670015650000000086008103110168001E650000000086008903FA00690026650000000086009303B30169002F650000000086009C0311016A0038650000000086189405FA006B0000000100AA0600000100AA0600000100B70500000100AA0600000100AA0600000100AE0600000100B20500000200B00600000100B20500000100B20500000100B20500000100B20500000100B20500000100B20500000100B20500000100B20500000100B20500000100B20500000100B20500000100B20500000100B20500000100B20500000100B20500000200BF0600000100BF0600000100BF0600000100BF0600000100B20500000100C50600000200CC0600000100D30600000100D70600000200E20600000300ED0602000400BF0600000100D70600000200220700000100B205000001002B0700000100BF0600000100B20500000100BF0600000100B70500000100BF0600000200340700000100BF0600000200B705000003003407000001003A07000001003A07000002003C07000001003A07000001004207000001004207000001004207000001003A07000001003A07000002004407000001003A0700000100420700000100420700000100420700000100430F000002004A0F00000100BF0600000100490700000100500700000100500700000100490700000100500700000100B20500000100B20500000200BF0600000100B20500000200BF0600000100B20500000200BF0600000100B20500000200BF0600000100B20500000200BF0600000100B20500000200BF0600000300220700000100BF0600000100BF0600000100BF0600000100B20500000100540700000100B20500000100B20500000100B20500000100B20500000100B20500000100B20500000100B20500000100B20500000100B20500000100B20500000100B20500000100B20500000100B20500000100B20500000100B205000001002B0700000100BF060200090002000D000600190031005601FE00F1009405FA00F9009405D50201019405D50209019405D50211019405D50219019405D50221019405D50229019405D50231019405D50239019405DA0241019405D50249019405D50251019405DF0261019405E60269019405FA0071019405FA0079014C09EB0279015409F10279015B090D0179016009F80279016C09FE0279017709020379018109070379018B09120381019405FA000C00D0091E031400DE093C031C00EA093C031C00F209490381016C09FE02D900050A4E039901120A0D010900A5010D010900290A5403A9013C0A0D01790154095A037901450A600381014C0A6803B101720AFE00B901870AFA0041005601FE004100F2090D0124008F0AFE0024009C0A3C032C00940597032C008F0AFE007901AE0AF8022400940597034100BC0A9D03C101D20A0D017901450AA303C1019405D50279018109AA037901450AAF03410060091E044900DE0A27044900BC0A2D044900E60A33047901F30ABA010C00FC0A3C040C00080B420449009F06490449001A064D0441009F065904C9019405FA003400940597036100240B9C046900320BA10459001A06A80461003E0BC9043C009405970361001A06CE0469009F06EB046900BC0AEF0471009F06FC047900570B00058100570B00058900570B00054900570B0005D901570B0005E101570B0005E901570B0005F101570B0005F9011A0605057100BC0A0D0579009F062D0571008E0B310581008E0B310589008E0B310549008E0B3105D9018E0B3105E1018E0B3105E9018E0B3105F1018E0B310501021A0636057900BC0A3E0581009F065E0571009F0B620579009F0B620589009F0B620549009F0B6205D9019F0B6205E1019F0B6205E9019F0B6205F1019F0B620509021A0667058100BC0A6F0589009F068F057100B00B93057900B00B93058100B00B93054900B00B9305D901B00B9305E101B00B9305E901B00B9305F101B00B930511021A0698058900BC0AA00591001106C0054100320BC50519029405D502B100D90BCB0591009405F401C1019405FA002902EA0BE1059100F90BE8050C00A902FA0044009405FA004400060C97034C009405FA005400D0091E035C00DE093C036400F209490379010A0C0D014400120C54066400EA093C034C00060C97034C00D0095A066C00DE093C035400080B42045400250C3C044400D0095A067400DE093C030C00250C3C047400720AFE006C00720AFE000C00330C72060C00060C72060C003C0CFE020C004E0CC1067C00080BD2060C00570CE6023902600C0A0749026C090F0749026F0C13075102940520075102930C27076102C104FE006102C10C2D076102CA0C32076102D30CAA036102DD0CFA00A100E30C41076902FB0CD5026902170D4707790294054E077902340DD5028102630D55078102710D5C075102920D61079102060C67075902A10D7007A1009405D5029902BA0DFA0054009405FA005400060C72065400FC0A3C044C003C0CFE024C00570CE6025400A902FA0081005601FE008100320BDD077901C40DE307610060091E08A101E40D2B0821001A0634082100F60D3D088900320B4E08B902A50154084902F2091307C102130E59084900320B2704B902A5015F08D901320B6808B902A5017108E101320B7808B902A5017F08B902A5018408E901320B8908F101320B92087900320B9908B902A5019F08C102A501A4087100320BA908B902A501AF08A902320BB408B902A501BD089100F2090D01C102A501C408C102A501CC08D9005F0ED408E102720E0D016100A501DA08C102A501E208C102A501EB08C102A501F508C102A501FD08C102A5010509C102A5010D09C102A5011509B902870E3309890094053809C1028F0E3D09490294054309B902A00E120349009405DA0241009405D502B902AA0E4909690094055209B902B50E5809D90194055F09B902BF0E6609E10194056B09B902C80E700981009405E602E90194055F09F10194056B09B902D00E7509790094057A095900D80E7F09B902E10EA804B902EC0E8709710094058C09B902F30E9109A902940598096100090F9F09D1021A06AD09D901BC0AB709F1021A06C009E101BC0AC809E901BC0ACF09F101BC0AD809A9021A06DF0909039405FA00F902D20A0D01010394050B0AB900C104110A1103B40F1B0A84009405290AB900F00F340A2103080B3A0A31032910410A41034D10340A49033C0CFE022103D009470A5103DE094D0A59033C0A0D01B902981002015903B910530A6103CC100D0161033C0A0D018400060C720659032910590A690309115F0A79033411530A5103720AFE00B1004511E602B1003C0A0D01B9026C010201B100F2090D018400FC0A3C048400080B4204B1005511FE02B1007411840AB10081118A0A44003C0CFE0209021A067009B100C104FE00C1008E11BA0AC100A011C10AC100A011C90AC100B511FA007901C5110D01C1008E11D502C100CD11D502C100E111D502C100EC11FA000902A5010D01C900FE11FE02C90008120D01C9001312F70AC9001D120F07C9002712030BC9003112FE0041009405090B61004F12120BC9005A12180BC90066121E0B59007112220BC9007B12280B1100C1041602A9029405D502D100E904E602D100E904D502D100E9047A09D100E9043809D100E904630BD100E904DA02410084126B0B41009A12FE026100A3120F076900F209C904D901F209180BD100E9045F09E101F2091E0BD100E9046B098100F209FE02E901F209180BF101F209710B5900AC120F07D100E9048C091100E9041C02A902F209750B54003C0CFE02D9009405F70BE102B612D502E102CB12D502D900F012FD0B91030113D50299011C13D5020C009405290A09009405FA0099039405080CA9039405D502B10394051B0CE900940511010E0004000D000E00080076000800300061020800340066022E005B000A162E006B001D162E0073002A162E0043000A162E004B000A162E003B0010162E007B0033162E0083003C162E001B00F9152E0023000A162E002B000A162E0033000A16C300D30A220CC300CB0A0F0C4101FB076602C00113026104C007FB07660220091302680C40091302880C60091302A80CA0091302CE0CC0091302110DE0091302410D000A1302760D200A1302A40D400A1302D80D600A1302090E800A1302600FA00A1302900FC00A1302C30FE00A1302F60F000B13022910200B13024A10400B13028E10600B1302CE10800B13021211A00B13025311C00B13029411E00B1302D911000C13021D12200C13026212400C1302A212600C1302E512800C13022813A00C13026F13C00C1302AF13E00C1302F513000D13024715200D13027815400D1302BB150D036F03B50353045D04AE04D704F604130544057505A605D305DB05ED05F50514067A06AA06D806F4061807370775078807BB07EA07FE07260845081D09E609650A7F0A8F0ACF0AFB0A2C0B3B0B4B0B7B0BC20B030C630C020001000600030000009A05510200001405550200007906510200009F06CB020000A406D00202000200030002003C00050002004200070002004300090002004C000B0006008400030017032F0341038B0391039504C2040E062F0635063D064B0664066B06CB06210A0480000002000000000002000000000000001D090000020000000000000000000000010073000000000002000000000000000000000001008A00000000000200000000000000000000000100C2000000000002000000000000000000000001007C00000000000300020004000200050002000000003C4D6F64756C653E005544542E54506172616D735F454D5054592E646C6C0054506172616D735F454D5054590053716C2E494E545F454D5054590056616C756544625374796C650053716C4462506172616D496E666F005072657061726564446174610053716C2E5544545F454D505459006D73636F726C69620053797374656D004F626A6563740053797374656D2E44617461004D6963726F736F66742E53716C5365727665722E536572766572004942696E61727953657269616C697A650053797374656D2E586D6C0053797374656D2E586D6C2E53657269616C697A6174696F6E0049586D6C53657269616C697A61626C6500456E756D0056616C7565547970650053797374656D2E446174612E53716C547970657300494E756C6C61626C650053716C54797065734E616D6573706163650053716C54797065734E616D6573706163654C6F636174696F6E00496E6974006765745F49734E756C6C00456E636F64654E616D65004465636F64654E616D650053716C44625479706500497351756F7465547970650051756F746556616C756500556E51756F746556616C756500546F537472696E670053716C537472696E670046726F6D537472696E6700436865636B4E616D6500417356617269616E740053716C426F6F6C65616E00417342697400417356617243686172004E756C6C61626C6560310054696D655370616E00417354696D65004461746554696D65004173446174650053716C4461746554696D650041734461746554696D650053716C4279746500417354696E79496E740053716C496E743136004173536D616C6C496E740053716C496E743332004173496E740053716C496E743634004173426967496E740053716C586D6C004173586D6C00417356617242696E617279004173506172616D7300457869737473506172616D00436C65617200537472696E674E616D6573004765744E616D65730053797374656D2E436F6C6C656374696F6E732E47656E65726963004C6973746031004C6973744E616D657300416464506172616D0043726F7373696E670043726F7373506172616D73004D65726765506172616D730044656C657465506172616D00457175616C56616C75657300457175616C730053797374656D2E446174612E53716C436C69656E740053716C436F6E6E656374696F6E00476574457874656E64656450726F7065727479004578656353514C46756E6374696F6E005072657061726500556E50726570617265005072657061726564005265676973746572446570656E646564506172616D7300497343616C63756C61746564506172616D730047657453716C54797065005479706546726F6D537472696E670056616C7565546F537472696E670056616C756546726F6D537472696E6700536F7274656444696374696F6E617279603200586D6C5265616465720052656164586D6C536368656D610052656164586D6C56616C7565730052656164586D6C0053797374656D2E586D6C2E536368656D6100586D6C536368656D6100476574536368656D6100586D6C577269746572005772697465586D6C536368656D61005772697465586D6C56616C756573005772697465586D6C0053797374656D2E494F0042696E6172795265616465720052656164496E666F005265616456616C75657300526561640042696E617279577269746572005772697465496E666F00577269746556616C756573005772697465004461746554696D65466F726D6174730053797374656D2E476C6F62616C697A6174696F6E0043756C74757265496E666F0063756C74757265496E666F006765745F43756C74757265496E666F00536F727465644C69737460320064617461007072657061726564446174610070726570617265644F626A656374730072656769737465726564446570656E646564506172616D730069676E6F7265436865636B4E616D65002E63746F720049734E756C6C0076616C75655F5F005465787400586D6C006E616D65007479706500646570656E646564506172616D730063616C63756C61746564506172616D73004E657700547970654F660053797374656D2E446174612E53716C54797065732E494E756C6C61626C652E6765745F49734E756C6C006765745F4E756C6C005061727365006765745F4E616D657300416464566172436861724D617800416464586D6C0041646456617242696E61727900416464506172616D730050726570617265506172616D0053716C4368617273004173566172436861724D61780053797374656D2E446174612E53716C54797065732E494E756C6C61626C652E49734E756C6C004E756C6C004E616D6573007374720073007072657061726564506172616D730076616C75650076616C7565310076616C7565320061726700636F6E6E656374696F6E006F626A6563744E616D650070726F704E616D650053797374656D2E52756E74696D652E496E7465726F705365727669636573004F75744174747269627574650066756E634E616D65006F626A6563744964007374796C650072007479706573007700696E666F005461726765740053726300617267730053797374656D2E5265666C656374696F6E00417373656D626C795469746C6541747472696275746500417373656D626C794465736372697074696F6E41747472696275746500417373656D626C79436F6E66696775726174696F6E41747472696275746500417373656D626C79436F6D70616E7941747472696275746500417373656D626C7950726F6475637441747472696275746500417373656D626C79436F7079726967687441747472696275746500417373656D626C7954726164656D61726B41747472696275746500417373656D626C7943756C7475726541747472696275746500436F6D56697369626C6541747472696275746500417373656D626C7956657273696F6E41747472696275746500417373656D626C7946696C6556657273696F6E4174747269627574650053797374656D2E446961676E6F73746963730044656275676761626C6541747472696275746500446562756767696E674D6F6465730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C697479417474726962757465005544542E54506172616D735F454D5054590053657269616C697A61626C6541747472696275746500537472696E67005265706C61636500436F6E636174005472696D006F705F457175616C697479006765745F4C656E677468006765745F436861727300537562737472696E670049734E756C6C4F72456D7074790053797374656D2E5465787400537472696E674275696C6465720049456E756D657261746F726031004B657956616C756550616972603200476574456E756D657261746F72006765745F43757272656E74006765745F4B6579006765745F56616C75650054657874496E666F006765745F54657874496E666F006765745F4C697374536570617261746F7200547970650047657454797065004D656D626572496E666F006765745F4E616D6500466F726D617400417070656E640053797374656D2E436F6C6C656374696F6E730049456E756D657261746F72004D6F76654E6578740049446973706F7361626C6500446973706F7365006765745F48617356616C75650047657456616C75654F7244656661756C74006F705F496E657175616C697479006F705F496D706C6963697400457863657074696F6E006765745F4D657373616765006F705F54727565006F705F426974776973654F7200436F6E7461696E7300436F6E7461696E734B6579006765745F4974656D0053716C4D6574686F64417474726962757465006765745F54696D654F66446179006F705F4578706C69636974006765745F446174650049466F726D617450726F766964657200546F53716C427974650053716C446563696D616C0053716C446F75626C650053716C4D6F6E65790053716C53696E676C65004279746500546F53716C496E74313600496E74313600546F53716C496E74333200496E74333200546F53716C496E74363400496E74363400537472696E6752656164657200546578745265616465720043726561746500416374697661746F7200437265617465496E7374616E6365004372656174655265616465720041646400546F557070657200496E6465784F6600456E756D657261746F720052656D6F76650044424E756C6C007365745F4974656D006765745F436F756E7400494C6973746031006765745F4B6579730052656D6F766541740056616C75650053716C4279746573006765745F4275666665720053716C436F6D6D616E640053716C4461746152656164657200457865637574655265616465720053797374656D2E446174612E436F6D6D6F6E0044624461746152656164657200497344424E756C6C00476574496E74333200476574537472696E6700436C6F736500437265617465436F6D6D616E64004462436F6D6D616E64007365745F436F6D6D616E645465787400436F6D6D616E6454797065007365745F436F6D6D616E64547970650053716C506172616D65746572007365745F556474547970654E616D65004462506172616D6574657200506172616D65746572446972656374696F6E007365745F446972656374696F6E007365745F56616C75650053716C506172616D65746572436F6C6C656374696F6E006765745F506172616D65746572730047657453716C56616C7565004462436F6E6E656374696F6E004F70656E00436861720053706C69740053716C477569640052756E74696D655479706548616E646C65004765745479706546726F6D48616E646C65004973446566696E656400586D6C436F6E7665727400436F6E7665727400546F426173653634537472696E6700586D6C4461746554696D6553657269616C697A6174696F6E4D6F646500446563696D616C0047756964004461746554696D65466F726D6174496E666F006765745F4461746554696D65466F726D6174006765745F53686F7274446174655061747465726E00546F496E7436340046726F6D426173653634537472696E6700546F426F6F6C65616E00546F4461746554696D6500546F446563696D616C00546F446F75626C6500546F496E74333200546F496E74313600547279506172736500546F54696D655370616E00546F4279746500546F47756964004461746554696D655374796C6573005061727365457861637400446F75626C650056616C69646174696F6E4576656E7441726773003C52656164586D6C536368656D613E625F5F300073656E64657200650056616C69646174696F6E4576656E7448616E646C6572004353243C3E395F5F436163686564416E6F6E796D6F75734D6574686F6444656C65676174653100436F6D70696C657247656E65726174656441747472696275746500537472696E67436F6D7061726572006765745F4F7264696E616C49676E6F7265436173650049436F6D7061726572603100586D6C536368656D614F626A656374436F6C6C656374696F6E006765745F4974656D7300586D6C536368656D614F626A65637400586D6C536368656D61456C656D656E7400586D6C536368656D6154797065006765745F536368656D615479706500586D6C536368656D61436F6D706C657854797065006765745F4174747269627574657300436F6C6C656374696F6E4261736500586D6C536368656D614F626A656374456E756D657261746F7200586D6C536368656D6141747472696275746500456E636F64654C6F63616C4E616D6500586D6C5175616C69666965644E616D65006765745F536368656D61547970654E616D65006765745F4E616D65737061636500586D6C536368656D6153696D706C655479706500586D6C536368656D6153696D706C6554797065436F6E74656E74006765745F436F6E74656E7400586D6C536368656D6153696D706C65547970655265737472696374696F6E006765745F42617365547970654E616D65004D6F7665546F417474726962757465006765745F417474726962757465436F756E7400586D6C4E6F646554797065006765745F4E6F646554797065004765744174747269627574650057726974655374617274456C656D656E74005772697465417474726962757465537472696E67005772697465456E64456C656D656E7400546F4C6F776572005772697465537461727441747472696275746500577269746556616C7565005772697465456E644174747269627574650052656164496E7433320052656164537472696E670052656164496E7431360052656164496E743634005265616442797465730052656164426F6F6C65616E0053716C436F6D706172654F7074696F6E730046726F6D42696E6172790052656164446563696D616C0052656164446F75626C650046726F6D5469636B73005265616442797465006765745F53716C436F6D706172654F7074696F6E73006765745F4C43494400546F42696E617279006765745F5469636B73007365745F53686F7274446174655061747465726E007365745F4C6F6E6754696D655061747465726E004E756D626572466F726D6174496E666F006765745F4E756D626572466F726D6174007365745F4E756D626572446563696D616C536570617261746F72007365745F4C697374536570617261746F72005374727563744C61796F7574417474726962757465004C61796F75744B696E6400586D6C526F6F744174747269627574650053716C55736572446566696E6564547970654174747269627574650000035B0000035D0000055D005D0000010003220000052200220000157B0030007D007B0031007D003D007B0032007D0000033A0000611D0435043204350440043D043E04200037043004340430043D043E04200037043D043004470435043D04380435042000540050006100720061006D0073005F0045004D00500054005900200027007B0030007D0027003A0020007B0031007D000180831D0435043204350440043D043E04200037043004340430043D043E04200037043D043004470435043D04380435042000540050006100720061006D0073005F0045004D00500054005900200027007B0030007D0027003A0020003E044204410443044204410442043204430435044204200037043D043004470435043D0438043504017D1D0435043204350440043D043E04200037043004340430043D043E04200037043D043004470435043D04380435042000540050006100720061006D0073005F0045004D00500054005900200027007B0030007D0027003A0020003E044204410443044204410442043204430435044204200027007B0031007D002700014518043C044F0420003F043004400430043C04350442044004300420003D04350420003C043E04360435044204200031044B0442044C0420003F044304410442044B043C040180F51D0435043204350440043D043E043504200038043C044F0420003F043004400430043C043504420440043004200027007B0030007D0027002C0020003F043004400430043C0435044204400420003D043004470438043D0430044E0449043804390441044F0420004104200027003D00270020003C043E04360435044204200031044B0442044C04200037043004340430043D042800380437043C0435043D0435043D042900200042043E043B044C043A043E04200032042000440443043D043A0446043804380420003F043E04340433043E0442043E0432043A04380420003F043004400430043C043504420440043E0432040180AB1D0435043204350440043D043E043504200038043C044F0420003F043004400430043C043504420440043004200027007B0030007D002700200032042000440443043D043A0446043804380420003F043E04340433043E0442043E0432043A04380420003F043004400430043C043504420440043E0432042C00200034043E043B0436043D043E0420003D043004470438043D04300442044C0441044F0420004104200027003D00270001033B00007F1D0435043204350440043D043E043504200038043C044F0420003F043004400430043C043504420440043004200027007B0030007D0027002C00200038043C044F04200041043E04340435044004360438044204200037043D0430043A042000400430043704340435043B043804420435043B044F04200027002C0027000180871D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D00270020003F043004400430043C043504420440043004200027007B0031007D002700200032042000420438043F0420004200690074000180891D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D00270020003F043004400430043C043504420440043004200027007B0031007D002700200032042000420438043F042000540069006D0065000180891D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D00270020003F043004400430043C043504420440043004200027007B0031007D002700200032042000420438043F04200044006100740065000180911D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D00270020003F043004400430043C043504420440043004200027007B0031007D002700200032042000420438043F0420004400610074006500540069006D00650001808F1D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D00270020003F043004400430043C043504420440043004200027007B0031007D002700200032042000420438043F042000540069006E00790049006E0074000180911D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D00270020003F043004400430043C043504420440043004200027007B0031007D002700200032042000420438043F04200053006D0061006C006C0049006E00740001808B1D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D00270020003F043004400430043C043504420440043004200027007B0031007D002700200032042000420438043F04200049006E0074003300320001808D1D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D00270020003F043004400430043C043504420440043004200027007B0031007D002700200032042000420438043F04200042006900670049006E0074000180871D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D00270020003F043004400430043C043504420440043004200027007B0031007D002700200032042000420438043F04200058006D006C000180931D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D00270020003F043004400430043C043504420440043004200027007B0031007D002700200032042000420438043F042000560061007200420069006E006100720079000180871D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D00270020003F043004400430043C043504420440043004200027007B0031007D002700200032042000420438043F0420007B0032007D000180AF1D0435043B044C0437044F042000380441043F043E043B044C0437043E043204300442044C0420003F0440043E0446043504340443044004430420003E0447043804410442043A04380420003F043004400430043C043504420440043E0432042000270043006C00650061007200270020003204200040043504360438043C04350420003F043E04340433043E0442043E0432043A04380420003F043004400430043C043504420440043E04320401819B530045004C0045004300540020004F0042004A004500430054005F0049004400280027007B0030007D00270029002C0020002800530045004C004500430054002000430041005300540028005B00760061006C00750065005D002000410053002000560041005200430048004100520028004D0041005800290029002000460052004F004D0020005B007300790073005D002E005B0066006E005F006C0069007300740065007800740065006E00640065006400700072006F00700065007200740079005D00200028002700540050006100720061006D0073005F0045004D005000540059003A003A007B0031007D0027002C002000270073006300680065006D00610027002C002000500041005200530045004E0041004D004500280027007B0030007D0027002C002000320029002C0020002700460055004E004300540049004F004E0027002C002000500041005200530045004E0041004D004500280027007B0030007D0027002C002000310029002C002000640065006600610075006C0074002C002000640065006600610075006C00740029002900012D1D04350420003D0430043904340435043D0420003E0431044A0435043A044204200027007B0030007D0027000127530045004C0045004300540020007B0030007D002800400050006100720061006D0073002900000F400050006100720061006D007300002B5B00640062006F005D002E005B00540050006100720061006D0073005F0045004D005000540059005D00002F63006F006E007400650078007400200063006F006E006E0065006300740069006F006E003D007400720075006500000F50007200650070006100720065000080B11C04350442043E04340420005200650067006900730074006500720044006500700065006E0064006500640050006100720061006D00730020003C043E043604350442042000380441043F043E043B044C0437043E043204300442044C0441044F04200042043E043B044C043A043E04200032042000440443043D043A0446043804380420003F043E04340433043E0442043E0432043A04380420003F043004400430043C043504420440043E0432040173220438043F04200027007B0030007D00270020003D04350420003F043E04340434043504400436043804320430043504420441044F042000420435043A044304490435043904200032043504400441043804350439042000540050006100720061006D0073005F0045004D0050005400590001033000000331000021210438044104420435043C043D0430044F0420003E044804380431043A04300401671D04350420004304340430043B043E0441044C04200041043A043E043D043204350440044204380440043E043204300442044C04200037043D043004470435043D0438043504200027007B0030007D002700200032042000420438043F0420007B0031007D00016968007400740070003A002F002F0073006300680065006D00610073002E006D006900630072006F0073006F00660074002E0063006F006D002F00730071006C007300650072007600650072002F0032003000300034002F00730071006C0074007900700065007300004B1D04350420003F043E043404340435044004360438043204300435043C044B0439042000420438043F0420003F043004400430043C043504420440043004200027007B0030007D002700010B78006D006C006E00730000157800730064003A0073006300680065006D006100000F4F007000740069006F006E0073000011500072006500700061007200650064000015430061006C00630075006C006100740065006400001144006500700065006E0064006500640000114F0062006A00650063007400490064000007780073006400000D73006300680065006D006100004168007400740070003A002F002F007700770077002E00770033002E006F00720067002F0032003000300031002F0058004D004C0053006300680065006D0061000011730071006C0074007900700065007300001F7400610072006700650074004E0061006D00650073007000610063006500000D50006100720061006D007300000D69006D0070006F007200740000136E0061006D00650073007000610063006500001D73006300680065006D0061004C006F0063006100740069006F006E0000808368007400740070003A002F002F0073006300680065006D00610073002E006D006900630072006F0073006F00660074002E0063006F006D002F00730071006C007300650072007600650072002F0032003000300034002F00730071006C00740079007000650073002F00730071006C00740079007000650073002E00780073006400000F65006C0065006D0065006E00740000096E0061006D006500001763006F006D0070006C006500780054007900700065000013610074007400720069006200750074006500000974007900700065000013730071006C00740079007000650073003A000080991D04350432043E0437043C043E0436043D043E0420003F0440043E04470438044204300442044C042000340430043D043D044B0435042C002000420438043F04200027007B0030007D00270020003D04350420003F043E04340434043504400436043804320430043504420441044F042000420435043A0443044904350439042000320435044004410438043504390420007B0031007D000180971D04350432043E0437043C043E0436043D043E042000370430043F0438044104300442044C042000340430043D043D044B0435042C002000420438043F04200027007B0030007D00270020003D04350420003F043E04340434043504400436043804320430043504420441044F042000420435043A0443044904350439042000320435044004410438043504390420007B0031007D00010B65006E002D0055005300011579007900790079002D004D004D002D00640064000121480048003A006D006D003A00730073002E00460046004600460046004600460000032E00003779007900790079002D004D004D002D00640064002000480048003A006D006D003A00730073002E0046004600460046004600460046000133790079002D004D004D002D00640064002000480048003A006D006D003A00730073002E0046004600460046004600460046000111790079002D004D004D002D0064006400013379007900790079004D004D00640064002000480048003A006D006D003A00730073002E004600460046004600460046004600001179007900790079004D004D0064006400002F790079004D004D00640064002000480048003A006D006D003A00730073002E004600460046004600460046004600000D790079004D004D006400640000000000B6AD084CAAEFCC4B95D39C5E278053C40008B77A5C561934E08902060E6868007400740070003A002F002F0073006300680065006D00610073002E006D006900630072006F0073006F00660074002E0063006F006D002F00730071006C007300650072007600650072002F0032003000300034002F00730071006C0074007900700065007300808268007400740070003A002F002F0073006300680065006D00610073002E006D006900630072006F0073006F00660074002E0063006F006D002F00730071006C007300650072007600650072002F0032003000300034002F00730071006C00740079007000650073002F00730071006C00740079007000650073002E0078007300640003200001032000020400010E0E05000102111D0320000E052001011121062002011121020520011C112106200111251121062001112111210A200115112901112D11210A200115112901113111210620011135112106200111391121062001113D11210620011141112106200111451121062001124911210620011208112105200102112107200015124D010E0620020111211C05200102120806200112081208052002021C1C0920040812510E0E100E072002120812510E06200111251141042001020E050001111D1C052001111D0E0620020E1C110C0820031C0E111D110C0B2001151255020E111D12590C2002011259151255020E111D052001011259042000125D0520010112610720011D111012650820020112651D111005200101126505200101126903061D0E0306126D042000126D0706151271020E1C080615127102081214060615124D0108060615124D010E02060203280002042800126D0206080306110C040000000004010000000306111D040000121805000111211C0600011218112104200011210720020111211121072002011121124907200201112111390720020111211218092003121811211C112105200102121806200112181218062001121811210620011275112104080012180428001121042001010E0420010102062001011180AD04200101080520020E0E0E0600030E0E0E0E050002020E0E0320000804200103080520020E0808040701111D040001020E06151271020E1C102000151280C501151180C902130013010C151280C501151180C9020E1C042000130007151180C9020E1C04200013010520001280CD0520001280D10500020E0E0E0700040E0E1C1C1C0620011280C10E1B07051280C1151180C9020E1C111D02151280C501151180C9020E1C05151129010305151129010805200101130005000111210E0600030E0E1C1C0420010E080500020E0E1C68071F0E0E0E08080802021511290103080E111D1280E115112901031511290108151129010808151129010303151129010315112901081511290108151129010315112901081511290108151129010315112901081511290108151129010315112901081511290108080002112511211121050001021125050001112502080002112511251125052001021300062001130113000306112505000111250E0507021C1125030611210307011C3301000300540E044E616D6506417354696D6554020F497344657465726D696E69737469630154020A4F6E4E756C6C43616C6C000615112901112D042000112D06000111311135050001112D0E1307051C15112901112D15112901112D1131113106151129011131042000113108000211310E1280E91307051C1511290111311511290111311131113103061135060001113511310507021C1135030611390420001139070002050E1280E905000111390519070A1C1139113D1141114511251180ED1180F11180F51180F90306113D042000113D070002060E1280E9050001113D0619070A1C113D11391141114511251180ED1180F11180F51180F9030611410420001141070002080E1280E905000111410819070A1C11411139113D114511251180ED1180F11180F51180F90306114504200011450700020A0E1280E905000111450A19070A1C11451139113D114111251180ED1180F11180F51180F904000012490500010E112107000112591281110707031C125912490507021C11390600011C1280D104200012590707031C120812081807031280C1151180C9020E1C151280C501151180C9020E1C0515124D010E1A070315124D010E151180C9020E1C151280C501151180C9020E1C0515124D010807151271020812140D151280C501151180C90208121408151180C90208121405200108130009200015118119011300061511811901080615118119010E07200201130013012F070815124D0108151180C9020812140815124D010E0E151280C501151180C90208121415118119010815118119010E160703151180C9020E1C02151280C501151180C9020E1C092000151281210113000615128121010E0520011300081B070415124D010E151180C9020E1C08151280C501151180C9020E1C150702151180C9020E1C151280C501151180C9020E1C040612811D0320000A0420001D05070703111D111D08062002010E125105200012812D042001020804200108080907030812812912812D05200012812906200101118139062002010E111D06200101118145042001011C05200012814908200112813D12813D0420011C08120706120812812912813D12812D1280E1120832070912510E0812141208151180C902081214151180C9020E1C151280C501151180C902081214151280C501151180C9020E1C21070515124D010E151180C9020E1C0E151280C501151180C9020E1C15118119010E0500010811410620011D0E1D031307081D0E0E0812141D031D0E081511811901081F0705151180C9020812140E02151280C501151180C90208121415118119010E070002021131113104070111310800011280D11181590800031C1280D10E02070002021280D11C080703111D111D111D0500010A11450400010E0A0500010E1D050800020E11311181650800011181691180ED0600010E1181690600010D1180F10400010E0D0400010E080800011181691180F50600010C1180F905000106113D0400010E060400010E1C0500010511390400010E0508000111816D1181550600010E11816D0700020E0A1280E90700020E021280E90520001281710720020E0E1280E90800020E11311280E90900020E1181691280E90700020E0D1280E90700020E081280E90700020E061280E90700020E1C1280E90700020E051280E9150709111D111D111D112111311121112111815511210400010A0E042001010A0500011D050E052001011D0508000211310E1181650520010111310600011181690E062001011181690400010D0E042001010D040001080E040001060E0420010106070002020E10112D040001050E042001010506000111816D0E0620010111816D0D000411310E1D0E1280E91181750900021181690E1280E90800011180ED1181690700020D0E1280E90600011180F10D0800011180F51181690600011180F90C0600011181550E17070B112D120812591259120812591C111D1131111D1131070002011C12817D0406128181052002011C18090002125D125912818105000012818907151255020E111D0A2001011512818D0113000520001281910620011281950805200012819D0520001281A90520001281950520001281B10520001281B50520001281B9190708151255020E111D125D1281991281A11281A90E1281AD0E040702080E0520001181C10420010E0E2A070C151255020E111D12140E0E151180C9020E1C1D031D0E081D031D0E08151280C501151180C9020E1C062003010E0E0E072004010E0E0E0E052002010E0E270708151180C9020812140E0E0E151280C501151180C9020812140815118119010E15118119010E03200006070703081D1110080520011D0508082003010E081181C505000111310A0520001181690320000D050001112D0A032000050E070808081C08081181C51259111D0F070A1D111008080812140808080808170703151180C9020E1C111D151280C501151180C9020E1C072003011D0508080520001181C50320000C05200011816D460717151180C9020E1C111D1121112111211121151280C501151180C9020E1C111D11311135113111311180ED1180F111411180F51180F9113511311180F5112D11815511816D34070B08151180C9020812140E0E080E151280C501151180C90208121415118119010E15118119010E15118119010815118119010E052002010E020520001281C90407011D0E062001011181D10B010006506172616D730000062001011181DD40010002000000030054020D4973427974654F7264657265640154080B4D61784279746553697A65FFFFFFFF540E044E616D650D54506172616D735F454D50545904070112181F01000200540E044E616D6505506172736554020A4F6E4E756C6C43616C6C001F01000200540E044E616D6505436C65617254020A4F6E4E756C6C43616C6C002501000200540E044E616D650B457869737473506172616D54020A4F6E4E756C6C43616C6C014201000400540E044E616D65084765744E616D657354020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C002F01000300540E044E616D6508416464506172616D54020949734D757461746F720154020A4F6E4E756C6C43616C6C013401000300540E044E616D650D416464566172436861724D617854020949734D757461746F720154020A4F6E4E756C6C43616C6C012D01000300540E044E616D6506416464586D6C54020949734D757461746F720154020A4F6E4E756C6C43616C6C013301000300540E044E616D650C41646456617242696E61727954020949734D757461746F720154020A4F6E4E756C6C43616C6C013001000300540E044E616D6509416464506172616D7354020949734D757461746F720154020A4F6E4E756C6C43616C6C01815501000500540E044E616D650C50726570617265506172616D54020949734D757461746F720054020A4F6E4E756C6C43616C6C015455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730100000054557F4D6963726F736F66742E53716C5365727665722E5365727665722E53797374656D446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038391053797374656D44617461416363657373010000002F01000300540E044E616D650843726F7373696E6754020949734D757461746F720054020A4F6E4E756C6C43616C6C013201000300540E044E616D650B43726F7373506172616D7354020949734D757461746F720054020A4F6E4E756C6C43616C6C003201000300540E044E616D650B4D65726765506172616D7354020949734D757461746F720054020A4F6E4E756C6C43616C6C013201000300540E044E616D650B44656C657465506172616D54020949734D757461746F720154020A4F6E4E756C6C43616C6C002001000200540E044E616D6506457175616C7354020A4F6E4E756C6C43616C6C014301000400540E044E616D6509417356617269616E7454020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C003F01000400540E044E616D6505417342697454020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C004301000400540E044E616D650941735661724368617254020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C004001000400540E044E616D650641734461746554020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C004001000400540E044E616D6506417354696D6554020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C004401000400540E044E616D650A41734461746554696D6554020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C004301000400540E044E616D6509417354696E79496E7454020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C004401000400540E044E616D650A4173536D616C6C496E7454020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C003F01000400540E044E616D65054173496E7454020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C004201000400540E044E616D65084173426967496E7454020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C004201000400540E044E616D65084173506172616D7354020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C004601000400540E044E616D650C4173566172436861724D617854020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C003F01000400540E044E616D65054173586D6C54020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C004501000400540E044E616D650B417356617242696E61727954020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C00815001000500540E044E616D65075072657061726554020949734D757461746F720154020A4F6E4E756C6C43616C6C005455794D6963726F736F66742E53716C5365727665722E5365727665722E446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038390A446174614163636573730100000054557F4D6963726F736F66742E53716C5365727665722E5365727665722E53797374656D446174614163636573734B696E642C2053797374656D2E446174612C2056657273696F6E3D322E302E302E302C2043756C747572653D6E65757472616C2C205075626C69634B6579546F6B656E3D623737613563353631393334653038391053797374656D44617461416363657373010000003001000300540E044E616D6509556E5072657061726554020949734D757461746F720154020A4F6E4E756C6C43616C6C014201000400540E044E616D6508507265706172656454020F497344657465726D696E6973746963015402094973507265636973650154020A4F6E4E756C6C43616C6C013D01000300540E044E616D65165265676973746572446570656E646564506172616D7354020949734D757461746F720154020A4F6E4E756C6C43616C6C011001000B5544542E54506172616D7300000501000000000C01000754506172616D7300000C010007322E302E302E3200000801000200000000000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F77730100000000005DB5805200000000020000007E00000010BB0000109D000052534453E5B16C1074D93349BF71BA3398BC076303000000443A5C576F726B5C50726F6A656374735C457874656E6465642053746F7265642050726F636564757265735C53716C2E5544542E54506172616D73202D20454D5054595C6F626A5C52656C656173655C5544542E54506172616D735F454D5054592E706462000000B8BB00000000000000000000CEBB0000002000000000000000000000000000000000000000000000C0BB00000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF25002040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058C00000B00200000000000000000000B00234000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000002000200000000000200020000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B00410020000010053007400720069006E006700460069006C00650049006E0066006F000000EC010000010030003000300030003000340062003000000040000C000100460069006C0065004400650073006300720069007000740069006F006E00000000005500440054002E00540050006100720061006D0073000000300008000100460069006C006500560065007200730069006F006E000000000032002E0030002E0030002E00320000004C001600010049006E007400650072006E0061006C004E0061006D00650000005500440054002E00540050006100720061006D0073005F0045004D005000540059002E0064006C006C0000002800020001004C006500670061006C0043006F0070007900720069006700680074000000200000005400160001004F0072006900670069006E0061006C00460069006C0065006E0061006D00650000005500440054002E00540050006100720061006D0073005F0045004D005000540059002E0064006C006C000000300008000100500072006F0064007500630074004E0061006D00650000000000540050006100720061006D0073000000340008000100500072006F006400750063007400560065007200730069006F006E00000032002E0030002E0030002E003200000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000032002E0030002E0030002E0032000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000B000000C000000E03B00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
WITH PERMISSION_SET = SAFE

GO
/****** Object:  Schema [Bloomberg]    Script Date: 16.01.2015 12:15:04 ******/
CREATE SCHEMA [Bloomberg]
GO
/****** Object:  Schema [Gate]    Script Date: 16.01.2015 12:15:04 ******/
CREATE SCHEMA [Gate]
GO
/****** Object:  Schema [Micex]    Script Date: 16.01.2015 12:15:04 ******/
CREATE SCHEMA [Micex]
GO
/****** Object:  Schema [MICEX-SM]    Script Date: 16.01.2015 12:15:04 ******/
CREATE SCHEMA [MICEX-SM]
GO
/****** Object:  Schema [Pub]    Script Date: 16.01.2015 12:15:04 ******/
CREATE SCHEMA [Pub]
GO
/****** Object:  Schema [Quik]    Script Date: 16.01.2015 12:15:04 ******/
CREATE SCHEMA [Quik]
GO
/****** Object:  Schema [SQL]    Script Date: 16.01.2015 12:15:04 ******/
CREATE SCHEMA [SQL]
GO
/****** Object:  Schema [System]    Script Date: 16.01.2015 12:15:04 ******/
CREATE SCHEMA [System]
GO
/****** Object:  UserDefinedDataType [dbo].[TEIdentity]    Script Date: 16.01.2015 12:15:04 ******/
CREATE TYPE [dbo].[TEIdentity] FROM [bigint] NULL
GO
/****** Object:  UserDefinedDataType [dbo].[TInstrumentNominal]    Script Date: 16.01.2015 12:15:04 ******/
CREATE TYPE [dbo].[TInstrumentNominal] FROM [numeric](32, 15) NULL
GO
/****** Object:  UserDefinedDataType [dbo].[TInstrumentPrice]    Script Date: 16.01.2015 12:15:04 ******/
CREATE TYPE [dbo].[TInstrumentPrice] FROM [numeric](32, 10) NULL
GO
/****** Object:  UserDefinedDataType [dbo].[TInstrumentQuantity]    Script Date: 16.01.2015 12:15:04 ******/
CREATE TYPE [dbo].[TInstrumentQuantity] FROM [numeric](32, 10) NULL
GO
/****** Object:  UserDefinedDataType [dbo].[TMoney]    Script Date: 16.01.2015 12:15:04 ******/
CREATE TYPE [dbo].[TMoney] FROM [numeric](32, 2) NULL
GO
/****** Object:  UserDefinedDataType [dbo].[TSecPrice]    Script Date: 16.01.2015 12:15:04 ******/
CREATE TYPE [dbo].[TSecPrice] FROM [numeric](18, 6) NULL
GO
/****** Object:  UserDefinedDataType [dbo].[TTimeStamp]    Script Date: 16.01.2015 12:15:04 ******/
CREATE TYPE [dbo].[TTimeStamp] FROM [binary](8) NULL
GO
/****** Object:  UserDefinedType [dbo].[TLink]    Script Date: 16.01.2015 12:15:04 ******/
CREATE TYPE [dbo].[TLink]
EXTERNAL NAME [UDT.TLink].[TLink]

GO
/****** Object:  UserDefinedType [dbo].[TParams]    Script Date: 16.01.2015 12:15:04 ******/
CREATE TYPE [dbo].[TParams]
EXTERNAL NAME [UDT.TParams].[Sql.UDT.TParams]

GO
/****** Object:  UserDefinedType [dbo].[TParams_EMPTY]    Script Date: 16.01.2015 12:15:04 ******/
CREATE TYPE [dbo].[TParams_EMPTY]
EXTERNAL NAME [UDT.TParams_EMPTY].[Sql.UDT_EMPTY.TParams_EMPTY]

GO
/****** Object:  UserDefinedTableType [dbo].[TList]    Script Date: 16.01.2015 12:15:04 ******/
CREATE TYPE [dbo].[TList] AS TABLE(
	[Id] [int] NOT NULL,
	[Target_Id] [int] NULL,
	PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (IGNORE_DUP_KEY = OFF)
)
GO
/****** Object:  UserDefinedAggregate [Pub].[Concat]    Script Date: 16.01.2015 12:15:04 ******/
CREATE AGGREGATE [Pub].[Concat]
(@Text [nvarchar](max), @Separator [nvarchar](64))
RETURNS[nvarchar](max)
EXTERNAL NAME [UDF.Pubs].[Concat]
GO
/****** Object:  UserDefinedAggregate [Pub].[Merge Arrays]    Script Date: 16.01.2015 12:15:04 ******/
CREATE AGGREGATE [Pub].[Merge Arrays]
(@Text [nvarchar](max), @Separator [nchar](1))
RETURNS[nvarchar](max)
EXTERNAL NAME [UDF.Pubs2].[MergeAgg]
GO
/****** Object:  UserDefinedAggregate [Pub].[Merge CharSets]    Script Date: 16.01.2015 12:15:04 ******/
CREATE AGGREGATE [Pub].[Merge CharSets]
(@Text [nvarchar](max))
RETURNS[nvarchar](max)
EXTERNAL NAME [UDF.Pubs2].[CharSetMergeAgg]
GO
/****** Object:  UserDefinedFunction [Pub].[Array Alias]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [Pub].[Array Alias]
(
  @Array            NVarChar(Max),
  @Aliases          NVarChar(Max),
  @ArrayDelimeter   NChar(1),
  @AliasDelimeter   NChar(1),
  @RemoveIfNotFound Bit = 0
)
  RETURNS VarChar(Max)
---
  WITH
  --SCHEMABINDING, 
  RETURNS NULL ON NULL INPUT
---
AS BEGIN
  DECLARE
    @Result VarChar(Max)

  SELECT
    @Result = [Pub].[Merge Arrays]
              (
                CASE WHEN NV.[Name] IS NOT NULL THEN NV.[Value] ELSE V.[Value] END,
                @ArrayDelimeter
              )
  FROM [Pub].[Array To RowSet Of Values](@Array, @ArrayDelimeter) V
  LEFT HASH JOIN [Pub].[Array To RowSet Of Named Values](@Aliases, @AliasDelimeter) NV ON V.[Value] = NV.[Name]
  WHERE (@RemoveIfNotFound = 0 OR NV.[Name] IS NOT NULL)
  OPTION (FORCE ORDER)

  SELECT
    @Result = [Pub].[Arrays Merge](@Result, A.[Value], @ArrayDelimeter)
  FROM [Pub].[Array To RowSet Of Named Values](@Aliases, @AliasDelimeter) A
  WHERE [Pub].[In Array](@Array, A.[Name], @ArrayDelimeter) = 1

  RETURN @Result
END

GO
/****** Object:  UserDefinedFunction [Pub].[Array Distinct]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [Pub].[Array Distinct]
(
  @Array     VarChar(Max),
  @Delimeter Char(1)      = ','
)
  RETURNS VarChar(Max)
AS BEGIN
  DECLARE 
    @Result VarChar(Max), 
    @i      int, 
    @Field  sysname,
    @LDelim Bit,
    @RDelim Bit

  IF @Array IS NULL OR @Array = '' OR @Array = @delimeter
    Return ('')

  IF @Array = '*' Return (@Array)

  IF Left(@Array, 1) <> @delimeter
    SET @LDelim = 0
  ELSE
    SELECT @LDelim = 1, @Array = [Pub].[Trim Left](@Array, @Delimeter)

  IF Right(@Array, 1) <> @delimeter
    SET @RDelim = 0
  ELSE
    SELECT @RDelim = 1, @Array = [Pub].[Trim Right](@Array, @Delimeter)


  SET @Result = @delimeter

LBL:
  SET @i = CharIndex(@delimeter, @Array)
  IF @i > 0
    SELECT @Field = Left(@Array, @i - 1), @Array = LTRim(Right(@Array, Len(@Array) - @i))
  ELSE
    SELECT @Field = @Array, @Array = ''

  IF CharIndex(@delimeter + @Field + @delimeter, @Result) = 0 
    SET @Result = @Result + @Field + @delimeter

  IF isNull(@Array, '') <> '' GOTO LBL

  IF @Result <> '' BEGIN
    IF @LDelim = 0
      SET @Result = [Pub].[Trim Left](@Result, @Delimeter)

    IF @RDelim = 0
      SET @Result = [Pub].[Trim Right](@Result, @Delimeter)
  END
LB:
  Return @Result 
END


GO
/****** Object:  UserDefinedFunction [Pub].[Array To RowSet Of Named Values]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE FUNCTION [Pub].[Array To RowSet Of Named Values](@Text [nvarchar](max), @Separator [nvarchar](64))
RETURNS  TABLE (
	[Name] [nvarchar](max) NULL,
	[Value] [nvarchar](max) NULL,
	[Index] [int] NULL
) WITH EXECUTE AS CALLER
AS 
EXTERNAL NAME [UDF.Pubs].[Pub].[ArrayToRowSetNamed]
GO
/****** Object:  UserDefinedFunction [Pub].[Array To RowSet Of Values]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE FUNCTION [Pub].[Array To RowSet Of Values](@Text [nvarchar](max), @Separator [nchar](1))
RETURNS  TABLE (
	[Value] [nvarchar](max) NULL,
	[Index] [int] NULL
) WITH EXECUTE AS CALLER
AS 
EXTERNAL NAME [UDF.Pubs].[Pub].[ArrayToRowSet]
GO
/****** Object:  UserDefinedFunction [Pub].[Arrays Anti Join]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE FUNCTION [Pub].[Arrays Anti Join](@Array1 [nvarchar](max), @Array2 [nvarchar](max), @Separator [nchar](1) = N',')
RETURNS [nvarchar](max) WITH EXECUTE AS CALLER
AS 
EXTERNAL NAME [UDF.Pubs2].[Pub].[ArraysAntiJoin]
GO
/****** Object:  UserDefinedFunction [Pub].[Arrays Join]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE FUNCTION [Pub].[Arrays Join](@Array1 [nvarchar](max), @Array2 [nvarchar](max), @Separator [nchar](1) = N',')
RETURNS [nvarchar](max) WITH EXECUTE AS CALLER
AS 
EXTERNAL NAME [UDF.Pubs2].[Pub].[ArraysJoin]
GO
/****** Object:  UserDefinedFunction [Pub].[Arrays Merge]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE FUNCTION [Pub].[Arrays Merge](@Array1 [nvarchar](max), @Array2 [nvarchar](max), @Separator [nchar](1) = N',')
RETURNS [nvarchar](max) WITH EXECUTE AS CALLER
AS 
EXTERNAL NAME [UDF.Pubs2].[Pub].[ArraysMerge]
GO
/****** Object:  UserDefinedFunction [Pub].[Arrays Positive Join]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE FUNCTION [Pub].[Arrays Positive Join](@Array1 [nvarchar](max), @Array2 [nvarchar](max), @Separator [nchar](1) = N',')
RETURNS [bit] WITH EXECUTE AS CALLER
AS 
EXTERNAL NAME [UDF.Pubs2].[Pub].[ArraysPositiveJoin]
GO
/****** Object:  UserDefinedFunction [Pub].[CharSets Join]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE FUNCTION [Pub].[CharSets Join](@Array1 [nvarchar](max), @Array2 [nvarchar](max))
RETURNS [nvarchar](max) WITH EXECUTE AS CALLER
AS 
EXTERNAL NAME [UDF.Pubs2].[Pub].[CharSetJoin]
GO
/****** Object:  UserDefinedFunction [Pub].[Extract Named Value]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE FUNCTION [Pub].[Extract Named Value](@Array [nvarchar](max), @Name [nvarchar](max), @Separator [nvarchar](64) = N',')
RETURNS [nvarchar](max) WITH EXECUTE AS CALLER
AS 
EXTERNAL NAME [UDF.Pubs].[Pub].[ExtractNamedValue]
GO
/****** Object:  UserDefinedFunction [Pub].[Extract Param]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [Pub].[Extract Param]
(
  @Array        varchar(max), 
  @ParamName    varchar(max), 
  @DefaultValue varchar(max) = Null, 
  @Delimeter    char(1) = ',', 
  @Equal        char(1) = '='
)
  returns varchar(max)
as begin
  declare
      @i         int,
      @j         int,
      @Result    varchar(max),
      @Param     varchar(max),
      @ParamLen  smallint

  select
    @Result = @DefaultValue

  if @Array is not null 
  begin
    if @ParamName is null 
    begin
      set @i = charindex(@Delimeter, @Array)

      if @i > 0
        select
          @Param = left(@Array, @i - 1)
      else
        select
          @Param = @Array

      set @i = charindex(@Equal, @Param)
      if @i > 0
        select
          @ParamName = left(@Param, @i - 1),
          @Result = substring(@Param, @i + 1, len(@Param) - @i)
      else
        select
          @ParamName = null,
          @Result = @Param
    end 
    else 
    begin
      set @i = charindex(@Delimeter + @ParamName + @Equal, @Delimeter + @Array)
      set @ParamLen = len(@ParamName)

      if @i > 0 
      begin
        set @j = charindex(@Delimeter, @Array, @i + 1)
        set @Result = case
                  when @j = 0 then right(@Array, len(@Array) - @i - @ParamLen)
                  else substring(@Array, @i + @ParamLen + 1, @j - @i - @ParamLen - 1)
                  end

      end
    end
  end


  return @Result
end


GO
/****** Object:  UserDefinedFunction [Pub].[Extract Value]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE FUNCTION [Pub].[Extract Value](@Array [nvarchar](max), @Index [int], @Separator [nvarchar](64) = N',')
RETURNS [nvarchar](max) WITH EXECUTE AS CALLER
AS 
EXTERNAL NAME [UDF.Pubs].[Pub].[ExtractValue]
GO
/****** Object:  UserDefinedFunction [Pub].[In Array]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE FUNCTION [Pub].[In Array](@Array [nvarchar](max), @Element [nvarchar](256), @Delimeter [nchar](1) = N',')
RETURNS [bit] WITH EXECUTE AS CALLER
AS 
EXTERNAL NAME [UDF.Pubs2].[Pub].[InArray]
GO
/****** Object:  UserDefinedFunction [Pub].[Max Integer]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [Pub].[Max Integer] (@i1 int, @i2 int)  
RETURNS int AS  
BEGIN 
  Return case when @i2 is Null or @i1>@i2 then @i1 else @i2 end
END


GO
/****** Object:  UserDefinedFunction [Pub].[Min Date]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [Pub].[Min Date] (@dt1 Date, @dt2 Date)  
  RETURNS Date
AS BEGIN 
  RETURN
    CASE
      WHEN @dt2 IS NULL OR @dt1 < @dt2 THEN @dt1
      ELSE @dt2
    END
END


GO
/****** Object:  UserDefinedFunction [Pub].[Min DateTime]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [Pub].[Min DateTime] (@dt1 datetime, @dt2 datetime)  
RETURNS datetime AS  
BEGIN 
  Return case when @dt2 is Null or @dt1<@dt2 then @dt1 else @dt2 end
END


GO
/****** Object:  UserDefinedFunction [Pub].[Min Integer]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [Pub].[Min Integer] (@i1 int, @i2 int)  
RETURNS int AS  
BEGIN 
  Return case when @i2 is Null or @i1<@i2 then @i1 else @i2 end
END


GO
/****** Object:  UserDefinedFunction [Pub].[RegExp::IsMatch]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE FUNCTION [Pub].[RegExp::IsMatch](@Input [nvarchar](max), @Pattern [nvarchar](1000), @Options [nvarchar](200))
RETURNS [bit] WITH EXECUTE AS CALLER
AS 
EXTERNAL NAME [UDF.RegExp].[Sql.UDF.RegEx.ScalarFunctions].[RegExIsMatch]
GO
/****** Object:  UserDefinedFunction [Pub].[RegExp::Matches]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE FUNCTION [Pub].[RegExp::Matches](@Input [nvarchar](max), @Pattern [nvarchar](1000), @Options [nvarchar](200) = N'')
RETURNS  TABLE (
	[MatchIndex] [smallint] NULL,
	[GroupIndex] [tinyint] NULL,
	[Match] [nvarchar](max) NULL,
	[Index] [int] NULL,
	[Length] [int] NULL
) WITH EXECUTE AS CALLER
AS 
EXTERNAL NAME [UDF.RegExp].[Sql.UDF.RegEx.TableValuedFunctions].[RegExMatches]
GO
/****** Object:  UserDefinedFunction [Pub].[RegExp::Replace]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE FUNCTION [Pub].[RegExp::Replace](@Input [nvarchar](max), @Pattern [nvarchar](1000), @Replacement [nvarchar](1000), @Options [nvarchar](200))
RETURNS [nvarchar](max) WITH EXECUTE AS CALLER
AS 
EXTERNAL NAME [UDF.RegExp].[Sql.UDF.RegEx.ScalarFunctions].[RegExReplace]
GO
/****** Object:  UserDefinedFunction [Pub].[Set Named Value]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE FUNCTION [Pub].[Set Named Value](@Array [nvarchar](max), @Name [nvarchar](max), @Value [nvarchar](max), @Separator [nvarchar](64) = N',')
RETURNS [nvarchar](max) WITH EXECUTE AS CALLER
AS 
EXTERNAL NAME [UDF.Pubs].[Pub].[SetNamedValue]
GO
/****** Object:  UserDefinedFunction [Pub].[Shift Text]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [Pub].[Shift Text](@Text NVarChar(Max), @ShiftCnt Int)
  RETURNS NVarChar(Max)
AS BEGIN
  DECLARE
    @RET  NVarChar(Max),
    @EL   NChar(2)      = NChar(13) + NChar(10)
  -------------------------------------------
  SET @RET = REPLICATE(' ', @ShiftCnt) + REPLACE(@Text, @EL, @EL + REPLICATE(' ', @ShiftCnt))
  -------------------------------------------
  RETURN (@RET)
END


GO
/****** Object:  UserDefinedFunction [Pub].[UnQuote]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [Pub].[UnQuote](@String NVarChar(Max), @Quote NChar(1) = NULL)
  RETURNS NVarChar(Max)
AS BEGIN
  IF @String IS NULL
    RETURN NULL

  DECLARE
    @Length Int = DataLength(@String) / 2

  IF @Length <= 1
    RETURN @String

  IF @Quote IS NULL
    SET @Quote = Left(@String, 1)
  ELSE IF Left(@String, 1) <> @Quote
    RETURN @String

  IF @Quote = '['
    SET @Quote = ']'
  ELSE IF @Quote NOT IN ('''', '"')
    RETURN @String

  IF Right(@String, 1) <> @Quote
    RETURN @String

  RETURN Replace(SubString(@String, 2, @Length - 2), @Quote + @Quote, @Quote)
END


GO
/****** Object:  UserDefinedFunction [SQL].[Final SQL]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [SQL].[Final SQL](@CommandText NVarChar(Max), @Params TParams)
  RETURNS NVarChar(Max)
---
  -- WITH SCHEMABINDING
---
AS BEGIN
  RETURN
  (
    SELECT
      CASE
        WHEN MAX([Index:After]) IS NULL THEN @CommandText
        ELSE [Pub].[Concat]([Text], N'')
          +
          SubString(@CommandText, MAX([Index:After]), LEN(@CommandText) - MAX([Index:After]) + 1)
      END
    FROM
    (
      SELECT TOP 1000
        [Text]        = SubString(@CommandText, [Index:From], [Index] - [Index:From]) + V.[ParamValue],
        [Index:After] = [Index] + [Length]
      FROM
      (
        SELECT
          [MatchIndex],
          [Index],
          [Length],
          [Index:From]  = LAG([Index], 1, 1) OVER (ORDER BY [MatchIndex]) + LAG([Length], 1, 0) OVER (ORDER BY [MatchIndex]),
          [Param]       = SubString(@CommandText, [Index] + 2, [Length] - 3)
        FROM [Pub].[RegExp::Matches](@CommandText, ':\[[^]]+\]', Default) R
      ) I
      CROSS APPLY
      (
        VALUES ([SQL].[SQL_Variant As Text](@Params.AsVariant([Param])))
      ) V([ParamValue])
      ORDER BY [MatchIndex]
    ) I
  )
END

GO
/****** Object:  UserDefinedFunction [SQL].[Generate Alias]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [SQL].[Generate Alias](@SqlObjectName Sysname)
  RETURNS Sysname
AS BEGIN
  DECLARE
    @RET    Sysname,
    @Index  Int = 0
  -------------------------------------------
  SET @SqlObjectName = PARSENAME(@SqlObjectName, 1)
  SET @RET = LEFT(@SqlObjectName, 1)
  
  --  
  SET @SqlObjectName = REPLACE(@SqlObjectName, '(Translate)', '')
  SET @SqlObjectName = REPLACE(@SqlObjectName, '(Translate Insert)', '')
  SET @SqlObjectName = REPLACE(@SqlObjectName, '(Translate Update)', '')
  SET @SqlObjectName = REPLACE(@SqlObjectName, '(Periodic)', '')
  SET @SqlObjectName = REPLACE(@SqlObjectName, '(Periodic Insert)', '')
  SET @SqlObjectName = REPLACE(@SqlObjectName, '(Periodic Update)', '')

  SET @SqlObjectName = REPLACE(@SqlObjectName, ' ', ':')
  SET @SqlObjectName = REPLACE(@SqlObjectName, '_', ':')
  SET @SqlObjectName = REPLACE(@SqlObjectName, '(', ':')
  SET @SqlObjectName = REPLACE(@SqlObjectName, ')', ':')
  SET @SqlObjectName = REPLACE(@SqlObjectName, '#', ':')
  SET @SqlObjectName = REPLACE(@SqlObjectName, '.', ':')
  
  SET @SqlObjectName = [Pub].[Trim](@SqlObjectName, ':')
  --   
  WHILE CHARINDEX('::', @SqlObjectName) > 0
    SET @SqlObjectName = REPLACE(@SqlObjectName, '::', ':') 
    
  SET @Index = PATINDEX('%:%', @SqlObjectName)
  WHILE (@Index > 0) AND (@Index < LEN(@SqlObjectName)) BEGIN
  
    SET @RET = @RET + SUBSTRING(@SqlObjectName, @Index + 1, 1)
    SET @SqlObjectName = RIGHT(@SqlObjectName, LEN(@SqlObjectName) - @Index)
    SET @Index = PATINDEX('%:%', @SqlObjectName)
  END
  -------------------------------------------
  RETURN (@RET)
END


GO
/****** Object:  UserDefinedFunction [SQL].[Get Object Quality Name]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

--------------------------------------------------------------------------
---    
--- :
/*
  PRINT [SQL].[Get Object Quality Name]('Test1')
  PRINT [SQL].[Get Object Quality Name]('Xxx.Test2')
  PRINT [SQL].[Get Object Quality Name]('Srv.DB.Xxx.Test3')
*/
--------------------------------------------------------------------------
CREATE FUNCTION [SQL].[Get Object Quality Name] (@Object_path NVarChar(256))
  Returns sysname
AS BEGIN
  DECLARE 
    @OpenBorder   NChar(1),
    @CloseBorder  NChar(1),
    @L            smallint,
    @I            smallint,
    @V            NVarChar(32),
    @PI           smallint,
    @SI           smallint,
    @VI           smallint,
    @Schema       SysName

  SET @Object_path = LTrim(RTrim(@Object_path))
  IF @Object_path is null or @Object_path = ''
    RETURN @Object_path

  SET @Schema = 'dbo'
  WHILE 1 = 1 BEGIN
    SET @L = LEN(@Object_path)
    SET @OpenBorder = Left(@Object_path, 1)
    IF @OpenBorder in ('[', '"') BEGIN
      SET @CloseBorder = CASE WHEN @OpenBorder = '[' THEN ']' ELSE @OpenBorder END
    
      SET @I = CHARINDEX(@CloseBorder, @Object_path, 2)
      IF @I = 0 BREAK
      SET @V = SUBSTRING(@Object_path, @I + 1, 1)
      IF @I = @L OR @V <> '.' BEGIN
        IF @V = ';' BEGIN
          SET @SI = @I + 2 WHILE @SI <= @L AND SUBSTRING(@Object_path, @SI, 1) BETWEEN '0' AND '9' SET @SI = @SI + 1
          SET @V = SUBSTRING(@Object_path, @I + 1, @SI - @I - 1)
        END ELSE
          SET @V = ''
        RETURN '[' + @Schema + '].[' + SUBSTRING(@Object_path, 2, @I - 2) + ']' + @V
      END

      IF @I > 2 
        SET @Schema = SUBSTRING(@Object_path, 2, @I - 2) 
      ELSE 
        SET @Schema = 'dbo'
      SET @Object_path = RIGHT(@Object_path, @L - @I - 1)
    END ELSE BEGIN
      SET @PI = CHARINDEX('.', @Object_path)
      SET @SI = CHARINDEX(' ', @Object_path)
      SET @VI = CHARINDEX(';', @Object_path)

      IF @PI = 0 AND @SI = 0 AND @VI = 0
        BREAK
      ELSE IF @PI > 0 AND (@SI = 0 OR @SI > @PI) AND (@VI = 0 OR @VI > @PI)
        SELECT @Schema = CASE WHEN @PI > 1 THEN LEFT(@Object_path, @PI - 1) ELSE 'dbo' END, @Object_path = RIGHT(@Object_path, @L - @PI)
      ELSE IF @VI > 0 AND (@SI = 0 OR @SI > @VI) BEGIN
        SET @SI = @VI + 1 WHILE @SI <= @L AND SUBSTRING(@Object_path, @SI, 1) BETWEEN '0' AND '9' SET @SI = @SI + 1
        RETURN '[' + @Schema + '].[' + LEFT(@Object_path, @VI - 1) + '];' + SUBSTRING(@Object_path, @VI + 1, @SI - @VI -1)
      END ELSE
        RETURN '[' + @Schema + '].[' + LEFT(@Object_path, @SI - 1) + ']'
    END
  END

  RETURN '[' + @Schema + '].[' + @Object_path + ']'
END

GO
/****** Object:  UserDefinedFunction [SQL].[Get Object Schemed Name]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [SQL].[Get Object Schemed Name] (@Object_path NVarChar(255))
  Returns sysname
AS BEGIN
  Declare 
    @OpenBorder   NChar(1)
  , @CloseBorder  NChar(1)
  , @L            smallint
  , @I            smallint
  , @PI           smallint
  , @SI           smallint
  , @VI           smallint
  , @Schema       SysName

  SET @Object_path = LTrim(RTrim(@Object_path))
  IF @Object_path is null or @Object_path = ''
    RETURN @Object_path

  SET @Schema = 'dbo'
  WHILE 1 = 1 BEGIN
  SET @L = LEN(@Object_path)
  SET @OpenBorder = Left(@Object_path, 1)
  IF @OpenBorder in ('[', '"') BEGIN
    SET @CloseBorder = CASE WHEN @OpenBorder = '[' THEN ']' ELSE @OpenBorder END
  
    SET @I = CHARINDEX(@CloseBorder, @Object_path, 2)
    IF @I = 0 BREAK
    IF @I = @L OR SUBSTRING(@Object_path, @I + 1, 1) <> '.' RETURN '[' + @Schema + '].[' + SUBSTRING(@Object_path, 2, @I - 2) + ']'
    IF @I > 2 SET @Schema = SUBSTRING(@Object_path, 2, @I - 2) ELSE SET @Schema = 'dbo'
    SET @Object_path = RIGHT(@Object_path, @L - @I - 1)
  END ELSE BEGIN
    SET @PI = CHARINDEX('.', @Object_path)
    SET @SI = CHARINDEX(' ', @Object_path)
    SET @VI = CHARINDEX(';', @Object_path)
    IF @PI = 0 AND @SI = 0 AND @VI = 0
      BREAK
    ELSE IF @PI > 0 AND (@SI = 0 OR @SI > @PI) AND (@VI = 0 OR @VI > @PI)
      SELECT @Schema = CASE WHEN @PI > 1 THEN LEFT(@Object_path, @PI - 1) ELSE 'dbo' END, @Object_path = RIGHT(@Object_path, @L - @PI)
    ELSE IF @VI > 0 AND (@SI = 0 OR @SI > @VI)
      RETURN '[' + @Schema + '].[' + LEFT(@Object_path, @VI - 1) + ']'
    ELSE
      RETURN '[' + @Schema + '].[' + LEFT(@Object_path, @SI - 1) + ']'
  END
  END

  RETURN '[' + @Schema + '].[' + @Object_path + ']'
END


GO
/****** Object:  UserDefinedFunction [SQL].[Is Unique Column]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [SQL].[Is Unique Column]
(
  @Object_Id  Int,
  @FieldName  SysName
)
  RETURNS Bit
AS BEGIN
  RETURN
    IsNull
    (
      (
        SELECT TOP 1 1
        FROM sys.indexes I WITH (NOLOCK)
        CROSS APPLY
        (
          SELECT
            C.[column_id],
            [Inc:Id]  = ROW_NUMBER() OVER (ORDER BY C.[index_column_id]),
            [Dec:Id]  = ROW_NUMBER() OVER (ORDER BY C.[index_column_id] DESC)
          FROM sys.index_columns C WITH (NOLOCK)
          WHERE C.[object_id] = @Object_Id AND C.[index_id] = I.[index_id]
        ) IC
        INNER JOIN sys.columns C WITH (NOLOCK) ON C.[object_id] = @Object_Id AND IC.[column_id] = C.[column_id]
        WHERE I.[object_id] = @Object_Id AND I.[is_unique] = 1 AND I.[has_filter] = 0 AND I.[is_disabled] = 0 AND I.[ignore_dup_key] = 0 AND I.[is_unique_constraint] = 0
              AND IC.[Inc:Id] = IC.[Dec:Id]
      ),
      0
    )
END


GO
/****** Object:  UserDefinedFunction [SQL].[Procedure Exists]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

--     ( )
CREATE FUNCTION [SQL].[Procedure Exists](@Object sysname)
  Returns bit
AS BEGIN
  DECLARE 
    @Version tinyint
    
  SET @Version = IsNull(Cast([Pub].[Extract Value](@Object, 2, ';') as tinyint), 1)
  SET @Object = [Pub].[Extract Value](@Object, 1, ';')

  RETURN [SQL].[Procedure Version Exists](@Object, @Version)
END


GO
/****** Object:  UserDefinedFunction [SQL].[Procedure Parameter Exists]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [SQL].[Procedure Parameter Exists] (@Object SysName, @Version SmallInt = 1, @Parameter SysName)
  Returns Bit
AS BEGIN
  DECLARE 
    @Object_Id Int

  SET @Object_Id = OBJECT_ID(@Object)
  IF @Object_Id IS NULL
    RETURN 0

  IF @Version IN (0, 1)
    RETURN
      IsNull
      (
        (
          SELECT 1
          FROM sys.parameters
          WHERE [object_id] = @Object_Id AND [name] = @Parameter
        ),
        0
      )

  RETURN
    IsNull
    (
      (
        SELECT 1
        FROM sys.numbered_procedure_parameters
        WHERE [object_id] = @Object_Id AND [procedure_number] = @Version AND [name] = @Parameter
      ),
      0
    )
END


GO
/****** Object:  UserDefinedFunction [SQL].[Procedure Version Exists]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [SQL].[Procedure Version Exists] (@Object SysName, @Version SmallInt)
  Returns Bit
AS BEGIN
  DECLARE 
    @Object_Id Int

  SET @Object_Id = OBJECT_ID(@Object)
  IF @Object_Id IS NULL
    RETURN 0

  IF NOT EXISTS
    (
      SELECT TOP 1 1
      FROM sys.all_objects
      WHERE [object_id] = @Object_Id
        AND [type] IN (N'P', N'RF', N'PC')
    )
    RETURN 0

  IF @Version IN (1)
    RETURN 1

  IF EXISTS
    (
      SELECT TOP 1 1
      FROM sys.numbered_procedures
      WHERE [object_id] = @Object_Id
        AND [procedure_number] = @Version
    )
    RETURN 1

  RETURN 0
END


GO
/****** Object:  UserDefinedFunction [SQL].[Shift]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [SQL].[Shift](@SQL NVarchar(1024), @ShiftCnt Int)
  RETURNS NVarChar(1024)
AS BEGIN
  RETURN
  (
    CASE
      WHEN LEN(@SQL) < @ShiftCnt THEN LEFT(@SQL + SPACE(@ShiftCnt), @ShiftCnt)
      ELSE @SQL
    END
  )
END


GO
/****** Object:  UserDefinedFunction [SQL].[SQL_Variant As Text]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [SQL].[SQL_Variant As Text](@Variable SQL_Variant)
  RETURNS NVarChar(Max)
---
--  WITH SCHEMABINDING
---
AS BEGIN
  DECLARE
    @Type SysName = Cast(SQL_VARIANT_PROPERTY(@Variable, 'BaseType') AS SysName)

  RETURN
    CASE
      WHEN @Variable IS NULL THEN 'NULL'
      WHEN @Type IN ('bigint', 'decimal', 'float', 'int', 'money', 'numeric', 'real', 'smallint', 'tinyint') THEN Cast(@Variable AS NVarChar(Max))
      WHEN @Type IN ('char', 'varchar') THEN [Pub].[Quote String](Cast(@Variable AS NVarChar(Max)))
      WHEN @Type IN ('nchar', 'nvarchar') THEN 'N' + [Pub].[Quote String](Cast(@Variable AS NVarChar(Max)))
      ELSE
        CASE
          WHEN @Type IN ('date') THEN '''' + Convert(NVarChar, Cast(@Variable AS Date), 112) + ''''
          WHEN @Type IN ('datetime', 'datetime2', 'smalldatetime') THEN '''' + Convert(NVarChar, Cast(@Variable AS Date), 112) + ' ' + [Pub].[Trim Right]([Pub].[Trim Right](Cast(Cast(@Variable AS Time) AS NVarChar), '0'), '.') + ''''
          WHEN @Type IN ('time') THEN '''' + [Pub].[Trim Right]([Pub].[Trim Right](Cast(Cast(@Variable AS Time) AS NVarChar), '0'), '.') + ''''
          ELSE Cast(@Variable AS NVarChar(Max))
        END
    END
END


GO
/****** Object:  UserDefinedFunction [SQL].[Table::Fields Array]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [SQL].[Table::Fields Array](@Object_Id  Int, @Delimeter NChar(1) = ';')
 RETURNS NVarChar(4000)
AS BEGIN
  DECLARE
    @Fields   NVarChar(4000)

  SELECT
    @Fields = IsNull(@Fields + @Delimeter, N'') + [name]
  FROM [sys].[columns] WITH (NOLOCK)
  WHERE [object_id] = @Object_Id
  
  RETURN @Fields
END


GO
/****** Object:  UserDefinedFunction [SQL].[TParams::Method By Type]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [SQL].[TParams::Method By Type](@Type SysName)
  RETURNS NVarChar(20)
AS BEGIN
  RETURN
    CASE
      WHEN @Type IN ('Bit', 'TinyInt', 'SmallInt', 'Int', 'BigInt', 'Date', 'Time', 'DateTime', 'VarBinary', 'XML') THEN N'As' + @Type
      WHEN @Type IN ('VarChar(Max)', 'NVarChar(Max)') THEN 'AsVarCharMax'
      WHEN @Type IN ('Char', 'VarChar', 'NChar', 'NVarChar') OR @Type LIKE 'Char(%' OR @Type LIKE 'VarChar(%' OR @Type LIKE 'NChar(%' OR @Type LIKE 'NVarChar(%' THEN 'AsVarChar'
      WHEN @Type IN ('Binary') THEN 'AsVarBinary'
      WHEN @Type IN ('TParams') THEN 'AsParams'
      ELSE 'AsVariant'
    END
END

GO
/****** Object:  UserDefinedFunction [System].[Raise Error(If Null Or Empty)]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [System].[Raise Error(If Null Or Empty)] (@Value NVarChar(Max), @ProcedureId Int, @Error NVarChar(2048))
  RETURNS NVarChar(Max)
AS BEGIN
  DECLARE
    @ErrorBit Bit

  IF @Value IS NULL OR [Pub].[Trim Right](@Value, '') = N''
    SET @ErrorBit = [System].[Raise Error](@ProcedureId, @Error)

  RETURN @Value
END


GO
/****** Object:  UserDefinedFunction [System].[Session Variable]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [System].[Session Variable] (@Name varchar(100))
  RETURNS sql_variant
AS BEGIN
  DECLARE
    @Connection_Id      UniqueIdentifier,
    @Request_StartTime  DateTime

  SELECT
    @Connection_Id      = [connection_id],
    @Request_StartTime  = [start_time]
    --@Request_NestLevel  = [nest_level]
  FROM sys.dm_exec_requests (NOLOCK)
  WHERE [session_id] = @@SPID
  OPTION (FORCE ORDER, MAXDOP 1)

  RETURN (SELECT [Value] FROM [System].[Session Variables] WHERE [Session_Id] = @@SPID AND [Connection_Id] = @Connection_Id AND [Name] = @Name)
END

GO
/****** Object:  UserDefinedFunction [Pub].[Quote String]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [Pub].[Quote String] (@String NVarChar(Max))
  Returns NVarChar(Max)
---
  WITH SCHEMABINDING, RETURNS NULL ON NULL INPUT
---
AS BEGIN
  Return '''' + Replace(@String, '''', '''''') + ''''
END


GO
/****** Object:  UserDefinedFunction [Pub].[Shl]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [Pub].[Shl] (@Value BigInt, @Count tinyint)
  RETURNS BigInt
---
  WITH SCHEMABINDING
---
AS BEGIN
  WHILE @Count > 0
    SELECT @Value = @Value * 2, @Count = @Count - 1

  RETURN @Value
END


GO
/****** Object:  UserDefinedFunction [Pub].[Deep Quote String]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [Pub].[Deep Quote String] (@String NVarChar(Max), @Depth TinyInt)
  Returns NVarChar(Max)
---
  WITH SCHEMABINDING, RETURNS NULL ON NULL INPUT
---
AS BEGIN
  Return Replace([Pub].[Quote String](@String), '''', REPLICATE('''', [Pub].[Shl](1, @Depth-1)))
END


GO
/****** Object:  UserDefinedFunction [Pub].[Trim Right]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [Pub].[Trim Right] (@String NVarChar(Max), @Char NChar(1))
  RETURNS NVarChar(Max)
---
  WITH SCHEMABINDING
---
AS BEGIN
  DECLARE
    @Length Int = DataLength(@String) / 2

  IF @Char = N' '
    WHILE 
    (
      @String IS NOT NULL 
      AND @Length > 0
      AND SubString(@String, @Length, 1) IN (N' ', NChar(9), NChar(10), NChar(13)) 
    )
    BEGIN
      SET @String = SubString(@String, 1, @Length - 1)
      SET @Length -= 1
    END
  ELSE BEGIN
    WHILE
    (
      @String IS NOT NULL
        AND @Length > 0
        AND SubString(@String, @Length, 1) = @Char
    )
    BEGIN
      SET @String = SubString(@String, 1, @Length - 1)
      SET @Length -= 1
    END

    IF @Char = N'0' AND @String IS NOT NULL AND @String <> N'' AND SubString(@String, @Length, 1) = N'.'
      SET @String = SubString(@String, 1, @Length - 1)
  END

  RETURN (@String)
END


GO
/****** Object:  UserDefinedFunction [SQL].[Field Type Compile]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [SQL].[Field Type Compile] (@field_type SysName, @length SmallInt, @prec TinyInt, @Scale TinyInt, @collation SysName = NULL)
  RETURNS sysname
---
  WITH SCHEMABINDING
---
AS BEGIN 
  SET @field_type =
    CASE @field_type
      WHEN N'char' THEN N'Char'
      WHEN N'varchar' THEN N'VarChar'
      WHEN N'nchar' THEN N'NChar'
      WHEN N'nvarchar' THEN N'NVarChar'
      WHEN N'bit' THEN N'Bit'
      WHEN N'tinyint' THEN N'TinyInt'
      WHEN N'smallint' THEN N'SmallInt'
      WHEN N'int' THEN N'Int'
      WHEN N'bigint' THEN N'BigInt'
      WHEN N'date' THEN N'Date'
      WHEN N'time' THEN N'Time'
      WHEN N'smalldatetime' THEN N'SmallDateTime'
      WHEN N'datetime' THEN N'DateTime'
      WHEN N'datetime2' THEN N'DateTime2'
      WHEN N'decimal' THEN N'Decimal'
      WHEN N'numeric' THEN N'Numeric'
      WHEN N'real' THEN N'Real'
      WHEN N'float' THEN N'Float'
      WHEN N'smallmoney' THEN N'SmallMoney'
      WHEN N'money' THEN N'Money'
      WHEN N'binary' THEN N'Binary'
      WHEN N'varbinary' THEN N'VarBinary'
      WHEN N'image' THEN N'Image'
      WHEN N'text' THEN N'Text'
      WHEN N'ntext' THEN N'NText'
      WHEN N'uniqueidentifier' THEN N'UniqueIdentifier'
      WHEN N'sql_variant' THEN N'SQL_Variant'
      WHEN N'xml' THEN N'Xml'
      WHEN N'sysname' THEN N'SysName'

      ELSE @field_type
    END
  RETURN
    @field_type
    +
    CASE 
      WHEN @field_type in ('nvarchar', 'varbinary', 'VarChar') THEN '(' + CASE WHEN @length <= 0 THEN 'Max' WHEN @field_type IN ('nvarchar') THEN cast(@length/2 AS VarChar) ELSE cast(@length AS VarChar) END + ')'
      WHEN @field_type in ('binary', 'char', 'nchar') THEN '(' + CASE WHEN @field_type IN ('nchar') THEN cast(@length/2 AS VarChar) ELSE cast(@length AS VarChar) END + ')'
      WHEN @field_type in ('decimal', 'numeric') THEN '(' + cast(@prec AS VarChar) + ',' + cast(@scale AS VarChar) + ')'
      ELSE ''
    END
    +
    CASE
      WHEN @collation IS NOT NULL AND @field_type in ('nvarchar', 'varbinary', 'VarChar', 'char', 'nchar') THEN ' COLLATE ' + @collation
      ELSE ''
    END
END


GO
/****** Object:  UserDefinedFunction [SQL].[SQL_Variant Compile]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [SQL].[SQL_Variant Compile](@Variable SQL_Variant)
  RETURNS NVarChar(Max)
---
  WITH SCHEMABINDING
---
AS BEGIN
  DECLARE
    @Type SysName = Cast(SQL_VARIANT_PROPERTY(@Variable, 'BaseType') AS SysName)

  RETURN
    CASE
      WHEN @Variable IS NULL THEN 'NULL'
      WHEN @Type IN ('bigint', 'decimal', 'float', 'int', 'money', 'numeric', 'real', 'smallint', 'tinyint') THEN Cast(@Variable AS NVarChar(Max))
      WHEN @Type IN ('char', 'NVarChar') THEN [Pub].[Quote String](Cast(@Variable AS NVarChar(Max)))
      WHEN @Type IN ('nchar', 'nvarchar') THEN 'N' + [Pub].[Quote String](Cast(@Variable AS NVarChar(Max)))
      ELSE
        'Cast('
        +
        CASE
          WHEN @Type IN ('date') THEN '''' + Convert(NVarChar, Cast(@Variable AS Date), 112) + ''''
          WHEN @Type IN ('datetime', 'datetime2', 'smalldatetime') THEN '''' + Convert(NVarChar(30), Cast(@Variable AS Date), 112) + ' ' + [Pub].[Trim Right]([Pub].[Trim Right](Cast(Cast(@Variable AS Time) AS NVarChar), '0'), '.') + ''''
          WHEN @Type IN ('time') THEN '''' + [Pub].[Trim Right]([Pub].[Trim Right](Cast(Cast(@Variable AS Time) AS NVarChar), '0'), '.') + ''''
          ELSE Cast(@Variable AS NVarChar(Max))
        END
        +
        ' AS '
        + [SQL].[Field Type Compile](@Type, Cast(SQL_VARIANT_PROPERTY(@Variable, 'MaxLength') AS Int), Cast(SQL_VARIANT_PROPERTY(@Variable, 'Precision') AS Int), Cast(SQL_VARIANT_PROPERTY(@Variable, 'Scale') AS Int), Cast(SQL_VARIANT_PROPERTY(@Variable, 'Collation') AS NVarChar(127)))
        + ')'
    END
END


GO
/****** Object:  UserDefinedFunction [Pub].[Trim Left]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [Pub].[Trim Left] (@String NVarChar(Max), @Char NChar(1))
  Returns NVarChar(Max)
---
  WITH SCHEMABINDING
---
AS BEGIN
  DECLARE
    @Length Int = DataLength(@String) / 2

  IF @Char = N' '
    WHILE 
    (
      @String IS NOT NULL
        AND @Length > 0
        AND SubString(@String, 1, 1) IN (N' ', NChar(9), NChar(10), NChar(13))
    )
    BEGIN
      SET @String = SubString(@String, 2, @Length - 1)
      SET @Length -= 1
    END
  ELSE
    WHILE
    (
      @String IS NOT NULL 
        AND @Length > 0
        AND SubString(@String, 1, 1) = @Char 
    )
    BEGIN
      SET @String = SubString(@String, 2, @Length - 1)
      SET @Length -= 1
    END

  RETURN (@String)
END


GO
/****** Object:  UserDefinedFunction [Pub].[Trim]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [Pub].[Trim] (@String NVarChar(Max), @Char NChar(1))
  RETURNS NVarChar(Max)
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN [Pub].[Trim Left]([Pub].[Trim Right](@String, @Char), @Char)
END


GO
/****** Object:  UserDefinedFunction [Pub].[Is Equal DateTimes]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Pub].[Is Equal DateTimes] (@DateTime1 DateTime, @DateTime2 DateTime)
  RETURNS Bit
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN CASE WHEN @DateTime1 IS NULL AND @DateTime2 IS NULL OR @DateTime1 = @DateTime2 THEN 1 ELSE 0 END
END

GO
/****** Object:  UserDefinedFunction [Pub].[Is Equal Strings]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Pub].[Is Equal Strings](@String1 NVarChar(Max), @String2 NVarChar(Max), @CaseSensitive Bit = 0)
  RETURNS Bit
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN
    CASE
      WHEN @String1 IS NULL AND @String2 IS NULL THEN 1
      WHEN @CaseSensitive = 1 THEN
        CASE
          WHEN @String1 COLLATE Cyrillic_general_BIN = @String2 THEN 1
          ELSE 0
        END
      ELSE
        CASE
          WHEN @String1 = @String2 THEN 1
          ELSE 0
        END
    END
END

GO
/****** Object:  UserDefinedFunction [Pub].[Is Equal Variants]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Pub].[Is Equal Variants] (@Variant1 sql_variant, @Variant2 sql_variant)
  RETURNS Bit
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN CASE WHEN @Variant1 IS NULL AND @Variant2 IS NULL OR @Variant1 = @Variant2 THEN 1 ELSE 0 END
END

GO
/****** Object:  UserDefinedFunction [Pub].[Max Date]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [Pub].[Max Date] (@Date1 Date, @Date2 Date)  
  RETURNS Date
---
  WITH SCHEMABINDING
---
AS BEGIN
  Return CASE WHEN @Date2 IS NULL OR @Date1 > @Date2 THEN @Date1 ELSE @Date2 END
END


GO
/****** Object:  UserDefinedFunction [Pub].[Max DateTime]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [Pub].[Max DateTime] (@dt1 datetime, @dt2 datetime)  
  RETURNS datetime
---
  WITH SCHEMABINDING
---
AS BEGIN
  Return case when @dt2 is Null or @dt1>@dt2 then @dt1 else @dt2 end
END


GO
/****** Object:  UserDefinedFunction [Pub].[Repeat]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- ============================================================
---          @From  @To
---        
--- :  .. <md>
--- : 
--- ============================================================
CREATE FUNCTION [Pub].[Repeat](@From int, @To int)
  RETURNS @DataSet TABLE
  (
    [Index] Int NOT NULL PRIMARY KEY CLUSTERED
  )
---
  WITH SCHEMABINDING
---
AS BEGIN
  IF @From is NULL OR @To IS NULL Return

  WHILE @From <= @To BEGIN
    INSERT INTO @DataSet([Index])
    VALUES(@From)

    SET @From = @From + 1
  END

  Return
END


GO
/****** Object:  UserDefinedFunction [Pub].[Shr]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [Pub].[Shr] (@Value BigInt, @Count tinyint)
  RETURNS BigInt
---
  WITH SCHEMABINDING
---
AS BEGIN
  WHILE @Count > 0
    SELECT @Value = @Value / 2, @Count = @Count - 1

  RETURN @Value
END


GO
/****** Object:  UserDefinedFunction [Pub].[Today]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [Pub].[Today] ()
  RETURNS date
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN Cast(GetDate() AS Date)
END


GO
/****** Object:  UserDefinedFunction [Pub].[Trim VarBinary]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [Pub].[Trim VarBinary](@Value VarBinary(Max))
  RETURNS VarBinary(Max)
---
  WITH SCHEMABINDING
---
AS BEGIN
  DECLARE
    @Len  Int

  SET @Len = DataLength(@Value)
  WHILE @Len > 0 AND SubString(@Value, 1, 1) = 0x00 BEGIN
    SET @Len -= 1
    SET @Value = SubString(@Value, 2, @Len)
  END

  RETURN @Value
END


GO
/****** Object:  UserDefinedFunction [Quik].[Deal::Active::Value::To SettleStatus]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Quik].[Deal::Active::Value::To SettleStatus] (@Value VarChar(32))
  RETURNS Char(1)
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN CASE
           WHEN @Value IN ('S', '', '') THEN 'S'
           WHEN @Value IN ('U', ' ', ' ', '') OR @Value IS NULL THEN 'U'
           WHEN @Value IN ('P', ' ', ' ') THEN 'P'
         END
END

GO
/****** Object:  UserDefinedFunction [Quik].[Deal::Active::Value::To Status]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Quik].[Deal::Active::Value::To Status] (@Value VarChar(24))
  RETURNS Char(1)
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN CASE
           WHEN @Value IN ('U', '', ' ') THEN 'U'
           WHEN @Value IN ('P', '', '  ') THEN 'P'
           WHEN @Value IN ('M', '+', '') THEN 'M'
           WHEN @Value IN ('G', '') THEN 'G'
           WHEN @Value IN ('N', '') THEN 'N'
           WHEN @Value IN ('C', '-', ' ') THEN 'C'
           WHEN @Value IN ('W', '-', ' 	 ') THEN 'W'
         END
END

GO
/****** Object:  UserDefinedFunction [Quik].[Deal::Value::To ClearingType]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Quik].[Deal::Value::To ClearingType] (@Value VarChar(32))
  RETURNS Char(1)
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN CASE
           WHEN @Value IN ('S', '', '') THEN 'S'
           WHEN @Value IN ('M', '', '') THEN 'M'
         END
END

GO
/****** Object:  UserDefinedFunction [Quik].[Deal::Value::To OperationType]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Quik].[Deal::Value::To OperationType] (@Value VarChar(12))
  RETURNS Char(1)
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN CASE
           WHEN @Value IN ('K', '', '', '', '', '') THEN 'K'
           WHEN @Value IN ('D', '', '', '', '', '') THEN 'D'
         END
END

GO
/****** Object:  UserDefinedFunction [Quik].[Order::Value::To ActivationType]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Quik].[Order::Value::To ActivationType] (@Value DateTime)
  RETURNS Char(1)
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN CASE
           WHEN @Value IS NOT NULL THEN 'T'
         END
END

GO
/****** Object:  UserDefinedFunction [Quik].[Order::Value::To BuySell]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Quik].[Order::Value::To BuySell] (@Value VarChar(12))
  RETURNS Char(1)
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN CASE
           WHEN @Value IN ('', '') THEN 'B'
           WHEN @Value = '' THEN 'S'
         END
END

GO
/****** Object:  UserDefinedFunction [Quik].[Order::Value::To Condition]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Quik].[Order::Value::To Condition] (@Value VarChar(12))
  RETURNS TinyInt
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN CASE
           WHEN @Value IN ('4', '<=') THEN 4
           WHEN @Value IN ('5', '>=') THEN 5
         END
END

GO
/****** Object:  UserDefinedFunction [Quik].[Order::Value::To ExecuteMethod]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Quik].[Order::Value::To ExecuteMethod] (@Value VarChar(12))
  RETURNS Char(1)
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN CASE Right(@Value, 1) 
           WHEN '' THEN 'A'
           WHEN 'A' THEN 'A'
           WHEN '' THEN 'C'
           WHEN 'C' THEN 'C'
         END -- /NULL -> NULL
END

GO
/****** Object:  UserDefinedFunction [Quik].[Order::Value::To ExpireDate]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Quik].[Order::Value::To ExpireDate] (@Value VarChar(20), @Today Date)
  RETURNS Date
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN CASE
           WHEN @Value IN ('-1', '', '') THEN @Today
           WHEN IsDate(@Value) = 1 THEN Cast(@Value AS Date)
         END -- 0/NULL -> NULL ( )
END

GO
/****** Object:  UserDefinedFunction [Quik].[Order::Value::To Period]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Quik].[Order::Value::To Period] (@Value VarChar(32))
  RETURNS Char(1)
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN CASE
           WHEN @Value = ''                        THEN 'O'
           WHEN @Value = ''                      THEN 'N'
           WHEN @Value = ''                        THEN 'C'
           WHEN @Value = ' '              THEN 'F'
           WHEN @Value = ' '                THEN 'L'
           WHEN @Value = '  '       THEN 'D'
           WHEN @Value = ' '              THEN 'I'
           WHEN @Value = '    ' THEN 'E'
         END
END

GO
/****** Object:  UserDefinedFunction [Quik].[Order::Value::To PriceEntryType]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Quik].[Order::Value::To PriceEntryType] (@Value VarChar(32))
  RETURNS Char(1)
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN CASE
           WHEN @Value = ' '                    THEN '0'
           WHEN @Value = ' '                        THEN '1'
           WHEN @Value IN (' ', 'Y')            THEN 'Y'
           WHEN @Value IN ('  ', 'A') THEN 'A'
         END
END

GO
/****** Object:  UserDefinedFunction [Quik].[Order::Value::To PriceKind]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Quik].[Order::Value::To PriceKind] (@Value VarChar(12))
  RETURNS Char(1)
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN CASE Left(@Value, 1) 
           WHEN '' THEN 'M'
           WHEN 'M' THEN 'M'
           WHEN 'C' THEN 'C'
         END -- //NULL -> NULL
END

GO
/****** Object:  UserDefinedFunction [Quik].[Order::Value::To SignDisableSplit]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Quik].[Order::Value::To SignDisableSplit] (@Value VarChar(12))
  RETURNS Char(1)
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN CASE SubString(@Value, 2, 1)
           WHEN '' THEN '1'
           WHEN '1' THEN '1'
         END -- /NULL -> NULL         
END

GO
/****** Object:  UserDefinedFunction [Quik].[Order::Value::To SignMarketMaker]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Quik].[Order::Value::To SignMarketMaker] (@Value VarChar(8))
  RETURNS Bit
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN CASE
           WHEN @Value IN ('1', '') THEN Cast(1 AS Bit)
         END   
END

GO
/****** Object:  UserDefinedFunction [Quik].[Order::Value::To Status]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Quik].[Order::Value::To Status] (@Value VarChar(12))
  RETURNS Char(1)
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN CASE
           WHEN @Value IN ('', '')       THEN 'O'
           WHEN @Value = ''                    THEN 'M'
           WHEN @Value = ''                        THEN 'W'
           WHEN @Value = ' '          THEN 'F'
           WHEN @Value = '  '  THEN 'R'
           WHEN @Value = '  '      THEN 'C'
           WHEN @Value = '   ' THEN 'T'
           WHEN @Value = '  '  THEN 'E'
         END
END

GO
/****** Object:  UserDefinedFunction [Quik].[Position::Value::To PositionGroup]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Quik].[Position::Value::To PositionGroup] (@Value VarChar(64))
  RETURNS Char(1)
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN CASE
           WHEN @Value IN ('  ', '  ', '0', '', '', 'L') THEN 'L'
           WHEN @Value IN ('  ', '  ', '1', '-', '-', 'D') THEN 'D'
           WHEN @Value IN ('  ', '  ', '2', '.', '.', 'I') THEN 'I'
           WHEN @Value IN ('  ', '  ', '3', '', '', 'T') THEN 'T'
           WHEN @Value IN ('  ', '  ', '4', '.', '.', 'S') THEN 'S'
           WHEN @Value IN ('  ', '  ', '5', '', '', 'P') THEN 'P'
         END
END

GO
/****** Object:  UserDefinedFunction [Quik].[Report::Value::To Kind]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Quik].[Report::Value::To Kind] (@Value VarChar(32))
  RETURNS Char(1)
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN CASE
           WHEN @Value IN (' ', ' ', '.', '.', '1') THEN '1'
           WHEN @Value IN ('. ', '. ', '.', '.', 'N') THEN 'N'
           WHEN @Value IN (' ', ' ', '.', '.', 'S') THEN 'S'
         END
END

GO
/****** Object:  UserDefinedFunction [Quik].[Report::Value::To SentReceived]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Quik].[Report::Value::To SentReceived] (@Value VarChar(30))
  RETURNS Char(1)
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN CASE
           WHEN @Value IN ('', '', 'sent', 'Sent', 'S') THEN 'S'
           WHEN @Value IN ('', '', 'received', 'Received', 'R') THEN 'R'
         END
END

GO
/****** Object:  UserDefinedFunction [Quik].[Report::Value::To Status]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Quik].[Report::Value::To Status] (@Value VarChar(30))
  RETURNS Char(1)
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN CASE
           WHEN @Value IN (' ', ' ', ' ', ' ', '', '', 'O') THEN 'O'
           WHEN @Value IN ('', '', '-', 'W') THEN 'W'
           WHEN @Value IN ('', '', '+', 'M') THEN 'M'
           WHEN @Value IN ('  ', 'c  ', '-', 'C') THEN 'C'
         END
END

GO
/****** Object:  UserDefinedFunction [Quik].[Value::To Bit]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [Quik].[Value::To Bit] (@Value VarChar(3))
  RETURNS Bit
---
  WITH SCHEMABINDING
---
AS BEGIN
  RETURN CASE
           WHEN @Value IN ('', '', 'No', 'no', '', 'N', '0') THEN Cast(0 AS Bit)
           WHEN @Value IN ('', '', 'Yes', 'yes', '', 'Y', '1') THEN Cast(1 AS Bit)
         END
END

GO
/****** Object:  UserDefinedFunction [SQL].[Object Name]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [SQL].[Object Name](@ObjectId Int)
  RETURNS sysname
---
  WITH SCHEMABINDING, RETURNS NULL ON NULL INPUT
---
AS BEGIN
  RETURN QuoteName(OBJECT_SCHEMA_NAME(@ObjectId)) + '.' + QuoteName(OBJECT_NAME(@ObjectId))
END

GO
/****** Object:  UserDefinedFunction [System].[Raise Error]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =================================================================================================================================================
--   :  
--     
--  :  ..
--  : 20.01.2010
--  : 2.0
-- =================================================================================================================================================
CREATE FUNCTION [System].[Raise Error](@Proc_ID Int, @Message NVarChar(4000))
  RETURNS Int
---
  WITH SCHEMABINDING, RETURNS NULL ON NULL INPUT
---
AS BEGIN
  RETURN Cast('<% RaisError:' + Cast(@Proc_ID as VarChar) + ' %>' + @Message + '<% /RaisError %>' AS Int)
END

GO
/****** Object:  Table [Bloomberg].[Dic:Instruments:Codes]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Bloomberg].[Dic:Instruments:Codes](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Instrument_Id] [int] NOT NULL,
	[Place_Id] [tinyint] NOT NULL,
	[Code] [nvarchar](64) NOT NULL,
	[TradeBoard_Id] [smallint] NULL,
	[Enabled] [bit] NULL,
	[AskCurrency] [char](3) NULL,
	[FixCurrency] [char](3) NULL,
	[MultiCalc] [numeric](19, 6) NULL,
	[CodeSuffix] [varchar](20) NULL,
	[CodeBoard] [varchar](10) NULL,
 CONSTRAINT [PK_Bloomberg.Dic:Instruments:Codes] PRIMARY KEY NONCLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [UQ_Bloomberg.Dic:Instruments:Codes_Id#Place_Id#TradeBoard_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE CLUSTERED INDEX [UQ_Bloomberg.Dic:Instruments:Codes_Id#Place_Id#TradeBoard_Id] ON [Bloomberg].[Dic:Instruments:Codes]
(
	[Instrument_Id] ASC,
	[Place_Id] ASC,
	[TradeBoard_Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Table [Bloomberg].[Dic:Instruments:Quotes:Types]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Bloomberg].[Dic:Instruments:Quotes:Types](
	[Id] [tinyint] IDENTITY(1,1) NOT NULL,
	[Code] [nvarchar](255) NOT NULL,
	[Gate_Code] [varchar](32) NOT NULL,
	[Active] [bit] NULL,
 CONSTRAINT [PK_Bloomberg.Dic:Instruments:Quotes:Types] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Bloomberg].[Dic:Places]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Bloomberg].[Dic:Places](
	[Id] [smallint] IDENTITY(1,1) NOT NULL,
	[Source_Id] [tinyint] NOT NULL,
	[Place_Id] [tinyint] NULL,
	[Code] [varchar](12) NOT NULL,
	[Currency] [char](3) NOT NULL,
 CONSTRAINT [PK_Bloomberg.Dic:Places] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Bloomberg].[Dic:Places:Calendars]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [Bloomberg].[Dic:Places:Calendars](
	[Place_Id] [tinyint] NOT NULL,
	[Date] [date] NOT NULL,
	[WorkDayIndex] [int] NULL,
 CONSTRAINT [PK_Bloomberg.Dic:Places:Calendars] PRIMARY KEY CLUSTERED 
(
	[Place_Id] ASC,
	[Date] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [Bloomberg].[Dic:Places:Schedules]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [Bloomberg].[Dic:Places:Schedules](
	[Place_Id] [tinyint] NOT NULL,
	[TimeStart] [time](7) NOT NULL,
	[TimeFinish] [time](7) NOT NULL,
 CONSTRAINT [PK_Bloomberg.Dic:Places:Schedules] PRIMARY KEY CLUSTERED 
(
	[Place_Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
/****** Object:  Table [Bloomberg].[Log:Errors]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Bloomberg].[Log:Errors](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Date] [datetime] NOT NULL DEFAULT (getdate()),
	[Message] [varchar](256) NOT NULL,
	[DataDetail] [varchar](max) NULL,
	[DateNotify] [datetime] NULL,
 CONSTRAINT [PK_Bloomberg.Log:Errors] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Gate].[Deals]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Deals](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Source_Id] [tinyint] NOT NULL,
	[Number] [bigint] NOT NULL,
	[TradeDateTime] [datetime] NOT NULL,
	[TradeBoard_Id] [smallint] NULL,
	[TradeBoardCode] [varchar](12) NULL,
	[BuySell] [char](1) NULL,
	[Instrument_Id] [int] NULL,
	[InstrumentCode] [varchar](12) NULL,
	[Accruedint] [numeric](19, 4) NULL,
	[AccruedintRate] [numeric](19, 4) NULL,
	[Order_Id] [int] NULL,
	[OrderNumber] [bigint] NULL,
	[Price] [numeric](19, 6) NULL,
	[Price2] [numeric](19, 6) NULL,
	[Currency] [varchar](5) NULL,
	[RepoRate] [numeric](19, 4) NULL,
	[RepoDays] [smallint] NULL,
	[RepoValue] [numeric](19, 4) NULL,
	[Repo2Value] [numeric](19, 4) NULL,
	[DiscountStart] [numeric](19, 4) NULL,
	[DiscountLower] [numeric](19, 4) NULL,
	[DiscountUpper] [numeric](19, 4) NULL,
	[TradeSystemCommission] [numeric](19, 4) NULL,
	[ClearingCommission] [numeric](19, 4) NULL,
	[ExchangeComission] [numeric](19, 4) NULL,
	[TechCenterComission] [numeric](19, 4) NULL,
	[Value] [numeric](19, 4) NULL,
	[Yield] [numeric](19, 4) NULL,
	[Quantity] [bigint] NULL,
	[BlockSecurities] [bit] NULL,
	[TradeAccount_Id] [int] NULL,
	[TradeAccountCode] [varchar](12) NULL,
	[BrokerRef] [varchar](20) NULL,
	[ClientCode] [varchar](12) NULL,
	[SettleCode] [varchar](12) NULL,
	[Type] [varchar](32) NULL,
	[TradeParticipantCode] [varchar](12) NULL,
	[PartnerTradeParticipant_Id] [smallint] NULL,
	[PartnerTradeParticipantCode] [varchar](12) NULL,
	[Margin] [numeric](19, 6) NULL,
	[SettleDate] [date] NULL,
	[SettleCurrency] [varchar](5) NULL,
	[Period] [char](1) NULL,
	[TradeTimeMcs] [int] NULL,
	[Kind] [varchar](64) NULL,
	[BankAccount] [varchar](12) NULL,
	[LinkedDeal_Id] [int] NULL,
	[LinkedDealNumber] [bigint] NULL,
 CONSTRAINT [PK_Gate.Deals] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Gate].[Deals:Active]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Deals:Active](
	[Id] [int] NOT NULL,
	[PartnerReportNumber] [bigint] NULL,
	[Price1] [numeric](19, 6) NULL,
	[RepoDeal_Id] [int] NULL,
	[RepoDealNumber] [bigint] NULL,
	[Amount] [numeric](19, 4) NULL,
	[ExpectedRepo2Value] [numeric](19, 4) NULL,
	[ExpectedRepoValue] [numeric](19, 4) NULL,
	[ExpectedReturnValue] [numeric](19, 4) NULL,
	[ReturnRepoValue] [numeric](19, 4) NULL,
	[Discount] [numeric](19, 4) NULL,
	[ExpectedDiscount] [numeric](19, 6) NULL,
	[DealDate] [date] NULL,
	[Balance] [int] NULL,
	[ExpectedQuantity] [int] NULL,
	[ReportDealDate] [date] NULL,
	[OperationType] [char](1) NULL,
	[ExecuteSign] [bit] NULL,
	[PartnerTradeAccount_Id] [int] NULL,
	[PartnerTradeAccountCode] [varchar](12) NULL,
	[Status] [char](1) NULL,
	[ReportNumber] [bigint] NULL,
	[SettleStatus] [char](1) NULL,
	[ClearingType] [char](1) NULL,
	[ReportComission] [numeric](19, 4) NULL,
	[CouponPayment] [numeric](19, 4) NULL,
	[CouponPaymentDate] [date] NULL,
	[PrincipalPayment] [numeric](19, 4) NULL,
	[PrincipalPaymentDate] [date] NULL,
 CONSTRAINT [PK_Gate.Deals:Active] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Gate].[Dic:Instruments:Quotes:Types]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Dic:Instruments:Quotes:Types](
	[Id] [tinyint] IDENTITY(1,1) NOT NULL,
	[Name] [nvarchar](255) NOT NULL,
	[Code] [varchar](32) NOT NULL,
 CONSTRAINT [PK_Gate.Dic:Instruments:Quotes:Types] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Gate].[Dic:Places]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Dic:Places](
	[Id] [tinyint] NOT NULL,
	[Code] [varchar](30) NULL,
	[Name] [nvarchar](255) NOT NULL,
 CONSTRAINT [PK_Gate.Dic:Places] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Gate].[Dic:Places:Trade Boards]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Dic:Places:Trade Boards](
	[Id] [smallint] IDENTITY(1,1) NOT NULL,
	[Place_Id] [tinyint] NOT NULL,
	[Code] [varchar](20) NOT NULL,
 CONSTRAINT [PK_Gate.Dic:Places:TradeBoards] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Gate].[Dic:Sources]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Dic:Sources](
	[Id] [tinyint] NOT NULL,
	[Name] [varchar](64) NOT NULL,
	[Description] [nvarchar](256) NULL,
 CONSTRAINT [PK_Gate.Dic:Sources] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Gate].[Instruments]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Instruments](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Code] [varchar](12) NOT NULL,
	[Place_Id] [tinyint] NOT NULL,
 CONSTRAINT [PK_Gate.Instruments] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Gate].[Instruments:Current Quotes]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Instruments:Current Quotes](
	[TradeBoard_Id] [smallint] NULL,
	[Instrument_Id] [int] NULL,
	[QuoteType_Id] [tinyint] NOT NULL,
	[Currency] [varchar](5) NULL,
	[Value] [numeric](19, 6) NOT NULL,
	[LastUpdateDateTime] [datetime] NOT NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [UQ_Gate.Instruments:CurrentQuotes#Instrument_Id#TradeBoard_Id#QuoteType_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE CLUSTERED INDEX [UQ_Gate.Instruments:CurrentQuotes#Instrument_Id#TradeBoard_Id#QuoteType_Id] ON [Gate].[Instruments:Current Quotes]
(
	[Instrument_Id] ASC,
	[TradeBoard_Id] ASC,
	[QuoteType_Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Table [Gate].[Instruments:Instrument Dates]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Instruments:Instrument Dates](
	[TradeDate] [date] NOT NULL,
	[TradeBoard_Id] [smallint] NULL,
	[TradeBoardCode] [varchar](12) NULL,
	[Instrument_Id] [int] NOT NULL,
	[TradeParticipant_Id] [smallint] NULL,
	[TradeParticipantCode] [varchar](12) NULL,
	[FaceValue] [numeric](19, 4) NULL,
	[FaceCurrency] [varchar](5) NULL,
	[OptionStrike] [numeric](19, 4) NULL,
	[OptionType] [varchar](12) NULL,
	[OptionBaseInstrument_Id] [int] NULL,
	[OptionBaseInstrumentCode] [varchar](12) NULL,
	[OptionBaseTradeBoard_Id] [smallint] NULL,
	[OptionBaseTradeBoardCode] [varchar](12) NULL,
	[LotSize] [numeric](19, 4) NULL,
	[PriceStep] [numeric](19, 6) NULL,
	[MaturityDate] [datetime] NULL,
	[MinStep] [numeric](19, 6) NULL,
	[Scale] [numeric](19, 0) NULL,
	[ShortName] [nvarchar](255) NULL,
	[FullName] [nvarchar](255) NULL,
	[Name] [nvarchar](255) NULL,
	[ISINCode] [varchar](12) NULL,
	[RegNumberCode] [varchar](32) NULL,
	[MarginTypes] [varchar](4) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ_Gate.Instruments:InstrumentDates#Instrument_Id#TradeDate#TradeBoard_Id#TradeBoardCode]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE CLUSTERED INDEX [UQ_Gate.Instruments:InstrumentDates#Instrument_Id#TradeDate#TradeBoard_Id#TradeBoardCode] ON [Gate].[Instruments:Instrument Dates]
(
	[Instrument_Id] ASC,
	[TradeDate] ASC,
	[TradeBoard_Id] ASC,
	[TradeBoardCode] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Table [Gate].[Instruments:Quotes]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Instruments:Quotes](
	[TradeDateTime] [datetime] NOT NULL,
	[TradeBoard_Id] [smallint] NULL,
	[Instrument_Id] [int] NULL,
	[QuoteType_Id] [tinyint] NOT NULL,
	[Currency] [varchar](5) NULL,
	[Value] [numeric](19, 6) NULL,
	[LastUpdateTime] [time](7) NOT NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [UQ_Gate.Instruments:Quotes#TradeDateTime#Instrument_Id#TradeBoard_Id#QuoteType_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE CLUSTERED INDEX [UQ_Gate.Instruments:Quotes#TradeDateTime#Instrument_Id#TradeBoard_Id#QuoteType_Id] ON [Gate].[Instruments:Quotes]
(
	[TradeDateTime] ASC,
	[Instrument_Id] ASC,
	[TradeBoard_Id] ASC,
	[QuoteType_Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Table [Gate].[Instruments:Quotes:Trade Dates]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Instruments:Quotes:Trade Dates](
	[TradeDate] [date] NOT NULL,
	[TradeBoard_Id] [smallint] NULL,
	[Instrument_Id] [int] NULL,
	[QuoteType_Id] [tinyint] NOT NULL,
	[Currency] [varchar](5) NULL,
	[Value] [numeric](19, 6) NOT NULL,
	[LastUpdateTime] [time](7) NOT NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [UQ_Gate.Instruments:Quotes:TradeDates#Instrument_Id#TradeDate#TradeBoard_Id#QuoteType_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE CLUSTERED INDEX [UQ_Gate.Instruments:Quotes:TradeDates#Instrument_Id#TradeDate#TradeBoard_Id#QuoteType_Id] ON [Gate].[Instruments:Quotes:Trade Dates]
(
	[Instrument_Id] ASC,
	[TradeDate] ASC,
	[TradeBoard_Id] ASC,
	[QuoteType_Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Table [Gate].[Limits:Derivatives]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Limits:Derivatives](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Source_Id] [tinyint] NOT NULL,
	[TradeAccount_Id] [int] NULL,
	[TradeAccountCode] [varchar](12) NULL,
	[TradeParticipantCode] [varchar](12) NULL,
	[Type] [varchar](40) NOT NULL,
	[TradeDate] [date] NOT NULL,
	[Accruedint] [numeric](19, 4) NULL,
	[OpenPositionsLimit] [numeric](19, 4) NULL,
	[NetPositionsPlanned] [numeric](19, 4) NULL,
	[NetPositionsUsed] [numeric](19, 4) NULL,
	[OpenPositionsPreviosLimit] [numeric](19, 4) NULL,
	[LiquidityRate] [numeric](19, 4) NULL,
	[VarMargin] [numeric](19, 4) NULL,
	[OrdersWarrantyProvision] [numeric](19, 4) NULL,
	[PositionsWarrantyProvision] [numeric](19, 4) NULL,
	[OptionsPremium] [numeric](19, 6) NULL,
	[TradeSystemComission] [numeric](19, 6) NULL,
	[WarrantyProvisionRate] [numeric](19, 6) NULL,
	[Currency] [varchar](5) NULL,
	[RealVarMargin] [numeric](19, 6) NULL,
 CONSTRAINT [PK_Gate.Limits:Derivatives] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Gate].[Limits:Money]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Limits:Money](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Source_Id] [tinyint] NOT NULL,
	[TradeParticipant_Id] [smallint] NULL,
	[TradeParticipantCode] [varchar](12) NULL,
	[ClientCode] [varchar](12) NOT NULL,
	[Currency] [varchar](5) NOT NULL,
	[Tag] [varchar](4) NOT NULL,
	[Kind] [varchar](3) NOT NULL,
	[TradeDate] [date] NOT NULL,
	[Leverage] [numeric](19, 4) NULL,
	[LockedValueRate] [numeric](19, 4) NULL,
	[CurrentBalance] [numeric](19, 2) NULL,
	[CurrentLimit] [numeric](19, 2) NULL,
	[Locked] [numeric](19, 2) NULL,
	[OpenBalance] [numeric](19, 2) NULL,
	[OpenLimit] [numeric](19, 2) NULL,
 CONSTRAINT [PK_Gate.Limits:Money] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Gate].[Limits:Securities]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Limits:Securities](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Source_Id] [tinyint] NOT NULL,
	[TradeAccount_Id] [int] NULL,
	[TradeAccountCode] [varchar](12) NULL,
	[TradeParticipantCode] [varchar](12) NULL,
	[Instrument_Id] [int] NULL,
	[InstrumentCode] [varchar](12) NULL,
	[ClientCode] [varchar](12) NOT NULL,
	[Kind] [varchar](3) NOT NULL,
	[TradeDate] [date] NOT NULL,
	[LockedSell] [numeric](19, 2) NULL,
	[LockedSellValue] [numeric](19, 4) NULL,
	[LockedBuy] [numeric](19, 2) NULL,
	[LockedBuyValue] [numeric](19, 4) NULL,
	[CurrentBalance] [numeric](19, 2) NULL,
	[CurrentLimit] [numeric](19, 2) NULL,
	[OpenBalance] [numeric](19, 2) NULL,
	[OpenLimit] [numeric](19, 2) NULL,
	[AvgPositionPrice] [numeric](19, 6) NULL,
 CONSTRAINT [PK_Gate.Limits:Securities] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Gate].[Orders]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Orders](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Source_Id] [tinyint] NOT NULL,
	[Number] [bigint] NOT NULL,
	[SessionDate] [date] NOT NULL,
	[SessionId] [int] NULL,
	[TradeBoard_Id] [smallint] NULL,
	[TradeBoardCode] [varchar](12) NULL,
	[Accruedint] [numeric](19, 4) NULL,
	[Price] [numeric](19, 6) NULL,
	[Value] [numeric](19, 4) NULL,
	[Yield] [numeric](19, 4) NULL,
	[Price2] [numeric](19, 6) NULL,
	[Quantity] [bigint] NULL,
	[CreateDateTime] [datetime] NOT NULL,
	[CancelDateTime] [time](7) NULL,
	[TradeAccount_Id] [int] NULL,
	[TradeAccountCode] [varchar](12) NULL,
	[BrokerRef] [varchar](20) NULL,
	[ExternalRef] [varchar](12) NULL,
	[ClientCode] [varchar](12) NULL,
	[SettleCode] [varchar](12) NULL,
	[BuySell] [char](1) NULL,
	[Status] [char](1) NULL,
	[PriceKind] [char](1) NULL,
	[SignDisableSplit] [char](1) NULL,
	[ExecuteMethod] [char](1) NULL,
	[TradeParticipantCode] [varchar](12) NULL,
	[Instrument_Id] [int] NULL,
	[InstrumentCode] [varchar](12) NULL,
	[ActivationDateTime] [time](7) NULL,
	[ActivationType] [char](1) NULL,
	[ExpireDate] [date] NULL,
	[SignMarketMaker] [bit] NULL,
	[Period] [char](1) NULL,
	[QuantityVisible] [bigint] NULL,
	[CreateTimeMcs] [int] NULL,
	[CancelTimeMcs] [int] NULL,
	[BankAccount] [varchar](12) NULL,
	[PriceEntryType] [char](1) NULL,
	[RepoDays] [smallint] NULL,
	[DiscountStart] [numeric](19, 6) NULL,
	[RejectReason] [nvarchar](255) NULL,
	[DealType] [char](1) NULL,
 CONSTRAINT [PK_Gate.Orders] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Gate].[Places:Trade Participants]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Places:Trade Participants](
	[Id] [smallint] IDENTITY(1,1) NOT NULL,
	[Place_Id] [tinyint] NOT NULL,
	[Code] [varchar](12) NOT NULL,
	[Name] [nvarchar](255) NULL,
	[Active] [bit] NOT NULL,
 CONSTRAINT [PK_Gate.Places:TradeParticipants] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Gate].[Reports]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Reports](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Source_Id] [tinyint] NOT NULL,
	[Number] [bigint] NOT NULL,
	[TradeBoard_Id] [smallint] NULL,
	[TradeBoardCode] [varchar](12) NULL,
	[SessionDate] [date] NOT NULL,
	[Value] [numeric](19, 4) NULL,
	[Quantity] [bigint] NULL,
	[CreateDateTime] [datetime] NULL,
	[OrderCancelTime] [time](7) NULL,
	[TradeAccount_Id] [int] NULL,
	[TradeAccountCode] [varchar](12) NULL,
	[PartnerTradeAccount_Id] [int] NULL,
	[PartnerTradeAccountCode] [varchar](12) NULL,
	[TradeParticipantCode] [varchar](12) NULL,
	[PartnerTradeParticipantCode] [varchar](12) NULL,
	[SentReceived] [char](1) NULL,
	[Status] [char](1) NULL,
	[Instrument_Id] [int] NULL,
	[InstrumentCode] [varchar](12) NULL,
	[Commission] [numeric](19, 4) NULL,
	[Kind] [char](1) NULL,
 CONSTRAINT [PK_Gate.Reports] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Gate].[Trade Accounts]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Trade Accounts](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Source_Id] [tinyint] NOT NULL,
	[Code] [varchar](12) NOT NULL,
	[TradeParticipant_Id] [smallint] NULL,
	[TradeParticipantCode] [varchar](12) NULL,
 CONSTRAINT [PK_Gate.TradeAccounts] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Gate].[Trade Accounts:Trade Dates]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Trade Accounts:Trade Dates](
	[TradeDate] [date] NOT NULL,
	[TradeAccount_Id] [int] NOT NULL,
	[DepoType] [tinyint] NOT NULL,
	[Description] [nvarchar](255) NULL,
	[BankAccount] [varchar](12) NULL,
	[Status] [bit] NULL,
	[DepoAccount] [varchar](12) NULL,
	[Type] [varchar](64) NULL,
	[MainTradeAccount] [varchar](12) NULL,
 CONSTRAINT [PK_Gate.TradeAccounts:TradeDates] PRIMARY KEY CLUSTERED 
(
	[TradeAccount_Id] ASC,
	[TradeDate] ASC,
	[DepoType] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Gate].[Trade Participant Rests:Accounts]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Trade Participant Rests:Accounts](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Source_Id] [tinyint] NOT NULL,
	[Instrument_Id] [int] NULL,
	[InstrumentCode] [varchar](12) NULL,
	[TradeAccount_Id] [int] NULL,
	[TradeAccountCode] [varchar](12) NULL,
	[TradeParticipantCode] [varchar](12) NULL,
	[DepoAccount] [varchar](12) NOT NULL,
	[TradeDate] [date] NOT NULL,
	[CurrentPosition] [numeric](19, 4) NULL,
	[OpenBalance] [numeric](19, 4) NULL,
	[PlannedPositionBuy] [numeric](19, 4) NULL,
	[PlannedPositionSell] [numeric](19, 4) NULL,
	[PlannedBalance] [numeric](19, 4) NULL,
	[QuantityBuy] [numeric](19, 4) NULL,
	[QuantitySell] [numeric](19, 4) NULL,
	[Planned] [numeric](19, 4) NULL,
	[BankAccount] [varchar](12) NULL,
	[SignUse] [varchar](16) NULL,
	[SettleBalance] [numeric](19, 4) NULL,
 CONSTRAINT [PK_Gate.TradeParticipantRests:Accounts] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Gate].[Trade Participant Rests:Derivatives]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Trade Participant Rests:Derivatives](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Source_Id] [tinyint] NOT NULL,
	[TradeAccount_Id] [int] NULL,
	[TradeAccountCode] [varchar](12) NULL,
	[TradeParticipantCode] [varchar](12) NULL,
	[Instrument_Id] [int] NULL,
	[InstrumentCode] [varchar](12) NULL,
	[Type] [varchar](40) NOT NULL,
	[TradeDate] [date] NOT NULL,
	[AvgPositionPrice] [numeric](19, 6) NULL,
	[ValuationPlanned] [numeric](19, 4) NULL,
	[ValuationUsed] [numeric](19, 4) NULL,
	[VarMargin] [numeric](19, 6) NULL,
	[Value] [numeric](19, 4) NULL,
	[OpenOrderBuys] [int] NULL,
	[OpenOrderSells] [int] NULL,
	[StartBuy] [int] NULL,
	[StartSell] [int] NULL,
	[StartNet] [int] NULL,
	[TodayBuy] [int] NULL,
	[TodaySell] [int] NULL,
	[TotalNet] [int] NULL,
	[MaturityDate] [date] NULL,
	[TotalVarMargin] [numeric](19, 6) NULL,
	[RealVarMargin] [numeric](19, 6) NULL,
 CONSTRAINT [PK_Gate.TradeParticipantRests:Derivatives] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Gate].[Trade Participant Rests:Execution Dates]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Trade Participant Rests:Execution Dates](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Source_Id] [tinyint] NOT NULL,
	[TradeParticipant_Id] [smallint] NULL,
	[TradeParticipantCode] [varchar](12) NULL,
	[Currency] [varchar](5) NOT NULL,
	[SettleDate] [date] NOT NULL,
	[SettleCode] [varchar](12) NOT NULL,
	[TradeDate] [date] NOT NULL,
	[PositionTag] [varchar](4) NULL,
	[MarginCall] [numeric](19, 2) NULL,
	[Debit] [numeric](19, 2) NULL,
	[Credit] [numeric](19, 2) NULL,
	[PositionGroup] [char](1) NULL,
 CONSTRAINT [PK_Gate.TradeParticipantRests:ExecutionDates] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Gate].[Trade Participant Rests:Money]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Trade Participant Rests:Money](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Source_Id] [tinyint] NOT NULL,
	[TradeParticipant_Id] [smallint] NULL,
	[TradeParticipantCode] [varchar](12) NULL,
	[Currency] [varchar](5) NOT NULL,
	[Tag] [varchar](4) NOT NULL,
	[BankAccount] [varchar](12) NOT NULL,
	[TradeDate] [date] NOT NULL,
	[Description] [nvarchar](255) NULL,
	[CurrentPosition] [numeric](19, 4) NULL,
	[OpenBalance] [numeric](19, 4) NULL,
	[PlannedPosition] [numeric](19, 4) NULL,
	[OrderBuy] [numeric](19, 4) NULL,
	[OrderSell] [numeric](19, 4) NULL,
	[Netto] [numeric](19, 4) NULL,
	[PlannedBalance] [numeric](19, 4) NULL,
	[MarginCall] [numeric](19, 4) NULL,
	[SettleBalance] [numeric](19, 4) NULL,
 CONSTRAINT [PK_Gate.TradeParticipantRests:Money] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Gate].[Trade Participant Rests:Securities]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Gate].[Trade Participant Rests:Securities](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Source_Id] [tinyint] NOT NULL,
	[TradeParticipant_Id] [smallint] NULL,
	[TradeParticipantCode] [varchar](12) NULL,
	[Instrument_Id] [int] NULL,
	[InstrumentCode] [varchar](12) NULL,
	[TradeDate] [date] NOT NULL,
	[CurrentPosition] [numeric](19, 4) NULL,
	[OpenBalance] [numeric](19, 4) NULL,
	[PlannedPositionBuy] [numeric](19, 4) NULL,
	[PlannedPositionSell] [numeric](19, 4) NULL,
	[QuantityBuy] [numeric](19, 4) NULL,
	[QuantitySell] [numeric](19, 4) NULL,
 CONSTRAINT [PK_Gate.TradeParticipantRests:Securities] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Micex].[Deals]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Micex].[Deals](
	[TradeNum] [bigint] NOT NULL,
	[TradeDate] [date] NOT NULL,
	[TradeTime] [time](7) NULL,
	[ClassCode] [varchar](50) NULL,
	[SecCode] [varchar](50) NOT NULL,
	[Price] [numeric](24, 8) NULL,
	[Quantity] [int] NULL,
	[Value] [numeric](24, 8) NULL,
	[BuySell] [varchar](10) NULL,
	[SettleCode] [varchar](4) NULL,
	[Yield] [numeric](16, 8) NULL,
	[Accruedint] [numeric](24, 8) NULL
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [PK_Micex.Deals]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE CLUSTERED INDEX [PK_Micex.Deals] ON [Micex].[Deals]
(
	[TradeNum] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Table [Quik].[Dic:Places]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Quik].[Dic:Places](
	[Id] [smallint] IDENTITY(1,1) NOT NULL,
	[Source_Id] [tinyint] NOT NULL,
	[Place_Id] [tinyint] NULL,
	[Code] [varchar](12) NOT NULL,
 CONSTRAINT [PK_Quik.Dic:Places] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Quik].[Dic:Places:Trade Boards]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Quik].[Dic:Places:Trade Boards](
	[Id] [smallint] IDENTITY(1,1) NOT NULL,
	[Source_Id] [tinyint] NOT NULL,
	[Code] [varchar](12) NOT NULL,
	[TradeBoard_Id] [smallint] NULL,
	[Ignore] [bit] NULL,
 CONSTRAINT [PK_Quik.Dic:Places:TradeBoards] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Quik].[Instruments]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Quik].[Instruments](
	[Instrument_Id] [int] NOT NULL,
	[Source_Id] [tinyint] NOT NULL,
	[Code] [varchar](12) NOT NULL,
 CONSTRAINT [PK_Quik.Instruments] PRIMARY KEY CLUSTERED 
(
	[Instrument_Id] ASC,
	[Source_Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Quik].[Orders:Stop]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Quik].[Orders:Stop](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Source_Id] [tinyint] NOT NULL,
	[Number] [bigint] NOT NULL,
	[SessionDate] [date] NOT NULL,
	[TradeBoard_Id] [smallint] NULL,
	[TradeBoardCode] [varchar](12) NULL,
	[ConditionPrice] [numeric](19, 6) NULL,
	[LinkedOrder_Id] [int] NULL,
	[LinkedOrderNumber] [bigint] NULL,
	[Price] [numeric](19, 6) NULL,
	[ConditionDeal_Id] [int] NULL,
	[ConditionDealNumber] [bigint] NULL,
	[CoOrder_Id] [int] NULL,
	[CoOrderNumber] [bigint] NULL,
	[BaseOrder_Id] [int] NULL,
	[BaseOrderNumber] [bigint] NULL,
	[TakeProfitOffset] [numeric](19, 6) NULL,
	[TakeProfitSpread] [numeric](19, 6) NULL,
	[Quantity] [bigint] NULL,
	[CreateDateTime] [datetime] NULL,
	[Balance] [bigint] NULL,
	[Condition] [tinyint] NULL,
	[ExpireDate] [date] NULL,
	[FilledQuantity] [bigint] NULL,
	[TradeAccount_Id] [int] NULL,
	[TradeAccountCode] [varchar](12) NULL,
	[BrokerRef] [varchar](20) NULL,
	[ClientCode] [varchar](12) NULL,
	[TradeParticipantCode] [varchar](12) NULL,
	[Status] [char](1) NULL,
	[StatusDescription] [nvarchar](255) NULL,
	[Kind] [varchar](40) NULL,
	[PriceKind] [char](1) NULL,
	[SignDisableSplit] [char](1) NULL,
	[ExecuteMethod] [char](1) NULL,
	[Mode] [varchar](20) NULL,
	[BuySell] [char](1) NULL,
	[ConditionInstrument_Id] [int] NULL,
	[ConditionInstrumentCode] [varchar](12) NULL,
	[ConditionTradeBoard_Id] [smallint] NULL,
	[ConditionTradeBoardCode] [varchar](12) NULL,
	[TransactionId] [bigint] NULL,
	[OffsetUnit] [varchar](2) NULL,
	[SpreadUnit] [varchar](2) NULL,
	[ActiveTimeStart] [time](7) NULL,
	[ActiveTimeFinish] [time](7) NULL,
	[CancelDateTime] [time](7) NULL,
	[ConditionPrice2] [numeric](19, 6) NULL,
	[MarketStopLimit] [varchar](2) NULL,
	[MarketTakeProfit] [varchar](4) NULL,
 CONSTRAINT [PK_Quik.Orders:Stop] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Quik].[Places:Trade Boards:Trade Dates]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Quik].[Places:Trade Boards:Trade Dates](
	[TradeDate] [date] NOT NULL,
	[TradeBoard_Id] [smallint] NOT NULL,
	[TradeParticipant_Id] [smallint] NULL,
	[TradeParticipantCode] [varchar](12) NULL,
	[Name] [nvarchar](255) NULL,
	[Flags] [int] NULL,
	[RFlags] [int] NULL,
 CONSTRAINT [PK_Quik.Places:TradeBoards:TradeDates] PRIMARY KEY CLUSTERED 
(
	[TradeBoard_Id] ASC,
	[TradeDate] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [Quik].[Places:Trade Participants]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [Quik].[Places:Trade Participants](
	[Id] [smallint] IDENTITY(1,1) NOT NULL,
	[Source_Id] [tinyint] NOT NULL,
	[Code] [varchar](12) NOT NULL,
	[TradeParticipant_Id] [smallint] NULL,
	[ExchangeCode] [varchar](12) NULL,
	[Active] [bit] NOT NULL,
 CONSTRAINT [PK_Quik.Places:TradeParticipants] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [System].[Session Variables]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [System].[Session Variables](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Session_Id] [int] NOT NULL,
	[Connection_Id] [uniqueidentifier] NOT NULL,
	[Request_StartTime] [datetime] NOT NULL,
	[LifeTime] [char](1) NOT NULL,
	[Name] [varchar](50) NOT NULL,
	[Value] [sql_variant] NOT NULL,
 CONSTRAINT [PK_System.Session Variables] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
 CONSTRAINT [UQ_System.Session Variables#Session_Id] UNIQUE NONCLUSTERED 
(
	[Session_Id] ASC,
	[Name] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  Table [System].[Variables]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [System].[Variables](
	[Id] [smallint] IDENTITY(1,1) NOT NULL,
	[Code] [varchar](50) NOT NULL,
	[Name] [varchar](100) NULL,
	[Value] [sql_variant] NULL,
 CONSTRAINT [PK_System.Variables] PRIMARY KEY CLUSTERED 
(
	[Code] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING ON
GO
/****** Object:  View [Gate].[BLOOMBERG:Securities:Codes]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE VIEW [Gate].[BLOOMBERG:Securities:Codes]
AS
  SELECT DISTINCT
    -- [Instrument_Id]   = C.[Instrument_Id],
    [Code]            = C.[Code],
    [CurrencyCode]    = CAST(N'RUB' AS NChar(3)),
    [LastLoadedDate]  = LLD.[LastLoadedDate]
  FROM [BackOffice].[Base].[Instruments:Codes] C
  INNER JOIN [BackOffice].[Base].[Instruments:Securities:Issues] S ON S.[Id] = C.[Instrument_Id]
  INNER JOIN [BackOffice].[Base].[Dic:Instruments:Places] P ON P.[Id] = C.[Place_Id]
  OUTER APPLY
  (
    SELECT TOP 1
      [LastLoadedDate] = P.[Date]
    FROM [Gate].[BLOOMBERG:Securities:Prices] P
    WHERE P.[Code] = C.[Code]
    ORDER BY [Date] DESC
  ) AS LLD
  WHERE P.[Code] = 'BLOOMBERG'

GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ_Bloomberg.Dic:Instruments:Codes#Code#Place_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Bloomberg.Dic:Instruments:Codes#Code#Place_Id] ON [Bloomberg].[Dic:Instruments:Codes]
(
	[Code] ASC,
	[Place_Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ_Bloomberg.Dic:Places#Code#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Bloomberg.Dic:Places#Code#Source_Id] ON [Bloomberg].[Dic:Places]
(
	[Code] ASC,
	[Source_Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Deals#InstrumentCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Deals#InstrumentCode#Source_Id] ON [Gate].[Deals]
(
	[InstrumentCode] ASC,
	[Source_Id] ASC
)
WHERE ([InstrumentCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_Gate.Deals#LinkedDealNumber#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Deals#LinkedDealNumber#Source_Id] ON [Gate].[Deals]
(
	[LinkedDealNumber] ASC,
	[Source_Id] ASC
)
WHERE ([LinkedDealNumber] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_Gate.Deals#OrderNumber#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Deals#OrderNumber#Source_Id] ON [Gate].[Deals]
(
	[OrderNumber] ASC,
	[Source_Id] ASC
)
WHERE ([OrderNumber] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Deals#PartnerTradeParticipantCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Deals#PartnerTradeParticipantCode#Source_Id] ON [Gate].[Deals]
(
	[PartnerTradeParticipantCode] ASC,
	[Source_Id] ASC
)
WHERE ([PartnerTradeParticipantCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Deals#TradeAccountCode#TradeParticipantCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Deals#TradeAccountCode#TradeParticipantCode#Source_Id] ON [Gate].[Deals]
(
	[TradeAccountCode] ASC,
	[TradeParticipantCode] ASC,
	[Source_Id] ASC
)
WHERE ([TradeAccountCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Deals#TradeBoardCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Deals#TradeBoardCode#Source_Id] ON [Gate].[Deals]
(
	[TradeBoardCode] ASC,
	[Source_Id] ASC
)
WHERE ([TradeBoardCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ_Gate.Deals#Number#Source_Id#TradeDateTime#TradeBoard_Id#TradeBoardCode]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Gate.Deals#Number#Source_Id#TradeDateTime#TradeBoard_Id#TradeBoardCode] ON [Gate].[Deals]
(
	[Number] ASC,
	[Source_Id] ASC,
	[TradeDateTime] ASC,
	[TradeBoard_Id] ASC,
	[TradeBoardCode] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Deals:Active#PartnerTradeAccountCode]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Deals:Active#PartnerTradeAccountCode] ON [Gate].[Deals:Active]
(
	[PartnerTradeAccountCode] ASC
)
WHERE ([PartnerTradeAccountCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_Gate.Deals:Active#RepoDealNumber]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Deals:Active#RepoDealNumber] ON [Gate].[Deals:Active]
(
	[RepoDealNumber] ASC
)
WHERE ([RepoDealNumber] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ_Gate.Dic:Places#Code]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Gate.Dic:Places#Code] ON [Gate].[Dic:Places]
(
	[Code] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Dic:Places:Trade Boards#Place_Id#Code]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [IX_Gate.Dic:Places:Trade Boards#Place_Id#Code] ON [Gate].[Dic:Places:Trade Boards]
(
	[Place_Id] ASC,
	[Code] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_Gate.Dic:Places:TradeBoards#Place_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Dic:Places:TradeBoards#Place_Id] ON [Gate].[Dic:Places:Trade Boards]
(
	[Place_Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ_Gate.Dic:Sources#Name]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Gate.Dic:Sources#Name] ON [Gate].[Dic:Sources]
(
	[Name] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ_Gate.Instruments#Code#Place_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Gate.Instruments#Code#Place_Id] ON [Gate].[Instruments]
(
	[Code] ASC,
	[Place_Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Instruments:Instrument Dates#OptionBaseInstrumentCode]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Instruments:Instrument Dates#OptionBaseInstrumentCode] ON [Gate].[Instruments:Instrument Dates]
(
	[OptionBaseInstrumentCode] ASC
)
WHERE ([OptionBaseInstrumentCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Instruments:Instrument Dates#TradeParticipantCode]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Instruments:Instrument Dates#TradeParticipantCode] ON [Gate].[Instruments:Instrument Dates]
(
	[TradeParticipantCode] ASC
)
WHERE ([TradeParticipantCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Instruments:InstrumentDates#OptionBaseTradeBoardCode]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Instruments:InstrumentDates#OptionBaseTradeBoardCode] ON [Gate].[Instruments:Instrument Dates]
(
	[OptionBaseTradeBoardCode] ASC
)
WHERE ([OptionBaseTradeBoardCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Instruments:InstrumentDates#TradeBoardCode]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Instruments:InstrumentDates#TradeBoardCode] ON [Gate].[Instruments:Instrument Dates]
(
	[TradeBoardCode] ASC
)
WHERE ([TradeBoardCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Instruments:Quotes#Instrument_Id#QuoteType_Id#TradeDateTime#TradeBoard_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [IX_Gate.Instruments:Quotes#Instrument_Id#QuoteType_Id#TradeDateTime#TradeBoard_Id] ON [Gate].[Instruments:Quotes]
(
	[Instrument_Id] ASC,
	[QuoteType_Id] ASC,
	[TradeDateTime] ASC,
	[TradeBoard_Id] ASC
)
INCLUDE ( 	[Value],
	[Currency]) WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [UQ_Gate.Instruments:Quotes#Instrument_Id#TradeDateTime#TradeBoard_Id#QuoteType_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Gate.Instruments:Quotes#Instrument_Id#TradeDateTime#TradeBoard_Id#QuoteType_Id] ON [Gate].[Instruments:Quotes]
(
	[Instrument_Id] ASC,
	[TradeDateTime] ASC,
	[TradeBoard_Id] ASC,
	[QuoteType_Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Limits:Derivatives#TradeAccountCode#TradeParticipantCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Limits:Derivatives#TradeAccountCode#TradeParticipantCode#Source_Id] ON [Gate].[Limits:Derivatives]
(
	[TradeAccountCode] ASC,
	[TradeParticipantCode] ASC,
	[Source_Id] ASC
)
WHERE ([TradeAccountCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ_Gate.Limits:Derivatives#TradeAccount_Id#TradeAccountCode#TradeParticipantCode#TradeDate#Type]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Gate.Limits:Derivatives#TradeAccount_Id#TradeAccountCode#TradeParticipantCode#TradeDate#Type] ON [Gate].[Limits:Derivatives]
(
	[TradeAccount_Id] ASC,
	[TradeAccountCode] ASC,
	[TradeParticipantCode] ASC,
	[TradeDate] ASC,
	[Type] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Limits:Money#TradeParticipantCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Limits:Money#TradeParticipantCode#Source_Id] ON [Gate].[Limits:Money]
(
	[TradeParticipantCode] ASC,
	[Source_Id] ASC
)
WHERE ([TradeParticipantCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ_Gate.Limits:Money#TradeParticipant_Id#TradeParticipantCode#ClientCode#TradeDate#Currency#Tag#Kind]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Gate.Limits:Money#TradeParticipant_Id#TradeParticipantCode#ClientCode#TradeDate#Currency#Tag#Kind] ON [Gate].[Limits:Money]
(
	[TradeParticipant_Id] ASC,
	[TradeParticipantCode] ASC,
	[TradeDate] ASC,
	[Currency] ASC,
	[Tag] ASC,
	[Kind] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Limits:Securities#InstrumentCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Limits:Securities#InstrumentCode#Source_Id] ON [Gate].[Limits:Securities]
(
	[InstrumentCode] ASC,
	[Source_Id] ASC
)
WHERE ([InstrumentCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Limits:Securities#TradeAccountCode#TradeParticipantCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Limits:Securities#TradeAccountCode#TradeParticipantCode#Source_Id] ON [Gate].[Limits:Securities]
(
	[TradeAccountCode] ASC,
	[TradeParticipantCode] ASC,
	[Source_Id] ASC
)
WHERE ([TradeAccountCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ_Gate.Limits:Securities#TrAcc_Id#TrAccCode#TradeParticipantCode#Instrument_Id#InstrumentCode#ClientCode#TradeDate#Kind]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Gate.Limits:Securities#TrAcc_Id#TrAccCode#TradeParticipantCode#Instrument_Id#InstrumentCode#ClientCode#TradeDate#Kind] ON [Gate].[Limits:Securities]
(
	[TradeAccount_Id] ASC,
	[TradeAccountCode] ASC,
	[TradeParticipantCode] ASC,
	[Instrument_Id] ASC,
	[InstrumentCode] ASC,
	[ClientCode] ASC,
	[TradeDate] ASC,
	[Kind] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Orders#InstrumentCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Orders#InstrumentCode#Source_Id] ON [Gate].[Orders]
(
	[InstrumentCode] ASC,
	[Source_Id] ASC
)
WHERE ([InstrumentCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Orders#TradeAccountCode#TradeParticipantCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Orders#TradeAccountCode#TradeParticipantCode#Source_Id] ON [Gate].[Orders]
(
	[TradeAccountCode] ASC,
	[TradeParticipantCode] ASC,
	[Source_Id] ASC
)
WHERE ([TradeAccountCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Orders#TradeBoardCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Orders#TradeBoardCode#Source_Id] ON [Gate].[Orders]
(
	[TradeBoardCode] ASC,
	[Source_Id] ASC
)
WHERE ([TradeBoardCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ_Gate.Orders#Number#Source_Id#SessionDate#TradeBoard_Id#TradeBoardCode]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Gate.Orders#Number#Source_Id#SessionDate#TradeBoard_Id#TradeBoardCode] ON [Gate].[Orders]
(
	[Number] ASC,
	[Source_Id] ASC,
	[SessionDate] ASC,
	[TradeBoard_Id] ASC,
	[TradeBoardCode] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Reports#InstrumentCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Reports#InstrumentCode#Source_Id] ON [Gate].[Reports]
(
	[InstrumentCode] ASC,
	[Source_Id] ASC
)
WHERE ([InstrumentCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Reports#PartnerTradeAccountCode#PartnerTradeParticipantCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Reports#PartnerTradeAccountCode#PartnerTradeParticipantCode#Source_Id] ON [Gate].[Reports]
(
	[PartnerTradeAccountCode] ASC,
	[PartnerTradeParticipantCode] ASC,
	[Source_Id] ASC
)
WHERE ([PartnerTradeAccountCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Reports#TradeAccountCode#TradeParticipantCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Reports#TradeAccountCode#TradeParticipantCode#Source_Id] ON [Gate].[Reports]
(
	[TradeAccountCode] ASC,
	[TradeParticipantCode] ASC,
	[Source_Id] ASC
)
WHERE ([TradeAccountCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Reports#TradeBoardCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Reports#TradeBoardCode#Source_Id] ON [Gate].[Reports]
(
	[TradeBoardCode] ASC,
	[Source_Id] ASC
)
WHERE ([TradeBoardCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ_Gate.Reports#Number#SessionDate#TradeBoard_Id#TradeBoardCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Gate.Reports#Number#SessionDate#TradeBoard_Id#TradeBoardCode#Source_Id] ON [Gate].[Reports]
(
	[Number] ASC,
	[SessionDate] ASC,
	[TradeBoard_Id] ASC,
	[TradeBoardCode] ASC,
	[Source_Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Trade Accounts#TradeParticipantCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Trade Accounts#TradeParticipantCode#Source_Id] ON [Gate].[Trade Accounts]
(
	[TradeParticipantCode] ASC,
	[Source_Id] ASC
)
WHERE ([TradeParticipantCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ_Gate.TradeAccounts#Code#Source_Id#TradeParticipant_Id#TradeParticipantCode]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Gate.TradeAccounts#Code#Source_Id#TradeParticipant_Id#TradeParticipantCode] ON [Gate].[Trade Accounts]
(
	[Code] ASC,
	[Source_Id] ASC,
	[TradeParticipant_Id] ASC,
	[TradeParticipantCode] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Trade Participant Rests:Accounts#InstrumentCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Trade Participant Rests:Accounts#InstrumentCode#Source_Id] ON [Gate].[Trade Participant Rests:Accounts]
(
	[InstrumentCode] ASC,
	[Source_Id] ASC
)
WHERE ([InstrumentCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Trade Participant Rests:Accounts#TradeAccountCode#TradeParticipantCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Trade Participant Rests:Accounts#TradeAccountCode#TradeParticipantCode#Source_Id] ON [Gate].[Trade Participant Rests:Accounts]
(
	[TradeAccountCode] ASC,
	[TradeParticipantCode] ASC,
	[Source_Id] ASC
)
WHERE ([TradeAccountCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ_Gate.TradeParticipantRests:Accounts#Instr_Id#InstrCode#TrAcc_Id#TrAccCode#TrPartCode#TrDate]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Gate.TradeParticipantRests:Accounts#Instr_Id#InstrCode#TrAcc_Id#TrAccCode#TrPartCode#TrDate] ON [Gate].[Trade Participant Rests:Accounts]
(
	[Instrument_Id] ASC,
	[InstrumentCode] ASC,
	[TradeAccount_Id] ASC,
	[TradeAccountCode] ASC,
	[TradeParticipantCode] ASC,
	[DepoAccount] ASC,
	[TradeDate] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Trade Participant Rests:Derivatives#InstrumentCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Trade Participant Rests:Derivatives#InstrumentCode#Source_Id] ON [Gate].[Trade Participant Rests:Derivatives]
(
	[InstrumentCode] ASC,
	[Source_Id] ASC
)
WHERE ([InstrumentCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Trade Participant Rests:Derivatives#TradeAccountCode#TradeParticipantCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Trade Participant Rests:Derivatives#TradeAccountCode#TradeParticipantCode#Source_Id] ON [Gate].[Trade Participant Rests:Derivatives]
(
	[TradeAccountCode] ASC,
	[TradeParticipantCode] ASC,
	[Source_Id] ASC
)
WHERE ([TradeAccountCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ_Gate.TradeParticipantRests:Derivatives#Instr_Id#InstrCode#TrAcc_Id#TrAccCode#TrPartCode#Type#TrDate]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Gate.TradeParticipantRests:Derivatives#Instr_Id#InstrCode#TrAcc_Id#TrAccCode#TrPartCode#Type#TrDate] ON [Gate].[Trade Participant Rests:Derivatives]
(
	[Instrument_Id] ASC,
	[InstrumentCode] ASC,
	[TradeAccount_Id] ASC,
	[TradeAccountCode] ASC,
	[TradeParticipantCode] ASC,
	[Type] ASC,
	[TradeDate] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Trade Participant Rests:Execution Dates#TradeParticipantCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Trade Participant Rests:Execution Dates#TradeParticipantCode#Source_Id] ON [Gate].[Trade Participant Rests:Execution Dates]
(
	[TradeParticipantCode] ASC,
	[Source_Id] ASC
)
WHERE ([TradeParticipantCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ_Gate.TradeParticipantRests:ExecutionDates#TrPart_Id#TrPartCode#TrDate#Currency#SettleDate#SettleCode]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Gate.TradeParticipantRests:ExecutionDates#TrPart_Id#TrPartCode#TrDate#Currency#SettleDate#SettleCode] ON [Gate].[Trade Participant Rests:Execution Dates]
(
	[TradeParticipant_Id] ASC,
	[TradeParticipantCode] ASC,
	[TradeDate] ASC,
	[Currency] ASC,
	[SettleDate] ASC,
	[SettleCode] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Trade Participant Rests:Money#TradeParticipantCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Trade Participant Rests:Money#TradeParticipantCode#Source_Id] ON [Gate].[Trade Participant Rests:Money]
(
	[TradeParticipantCode] ASC,
	[Source_Id] ASC
)
WHERE ([TradeParticipantCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ_Gate.TradeParticipantRests:Money#TradeParticipant_Id#TradeParticipantCode#Currency#Tag#BankAccount#TradeDate]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Gate.TradeParticipantRests:Money#TradeParticipant_Id#TradeParticipantCode#Currency#Tag#BankAccount#TradeDate] ON [Gate].[Trade Participant Rests:Money]
(
	[TradeParticipant_Id] ASC,
	[TradeParticipantCode] ASC,
	[Currency] ASC,
	[Tag] ASC,
	[BankAccount] ASC,
	[TradeDate] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Trade Participant Rests:Securities#InstrumentCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Trade Participant Rests:Securities#InstrumentCode#Source_Id] ON [Gate].[Trade Participant Rests:Securities]
(
	[InstrumentCode] ASC,
	[Source_Id] ASC
)
WHERE ([InstrumentCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Gate.Trade Participant Rests:Securities#TradeParticipantCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Gate.Trade Participant Rests:Securities#TradeParticipantCode#Source_Id] ON [Gate].[Trade Participant Rests:Securities]
(
	[TradeParticipantCode] ASC,
	[Source_Id] ASC
)
WHERE ([TradeParticipantCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ_Gate.TradeParticipantRests:Securities#Instrument_Id#InstrumentCode#TradeParticipant_Id#TradeParticipantCode#TradeDate]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Gate.TradeParticipantRests:Securities#Instrument_Id#InstrumentCode#TradeParticipant_Id#TradeParticipantCode#TradeDate] ON [Gate].[Trade Participant Rests:Securities]
(
	[Instrument_Id] ASC,
	[InstrumentCode] ASC,
	[TradeParticipant_Id] ASC,
	[TradeParticipantCode] ASC,
	[TradeDate] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Micex.Deals#SecCode#TradeDate#TradeTime]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Micex.Deals#SecCode#TradeDate#TradeTime] ON [Micex].[Deals]
(
	[SecCode] ASC,
	[TradeDate] ASC,
	[TradeTime] ASC
)
INCLUDE ( 	[Price],
	[Quantity],
	[Value]) WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Micex.Deals#TradeDate#TradeTime#TradeNum]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Micex.Deals#TradeDate#TradeTime#TradeNum] ON [Micex].[Deals]
(
	[TradeDate] ASC,
	[TradeTime] ASC,
	[TradeNum] ASC
)
INCLUDE ( 	[SecCode],
	[Price],
	[Quantity],
	[Value]) WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ_Quik.Dic:Places#Code#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Quik.Dic:Places#Code#Source_Id] ON [Quik].[Dic:Places]
(
	[Code] ASC,
	[Source_Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ_Quik.Dic:Places:TradeBoards#Code#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Quik.Dic:Places:TradeBoards#Code#Source_Id] ON [Quik].[Dic:Places:Trade Boards]
(
	[Code] ASC,
	[Source_Id] ASC
)
INCLUDE ( 	[TradeBoard_Id]) WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_Quik.Orders:Stop#BaseOrderNumber#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Quik.Orders:Stop#BaseOrderNumber#Source_Id] ON [Quik].[Orders:Stop]
(
	[BaseOrderNumber] ASC,
	[Source_Id] ASC
)
WHERE ([BaseOrderNumber] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_Quik.Orders:Stop#ConditionDealNumber#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Quik.Orders:Stop#ConditionDealNumber#Source_Id] ON [Quik].[Orders:Stop]
(
	[ConditionDealNumber] ASC,
	[Source_Id] ASC
)
WHERE ([ConditionDealNumber] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Quik.Orders:Stop#ConditionInstrumentCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Quik.Orders:Stop#ConditionInstrumentCode#Source_Id] ON [Quik].[Orders:Stop]
(
	[ConditionInstrumentCode] ASC,
	[Source_Id] ASC
)
WHERE ([ConditionInstrumentCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Quik.Orders:Stop#ConditionTradeBoardCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Quik.Orders:Stop#ConditionTradeBoardCode#Source_Id] ON [Quik].[Orders:Stop]
(
	[ConditionTradeBoardCode] ASC,
	[Source_Id] ASC
)
WHERE ([ConditionTradeBoardCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_Quik.Orders:Stop#CoOrderNumber#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Quik.Orders:Stop#CoOrderNumber#Source_Id] ON [Quik].[Orders:Stop]
(
	[CoOrderNumber] ASC,
	[Source_Id] ASC
)
WHERE ([CoOrderNumber] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IX_Quik.Orders:Stop#LinkedOrderNumber#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Quik.Orders:Stop#LinkedOrderNumber#Source_Id] ON [Quik].[Orders:Stop]
(
	[LinkedOrderNumber] ASC,
	[Source_Id] ASC
)
WHERE ([LinkedOrderNumber] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Quik.Orders:Stop#TradeAccountCode#TradeParticipantCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Quik.Orders:Stop#TradeAccountCode#TradeParticipantCode#Source_Id] ON [Quik].[Orders:Stop]
(
	[TradeAccountCode] ASC,
	[TradeParticipantCode] ASC,
	[Source_Id] ASC
)
WHERE ([TradeAccountCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Quik.Orders:Stop#TradeBoardCode#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Quik.Orders:Stop#TradeBoardCode#Source_Id] ON [Quik].[Orders:Stop]
(
	[TradeBoardCode] ASC,
	[Source_Id] ASC
)
WHERE ([TradeBoardCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [UQ_Quik.Orders:Stop#Number#SessionDate#Source_Id]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Quik.Orders:Stop#Number#SessionDate#Source_Id] ON [Quik].[Orders:Stop]
(
	[Number] ASC,
	[SessionDate] ASC,
	[Source_Id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [IX_Quik.Places:Trade Boards:Trade Dates#TradeParticipantCode]    Script Date: 16.01.2015 12:15:05 ******/
CREATE NONCLUSTERED INDEX [IX_Quik.Places:Trade Boards:Trade Dates#TradeParticipantCode] ON [Quik].[Places:Trade Boards:Trade Dates]
(
	[TradeParticipantCode] ASC
)
WHERE ([TradeParticipantCode] IS NOT NULL)
WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON

GO
/****** Object:  Index [UQ_Quik.Places:TradeParticipants#Code#Source_Id#TradeParticipant_Id#ExchangeCode]    Script Date: 16.01.2015 12:15:05 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UQ_Quik.Places:TradeParticipants#Code#Source_Id#TradeParticipant_Id#ExchangeCode] ON [Quik].[Places:Trade Participants]
(
	[Code] ASC,
	[Source_Id] ASC,
	[TradeParticipant_Id] ASC,
	[ExchangeCode] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
ALTER TABLE [Bloomberg].[Dic:Instruments:Codes]  WITH CHECK ADD  CONSTRAINT [FK_Bloomberg.Dic:Instruments:Codes#TradeBoard_Id] FOREIGN KEY([TradeBoard_Id])
REFERENCES [Gate].[Dic:Places:Trade Boards] ([Id])
GO
ALTER TABLE [Bloomberg].[Dic:Instruments:Codes] CHECK CONSTRAINT [FK_Bloomberg.Dic:Instruments:Codes#TradeBoard_Id]
GO
ALTER TABLE [Bloomberg].[Dic:Places]  WITH NOCHECK ADD  CONSTRAINT [FK_Bloomberg.Dic:Places#Place_Id] FOREIGN KEY([Place_Id])
REFERENCES [Gate].[Dic:Places] ([Id])
GO
ALTER TABLE [Bloomberg].[Dic:Places] NOCHECK CONSTRAINT [FK_Bloomberg.Dic:Places#Place_Id]
GO
ALTER TABLE [Bloomberg].[Dic:Places]  WITH NOCHECK ADD  CONSTRAINT [FK_Bloomberg.Dic:Places#Source_Id] FOREIGN KEY([Source_Id])
REFERENCES [Gate].[Dic:Sources] ([Id])
GO
ALTER TABLE [Bloomberg].[Dic:Places] NOCHECK CONSTRAINT [FK_Bloomberg.Dic:Places#Source_Id]
GO
ALTER TABLE [Gate].[Deals]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Deals#Instrument_Id] FOREIGN KEY([Instrument_Id])
REFERENCES [Gate].[Instruments] ([Id])
GO
ALTER TABLE [Gate].[Deals] NOCHECK CONSTRAINT [FK_Gate.Deals#Instrument_Id]
GO
ALTER TABLE [Gate].[Deals]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Deals#LinkedDeal_Id] FOREIGN KEY([LinkedDeal_Id])
REFERENCES [Gate].[Deals] ([Id])
GO
ALTER TABLE [Gate].[Deals] NOCHECK CONSTRAINT [FK_Gate.Deals#LinkedDeal_Id]
GO
ALTER TABLE [Gate].[Deals]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Deals#Order_Id] FOREIGN KEY([Order_Id])
REFERENCES [Gate].[Orders] ([Id])
GO
ALTER TABLE [Gate].[Deals] NOCHECK CONSTRAINT [FK_Gate.Deals#Order_Id]
GO
ALTER TABLE [Gate].[Deals]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Deals#PartnerTradeParticipant_Id] FOREIGN KEY([PartnerTradeParticipant_Id])
REFERENCES [Gate].[Places:Trade Participants] ([Id])
GO
ALTER TABLE [Gate].[Deals] NOCHECK CONSTRAINT [FK_Gate.Deals#PartnerTradeParticipant_Id]
GO
ALTER TABLE [Gate].[Deals]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Deals#Source_Id] FOREIGN KEY([Source_Id])
REFERENCES [Gate].[Dic:Sources] ([Id])
GO
ALTER TABLE [Gate].[Deals] NOCHECK CONSTRAINT [FK_Gate.Deals#Source_Id]
GO
ALTER TABLE [Gate].[Deals]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Deals#TradeAccount_Id] FOREIGN KEY([TradeAccount_Id])
REFERENCES [Gate].[Trade Accounts] ([Id])
GO
ALTER TABLE [Gate].[Deals] NOCHECK CONSTRAINT [FK_Gate.Deals#TradeAccount_Id]
GO
ALTER TABLE [Gate].[Deals]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Deals#TradeBoard_Id] FOREIGN KEY([TradeBoard_Id])
REFERENCES [Gate].[Dic:Places:Trade Boards] ([Id])
GO
ALTER TABLE [Gate].[Deals] NOCHECK CONSTRAINT [FK_Gate.Deals#TradeBoard_Id]
GO
ALTER TABLE [Gate].[Deals:Active]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Deals:Active#Id] FOREIGN KEY([Id])
REFERENCES [Gate].[Deals] ([Id])
GO
ALTER TABLE [Gate].[Deals:Active] NOCHECK CONSTRAINT [FK_Gate.Deals:Active#Id]
GO
ALTER TABLE [Gate].[Deals:Active]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Deals:Active#PartnerTradeAccount_Id] FOREIGN KEY([PartnerTradeAccount_Id])
REFERENCES [Gate].[Trade Accounts] ([Id])
GO
ALTER TABLE [Gate].[Deals:Active] NOCHECK CONSTRAINT [FK_Gate.Deals:Active#PartnerTradeAccount_Id]
GO
ALTER TABLE [Gate].[Deals:Active]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Deals:Active#RepoDeal_Id] FOREIGN KEY([RepoDeal_Id])
REFERENCES [Gate].[Deals] ([Id])
GO
ALTER TABLE [Gate].[Deals:Active] NOCHECK CONSTRAINT [FK_Gate.Deals:Active#RepoDeal_Id]
GO
ALTER TABLE [Gate].[Dic:Places:Trade Boards]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Dic:Places:TradeBoards#Place_Id] FOREIGN KEY([Place_Id])
REFERENCES [Gate].[Dic:Places] ([Id])
GO
ALTER TABLE [Gate].[Dic:Places:Trade Boards] NOCHECK CONSTRAINT [FK_Gate.Dic:Places:TradeBoards#Place_Id]
GO
ALTER TABLE [Gate].[Instruments]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Instruments#Place_Id] FOREIGN KEY([Place_Id])
REFERENCES [Gate].[Dic:Places] ([Id])
GO
ALTER TABLE [Gate].[Instruments] CHECK CONSTRAINT [FK_Gate.Instruments#Place_Id]
GO
ALTER TABLE [Gate].[Instruments:Current Quotes]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Instruments:CurrentQuotes#Instrument_Id] FOREIGN KEY([Instrument_Id])
REFERENCES [Gate].[Instruments] ([Id])
GO
ALTER TABLE [Gate].[Instruments:Current Quotes] NOCHECK CONSTRAINT [FK_Gate.Instruments:CurrentQuotes#Instrument_Id]
GO
ALTER TABLE [Gate].[Instruments:Current Quotes]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Instruments:CurrentQuotes#QuoteType_Id] FOREIGN KEY([QuoteType_Id])
REFERENCES [Gate].[Dic:Instruments:Quotes:Types] ([Id])
GO
ALTER TABLE [Gate].[Instruments:Current Quotes] NOCHECK CONSTRAINT [FK_Gate.Instruments:CurrentQuotes#QuoteType_Id]
GO
ALTER TABLE [Gate].[Instruments:Current Quotes]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Instruments:CurrentQuotes#TradeBoard_Id] FOREIGN KEY([TradeBoard_Id])
REFERENCES [Gate].[Dic:Places:Trade Boards] ([Id])
GO
ALTER TABLE [Gate].[Instruments:Current Quotes] NOCHECK CONSTRAINT [FK_Gate.Instruments:CurrentQuotes#TradeBoard_Id]
GO
ALTER TABLE [Gate].[Instruments:Instrument Dates]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Instruments:InstrumentDates#Instrument_Id] FOREIGN KEY([Instrument_Id])
REFERENCES [Gate].[Instruments] ([Id])
GO
ALTER TABLE [Gate].[Instruments:Instrument Dates] NOCHECK CONSTRAINT [FK_Gate.Instruments:InstrumentDates#Instrument_Id]
GO
ALTER TABLE [Gate].[Instruments:Instrument Dates]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Instruments:InstrumentDates#OptionBaseInstrument_Id] FOREIGN KEY([OptionBaseInstrument_Id])
REFERENCES [Gate].[Instruments] ([Id])
GO
ALTER TABLE [Gate].[Instruments:Instrument Dates] NOCHECK CONSTRAINT [FK_Gate.Instruments:InstrumentDates#OptionBaseInstrument_Id]
GO
ALTER TABLE [Gate].[Instruments:Instrument Dates]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Instruments:InstrumentDates#OptionBaseTradeBoard_Id] FOREIGN KEY([OptionBaseTradeBoard_Id])
REFERENCES [Gate].[Dic:Places:Trade Boards] ([Id])
GO
ALTER TABLE [Gate].[Instruments:Instrument Dates] NOCHECK CONSTRAINT [FK_Gate.Instruments:InstrumentDates#OptionBaseTradeBoard_Id]
GO
ALTER TABLE [Gate].[Instruments:Instrument Dates]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Instruments:InstrumentDates#TradeBoard_Id] FOREIGN KEY([TradeBoard_Id])
REFERENCES [Gate].[Dic:Places:Trade Boards] ([Id])
GO
ALTER TABLE [Gate].[Instruments:Instrument Dates] NOCHECK CONSTRAINT [FK_Gate.Instruments:InstrumentDates#TradeBoard_Id]
GO
ALTER TABLE [Gate].[Instruments:Instrument Dates]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Instruments:InstrumentDates#TradeParticipant_Id] FOREIGN KEY([TradeParticipant_Id])
REFERENCES [Gate].[Places:Trade Participants] ([Id])
GO
ALTER TABLE [Gate].[Instruments:Instrument Dates] NOCHECK CONSTRAINT [FK_Gate.Instruments:InstrumentDates#TradeParticipant_Id]
GO
ALTER TABLE [Gate].[Instruments:Quotes]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Instruments:Quotes#Instrument_Id] FOREIGN KEY([Instrument_Id])
REFERENCES [Gate].[Instruments] ([Id])
GO
ALTER TABLE [Gate].[Instruments:Quotes] NOCHECK CONSTRAINT [FK_Gate.Instruments:Quotes#Instrument_Id]
GO
ALTER TABLE [Gate].[Instruments:Quotes]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Instruments:Quotes#QuoteType_Id] FOREIGN KEY([QuoteType_Id])
REFERENCES [Gate].[Dic:Instruments:Quotes:Types] ([Id])
GO
ALTER TABLE [Gate].[Instruments:Quotes] NOCHECK CONSTRAINT [FK_Gate.Instruments:Quotes#QuoteType_Id]
GO
ALTER TABLE [Gate].[Instruments:Quotes]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Instruments:Quotes#TradeBoard_Id] FOREIGN KEY([TradeBoard_Id])
REFERENCES [Gate].[Dic:Places:Trade Boards] ([Id])
GO
ALTER TABLE [Gate].[Instruments:Quotes] NOCHECK CONSTRAINT [FK_Gate.Instruments:Quotes#TradeBoard_Id]
GO
ALTER TABLE [Gate].[Instruments:Quotes:Trade Dates]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Instruments:Quotes:TradeDates#Instrument_Id] FOREIGN KEY([Instrument_Id])
REFERENCES [Gate].[Instruments] ([Id])
GO
ALTER TABLE [Gate].[Instruments:Quotes:Trade Dates] NOCHECK CONSTRAINT [FK_Gate.Instruments:Quotes:TradeDates#Instrument_Id]
GO
ALTER TABLE [Gate].[Instruments:Quotes:Trade Dates]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Instruments:Quotes:TradeDates#QuoteType_Id] FOREIGN KEY([QuoteType_Id])
REFERENCES [Gate].[Dic:Instruments:Quotes:Types] ([Id])
GO
ALTER TABLE [Gate].[Instruments:Quotes:Trade Dates] NOCHECK CONSTRAINT [FK_Gate.Instruments:Quotes:TradeDates#QuoteType_Id]
GO
ALTER TABLE [Gate].[Instruments:Quotes:Trade Dates]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Instruments:Quotes:TradeDates#TradeBoard_Id] FOREIGN KEY([TradeBoard_Id])
REFERENCES [Gate].[Dic:Places:Trade Boards] ([Id])
GO
ALTER TABLE [Gate].[Instruments:Quotes:Trade Dates] NOCHECK CONSTRAINT [FK_Gate.Instruments:Quotes:TradeDates#TradeBoard_Id]
GO
ALTER TABLE [Gate].[Limits:Derivatives]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Limits:Derivatives#Source_Id] FOREIGN KEY([Source_Id])
REFERENCES [Gate].[Dic:Sources] ([Id])
GO
ALTER TABLE [Gate].[Limits:Derivatives] NOCHECK CONSTRAINT [FK_Gate.Limits:Derivatives#Source_Id]
GO
ALTER TABLE [Gate].[Limits:Derivatives]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Limits:Derivatives#TradeAccount_Id] FOREIGN KEY([TradeAccount_Id])
REFERENCES [Gate].[Trade Accounts] ([Id])
GO
ALTER TABLE [Gate].[Limits:Derivatives] NOCHECK CONSTRAINT [FK_Gate.Limits:Derivatives#TradeAccount_Id]
GO
ALTER TABLE [Gate].[Limits:Money]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Limits:Money#Source_Id] FOREIGN KEY([Source_Id])
REFERENCES [Gate].[Dic:Sources] ([Id])
GO
ALTER TABLE [Gate].[Limits:Money] NOCHECK CONSTRAINT [FK_Gate.Limits:Money#Source_Id]
GO
ALTER TABLE [Gate].[Limits:Money]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Limits:Money#TradeParticipant_Id] FOREIGN KEY([TradeParticipant_Id])
REFERENCES [Gate].[Places:Trade Participants] ([Id])
GO
ALTER TABLE [Gate].[Limits:Money] NOCHECK CONSTRAINT [FK_Gate.Limits:Money#TradeParticipant_Id]
GO
ALTER TABLE [Gate].[Limits:Securities]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Limits:Securities#Instrument_Id] FOREIGN KEY([Instrument_Id])
REFERENCES [Gate].[Instruments] ([Id])
GO
ALTER TABLE [Gate].[Limits:Securities] NOCHECK CONSTRAINT [FK_Gate.Limits:Securities#Instrument_Id]
GO
ALTER TABLE [Gate].[Limits:Securities]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Limits:Securities#Source_Id] FOREIGN KEY([Source_Id])
REFERENCES [Gate].[Dic:Sources] ([Id])
GO
ALTER TABLE [Gate].[Limits:Securities] NOCHECK CONSTRAINT [FK_Gate.Limits:Securities#Source_Id]
GO
ALTER TABLE [Gate].[Limits:Securities]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Limits:Securities#TradeAccount_Id] FOREIGN KEY([TradeAccount_Id])
REFERENCES [Gate].[Trade Accounts] ([Id])
GO
ALTER TABLE [Gate].[Limits:Securities] NOCHECK CONSTRAINT [FK_Gate.Limits:Securities#TradeAccount_Id]
GO
ALTER TABLE [Gate].[Orders]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Orders#Instrument_Id] FOREIGN KEY([Instrument_Id])
REFERENCES [Gate].[Instruments] ([Id])
GO
ALTER TABLE [Gate].[Orders] NOCHECK CONSTRAINT [FK_Gate.Orders#Instrument_Id]
GO
ALTER TABLE [Gate].[Orders]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Orders#Source_Id] FOREIGN KEY([Source_Id])
REFERENCES [Gate].[Dic:Sources] ([Id])
GO
ALTER TABLE [Gate].[Orders] NOCHECK CONSTRAINT [FK_Gate.Orders#Source_Id]
GO
ALTER TABLE [Gate].[Orders]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Orders#TradeAccount_Id] FOREIGN KEY([TradeAccount_Id])
REFERENCES [Gate].[Trade Accounts] ([Id])
GO
ALTER TABLE [Gate].[Orders] NOCHECK CONSTRAINT [FK_Gate.Orders#TradeAccount_Id]
GO
ALTER TABLE [Gate].[Orders]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Orders#TradeBoard_Id] FOREIGN KEY([TradeBoard_Id])
REFERENCES [Gate].[Dic:Places:Trade Boards] ([Id])
GO
ALTER TABLE [Gate].[Orders] NOCHECK CONSTRAINT [FK_Gate.Orders#TradeBoard_Id]
GO
ALTER TABLE [Gate].[Places:Trade Participants]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Places:TradeParticipants#Place_Id] FOREIGN KEY([Place_Id])
REFERENCES [Gate].[Dic:Places] ([Id])
GO
ALTER TABLE [Gate].[Places:Trade Participants] NOCHECK CONSTRAINT [FK_Gate.Places:TradeParticipants#Place_Id]
GO
ALTER TABLE [Gate].[Reports]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Reports#Instrument_Id] FOREIGN KEY([Instrument_Id])
REFERENCES [Gate].[Instruments] ([Id])
GO
ALTER TABLE [Gate].[Reports] NOCHECK CONSTRAINT [FK_Gate.Reports#Instrument_Id]
GO
ALTER TABLE [Gate].[Reports]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Reports#PartnerTradeAccount_Id] FOREIGN KEY([PartnerTradeAccount_Id])
REFERENCES [Gate].[Trade Accounts] ([Id])
GO
ALTER TABLE [Gate].[Reports] NOCHECK CONSTRAINT [FK_Gate.Reports#PartnerTradeAccount_Id]
GO
ALTER TABLE [Gate].[Reports]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Reports#Source_Id] FOREIGN KEY([Source_Id])
REFERENCES [Gate].[Dic:Sources] ([Id])
GO
ALTER TABLE [Gate].[Reports] NOCHECK CONSTRAINT [FK_Gate.Reports#Source_Id]
GO
ALTER TABLE [Gate].[Reports]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Reports#TradeAccount_Id] FOREIGN KEY([TradeAccount_Id])
REFERENCES [Gate].[Trade Accounts] ([Id])
GO
ALTER TABLE [Gate].[Reports] NOCHECK CONSTRAINT [FK_Gate.Reports#TradeAccount_Id]
GO
ALTER TABLE [Gate].[Reports]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.Reports#TradeBoard_Id] FOREIGN KEY([TradeBoard_Id])
REFERENCES [Gate].[Dic:Places:Trade Boards] ([Id])
GO
ALTER TABLE [Gate].[Reports] NOCHECK CONSTRAINT [FK_Gate.Reports#TradeBoard_Id]
GO
ALTER TABLE [Gate].[Trade Accounts]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.TradeAccounts#Source_Id] FOREIGN KEY([Source_Id])
REFERENCES [Gate].[Dic:Sources] ([Id])
GO
ALTER TABLE [Gate].[Trade Accounts] NOCHECK CONSTRAINT [FK_Gate.TradeAccounts#Source_Id]
GO
ALTER TABLE [Gate].[Trade Accounts]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.TradeAccounts#TradeParticipant_Id] FOREIGN KEY([TradeParticipant_Id])
REFERENCES [Gate].[Places:Trade Participants] ([Id])
GO
ALTER TABLE [Gate].[Trade Accounts] NOCHECK CONSTRAINT [FK_Gate.TradeAccounts#TradeParticipant_Id]
GO
ALTER TABLE [Gate].[Trade Accounts:Trade Dates]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.TradeAccounts:TradeDates#TradeAccount_Id] FOREIGN KEY([TradeAccount_Id])
REFERENCES [Gate].[Trade Accounts] ([Id])
GO
ALTER TABLE [Gate].[Trade Accounts:Trade Dates] NOCHECK CONSTRAINT [FK_Gate.TradeAccounts:TradeDates#TradeAccount_Id]
GO
ALTER TABLE [Gate].[Trade Participant Rests:Accounts]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.TradeParticipantRests:Accounts#Instrument_Id] FOREIGN KEY([Instrument_Id])
REFERENCES [Gate].[Instruments] ([Id])
GO
ALTER TABLE [Gate].[Trade Participant Rests:Accounts] NOCHECK CONSTRAINT [FK_Gate.TradeParticipantRests:Accounts#Instrument_Id]
GO
ALTER TABLE [Gate].[Trade Participant Rests:Accounts]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.TradeParticipantRests:Accounts#Source_Id] FOREIGN KEY([Source_Id])
REFERENCES [Gate].[Dic:Sources] ([Id])
GO
ALTER TABLE [Gate].[Trade Participant Rests:Accounts] NOCHECK CONSTRAINT [FK_Gate.TradeParticipantRests:Accounts#Source_Id]
GO
ALTER TABLE [Gate].[Trade Participant Rests:Accounts]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.TradeParticipantRests:Accounts#TradeAccount_Id] FOREIGN KEY([TradeAccount_Id])
REFERENCES [Gate].[Trade Accounts] ([Id])
GO
ALTER TABLE [Gate].[Trade Participant Rests:Accounts] NOCHECK CONSTRAINT [FK_Gate.TradeParticipantRests:Accounts#TradeAccount_Id]
GO
ALTER TABLE [Gate].[Trade Participant Rests:Derivatives]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.TradeParticipantRests:Derivatives#Instrument_Id] FOREIGN KEY([Instrument_Id])
REFERENCES [Gate].[Instruments] ([Id])
GO
ALTER TABLE [Gate].[Trade Participant Rests:Derivatives] NOCHECK CONSTRAINT [FK_Gate.TradeParticipantRests:Derivatives#Instrument_Id]
GO
ALTER TABLE [Gate].[Trade Participant Rests:Derivatives]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.TradeParticipantRests:Derivatives#Source_Id] FOREIGN KEY([Source_Id])
REFERENCES [Gate].[Dic:Sources] ([Id])
GO
ALTER TABLE [Gate].[Trade Participant Rests:Derivatives] NOCHECK CONSTRAINT [FK_Gate.TradeParticipantRests:Derivatives#Source_Id]
GO
ALTER TABLE [Gate].[Trade Participant Rests:Derivatives]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.TradeParticipantRests:Derivatives#TradeAccount_Id] FOREIGN KEY([TradeAccount_Id])
REFERENCES [Gate].[Trade Accounts] ([Id])
GO
ALTER TABLE [Gate].[Trade Participant Rests:Derivatives] NOCHECK CONSTRAINT [FK_Gate.TradeParticipantRests:Derivatives#TradeAccount_Id]
GO
ALTER TABLE [Gate].[Trade Participant Rests:Execution Dates]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.TradeParticipantRests:ExecutionDates#Source_Id] FOREIGN KEY([Source_Id])
REFERENCES [Gate].[Dic:Sources] ([Id])
GO
ALTER TABLE [Gate].[Trade Participant Rests:Execution Dates] NOCHECK CONSTRAINT [FK_Gate.TradeParticipantRests:ExecutionDates#Source_Id]
GO
ALTER TABLE [Gate].[Trade Participant Rests:Execution Dates]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.TradeParticipantRests:ExecutionDates#TradeParticipant_Id] FOREIGN KEY([TradeParticipant_Id])
REFERENCES [Gate].[Places:Trade Participants] ([Id])
GO
ALTER TABLE [Gate].[Trade Participant Rests:Execution Dates] NOCHECK CONSTRAINT [FK_Gate.TradeParticipantRests:ExecutionDates#TradeParticipant_Id]
GO
ALTER TABLE [Gate].[Trade Participant Rests:Money]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.TradeParticipantRests:Money#Source_Id] FOREIGN KEY([Source_Id])
REFERENCES [Gate].[Dic:Sources] ([Id])
GO
ALTER TABLE [Gate].[Trade Participant Rests:Money] NOCHECK CONSTRAINT [FK_Gate.TradeParticipantRests:Money#Source_Id]
GO
ALTER TABLE [Gate].[Trade Participant Rests:Money]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.TradeParticipantRests:Money#TradeParticipant_Id] FOREIGN KEY([TradeParticipant_Id])
REFERENCES [Gate].[Places:Trade Participants] ([Id])
GO
ALTER TABLE [Gate].[Trade Participant Rests:Money] NOCHECK CONSTRAINT [FK_Gate.TradeParticipantRests:Money#TradeParticipant_Id]
GO
ALTER TABLE [Gate].[Trade Participant Rests:Securities]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.TradeParticipantRests:Securities#Instrument_Id] FOREIGN KEY([Instrument_Id])
REFERENCES [Gate].[Instruments] ([Id])
GO
ALTER TABLE [Gate].[Trade Participant Rests:Securities] NOCHECK CONSTRAINT [FK_Gate.TradeParticipantRests:Securities#Instrument_Id]
GO
ALTER TABLE [Gate].[Trade Participant Rests:Securities]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.TradeParticipantRests:Securities#Source_Id] FOREIGN KEY([Source_Id])
REFERENCES [Gate].[Dic:Sources] ([Id])
GO
ALTER TABLE [Gate].[Trade Participant Rests:Securities] NOCHECK CONSTRAINT [FK_Gate.TradeParticipantRests:Securities#Source_Id]
GO
ALTER TABLE [Gate].[Trade Participant Rests:Securities]  WITH NOCHECK ADD  CONSTRAINT [FK_Gate.TradeParticipantRests:Securities#TradeParticipant_Id] FOREIGN KEY([TradeParticipant_Id])
REFERENCES [Gate].[Places:Trade Participants] ([Id])
GO
ALTER TABLE [Gate].[Trade Participant Rests:Securities] NOCHECK CONSTRAINT [FK_Gate.TradeParticipantRests:Securities#TradeParticipant_Id]
GO
ALTER TABLE [Quik].[Dic:Places]  WITH NOCHECK ADD  CONSTRAINT [FK_Quik.Dic:Places#Place_Id] FOREIGN KEY([Place_Id])
REFERENCES [Gate].[Dic:Places] ([Id])
GO
ALTER TABLE [Quik].[Dic:Places] NOCHECK CONSTRAINT [FK_Quik.Dic:Places#Place_Id]
GO
ALTER TABLE [Quik].[Dic:Places]  WITH NOCHECK ADD  CONSTRAINT [FK_Quik.Dic:Places#Source_Id] FOREIGN KEY([Source_Id])
REFERENCES [Gate].[Dic:Sources] ([Id])
GO
ALTER TABLE [Quik].[Dic:Places] NOCHECK CONSTRAINT [FK_Quik.Dic:Places#Source_Id]
GO
ALTER TABLE [Quik].[Dic:Places:Trade Boards]  WITH NOCHECK ADD  CONSTRAINT [FK_Quik.Dic:Places:TradeBoards#Source_Id] FOREIGN KEY([Source_Id])
REFERENCES [Gate].[Dic:Sources] ([Id])
GO
ALTER TABLE [Quik].[Dic:Places:Trade Boards] NOCHECK CONSTRAINT [FK_Quik.Dic:Places:TradeBoards#Source_Id]
GO
ALTER TABLE [Quik].[Dic:Places:Trade Boards]  WITH NOCHECK ADD  CONSTRAINT [FK_Quik.Dic:Places:TradeBoards#TradeBoard_Id] FOREIGN KEY([TradeBoard_Id])
REFERENCES [Gate].[Dic:Places:Trade Boards] ([Id])
GO
ALTER TABLE [Quik].[Dic:Places:Trade Boards] NOCHECK CONSTRAINT [FK_Quik.Dic:Places:TradeBoards#TradeBoard_Id]
GO
ALTER TABLE [Quik].[Instruments]  WITH NOCHECK ADD  CONSTRAINT [FK_Quik.Instruments#Source_Id] FOREIGN KEY([Source_Id])
REFERENCES [Gate].[Dic:Sources] ([Id])
GO
ALTER TABLE [Quik].[Instruments] CHECK CONSTRAINT [FK_Quik.Instruments#Source_Id]
GO
ALTER TABLE [Quik].[Orders:Stop]  WITH NOCHECK ADD  CONSTRAINT [FK_Quik.Orders:Stop#BaseOrder_Id] FOREIGN KEY([BaseOrder_Id])
REFERENCES [Gate].[Orders] ([Id])
GO
ALTER TABLE [Quik].[Orders:Stop] NOCHECK CONSTRAINT [FK_Quik.Orders:Stop#BaseOrder_Id]
GO
ALTER TABLE [Quik].[Orders:Stop]  WITH NOCHECK ADD  CONSTRAINT [FK_Quik.Orders:Stop#ConditionDeal_Id] FOREIGN KEY([ConditionDeal_Id])
REFERENCES [Gate].[Deals] ([Id])
GO
ALTER TABLE [Quik].[Orders:Stop] NOCHECK CONSTRAINT [FK_Quik.Orders:Stop#ConditionDeal_Id]
GO
ALTER TABLE [Quik].[Orders:Stop]  WITH NOCHECK ADD  CONSTRAINT [FK_Quik.Orders:Stop#ConditionInstrument_Id] FOREIGN KEY([ConditionInstrument_Id])
REFERENCES [Gate].[Instruments] ([Id])
GO
ALTER TABLE [Quik].[Orders:Stop] NOCHECK CONSTRAINT [FK_Quik.Orders:Stop#ConditionInstrument_Id]
GO
ALTER TABLE [Quik].[Orders:Stop]  WITH NOCHECK ADD  CONSTRAINT [FK_Quik.Orders:Stop#ConditionTradeBoard_Id] FOREIGN KEY([ConditionTradeBoard_Id])
REFERENCES [Gate].[Dic:Places:Trade Boards] ([Id])
GO
ALTER TABLE [Quik].[Orders:Stop] NOCHECK CONSTRAINT [FK_Quik.Orders:Stop#ConditionTradeBoard_Id]
GO
ALTER TABLE [Quik].[Orders:Stop]  WITH NOCHECK ADD  CONSTRAINT [FK_Quik.Orders:Stop#CoOrder_Id] FOREIGN KEY([CoOrder_Id])
REFERENCES [Gate].[Orders] ([Id])
GO
ALTER TABLE [Quik].[Orders:Stop] NOCHECK CONSTRAINT [FK_Quik.Orders:Stop#CoOrder_Id]
GO
ALTER TABLE [Quik].[Orders:Stop]  WITH NOCHECK ADD  CONSTRAINT [FK_Quik.Orders:Stop#LinkedOrder_Id] FOREIGN KEY([LinkedOrder_Id])
REFERENCES [Gate].[Orders] ([Id])
GO
ALTER TABLE [Quik].[Orders:Stop] NOCHECK CONSTRAINT [FK_Quik.Orders:Stop#LinkedOrder_Id]
GO
ALTER TABLE [Quik].[Orders:Stop]  WITH NOCHECK ADD  CONSTRAINT [FK_Quik.Orders:Stop#Source_Id] FOREIGN KEY([Source_Id])
REFERENCES [Gate].[Dic:Sources] ([Id])
GO
ALTER TABLE [Quik].[Orders:Stop] NOCHECK CONSTRAINT [FK_Quik.Orders:Stop#Source_Id]
GO
ALTER TABLE [Quik].[Orders:Stop]  WITH NOCHECK ADD  CONSTRAINT [FK_Quik.Orders:Stop#TradeAccount_Id] FOREIGN KEY([TradeAccount_Id])
REFERENCES [Gate].[Trade Accounts] ([Id])
GO
ALTER TABLE [Quik].[Orders:Stop] NOCHECK CONSTRAINT [FK_Quik.Orders:Stop#TradeAccount_Id]
GO
ALTER TABLE [Quik].[Orders:Stop]  WITH NOCHECK ADD  CONSTRAINT [FK_Quik.Orders:Stop#TradeBoard_Id] FOREIGN KEY([TradeBoard_Id])
REFERENCES [Gate].[Dic:Places:Trade Boards] ([Id])
GO
ALTER TABLE [Quik].[Orders:Stop] NOCHECK CONSTRAINT [FK_Quik.Orders:Stop#TradeBoard_Id]
GO
ALTER TABLE [Quik].[Places:Trade Boards:Trade Dates]  WITH NOCHECK ADD  CONSTRAINT [FK_Quik.Places:TradeBoards:TradeDates#TradeBoard_Id] FOREIGN KEY([TradeBoard_Id])
REFERENCES [Quik].[Dic:Places:Trade Boards] ([Id])
GO
ALTER TABLE [Quik].[Places:Trade Boards:Trade Dates] NOCHECK CONSTRAINT [FK_Quik.Places:TradeBoards:TradeDates#TradeBoard_Id]
GO
ALTER TABLE [Quik].[Places:Trade Boards:Trade Dates]  WITH NOCHECK ADD  CONSTRAINT [FK_Quik.Places:TradeBoards:TradeDates#TradeParticipant_Id] FOREIGN KEY([TradeParticipant_Id])
REFERENCES [Gate].[Places:Trade Participants] ([Id])
GO
ALTER TABLE [Quik].[Places:Trade Boards:Trade Dates] NOCHECK CONSTRAINT [FK_Quik.Places:TradeBoards:TradeDates#TradeParticipant_Id]
GO
ALTER TABLE [Quik].[Places:Trade Participants]  WITH NOCHECK ADD  CONSTRAINT [FK_Quik.Places:TradeParticipants#Source_Id] FOREIGN KEY([Source_Id])
REFERENCES [Gate].[Dic:Sources] ([Id])
GO
ALTER TABLE [Quik].[Places:Trade Participants] NOCHECK CONSTRAINT [FK_Quik.Places:TradeParticipants#Source_Id]
GO
ALTER TABLE [Quik].[Places:Trade Participants]  WITH NOCHECK ADD  CONSTRAINT [FK_Quik.Places:TradeParticipants#TradeParticipant_Id] FOREIGN KEY([TradeParticipant_Id])
REFERENCES [Gate].[Places:Trade Participants] ([Id])
GO
ALTER TABLE [Quik].[Places:Trade Participants] NOCHECK CONSTRAINT [FK_Quik.Places:TradeParticipants#TradeParticipant_Id]
GO
/****** Object:  StoredProcedure [Bloomberg].[Instrument::Quote::Modify]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--===============================================================================================================
-- <>:           ;
-- <>:              -
-- < >:       -
-- <>:             Fetisov
-- < >:     10.12.2013;
-- <>:       
-----------------------------------------------------------------------------------------------------------------
-- <>:
/*


*/
--===============================================================================================================
CREATE PROCEDURE [Bloomberg].[Instrument::Quote::Modify]
  @Data     Xml,
  @Place_Id Tinyint
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @TradeBoard_Id    Int,
    @Instrument_Id    Int,
    @Quote_Type_Id    Int

  BEGIN TRY
    DECLARE 
      @GatePlace_Id int
    
/*    DECLARE @InputData TABLE 
    (
      [PlaceCode]     NVarChar(64), 
      [CurrencyCode]  NVarChar(64),
      [TradeDateTime] DateTime,
      [Instrument]    NVarChar(64),
      [QuoteType]     NVarChar(64),
      [Value]         Numeric(25,8)
    )*/
    SELECT 
      @GatePlace_Id = [Place_Id]
    FROM [Bloomberg].[Dic:Places]
    WHERE [Id] = @Place_Id
-- select top(20) * from [Bloomberg].[Log:Errors] order by id desc
/*    INSERT @InputData
    ( 
      [PlaceCode],
      [CurrencyCode],
      [TradeDateTime],
      [Instrument],
      [QuoteType],
      [Value]
    )*/
    INSERT [Bloomberg].[Log:Errors]
    ( 
      [Date],
      [Message],
      [DataDetail],
      [DateNotify]
    )
    VALUES
    ( 
      GETDATE(),
      'INSERTED XML PLACE_ID=' + CAST(@Place_Id AS NVarChar(15)),
      CAST(@Data AS NVarChar(MAX)),
      GETDATE()
    )

    MERGE [Gate].[Instruments:Quotes] O USING
    (
      SELECT 
        [TradeDateTime]  = U.[TradeDateTime],
        [TradeBoard_Id]  = I.[TradeBoard_Id],
        [Instrument_Id]  = I.[Instrument_Id],
        [QuoteType_Id]   = GT.[Id],
        [CurrencyCode]   = ISNULL(I.[FixCurrency], U.[CurrencyCode]),
        [Value]          = U.[Value] * ISNULL(I.MultiCalc, 1),
        [LastUpdateTime] = CAST(SYSDATETIME() AS Time)
      FROM
      (
        SELECT 
          [PlaceCode]     = I.nref.value('../@PLACE','nvarchar(64)'),
          [CurrencyCode]  = I.nref.value('../@CURRENCY','nvarchar(64)'),
          [TradeDateTime] = I.nref.value('@DATE', 'datetime'),
          [Instrument]    = I.nref.value('@SEC','nvarchar(64)'),
          [QuoteType]     = X.rref.value('@NAME','nvarchar(64)'),
          [Value]         = X.rref.value('@VALUE','numeric(25,8)')
        FROM @Data.nodes('/RECORDS/RECORD') AS I(nref)
        CROSS APPLY I.nref.nodes('QTYPE') AS X(rref)
        WHERE X.rref.value('@VALUE','NVarChar(64)') NOT LIKE '%N/A%'
      ) U
      INNER LOOP JOIN [Bloomberg].[Dic:Instruments:Quotes:Types] T ON T.[Code] = U.[QuoteType]
      INNER LOOP JOIN [Gate].[Dic:Instruments:Quotes:Types] GT ON T.[Gate_Code] = GT.[Code] 
      INNER LOOP JOIN [Bloomberg].[Dic:Instruments:Codes] I ON I.[Code] + ISNULL(' ' + [CodeBoard], '') + ISNULL(' ' + [CodeSuffix], '') = U.[Instrument] 
      INNER LOOP JOIN [Gate].[Dic:Places:Trade Boards] B ON B.[Id] = I.[TradeBoard_Id] AND B.[Place_Id] = @GatePlace_Id
    ) Z ON O.[TradeDateTime]  = Z.[TradeDateTime] AND O.[TradeBoard_Id] = Z.[TradeBoard_Id] AND O.[Instrument_Id] = Z.[Instrument_Id] AND O.[QuoteType_Id]=Z.[QuoteType_Id]
    WHEN NOT MATCHED THEN
    INSERT ([TradeDateTime], [TradeBoard_Id], [Instrument_Id], [QuoteType_Id], [Currency], [Value], [LastUpdateTime])
    VALUES (Z.[TradeDateTime], Z.[TradeBoard_Id], Z.[Instrument_Id], Z.[QuoteType_Id], Z.[CurrencyCode], Z.[Value], Z.[LastUpdateTime])
    OPTION (FORCE ORDER, MAXDOP 1);

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [Bloomberg].[Instruments::Quotes]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--===============================================================================================================
-- <>:         ;
-- <>:              -
-- < >:       -
-- <>:             Fetisov
-- < >:     24.10.2014;
-- <>:
-----------------------------------------------------------------------------------------------------------------
-- <>:
/*
EXEC [Bloomberg].[Instruments::Quotes]
  @DateBegin      =   '20141020',
  @DateEnd        =   '20141022',
  @BloombergCode  =   '%A%',
  @PlaceCode      =   'LSE',
  @BoardCode      =   'LN'
*/
--===============================================================================================================
CREATE PROCEDURE [Bloomberg].[Instruments::Quotes]
  @DateBegin        Date,
  @DateEnd          Date,
  @Code             NVarChar(64)  = NULL,
  @PlaceCode        NVarChar(32)  = NULL,
  @BoardCode        NVarChar(32)  = NULL,
  @BloombergCode    NVarChar(64)  = NULL
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON
  DECLARE
    @DateAfterEnd Date = DATEADD(Day, 1, @DateEnd)
  BEGIN TRY
    IF @DateBegin IS NULL
      RaisError('   @DateBegin', 16, 2)
    IF @DateEnd IS NULL
      RaisError('   @DateEnd', 16, 2)

      SELECT
        [Code]          = I.[Code],
        [PlaceCode]     = B.[Code],
        [BoardCode]     = D.[Code],
        [BloombergCode] = C.[Code],
        [QuoteTypeCode] = T.[Code],
        Q.[TradeDateTime],
        Q.[Value]
      FROM [Bloomberg].[Dic:Places] B
      INNER JOIN [Gate].[Dic:Places] G ON B.[Place_Id] = G.[Id]
      INNER JOIN [Gate].[Dic:Places:Trade Boards] D ON D.[Place_Id] = G.[Id]
      INNER JOIN [Gate].[Instruments:Quotes] Q ON Q.[TradeBoard_Id] = D.[Id]
      INNER JOIN [Gate].[Dic:Instruments:Quotes:Types] T ON T.[Id] = Q.[QuoteType_Id]
      INNER JOIN [Bloomberg].[Dic:Instruments:Codes] C ON C.[Instrument_Id] = Q.[Instrument_Id] AND B.[Id] = C.[Place_Id]
      INNER JOIN [Gate].[Instruments] I ON C.[Instrument_Id] = I.[Id]
      WHERE [TradeDateTime] >= @DateBegin AND [TradeDateTime] < @DateAfterEnd
            AND (@BoardCode IS NULL OR D.[Code] = @BoardCode)
            AND (@PlaceCode IS NULL OR B.[Code] = @PlaceCode)
            AND (@Code IS NULL OR I.[Code] LIKE @Code)
            AND (@BloombergCode IS NULL OR C.[Code] LIKE @BloombergCode)
    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [Bloomberg].[Instruments::SendList]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--===============================================================================================================
-- <>:               ;
-- <>:              -
-- < >:       -
-- <>:             Fetisov
-- < >:     11.12.2013;
-- <>:
-----------------------------------------------------------------------------------------------------------------
-- <>:
/*
select * from [Bloomberg].[Dic:Places]
EXEC [Bloomberg].[Instruments::SendList] @fix_range = -2
  @Place_Id = 6
EXEC [Bloomberg].[Instruments::SendList] @Place_Id = 2
*/
--===============================================================================================================
CREATE PROCEDURE [Bloomberg].[Instruments::SendList]
  @Place_Id          Tinyint,
  @Filter_Instrument NVarChar(15) = NULL
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  BEGIN TRY

    SELECT
      [Code] = I.[Code] + ISNULL(' ' + [CodeBoard], '') + ISNULL(' ' + [CodeSuffix], '')
    FROM [Bloomberg].[Dic:Instruments:Codes] I
    WHERE I.[Place_Id] = @Place_Id AND I.[Enabled] = 1
      AND (@Filter_Instrument IS NULL OR I.[Code] LIKE '%'+@Filter_Instrument+'%')

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [Bloomberg].[Places::SendList]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*
  DECLARE @Date Date = '20141030 0:00:00', @fix_place NVarChar(20) = '' , @fix_range Int = 1
  EXEC [Bloomberg].[Places::SendList] @Date = @Date , @Filter_place = @fix_place, @fix_range = @fix_range 
*/
CREATE PROCEDURE [Bloomberg].[Places::SendList]
  @Date         Date,
  @Filter_Place NVarChar(15),
  @Fix_range    int = NULL
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  BEGIN TRY
    DECLARE
      @CurrentDate Date  = GETDATE(),
      @DateTime DateTime = @Date
      --@PlusDate DateTime = DATEADD(Day, 30, @Date)

    SELECT
      V.[Id],
      V.[Place_id],
      V.[Source_Id],
      V.[Code],
      V.[LastDate],
      V.[TimeStart],
      V.[TimeFinish],
      C.[Date],
      V.[Currency]
    FROM
    (
      SELECT
        P.[Id],
        P.[Place_Id],
        P.[Source_Id],
        P.[Code],
        P.[Currency],
        [LastDate] = CASE
                       WHEN @Fix_range IS NULL THEN ISNULL(X.[TradeDateTime], DATEADD(MONTH, -1, @Date))
                       WHEN @Fix_range  > 0 THEN DATEADD(DAY, -@Fix_range, @Date)
                       WHEN @Fix_range <= 0 THEN ISNULL(X.[TradeDateTime], DATEADD(DAY, @Fix_range, @Date))
                     END,
        S.[TimeStart],
        S.[TimeFinish]
      FROM [Bloomberg].[Dic:Places] P
      INNER JOIN [Gate].[Dic:Places] G ON P.[Place_Id] = G.[Id]
      LEFT JOIN [Bloomberg].[Dic:Places:Schedules] S ON S.[Place_Id] = P.[Id]
      OUTER APPLY
      (
        SELECT TOP 1 [TradeDateTime]
        FROM [Bloomberg].[Dic:Instruments:Codes] I
        INNER JOIN [Gate].[Instruments:Quotes] Q ON Q.[Instrument_Id] = I.[Instrument_Id] 
        WHERE @Fix_range <= 0 AND @CurrentDate = @Date
          AND I.[Place_Id] = P.[Id]  AND Q.[TradeDateTime] >= @DateTime --AND @PlusDate
        ORDER BY [TradeDateTime] DESC
        
      ) X
      WHERE @Filter_Place = '' OR @Filter_Place= P.[Code]
    ) V
    INNER JOIN [Bloomberg].[Dic:Places:Calendars] C ON C.[Place_Id] = V.[Id]
      AND C.[Date] BETWEEN CAST(V.[LastDate] AS Date) AND @Date
      AND C.[WorkDayIndex] > 0
    WHERE LastDate <= CAST([Date] AS Datetime) + CAST([TimeFinish] AS Datetime)
      AND @CurrentDate >  CAST([Date] AS Datetime) + CAST([TimeStart] AS Datetime)
    ORDER BY C.[Date], V.[Id]
    OPTION (RECOMPILE)
    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [Gate].[BLOOMBERG::Securities::Codes::View]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--===============================================================================================================
-- <>:             Bloomberg-;
-- <>:              ..;
-- < >:     02.04.2012;
-- <>:       ;
-----------------------------------------------------------------------------------------------------------------
-- <>:
/*
--*/
--=============================================================================================================
CREATE PROCEDURE [Gate].[BLOOMBERG::Securities::Codes::View]
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON
  
  SELECT *
  FROM [Gate].[BLOOMBERG:Securities:Codes]
   
  -- !    "1"     .
  RETURN 1

GO
/****** Object:  StoredProcedure [Gate].[BLOOMBERG::Securities::Prices::Save]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--===============================================================================================================
-- <>:               ;
-- <>:              ..;
-- < >:     30.03.2012;
-- <>:       ;
-----------------------------------------------------------------------------------------------------------------
-- <>:
/*
--*/
--=============================================================================================================
CREATE PROCEDURE [Gate].[BLOOMBERG::Securities::Prices::Save]
--  @Interface          Char(2),
  @Data               Xml,
  @Debug              Bit               = 0
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON
  
  DECLARE 
    @ErrorNumber        Int,
    @RowCount           Int,
    @ProcedureVersion   Int             = 1,
    @ProcName           Sysname         = REPLICATE('  ', @@NESTLEVEL-1) + QUOTENAME(OBJECT_SCHEMA_NAME( @@ProcId )) + '.' + QUOTENAME(OBJECT_NAME( @@ProcId )),
    @SavePoint          Sysname         = 'GIPBS_TRAN',
    @TranCount          Int, 
    @Retry              TinyInt
    
  --IF @Debug = 1
  --  PRINT @ProcName + '(0): @Interface = ' + ISNULL([Pub].[Quote String](@Interface), 'NULL') + '.'
    
  -------------------------------
  BEGIN TRY
    -- 1.1.  
    --IF @Interface IS NULL
    --  RAISERROR ('    @Interface!', 16, 2)

    -------------------------------------
    -- 2. "".        
    SET @TranCount = @@TRANCOUNT
    SET @Retry = CASE WHEN @TranCount = 0 THEN 5 ELSE 1 END
    WHILE @Retry > 0
    BEGIN TRY
      IF @TranCount > 0
        SAVE TRAN @SavePoint
      ELSE
        BEGIN TRAN
            
      INSERT INTO [Gate].[BLOOMBERG:Securities:Prices] -- '[Gate].[BLOOMBERG:Securities:Prices]'
      (
        [Code],
        [Date],
        [CurrencyCode],
        [PX_BID],
        [PX_ASK],
        [PX_HIGH],
        [PX_LOW],
        [PX_LAST]
      )
      SELECT
        [Code],
        [Date],
        [CurrencyCode],
        [PX_BID],
        [PX_ASK],
        [PX_HIGH],
        [PX_LOW],
        [PX_LAST]
      FROM
      (
        SELECT
          [Code]          = I.Node.value('@Code', 'VarChar(30)'),
          [Date]          = I.Node.value('@Date', 'Date'),
          [CurrencyCode]  = I.Node.value('@CurrencyCode', 'NChar(3)'),
          [PX_BID]        = I.Node.value('@PX_BID', 'Numeric(32,10)'),
          [PX_ASK]        = I.Node.value('@PX_ASK', 'Numeric(32,10)'),
          [PX_HIGH]       = I.Node.value('@PX_HIGH', 'Numeric(32,10)'),
          [PX_LOW]        = I.Node.value('@PX_LOW', 'Numeric(32,10)'),
          [PX_LAST]       = I.Node.value('@PX_LAST', 'Numeric(32,10)')
        FROM @Data.nodes('/RECORD') AS I(Node)
      ) AS V
      WHERE NOT EXISTS
            (
              SELECT *
              FROM [Gate].[BLOOMBERG:Securities:Prices] AS X
              WHERE X.[Code] = V.[Code]
                AND X.[Date] = V.[Date]
            )

      SET @RowCount = @@ROWCOUNT
      IF @Debug = 1
        PRINT @ProcName + ' (4.3): Deleted Quote Lists: ' + CAST(@RowCount AS VarChar(32))

      ------------------------------------------
      WHILE @@TranCount > @TranCount COMMIT TRAN
      SET @Retry = 0
    END TRY
    BEGIN CATCH
      SET @ErrorNumber = ERROR_NUMBER()
      IF @ErrorNumber IN (1205, 51205) BEGIN -- DEAD LOCK OR USER DEAD LOCK
        SET @ErrorNumber = 51205
        SET @Retry = @Retry - 1
      END ELSE
        SET @Retry = 0
 
      IF XACT_STATE() <> 0
        IF @@TranCount > @TranCount
          ROLLBACK TRAN
        ELSE IF XACT_STATE() <> -1 AND @@TranCount = @TranCount
          ROLLBACK TRAN @SavePoint
 
      IF @@TranCount > 0 OR @Retry = 0
        EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID, @ProcedureVersion = @ProcedureVersion, @ErrorNumber = @ErrorNumber
      ELSE
        --     DEAD LOCK
        WAITFOR DELAY '00:00:00.500'
    END CATCH
 
    -- 5. !    "1"     .
    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID, @ProcedureVersion = @ProcedureVersion, @ErrorNumber = @ErrorNumber
  END CATCH

GO
/****** Object:  StoredProcedure [Gate].[Instruments::Prices::Bloomberg::Save]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--===============================================================================================================
-- <>:               ;
-- <>:              ..;
-- < >:     30.03.2012;
-- <>:       ;
-----------------------------------------------------------------------------------------------------------------
-- <>:
/*
--*/
--=============================================================================================================
CREATE PROCEDURE [Gate].[Instruments::Prices::Bloomberg::Save]
  @Interface          Char(2),
  @Data               Xml,
  @Debug              Bit               = 0
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON
  
  DECLARE 
    @ErrorNumber        Int,
    @RowCount           Int,
    @ProcedureVersion   Int             = 1,
    @ProcName           Sysname         = REPLICATE('  ', @@NESTLEVEL-1) + QUOTENAME(OBJECT_SCHEMA_NAME( @@ProcId )) + '.' + QUOTENAME(OBJECT_NAME( @@ProcId )),
    @SavePoint          Sysname         = 'GIPBS_TRAN',
    @TranCount          Int, 
    @Retry              TinyInt
    
  IF @Debug = 1
    PRINT @ProcName + '(0): @Interface = ' + ISNULL([Pub].[Quote String](@Interface), 'NULL') + '.'
    
  -------------------------------
  BEGIN TRY
    -- 1.1.  
    IF @Interface IS NULL
      RAISERROR ('    @Interface!', 16, 2)

    -------------------------------------
    -- 2. "".        
    SET @TranCount = @@TRANCOUNT
    SET @Retry = CASE WHEN @TranCount = 0 THEN 5 ELSE 1 END
    WHILE @Retry > 0
    BEGIN TRY
      IF @TranCount > 0
        SAVE TRAN @SavePoint
      ELSE
        BEGIN TRAN
            
      INSERT INTO [Gate].[Instruments:Prices:Bloomberg] -- '[Gate].[Instruments:Prices:Bloomberg]'
      (
        [Code],
        [Date],
        [CurrencyCode],
        [PX_BID],
        [PX_ASK],
        [PX_HIGH],
        [PX_LOW],
        [PX_LAST]
      )
      SELECT
        [Code],
        [Date],
        [CurrencyCode],
        [PX_BID],
        [PX_ASK],
        [PX_HIGH],
        [PX_LOW],
        [PX_LAST]
      FROM
      (
        SELECT
          [Code]          = I.Node.value('@Code', 'VarChar(30)'),
          [Date]          = I.Node.value('@Date', 'Date'),
          [CurrencyCode]  = I.Node.value('@CurrencyCode', 'NChar(3)'),
          [PX_BID]        = I.Node.value('@PX_BID', 'Numeric(32,10)'),
          [PX_ASK]        = I.Node.value('@PX_ASK', 'Numeric(32,10)'),
          [PX_HIGH]       = I.Node.value('@PX_HIGH', 'Numeric(32,10)'),
          [PX_LOW]        = I.Node.value('@PX_LOW', 'Numeric(32,10)'),
          [PX_LAST]       = I.Node.value('@PX_LAST', 'Numeric(32,10)')
        FROM @Data.nodes('/RECORD') AS I(Node)
      ) AS V
      WHERE NOT EXISTS
            (
              SELECT *
              FROM [Gate].[Instruments:Prices:Bloomberg] AS X
              WHERE X.[Code] = V.[Code]
                AND X.[Date] = V.[Date]
            )

      SET @RowCount = @@ROWCOUNT
      IF @Debug = 1
        PRINT @ProcName + ' (4.3): Deleted Quote Lists: ' + CAST(@RowCount AS VarChar(32))

      ------------------------------------------
      WHILE @@TranCount > @TranCount COMMIT TRAN
      SET @Retry = 0
    END TRY
    BEGIN CATCH
      SET @ErrorNumber = ERROR_NUMBER()
      IF @ErrorNumber IN (1205, 51205) BEGIN -- DEAD LOCK OR USER DEAD LOCK
        SET @ErrorNumber = 51205
        SET @Retry = @Retry - 1
      END ELSE
        SET @Retry = 0
 
      IF XACT_STATE() <> 0
        IF @@TranCount > @TranCount
          ROLLBACK TRAN
        ELSE IF XACT_STATE() <> -1 AND @@TranCount = @TranCount
          ROLLBACK TRAN @SavePoint
 
      IF @@TranCount > 0 OR @Retry = 0
        EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID, @ProcedureVersion = @ProcedureVersion, @ErrorNumber = @ErrorNumber
      ELSE
        --     DEAD LOCK
        WAITFOR DELAY '00:00:00.500'
    END CATCH
 
    -- 5. !    "1"     .
    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID, @ProcedureVersion = @ProcedureVersion, @ErrorNumber = @ErrorNumber
  END CATCH

GO
/****** Object:  StoredProcedure [Gate].[Instruments::Quotes::Get Lasts]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*
  EXEC [Gate].[Instruments::Quotes::Get Lasts]
    @PlaceCode  = 'MICEX:S',
    @Date       = '20140603',
    @Time       = '17:00'
--*/
CREATE PROCEDURE [Gate].[Instruments::Quotes::Get Lasts]
  @PlaceCode    VarChar(20),
  @Date         Date, --       
  @Time         Time
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @QuoteType_Id     TinyInt,
    @DateTimeFrom     DateTime,
    @DateTimeTo       DateTime,
    @Place_Id         Int

  DECLARE @Instruments Table
  (
    [Id]    Int                                       NOT NULL,
    [Code]  VarChar(20) COLLATE Cyrillic_General_BIN  NOT NULL,
    PRIMARY KEY CLUSTERED([Id])
  )

  BEGIN TRY
    SET @DateTimeFrom = @Date
    SET @DateTimeTo = CAST(@Date AS DateTime) + CAST(@Time AS DateTime)

    SELECT TOP (1)
      @Place_Id = [Id]
    FROM [Gate].[Dic:Places] P
    WHERE P.[Code] = @PlaceCode

    SELECT TOP (1)
      @QuoteType_Id = [Id]
    FROM [Gate].[Dic:Instruments:Quotes:Types]
    WHERE [Code] = 'Last'

    INSERT INTO @Instruments
    SELECT [Id], [Code]
    FROM [Gate].[Instruments]
    WHERE [Place_Id] = @Place_Id

    SELECT
      [PlaceCode]       = @PlaceCode,
      [InstrumentCode]  = I.[Code],
      [LastPrice]       = Q.[Value],
      [CurrencyCode]    = CASE WHEN Q.[Currency] = 'SUR' THEN 'RUB' ELSE Q.[Currency] END,
      [TradeDateTime]   = Q.[TradeDateTime]
    FROM @Instruments I
    CROSS APPLY
    (
      SELECT TOP (1) *
      FROM [Gate].[Instruments:Quotes] Q
      WHERE Q.[Instrument_Id] = I.[Id]
        AND Q.[TradeDateTime] > @DateTimeFrom
        AND Q.[TradeDateTime] <= @DateTimeTo
        AND Q.[Value] IS NOT NULL
        -- AND Q.[Currency] IS NOT NULL
    ) Q
    ORDER BY [InstrumentCode]

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [Micex].[Deal_Save]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Micex].[Deal_Save]
  @TradeNum     BigInt,
  @TradeDate    Date,
  @TradeTime    DateTime,
  @ClassCode    VarChar(50),
  @SecCode      VarChar(50),
  @Price        Numeric(24,8),
  @Quantity     Int,
  @Value        Numeric(24,8),
  @BuySell      VarChar(10)     = NULL,
  @SettleCode   VarChar(4)      = NULL,
  @Yield        Numeric(16,8)   = NULL,
  @Accruedint   Numeric(24,8)   = NULL
---
  WITH EXECUTE AS OWNER
---
AS
  DECLARE
    @ErrorMessage       NVarChar(100),
    @ErrorSeverity      Int,
    @ErrorState         Int

  BEGIN TRY

    MERGE [Micex].[Deals] I
    USING
    (
      SELECT
        [TradeNum]    = @TradeNum,
        [TradeDate]   = @TradeDate,
        [TradeTime]   = @TradeTime,
        [ClassCode]   = @ClassCode,
        [SecCode]     = @SecCode,
        [Price]       = @Price,
        [Quantity]    = @Quantity,
        [Value]       = @Value,
        [BuySell]     = @BuySell,
        [SettleCode]  = @SettleCode,
        [Yield]       = @Yield,
        [Accruedint]  = @Accruedint
    ) X ON I.[TradeNum] = X.[TradeNum] AND YEAR(I.[TradeDate]) = YEAR(X.[TradeDate])
    WHEN  MATCHED
      AND (
             [Pub].[Is Equal DateTimes](I.[TradeTime], X.[TradeTime]) = 0
          OR [Pub].[Is Equal Strings](I.[ClassCode], X.[ClassCode], 0) = 0
          OR [Pub].[Is Equal Strings](I.[SecCode], X.[SecCode], 0) = 0
          OR [Pub].[Is Equal Variants](I.[Price], X.[Price]) = 0
          OR [Pub].[Is Equal Variants](I.[Quantity], X.[Quantity]) = 0
          OR [Pub].[Is Equal Variants](I.[Value], X.[Value]) = 0
          OR [Pub].[Is Equal Strings](I.[BuySell], X.[BuySell], 0) = 0
          OR [Pub].[Is Equal Strings](I.[SettleCode], X.[SettleCode], 0) = 0
          OR [Pub].[Is Equal Variants](I.[Yield], X.[Yield]) = 0
          OR [Pub].[Is Equal Variants](I.[Accruedint], X.[Accruedint]) = 0
          )
    THEN
      UPDATE SET
        [TradeTime]   = X.[TradeTime],
        [ClassCode]   = X.[ClassCode],
        [SecCode]     = X.[SecCode],
        [Price]       = X.[Price],
        [Quantity]    = X.[Quantity],
        [Value]       = X.[Value],
        [BuySell]     = X.[BuySell],
        [SettleCode]  = X.[SettleCode],
        [Yield]       = X.[Yield],
        [Accruedint]  = X.[Accruedint]
    WHEN NOT MATCHED BY TARGET
      THEN INSERT ([TradeNum], [TradeDate], [TradeTime], [ClassCode], [SecCode], [Price], [Quantity], [Value], [BuySell], [SettleCode], [Yield], [Accruedint])
      VALUES (X.[TradeNum], X.[TradeDate], X.[TradeTime], X.[ClassCode], X.[SecCode], X.[Price], X.[Quantity], X.[Value], X.[BuySell], X.[SettleCode], X.[Yield], X.[Accruedint])
    ;

  END TRY
  BEGIN CATCH
    IF @@TRANCOUNT > 0 AND XACT_STATE() <> 0 ROLLBACK TRAN
    SET @ErrorMessage = ERROR_MESSAGE()
    SET @ErrorSeverity = ERROR_SEVERITY()
    SET @ErrorState = ERROR_STATE()
    RAISERROR (@ErrorMessage, @ErrorSeverity, @ErrorState)
  END CATCH

GO
/****** Object:  StoredProcedure [MICEX-SM].[Deals::Modify]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [MICEX-SM].[Deals::Modify]
  @TradeNo              BigInt            = NULL,
  @TradeDate            Date              = NULL,
  @TradeTime            Time              = NULL,
  @SecID                VarChar(50)       = NULL,
  @BoardID              VarChar(50)       = NULL,
  @Price                Numeric(18,8)     = NULL,
  @Quantity             Numeric(18,8)     = NULL,
  @Value                Numeric(28,8)     = NULL,
  @BuySell              VarChar(10)       = NULL
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  BEGIN TRY
    EXEC [Micex].[Deal_Save]
        @TradeNum     = @TradeNo,
        @TradeDate    = @TradeDate,
        @TradeTime    = @TradeTime,
        @SecCode      = @SecID,
        @ClassCode    = @BoardID,
        @Price        = @Price,
        @Quantity     = @Quantity,
        @Value        = @Value, 
        @BuySell      = @BuySell

    EXEC [MICEX-SM].[Instruments::Quotes::Modify]
      @ClassCode      = @BoardID,
      @SecCode        = @SecID,
      @TradeDate      = @TradeDate,
      @time           = @TradeTime,
      @last           = @Price

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID      
  END CATCH

GO
/****** Object:  StoredProcedure [MICEX-SM].[Instruments::Quotes::Modify]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [MICEX-SM].[Instruments::Quotes::Modify]
  @ClassCode        VarChar(12),
  @SecCode          VarChar(12),
  @TradeDate        DateTime,
  @MatDate          DateTime        = NULL,
  @accruedint       Numeric(19, 4)  = NULL,
  @bid              Numeric(19, 6)  = NULL,
  @biddepth         Numeric(19, 0)  = NULL,
  @biddeptht        Numeric(19, 0)  = NULL,
  @buydepo          Numeric(19, 4)  = NULL,
  @buyprofit        Numeric(19, 4)  = NULL,
  @change           Numeric(19, 6)  = NULL,
  @changetime       DateTime        = NULL,
  @chngclose        Numeric(19, 4)  = NULL,
  @chngopen         Numeric(19, 4)  = NULL,
  @closeprice       Numeric(19, 6)  = NULL,
  @closetime        DateTime        = NULL,
  @closeval         Numeric(19, 4)  = NULL,
  @closeyield       Numeric(19, 4)  = NULL,
  @couponvalue      Numeric(19, 4)  = NULL,
  @currentvalue     Numeric(19, 4)  = NULL,
  @curval           Numeric(19, 4)  = NULL,
  @facevalue        Numeric(19, 6)  = NULL,
  @high             Numeric(19, 6)  = NULL,
  @highbid          Numeric(19, 6)  = NULL,
  @last             Numeric(19, 6)  = NULL,
  @lastchange       Numeric(19, 4)  = NULL,
  @lasttoprevstlprc Numeric(19, 6)  = NULL,
  @lastvalue        Numeric(19, 6)  = NULL,
  @lotsize          Numeric(19, 0)  = NULL,
  @low              Numeric(19, 6)  = NULL,
  @lowoffer         Numeric(19, 6)  = NULL,
  @marketprice      Numeric(19, 6)  = NULL,
  @marketpricetoday Numeric(19, 6)  = NULL,
  @maxoutvolume     Numeric(19, 0)  = NULL,
  @negnumtrades     Numeric(19, 0)  = NULL,
  @negvaltoday      Numeric(19, 4)  = NULL,
  @numbids          Numeric(19, 0)  = NULL,
  @numcontracts     Numeric(19, 0)  = NULL,
  @numoffers        Numeric(19, 0)  = NULL,
  @numtrades        Numeric(19, 0)  = NULL,
  @offer            Numeric(19, 6)  = NULL,
  @offerdepth       Numeric(19, 0)  = NULL,
  @offerdeptht      Numeric(19, 0)  = NULL,
  @open             Numeric(19, 6)  = NULL,
  @openval          Numeric(19, 4)  = NULL,
  @optionbase       VarChar(255)    = NULL,
  @optiontype       VarChar(255)    = NULL,
  @prevprice        Numeric(19, 6)  = NULL,
  @prevsettlprice   Numeric(19, 6)  = NULL,
  @prevwaprice      Numeric(19, 6)  = NULL,
  @pricemax         Numeric(19, 6)  = NULL,
  @pricemin         Numeric(19, 6)  = NULL,
  @priceminusprevwa Numeric(19, 6)  = NULL,
  @pricemvtlimit    Numeric(19, 6)  = NULL,
  @pricemvtlimitt1  Numeric(19, 6)  = NULL,
  @primarydist      VarChar(128)    = NULL,
  @qty              Numeric(19, 0)  = NULL,
  @qty_pcs          Numeric(19, 0)  = NULL,
  @selldepo         Numeric(19, 4)  = NULL,
  @sellprofit       Numeric(19, 4)  = NULL,
  @status           VarChar(128)    = NULL,
  @steppricet       Numeric(19, 6)  = NULL,
  @stepprice        Numeric(19, 6)  = NULL,
  @time             DateTime        = NULL,
  @theorprice       Numeric(19, 6)  = NULL,
  @tradechange      Numeric(19, 6)  = NULL,
  @tradingstatus    VarChar(128)    = NULL,
  @valtoday         Numeric(19, 4)  = NULL,
  @value            Numeric(19, 4)  = NULL,
  @volatility       Numeric(19, 4)  = NULL,
  @voltoday         Numeric(19, 0)  = NULL,
  @waprice          Numeric(19, 6)  = NULL,
  @yield            Numeric(19, 4)  = NULL,
  @yieldatprevwapri Numeric(19, 4)  = NULL,
  @yieldatwaprice   Numeric(19, 4)  = NULL,
  @bgonp            Numeric(19, 4)  = NULL,
  @bgop             Numeric(19, 4)  = NULL,
  @highval          Numeric(19, 4)  = NULL,
  @ichange          Numeric(19, 4)  = NULL,
  @iopen            Numeric(19, 4)  = NULL,
  @lowval           Numeric(19, 4)  = NULL,
  @pchange          Numeric(19, 4)  = NULL,
  @quantity         Numeric(19, 4)  = NULL,
  @settleprice      Numeric(19, 6)  = NULL,
  @strike           Numeric(19, 6)  = NULL,
  @Scale            Int             = NULL,
  @DaysToMatDate    Int             = NULL,
  @nextcoupon       DateTime        = NULL,
  @FaceUnit         VarChar(12)     = NULL,
  @admittedquote    Numeric(19, 6)  = NULL,
  @issuesize        Numeric(19, 0)  = NULL,
  @prevdate         DateTime        = NULL,
  @lopenprice       Numeric(19, 6)  = NULL,
  @lcurrentprice    Numeric(19, 6)  = NULL,
  @quotebasis       VarChar(255)    = NULL,
  @couponperiod     Numeric(19, 0)  = NULL,
  @buybackprice     Numeric(19, 6)  = NULL,
  @buybackdate      DateTime        = NULL,
  @duration         Numeric(19, 4)  = NULL,
  @baseprice        Numeric(19, 4)  = NULL,
  @clprice          Numeric(19, 4)  = NULL,
  @clstate          VarChar(32)     = NULL,
  @counterprice     Numeric(19, 6)  = NULL,
  @crossrate        Numeric(19, 4)  = NULL,
  @curstepprice     VarChar(32)     = NULL,
  @endtime          DateTime        = NULL,
  @evnendtime       DateTime        = NULL,
  @evnstarttime     DateTime        = NULL,
  @expdate          DateTime        = NULL,
  @ispercent        VarChar(32)     = NULL,
  @lastbid          Numeric(19, 6)  = NULL,
  @lastoffer        Numeric(19, 6)  = NULL,
  @lcloseprice      Numeric(19, 6)  = NULL,
  @marg             VarChar(32)     = NULL,
  @marketprice2     Numeric(19, 6)  = NULL,
  @min_curr_last    Numeric(19, 6)  = NULL,
  @monendtime       DateTime        = NULL,
  @monstarttime     DateTime        = NULL,
  @openperiodprice  Numeric(19, 6)  = NULL,
  @percentrate      Numeric(19, 4)  = NULL,
  @prevadmittedquot Numeric(19, 6)  = NULL,
  @prevlegalclosepr Numeric(19, 6)  = NULL,
  @realvmprice      Numeric(19, 6)  = NULL,
  @sectype          VarChar(32)     = NULL,
  @starttime        DateTime        = NULL,
  @settlecode       VarChar(16)     = NULL,
  @steppricecl      Numeric(19, 6)  = NULL,
  @steppriceprcl    Numeric(19, 6)  = NULL,
  @min_curr_last_ti DateTime        = NULL,
  @prevlotsize      Numeric(19, 4)  = NULL,
  @lotsizechangedat DateTime        = NULL,
  @CurrencyId       VarChar(10)     = NULL,
  @StepDelay        Int             = 1, --  ,     

  @Debug            Bit             = NULL
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Place_Id           TinyInt       = 1, 
    @PlaceCode          VarChar(32)   = 'MICEX:S',
    @TradeBoard_Id      Int,
    @Instrument_Id      Int,
    @TradeDateTime      DateTime,
    @TradeDateTime_Prev DateTime

  DECLARE @Quotes Table
  (
    [TradeBoard_Id]     SmallInt                                  NOT NULL,
    [Instrument_Id]     Int                                       NOT NULL,
    [QuoteType_Id]      TinyInt                                   NOT NULL,
    [Currency]          VarChar(5)  COLLATE Cyrillic_General_BIN      NULL,
    [Value]             Numeric(19, 6)                                NULL,
    [LastUpdateTime]    Time                                      NOT NULL,
    [IsEqual]           Bit                                           NULL,
    PRIMARY KEY CLUSTERED([Instrument_Id], [QuoteType_Id], [TradeBoard_Id])
  )

  BEGIN TRY

    SELECT
      @Place_Id = [Id]
    FROM [Gate].[Dic:Places]
    WHERE [Code] = @PlaceCode

    IF @TradeDate IS NULL
      RaisError('   @TradeDate', 16, 2)

    IF @ClassCode IS NULL
      RaisError('   @ClassCode', 16, 2)

    IF @SecCode IS NULL
      RaisError('   @SecCode', 16, 2)

    IF @StepDelay IS NULL
      RaisError('   ', 16, 2)

    IF @Place_Id IS NULL
      RaisError('  ', 16, 2)

    -- SET @CurrencyId = ISNULL(@CurrencyId, 'RUB')

    SET @TradeDateTime = DateAdd(Minute, IsNull(DateDiff(Minute, 0, @time) / @StepDelay * @StepDelay, 0), @TradeDate)

    SELECT
      @TradeBoard_Id = [Id]
    FROM [Gate].[Dic:Places:Trade Boards]
    WHERE [Code] = @ClassCode
      AND [Place_Id] = @Place_Id

    SELECT
      @Instrument_Id = [Id]
    FROM [Gate].[Instruments]
    WHERE [Code] = @SecCode
      AND [Place_Id] = @Place_Id

    IF @Debug = 1
      SELECT [@ClassCode] = @ClassCode, [@TradeBoard_Id] = @TradeBoard_Id, [@Instrument_Id] = @Instrument_Id, [@TradeDateTime] = @TradeDateTime, [@CurrencyId] = @CurrencyId, [@quotebasis] = @quotebasis

    IF @TradeBoard_Id IS NULL OR @Instrument_Id IS NULL --      
      RETURN 1

    --   
    INSERT INTO @Quotes ([TradeBoard_Id], [Instrument_Id], [QuoteType_Id], [Currency], [Value], [LastUpdateTime], [IsEqual])
    SELECT
      Q.[TradeBoard_Id],
      Q.[Instrument_Id],
      Q.[QuoteType_Id],
      Q.[Currency],
      Q.[Value],
      Q.[LastUpdateTime],
      [IsEqual]         = CASE
                            WHEN  Q.[PrevExist] = 1
                              AND (
                                      Q.[PrevValue] IS NULL AND Q.[Value] IS NULL
                                    OR
                                      Q.[PrevValue] = Q.[Value]
                                  )
                              THEN 1
                          END
    FROM
    (
      SELECT
        [TradeBoard_Id]   = @TradeBoard_Id,
        [Instrument_Id]   = @Instrument_Id,
        [QuoteType_Id]    = [Id],
        [Currency]        = CASE
                              WHEN @quotebasis = 'F'
                                THEN '%' -- CASE WHEN @FaceUnit = 'SUR' THEN 'RUB' ELSE @FaceUnit END
                              WHEN @quotebasis = 'R'
                                THEN CASE WHEN @CurrencyId = 'SUR' THEN 'RUB' ELSE @CurrencyId END
                            END,
        [Value]           = CASE QT.[Code]
                              WHEN 'Ask'          THEN NullIf(@bid, 0)
                              WHEN 'Bid'          THEN NullIf(@offer, 0)
                              WHEN 'Last'         THEN NullIf(@last, 0)
                              WHEN 'Average'      THEN NullIf(@waprice, 0)
                              WHEN 'Min'          THEN NullIf(@pricemin, 0)
                              WHEN 'Max'          THEN NullIf(@pricemax, 0)
                              WHEN 'Market1'      THEN NullIf(@marketpricetoday, 0)
                              WHEN 'Market2'      THEN NullIf(@marketprice2, 0)
                              --WHEN 'Market3'      THEN NULL
                              WHEN 'Acknowledged' THEN NullIf(@admittedquote, 0)
                              WHEN 'Closed'       THEN NullIf(@lcloseprice, 0)
                            END,
        [LastUpdateTime]  = IsNull(Cast(@time AS Time), '00:00:00'),
        [PrevValue]       = QPrev.[Value],
        [PrevExist]       = QPrev.[Exist]
      FROM [Gate].[Dic:Instruments:Quotes:Types] QT
      OUTER APPLY
      (
        --   
        SELECT TOP (1)
          [Exist]   = 1,
          Q.[Value]
        FROM [Gate].[Instruments:Quotes] Q
        WHERE Q.[Instrument_Id] = @Instrument_Id
              AND Q.[QuoteType_Id] = QT.[Id]
              AND Q.[TradeBoard_Id] = @TradeBoard_Id
              AND Q.[TradeDateTime] < @TradeDateTime
              AND Q.[TradeDateTime] >= CAST(@TradeDateTime AS Date)
        ORDER BY Q.[TradeDateTime] DESC
      ) QPrev
    ) Q

    IF @Debug = 1
      SELECT [@Quotes] = '@Quotes', * FROM @Quotes

    -- ,     
    DELETE FROM T
    FROM [Gate].[Instruments:Quotes] T
    INNER JOIN @Quotes V  ON  V.[Instrument_Id] = T.[Instrument_Id]
                            AND V.[TradeBoard_Id] = T.[TradeBoard_Id]
                            AND V.[QuoteType_Id] = T.[QuoteType_Id]
                            AND V.[IsEqual] = 1
    WHERE T.[TradeDateTime] = @TradeDateTime


    -- [Gate].[Instruments:Quotes] -- ""
    --   
    MERGE [Gate].[Instruments:Quotes] T
    USING
    (
      SELECT
        @TradeDateTime,
        V.[TradeBoard_Id],
        V.[Instrument_Id],
        V.[QuoteType_Id],
        V.[Currency],
        V.[Value],
        V.[LastUpdateTime]
      FROM @Quotes V
      WHERE [IsEqual] IS NULL
    ) AS S ([TradeDateTime], [TradeBoard_Id], [Instrument_Id], [QuoteType_Id], [Currency], [Value], [LastUpdateTime])
    ON T.[TradeDateTime] = S.[TradeDateTime] AND T.[Instrument_Id] = S.[Instrument_Id] AND T.[TradeBoard_Id] = S.[TradeBoard_Id] AND T.[QuoteType_Id] = S.[QuoteType_Id]
    WHEN MATCHED AND S.[LastUpdateTime] >= T.[LastUpdateTime] THEN
      UPDATE SET
        [TradeDateTime]  = S.[TradeDateTime],
        [TradeBoard_Id]  = S.[TradeBoard_Id],
        [Instrument_Id]  = S.[Instrument_Id],
        [QuoteType_Id]   = S.[QuoteType_Id],
        [Currency]       = S.[Currency],
        [Value]          = S.[Value],
        [LastUpdateTime] = S.[LastUpdateTime]
    WHEN NOT MATCHED THEN
      INSERT ([TradeDateTime], [TradeBoard_Id], [Instrument_Id], [QuoteType_Id], [Currency], [Value], [LastUpdateTime])
      VALUES (S.[TradeDateTime], S.[TradeBoard_Id], S.[Instrument_Id], S.[QuoteType_Id], S.[Currency], S.[Value], S.[LastUpdateTime]);

    -- [Gate].[Instruments:Quotes:Trade Dates] --  
    --   
    MERGE [Gate].[Instruments:Quotes:Trade Dates] T
    USING
    (
      SELECT
        @TradeDate,
        V.[TradeBoard_Id],
        V.[Instrument_Id],
        V.[QuoteType_Id],
        V.[Currency],
        V.[Value],
        V.[LastUpdateTime]
      FROM @Quotes V
      WHERE V.[Instrument_Id] IS NOT NULL
    ) AS S ([TradeDate], [TradeBoard_Id], [Instrument_Id], [QuoteType_Id], [Currency], [Value], [LastUpdateTime])
    ON T.[Instrument_Id] = S.[Instrument_Id] AND T.[TradeDate] = S.[TradeDate] AND T.[TradeBoard_Id] = S.[TradeBoard_Id] AND T.[QuoteType_Id] = S.[QuoteType_Id]
    WHEN MATCHED AND S.[LastUpdateTime] >= T.[LastUpdateTime] AND S.[Value] IS NOT NULL THEN
      UPDATE SET
        [TradeDate]      = S.[TradeDate],
        [TradeBoard_Id]  = S.[TradeBoard_Id],
        [Instrument_Id]  = S.[Instrument_Id],
        [QuoteType_Id]   = S.[QuoteType_Id],
        [Currency]       = S.[Currency],
        [Value]          = S.[Value],
        [LastUpdateTime] = S.[LastUpdateTime]
    WHEN MATCHED AND S.[LastUpdateTime] >= T.[LastUpdateTime] AND S.[Value] IS NULL THEN
      DELETE
    WHEN NOT MATCHED AND S.[Value] IS NOT NULL THEN
      INSERT ([TradeDate], [TradeBoard_Id], [Instrument_Id], [QuoteType_Id], [Currency], [Value], [LastUpdateTime])
      VALUES (S.[TradeDate], S.[TradeBoard_Id], S.[Instrument_Id], S.[QuoteType_Id], S.[Currency], S.[Value], S.[LastUpdateTime]);

    -- [Gate].[Instruments:Current Quotes] -- 
    --   
    MERGE [Gate].[Instruments:Current Quotes] T
    USING
    (
      SELECT
        V.[TradeBoard_Id],
        V.[Instrument_Id],
        V.[QuoteType_Id],
        V.[Currency],
        V.[Value],
        @TradeDate + Cast(V.[LastUpdateTime] AS DateTime)
      FROM @Quotes V
      WHERE V.[Instrument_Id] IS NOT NULL
    ) AS S ([TradeBoard_Id], [Instrument_Id], [QuoteType_Id], [Currency], [Value], [LastUpdateDateTime])
    ON T.[Instrument_Id] = S.[Instrument_Id] AND T.[TradeBoard_Id] = S.[TradeBoard_Id] AND T.[QuoteType_Id] = S.[QuoteType_Id]
    WHEN MATCHED AND S.[LastUpdateDateTime] >= T.[LastUpdateDateTime] AND S.[Value] IS NOT NULL THEN
      UPDATE SET
        [TradeBoard_Id]      = S.[TradeBoard_Id],
        [Instrument_Id]      = S.[Instrument_Id],
        [QuoteType_Id]       = S.[QuoteType_Id],
        [Currency]           = S.[Currency],
        [Value]              = S.[Value],
        [LastUpdateDateTime] = S.[LastUpdateDateTime]
    WHEN MATCHED AND S.[LastUpdateDateTime] >= T.[LastUpdateDateTime] AND S.[Value] IS NULL THEN
      DELETE
    WHEN NOT MATCHED AND S.[Value] IS NOT NULL THEN
      INSERT ([TradeBoard_Id], [Instrument_Id], [QuoteType_Id], [Currency], [Value], [LastUpdateDateTime])
      VALUES (S.[TradeBoard_Id], S.[Instrument_Id], S.[QuoteType_Id], S.[Currency], S.[Value], S.[LastUpdateDateTime]);

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [MICEX-SM].[Instruments::Quotes::Modify::McxSECURITIES]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--
--   [Instruments::Quotes::Modify]     VBS  MicexGate
--
CREATE PROCEDURE [MICEX-SM].[Instruments::Quotes::Modify::McxSECURITIES]
  @SECBOARD varchar(4), @SECCODE varchar(12), @SECNAME varchar(30), @REMARKS varchar(8), @SHORTNAME varchar(10), @STATUS varchar(1), @TRADINGSTATUS varchar(1),
  @MARKETCODE varchar(4), @INSTRID varchar(4), @LOTSIZE Numeric(28,0), @MINSTEP Numeric(28,9), @FACEVALUE Numeric(28,9), @FACEUNIT varchar(4), @PREVDATE datetime,
  @PREVPRICE Numeric(28,9), @DECIMALS Numeric(28,0), @YIELD Numeric(28,9), @ACCRUEDINT Numeric(28,9), @PRIMARYDIST varchar(1), @MATDATE datetime,
  @COUPONVALUE Numeric(28,9), @COUPONPERIOD Numeric(28,0), @NEXTCOUPON datetime, @ISSUESIZE Numeric(28,0), @PREVWAPRICE Numeric(28,9),
  @YIELDATPREVWAPRICE Numeric(28,9), @REPO2PRICE Numeric(28,9), @CURRENCYID varchar(4), @BUYBACKPRICE Numeric(28,9), @BUYBACKDATE datetime, @AGENTID varchar(12),
  @QUOTEBASIS varchar(1), @ISIN varchar(12), @LATNAME varchar(30), @REGNUMBER varchar(20), @PREVLEGALCLOSEPRICE Numeric(28,9), @PREVADMITTEDQUOTE Numeric(28,9),
  @SECTYPE varchar(1), @ACTIVATIONDATE datetime, @PREVLOTSIZE Numeric(28,0), @LOTSIZECHANGEDATE datetime, @ORIGINTRADINGSTATUS varchar(1),
  @ISSUESIZEPLACED Numeric(28,0), @FULLCOVEREDFLAG varchar(1), @ASSET varchar(12), @LISTLEVEL Numeric(28,0), @COMMENTS varchar(128), @DIVIDENDVALUE Numeric(28,9),
  @DIVIDENDDATE datetime, @BID Numeric(28,9), @BIDDEPTH Numeric(28,0), @BIDDEPTHT Numeric(28,0), @NUMBIDS Numeric(28,0), @OFFER Numeric(28,9),
  @OFFERDEPTH Numeric(28,0), @OFFERDEPTHT Numeric(28,0), @NUMOFFERS Numeric(28,0), @OPEN Numeric(28,9), @HIGH Numeric(28,9), @LOW Numeric(28,9),
  @LAST Numeric(28,9), @CHANGE Numeric(28,9), @QTY Numeric(28,0), @TIME varchar(10), @VOLTODAY Numeric(28,0), @VALTODAY Numeric(28,0), @VALUE Numeric(28,9),
  @WAPRICE Numeric(28,9), @HIGHBID Numeric(28,9), @LOWOFFER Numeric(28,9), @NUMTRADES Numeric(28,0), @YIELDATWAPRICE Numeric(28,9),
  @PRICEMINUSPREVWAPRICE Numeric(28,9), @CLOSEPRICE Numeric(28,9), @CLOSEYIELD Numeric(28,9), @LASTBID Numeric(28,9), @LASTOFFER Numeric(28,9),
  @LASTSETTLECODE varchar(12), @MARKETPRICE Numeric(28,9), @MARKETPRICETODAY Numeric(28,9), @DURATION Numeric(28,9), @SETTLECODE varchar(12),
  @LOPENPRICE Numeric(28,9), @LCURRENTPRICE Numeric(28,9), @LCLOSEPRICE Numeric(28,9), @MARKETPRICE2 Numeric(28,9), @ADMITTEDQUOTE Numeric(28,9),
  @OPENPERIODPRICE Numeric(28,9), @COUNTERPRICE Numeric(28,9), @MIN_CURR_LAST Numeric(28,9), @MIN_CURR_LAST_TIME varchar(10), @CLOSING_AUCTION_PRICE Numeric(28,9),
  @CLOSING_AUCTION_VOLUME Numeric(28,0), @DPVALINDICATORBUY varchar(1), @DPVALINDICATORSELL varchar(1), @SETTLEDATE datetime, @NFAPRICE Numeric(28,9),
  @Debug Bit = NULL
---
  WITH EXECUTE AS OWNER
---
AS
BEGIN
	SET NOCOUNT ON

  DECLARE
    @TradeDate  Date,
    @TradeTime  Time,
    @Place_Id   Int

  IF @Debug = 1
    SELECT [@SECCODE] = @SECCODE, [@LAST] = @LAST

  SET @TradeTime = CAST(GETDATE() AS Time)
  SET @TradeDate = CAST(GETDATE() AS Date)
  
  SELECT @Place_Id = [Id]
  FROM [Gate].[Dic:Places] 
  WHERE [Code] = 'MICEX:S'

  IF NOT EXISTS(SELECT TOP (1) 1 FROM [Gate].[Dic:Places:Trade Boards] WHERE [Code] = @SECBOARD AND [Place_Id] = @Place_Id)
    INSERT INTO [Gate].[Dic:Places:Trade Boards] ([Place_Id], [Code]) VALUES (@Place_Id, @SECBOARD)

  EXEC [MICEX-SM].[Instruments::Quotes::Modify]
    @ClassCode            = @SECBOARD,
    @SecCode              = @SECCODE,
    @TradeDate            = @TradeDate,
    @MatDate              = @MATDATE,
    @accruedint           = @ACCRUEDINT,
    @bid                  = @BID,
    @biddepth             = @BIDDEPTH,
    @biddeptht            = @BIDDEPTHT,
    @buydepo              = NULL,
    @buyprofit            = NULL,
    @change               = @CHANGE,
    @changetime           = NULL,
    @chngclose            = NULL,
    @chngopen             = NULL,
    @closeprice           = @CLOSEPRICE,
    @closetime            = NULL,
    @closeval             = NULL,
    @closeyield           = @CLOSEYIELD,
    @couponvalue          = NULL,
    @currentvalue         = NULL,
    @curval               = NULL,
    @facevalue            = @FACEVALUE,
    @high                 = @HIGH,
    @highbid              = @HIGHBID,
    @last                 = @LAST,
    @lastchange           = @CHANGE,
    @lasttoprevstlprc     = NULL,
    @lastvalue            = NULL,
    @lotsize              = @LOTSIZE,
    @low                  = @LOW,
    @lowoffer             = @LOWOFFER,
    @marketprice          = @MARKETPRICE,
    @marketpricetoday     = @MARKETPRICETODAY,
    @maxoutvolume         = NULL,
    @negnumtrades         = NULL,
    @negvaltoday          = NULL,
    @numbids              = @NUMBIDS,
    @numcontracts         = NULL,
    @numoffers            = @NUMOFFERS,
    @numtrades            = @NUMTRADES,
    @offer                = @OFFER,
    @offerdepth           = @OFFERDEPTH,
    @offerdeptht          = @OFFERDEPTHT,
    @open                 = @OPEN,
    @openval              = NULL,
    @optionbase           = NULL,
    @optiontype           = NULL,
    @prevprice            = @PREVPRICE,
    @prevsettlprice       = NULL,
    @prevwaprice          = NULL,
    @pricemax             = NULL,
    @pricemin             = NULL,
    @priceminusprevwa     = NULL,
    @pricemvtlimit        = NULL,
    @pricemvtlimitt1      = NULL,
    @primarydist          = NULL,
    @qty                  = @QTY,
    @qty_pcs              = NULL,
    @selldepo             = NULL,
    @sellprofit           = NULL,
    @status               = @STATUS,
    @steppricet           = NULL,
    @stepprice            = NULL,
    @time                 = @TradeTime,
    @theorprice           = NULL,
    @tradechange          = NULL,
    @tradingstatus        = @TRADINGSTATUS,
    @valtoday             = NULL,
    @value                = NULL,
    @volatility           = NULL,
    @voltoday             = NULL,
    @waprice              = NULL,
    @yield                = @YIELD,
    @yieldatprevwapri     = NULL,
    @yieldatwaprice       = NULL,
    @bgonp                = NULL,
    @bgop                 = NULL,
    @highval              = NULL,
    @ichange              = NULL,
    @iopen                = NULL,
    @lowval               = NULL,
    @pchange              = NULL,
    @quantity             = NULL,
    @settleprice          = NULL,
    @strike               = NULL,
    @Scale                = NULL,
    @DaysToMatDate        = NULL,
    @nextcoupon           = NULL,
    @FaceUnit             = @FACEUNIT,
    @admittedquote        = NULL,
    @issuesize            = NULL,
    @prevdate             = NULL,
    @lopenprice           = NULL,
    @lcurrentprice        = NULL,
    @quotebasis           = @QUOTEBASIS,
    @couponperiod         = NULL,
    @buybackprice         = NULL,
    @buybackdate          = NULL,
    @duration             = NULL,
    @baseprice            = NULL,
    @clprice              = NULL,
    @clstate              = NULL,
    @counterprice         = NULL,
    @crossrate            = NULL,
    @curstepprice         = NULL,
    @endtime              = NULL,
    @evnendtime           = NULL,
    @evnstarttime         = NULL,
    @expdate              = NULL,
    @ispercent            = NULL,
    @lastbid              = NULL,
    @lastoffer            = NULL,
    @lcloseprice          = NULL,
    @marg                 = NULL,
    @marketprice2         = NULL,
    @min_curr_last        = NULL,
    @monendtime           = NULL,
    @monstarttime         = NULL,
    @openperiodprice      = NULL,
    @percentrate          = NULL,
    @prevadmittedquot     = NULL,
    @prevlegalclosepr     = NULL,
    @realvmprice          = NULL,
    @sectype              = NULL,
    @starttime            = NULL,
    @settlecode           = NULL,
    @steppricecl          = NULL,
    @steppriceprcl        = NULL,
    @min_curr_last_ti     = NULL,
    @prevlotsize          = NULL,
    @lotsizechangedat     = NULL,
    @CurrencyId           = @CURRENCYID,

    @Debug                = @Debug

END

GO
/****** Object:  StoredProcedure [Quik].[Deals::Active::Modify]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Deals::Active::Modify]
  @TradeNum             Decimal(19,0),
  @TradeDate            DateTime,
  @ClassCode            VarChar(12),
  @Operation            VarChar(20),
  @Accruedint           Decimal(19,4),
  @CPReportNum          Decimal(19,0),
  @Price                Decimal(19,6),
  @Price1               Decimal(19,6),
  @Price2               Decimal(19,6),
  @RepoRate             Decimal(19,4),
  @RepoTradeNum         Decimal(19,0),
  @Value                Decimal(19,4),
  @Amount               Decimal(19,4),
  @ExpectedRepo2Value   Decimal(19,4),
  @ExpectedRepoValue    Decimal(19,4),
  @ExpectedReturnValue  Decimal(19,4),
  @Repo2Value           Decimal(19,4),
  @RepoValue            Decimal(19,4),
  @ReturnValue          Decimal(19,4),
  @TSCommission         Decimal(19,4),
  @Discount             Decimal(19,4),
  @ExpectedDiscount     Decimal(19,6),
  @LowerDiscount        Decimal(19,6),
  @UpperDiscount        Decimal(19,6),
  @Qty                  Decimal(10,0),
  @SettleDate           DateTime,
  @UsTradeDate          DateTime,
  @Balance              Int,
  @ExpectedQuantity     Int,
  @SettleTime           DateTime,
  @ReportTradeDate      DateTime,
  @BlockSecurities      VarChar(3),
  @OperationType        VarChar(12),
  @RepoTerm             SmallInt,
  @Type                 VarChar(64),
  @UrgencyFlags         VarChar(64),
  @Account              VarChar(12),
  @BrokerRef            VarChar(20),
  @CPAccount            VarChar(12),
  @CPFirmId             VarChar(12),
  @FirmId               VarChar(12),
  @FirmName             VarChar(30),
  @SettleCode           VarChar(12),
  @ClientCode           VarChar(12),
  @DealState            VarChar(20),
  @ReportNum            Decimal(19,0),
  @ClassName            VarChar(255),
  @SecName              VarChar(255),
  @SecCode              VarChar(12),
  @Settled              VarChar(32),
  @ClearingType         VarChar(32),
  @ReportComission      Decimal(19,4),
  @CouponPayment        Decimal(19,4),
  @CouponPaymentDate    DateTime,
  @PrincipalPayment     Decimal(19,4),
  @PrincipalPaymentDate DateTime,
  @OrderNum             Decimal(19,0),
  @SettleCurrency       VarChar(5),
  @Source_Id            TinyInt
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Ignore                     Bit,
    @Id                         Int,
    @TradeBoard_Id              Int,
    @PartnerTradeParticipant_Id Int,
    @PartnerTradeAccount_Id     Int,
    @RepoDeal_Id                Int,
    @OperationTypeValue         Char(1),
    @ExecuteSign                Bit,
    @Status                     Char(1),
    @SettleStatus               Char(1),
    @ClearingTypeValue          Char(1)

  BEGIN TRY
    IF @TradeDate IS NULL
      RaisError('   @TradeDate', 16, 2)  

    IF @TradeNum IS NULL
      RaisError('   @TradeNum', 16, 2)  

    IF @ClassCode IS NULL
      RaisError('   @ClassCode', 16, 2) 

    IF @Operation IS NULL
      RaisError('   @Operation', 16, 2) 
 
    IF @Source_Id IS NULL
      RaisError('   ', 16, 2)   
                              
    SET @OperationTypeValue = [Quik].[Deal::Value::To OperationType](@OperationType)

    IF @OperationType IS NOT NULL AND @OperationTypeValue IS NULL
      RaisError('   @OperationType', 16, 2) 
  
    SET @ExecuteSign = [Quik].[Value::To Bit](@UrgencyFlags)

    IF @UrgencyFlags IS NOT NULL AND @ExecuteSign IS NULL
      RaisError('   @UrgencyFlags', 16, 2) 
  
    SET @Status = [Quik].[Deal::Active::Value::To Status](@DealState)

    IF @DealState IS NOT NULL AND @Status IS NULL
      RaisError('   @DealState', 16, 2) 
  
    SET @SettleStatus = [Quik].[Deal::Active::Value::To SettleStatus](@Settled)

    IF @Settled IS NOT NULL AND @SettleStatus IS NULL
      RaisError('   @Settled', 16, 2) 
      
    SET @ClearingTypeValue = [Quik].[Deal::Value::To ClearingType](@ClearingType)

    SELECT
      @TradeBoard_Id = [TradeBoard_Id],
      @Ignore        = [Ignore]
    FROM [Quik].[Dic:Places:Trade Boards]
    WHERE [Code] = @ClassCode
      AND [Source_Id] = @Source_Id

    IF @Ignore = 1 --     
      RETURN 1

    SELECT
      @PartnerTradeParticipant_Id = QT.[TradeParticipant_Id]
    FROM [Quik].[Places:Trade Participants] QT
    INNER JOIN [Gate].[Places:Trade Participants] GT ON GT.[Id] = QT.[TradeParticipant_Id]
    INNER JOIN [Gate].[Dic:Places:Trade Boards] GB ON GB.[Place_Id] = GT.[Place_Id]
    WHERE QT.[Code] = @CPFirmId    
      AND QT.[Source_Id] = @Source_Id
      AND GB.[Id] = @TradeBoard_Id

    SELECT
      @PartnerTradeAccount_Id = [Id]
    FROM [Gate].[Trade Accounts]
    WHERE [Code] = @CPAccount
      AND [Source_Id] = @Source_Id
      AND [TradeParticipant_Id] = @PartnerTradeParticipant_Id
      
    SELECT
      @RepoDeal_Id = [Id]
    FROM [Gate].[Deals]
    WHERE [Number] = @RepoTradeNum
      AND [Source_Id] = @Source_Id
      AND ([TradeBoard_Id] = @TradeBoard_Id OR [TradeBoardCode] = @ClassCode)  
      
    EXEC [Quik].[Deals::Modify]
      @TradeNum            = @TradeNum,
      @Operation           = @Operation,
      @ClassCode           = @ClassCode,
      @TradeDate           = @TradeDate,
      @SecCode             = @SecCode,
      @Accruedint          = @Accruedint,
      @Accruedint2         = NULL,
      @LowerDiscount       = @LowerDiscount,
      @OrderNum            = @OrderNum,
      @Price               = @Price,
      @Price2              = @Price2,
      @RepoRate            = @RepoRate,
      @RepoValue           = @RepoValue,
      @Repo2Value          = @Repo2Value,
      @StartDiscount       = NULL,
      @TSCommission        = @TSCommission,
      @UpperDiscount       = @UpperDiscount,
      @Value               = @Value,
      @Yield               = NULL,
      @Qty                 = @Qty,
      @TradeTime           = '00:00:00',
      @BlockSecurities     = @BlockSecurities,
      @RepoTerm            = @RepoTerm,
      @ClearingComission   = NULL,
      @ExchangeComission   = NULL,
      @TechCenterComission = NULL,
      @Account             = @Account,
      @BrokerRef           = @BrokerRef,
      @ClientCode          = @ClientCode,
      @SettleCode          = @SettleCode,
      @UserId              = NULL,
      @ExchangeCode        = NULL,
      @Type                = @Type,
      @FirmId              = @FirmId,
      @FirmName            = @FirmName,
      @CPFirmId            = @CPFirmId,
      @CPFirmName          = NULL,
      @Margin              = NULL,
      @ClassName           = @ClassName,
      @SecName             = @SecName,
      @SettleDate          = @SettleDate,
      @SettleCurrency      = @SettleCurrency,
      @TradeCurrency       = NULL,
      @StationId           = NULL,
      @Period              = NULL,
      @TradeTimeMs         = NULL,
      @Kind                = NULL,
      @BankAccId           = NULL,
      @LinkedTrade         = NULL,
      @Source_Id           = @Source_Id,
      @Id                  = @Id OUTPUT

    MERGE [Gate].[Deals:Active] T
    USING
    (
      SELECT
        @Id,
        @CPReportNum,
        @Price1,
        @RepoDeal_Id,
        CASE WHEN @RepoDeal_Id IS NULL THEN @RepoTradeNum END,
        @Amount,
        @ExpectedRepo2Value,
        @ExpectedRepoValue,
        @ExpectedReturnValue,
        @ReturnValue,
        @Discount,
        @ExpectedDiscount,
        @UsTradeDate,
        @Balance,
        @ExpectedQuantity,
        @ReportTradeDate,
        @OperationTypeValue,
        @ExecuteSign,
        @PartnerTradeAccount_Id,
        CASE WHEN @PartnerTradeAccount_Id IS NULL THEN @CPAccount END,
        @Status,
        @ReportNum,
        @SettleStatus,
        @ClearingTypeValue,
        @ReportComission,
        @CouponPayment,
        @CouponPaymentDate,
        @PrincipalPayment,
        @PrincipalPaymentDate
    ) AS S ([Id], [PartnerReportNumber], [Price1], [RepoDeal_Id], [RepoDealNumber], [Amount], [ExpectedRepo2Value], [ExpectedRepoValue],
            [ExpectedReturnValue], [ReturnRepoValue], [Discount], [ExpectedDiscount], [DealDate], [Balance], [ExpectedQuantity],
            [ReportDealDate], [OperationType], [ExecuteSign], [PartnerTradeAccount_Id], [PartnerTradeAccountCode], [Status], [ReportNumber],
            [SettleStatus], [ClearingType], [ReportComission], [CouponPayment], [CouponPaymentDate], [PrincipalPayment], [PrincipalPaymentDate])
    ON T.[Id] = S.[Id]
    WHEN MATCHED THEN
      UPDATE SET
        [PartnerReportNumber]     = S.[PartnerReportNumber],
        [Price1]                  = S.[Price1],
        [RepoDeal_Id]             = S.[RepoDeal_Id],
        [RepoDealNumber]          = S.[RepoDealNumber],
        [Amount]                  = S.[Amount],
        [ExpectedRepo2Value]      = S.[ExpectedRepo2Value],
        [ExpectedRepoValue]       = S.[ExpectedRepoValue],
        [ExpectedReturnValue]     = S.[ExpectedReturnValue],
        [ReturnRepoValue]         = S.[ReturnRepoValue],
        [Discount]                = S.[Discount],
        [ExpectedDiscount]        = S.[ExpectedDiscount],
        [DealDate]                = S.[DealDate],
        [Balance]                 = S.[Balance],
        [ExpectedQuantity]        = S.[ExpectedQuantity],
        [ReportDealDate]          = S.[ReportDealDate],
        [OperationType]           = S.[OperationType],
        [ExecuteSign]             = S.[ExecuteSign],
        [PartnerTradeAccount_Id]  = S.[PartnerTradeAccount_Id],
        [PartnerTradeAccountCode] = S.[PartnerTradeAccountCode],
        [Status]                  = S.[Status],
        [ReportNumber]            = S.[ReportNumber],
        [SettleStatus]            = S.[SettleStatus],
        [ClearingType]            = S.[ClearingType],
        [ReportComission]         = S.[ReportComission],
        [CouponPayment]           = S.[CouponPayment],
        [CouponPaymentDate]       = S.[CouponPaymentDate],
        [PrincipalPayment]        = S.[PrincipalPayment],
        [PrincipalPaymentDate]    = S.[PrincipalPaymentDate]
    WHEN NOT MATCHED THEN 
      INSERT ([Id], [PartnerReportNumber], [Price1], [RepoDeal_Id], [RepoDealNumber], [Amount], [ExpectedRepo2Value], [ExpectedRepoValue],
              [ExpectedReturnValue], [ReturnRepoValue], [Discount], [ExpectedDiscount], [DealDate], [Balance], [ExpectedQuantity],
              [ReportDealDate], [OperationType], [ExecuteSign], [PartnerTradeAccount_Id], [PartnerTradeAccountCode], [Status], [ReportNumber],
              [SettleStatus], [ClearingType], [ReportComission], [CouponPayment], [CouponPaymentDate], [PrincipalPayment], [PrincipalPaymentDate])
      VALUES (S.[Id], S.[PartnerReportNumber], S.[Price1], S.[RepoDeal_Id], S.[RepoDealNumber], S.[Amount], S.[ExpectedRepo2Value], S.[ExpectedRepoValue],
              S.[ExpectedReturnValue], S.[ReturnRepoValue], S.[Discount], S.[ExpectedDiscount], S.[DealDate], S.[Balance], S.[ExpectedQuantity],
              S.[ReportDealDate], S.[OperationType], S.[ExecuteSign], S.[PartnerTradeAccount_Id], S.[PartnerTradeAccountCode], S.[Status], S.[ReportNumber],
              S.[SettleStatus], S.[ClearingType], S.[ReportComission], S.[CouponPayment], S.[CouponPaymentDate], S.[PrincipalPayment], S.[PrincipalPaymentDate]);  

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [Quik].[Deals::Active::Modify#Aton]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Deals::Active::Modify#Aton]
  @TradeNum             Decimal(19,0),
  @TradeDate            DateTime,
  @ClassCode            VarChar(12),
  @Operation            VarChar(20),
  @Accruedint           Decimal(19,4),
  @CPReportNum          Decimal(19,0),
  @Price                Decimal(19,6),
  @Price1               Decimal(19,6),
  @Price2               Decimal(19,6),
  @RepoRate             Decimal(19,4),
  @RepoTradeNum         Decimal(19,0),
  @Value                Decimal(19,4),
  @Amount               Decimal(19,4),
  @ExpectedRepo2Value   Decimal(19,4),
  @ExpectedRepoValue    Decimal(19,4),
  @ExpectedReturnValue  Decimal(19,4),
  @Repo2Value           Decimal(19,4),
  @RepoValue            Decimal(19,4),
  @ReturnValue          Decimal(19,4),
  @TSCommission         Decimal(19,4),
  @Discount             Decimal(19,4),
  @ExpectedDiscount     Decimal(19,6),
  @LowerDiscount        Decimal(19,6),
  @UpperDiscount        Decimal(19,6),
  @Qty                  Decimal(10,0),
  @SettleDate           DateTime,
  @UsTradeDate          DateTime,
  @Balance              Int,
  @ExpectedQuantity     Int,
  @SettleTime           DateTime,
  @ReportTradeDate      DateTime,
  @BlockSecurities      VarChar(3),
  @OperationType        VarChar(12),
  @RepoTerm             SmallInt,
  @Type                 VarChar(64),
  @UrgencyFlags         VarChar(64),
  @Account              VarChar(12),
  @BrokerRef            VarChar(20),
  @CPAccount            VarChar(12),
  @CPFirmId             VarChar(12),
  @FirmId               VarChar(12),
  @FirmName             VarChar(30),
  @SettleCode           VarChar(12),
  @ClientCode           VarChar(12),
  @DealState            VarChar(20),
  @ReportNum            Decimal(19,0),
  @ClassName            VarChar(255),
  @SecName              VarChar(255),
  @SecCode              VarChar(12),
  @Settled              VarChar(32),
  @ClearingType         VarChar(32),
  @ReportComission      Decimal(19,4),
  @CouponPayment        Decimal(19,4),
  @CouponPaymentDate    DateTime,
  @PrincipalPayment     Decimal(19,4),
  @PrincipalPaymentDate DateTime,
  @OrderNum             Decimal(19,0),
  @SettleCurrency       VarChar(5)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 1 -- Aton

  EXEC [Quik].[Deals::Active::Modify]
    @TradeNum             = @TradeNum,
    @TradeDate            = @TradeDate,
    @ClassCode            = @ClassCode,
    @Operation            = @Operation,
    @Accruedint           = @Accruedint,
    @CPReportNum          = @CPReportNum,
    @Price                = @Price,
    @Price1               = @Price1,
    @Price2               = @Price2,
    @RepoRate             = @RepoRate,
    @RepoTradeNum         = @RepoTradeNum,
    @Value                = @Value,
    @Amount               = @Amount,
    @ExpectedRepo2Value   = @ExpectedRepo2Value,
    @ExpectedRepoValue    = @ExpectedRepoValue,
    @ExpectedReturnValue  = @ExpectedReturnValue,
    @Repo2Value           = @Repo2Value,
    @RepoValue            = @RepoValue,
    @ReturnValue          = @ReturnValue,
    @TSCommission         = @TSCommission,
    @Discount             = @Discount,
    @ExpectedDiscount     = @ExpectedDiscount,
    @LowerDiscount        = @LowerDiscount,
    @UpperDiscount        = @UpperDiscount,
    @Qty                  = @Qty,
    @SettleDate           = @SettleDate,
    @UsTradeDate          = @UsTradeDate,
    @Balance              = @Balance,
    @ExpectedQuantity     = @ExpectedQuantity,
    @SettleTime           = @SettleTime,
    @ReportTradeDate      = @ReportTradeDate,
    @BlockSecurities      = @BlockSecurities,
    @OperationType        = @OperationType,
    @RepoTerm             = @RepoTerm,
    @Type                 = @Type,
    @UrgencyFlags         = @UrgencyFlags,
    @Account              = @Account,
    @BrokerRef            = @BrokerRef,
    @CPAccount            = @CPAccount,
    @CPFirmId             = @CPFirmId,
    @FirmId               = @FirmId,
    @FirmName             = @FirmName,
    @SettleCode           = @SettleCode,
    @ClientCode           = @ClientCode,
    @DealState            = @DealState,
    @ReportNum            = @ReportNum,
    @ClassName            = @ClassName,
    @SecName              = @SecName,
    @SecCode              = @SecCode,
    @Settled              = @Settled,
    @ClearingType         = @ClearingType,
    @ReportComission      = @ReportComission,
    @CouponPayment        = @CouponPayment,
    @CouponPaymentDate    = @CouponPaymentDate,
    @PrincipalPayment     = @PrincipalPayment,
    @PrincipalPaymentDate = @PrincipalPaymentDate,
    @OrderNum             = @OrderNum,
    @SettleCurrency       = @SettleCurrency,
    @Source_Id            = @Source_Id
    
  RETURN 1  

GO
/****** Object:  StoredProcedure [Quik].[Deals::Active::Modify#OSL]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Deals::Active::Modify#OSL]
  @TradeNum             Decimal(19,0),
  @TradeDate            DateTime,
  @ClassCode            VarChar(12),
  @Operation            VarChar(20),
  @Accruedint           Decimal(19,4),
  @CPReportNum          Decimal(19,0),
  @Price                Decimal(19,6),
  @Price1               Decimal(19,6),
  @Price2               Decimal(19,6),
  @RepoRate             Decimal(19,4),
  @RepoTradeNum         Decimal(19,0),
  @Value                Decimal(19,4),
  @Amount               Decimal(19,4),
  @ExpectedRepo2Value   Decimal(19,4),
  @ExpectedRepoValue    Decimal(19,4),
  @ExpectedReturnValue  Decimal(19,4),
  @Repo2Value           Decimal(19,4),
  @RepoValue            Decimal(19,4),
  @ReturnValue          Decimal(19,4),
  @TSCommission         Decimal(19,4),
  @Discount             Decimal(19,4),
  @ExpectedDiscount     Decimal(19,6),
  @LowerDiscount        Decimal(19,6),
  @UpperDiscount        Decimal(19,6),
  @Qty                  Decimal(10,0),
  @SettleDate           DateTime,
  @UsTradeDate          DateTime,
  @Balance              Int,
  @ExpectedQuantity     Int,
  @SettleTime           DateTime,
  @ReportTradeDate      DateTime,
  @BlockSecurities      VarChar(3),
  @OperationType        VarChar(12),
  @RepoTerm             SmallInt,
  @Type                 VarChar(64),
  @UrgencyFlags         VarChar(64),
  @Account              VarChar(12),
  @BrokerRef            VarChar(20),
  @CPAccount            VarChar(12),
  @CPFirmId             VarChar(12),
  @FirmId               VarChar(12),
  @FirmName             VarChar(30),
  @SettleCode           VarChar(12),
  @ClientCode           VarChar(12),
  @DealState            VarChar(20),
  @ReportNum            Decimal(19,0),
  @ClassName            VarChar(255),
  @SecName              VarChar(255),
  @SecCode              VarChar(12),
  @Settled              VarChar(32),
  @ClearingType         VarChar(32),
  @ReportComission      Decimal(19,4),
  @CouponPayment        Decimal(19,4),
  @CouponPaymentDate    DateTime,
  @PrincipalPayment     Decimal(19,4),
  @PrincipalPaymentDate DateTime,
  @OrderNum             Decimal(19,0),
  @SettleCurrency       VarChar(5)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 3 -- 

  EXEC [Quik].[Deals::Active::Modify]
    @TradeNum             = @TradeNum,
    @TradeDate            = @TradeDate,
    @ClassCode            = @ClassCode,
    @Operation            = @Operation,
    @Accruedint           = @Accruedint,
    @CPReportNum          = @CPReportNum,
    @Price                = @Price,
    @Price1               = @Price1,
    @Price2               = @Price2,
    @RepoRate             = @RepoRate,
    @RepoTradeNum         = @RepoTradeNum,
    @Value                = @Value,
    @Amount               = @Amount,
    @ExpectedRepo2Value   = @ExpectedRepo2Value,
    @ExpectedRepoValue    = @ExpectedRepoValue,
    @ExpectedReturnValue  = @ExpectedReturnValue,
    @Repo2Value           = @Repo2Value,
    @RepoValue            = @RepoValue,
    @ReturnValue          = @ReturnValue,
    @TSCommission         = @TSCommission,
    @Discount             = @Discount,
    @ExpectedDiscount     = @ExpectedDiscount,
    @LowerDiscount        = @LowerDiscount,
    @UpperDiscount        = @UpperDiscount,
    @Qty                  = @Qty,
    @SettleDate           = @SettleDate,
    @UsTradeDate          = @UsTradeDate,
    @Balance              = @Balance,
    @ExpectedQuantity     = @ExpectedQuantity,
    @SettleTime           = @SettleTime,
    @ReportTradeDate      = @ReportTradeDate,
    @BlockSecurities      = @BlockSecurities,
    @OperationType        = @OperationType,
    @RepoTerm             = @RepoTerm,
    @Type                 = @Type,
    @UrgencyFlags         = @UrgencyFlags,
    @Account              = @Account,
    @BrokerRef            = @BrokerRef,
    @CPAccount            = @CPAccount,
    @CPFirmId             = @CPFirmId,
    @FirmId               = @FirmId,
    @FirmName             = @FirmName,
    @SettleCode           = @SettleCode,
    @ClientCode           = @ClientCode,
    @DealState            = @DealState,
    @ReportNum            = @ReportNum,
    @ClassName            = @ClassName,
    @SecName              = @SecName,
    @SecCode              = @SecCode,
    @Settled              = @Settled,
    @ClearingType         = @ClearingType,
    @ReportComission      = @ReportComission,
    @CouponPayment        = @CouponPayment,
    @CouponPaymentDate    = @CouponPaymentDate,
    @PrincipalPayment     = @PrincipalPayment,
    @PrincipalPaymentDate = @PrincipalPaymentDate,
    @OrderNum             = @OrderNum,
    @SettleCurrency       = @SettleCurrency,
    @Source_Id            = @Source_Id
    
  RETURN 1  

GO
/****** Object:  StoredProcedure [Quik].[Deals::Modify]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Deals::Modify]
  @TradeNum            Decimal(19, 0),
  @Operation           VarChar(16),
  @ClassCode           VarChar(12),
  @TradeDate           DateTime,
  @SecCode             VarChar(12),
  @Accruedint          Decimal(19, 4),
  @Accruedint2         Decimal(19, 4),
  @LowerDiscount       Decimal(19, 4),
  @OrderNum            Decimal(19, 0),
  @Price               Decimal(19, 6),
  @Price2              Decimal(19, 6),
  @RepoRate            Decimal(19, 4),
  @RepoValue           Decimal(19, 4),
  @Repo2Value          Decimal(19, 4),
  @StartDiscount       Decimal(19, 4),
  @TSCommission        Decimal(19, 4),
  @UpperDiscount       Decimal(19, 4),
  @Value               Decimal(19, 4),
  @Yield               Decimal(19, 4),
  @Qty                 Decimal(19, 0),
  @TradeTime           DateTime,
  @BlockSecurities     VarChar(3),
  @RepoTerm            SmallInt,
  @ClearingComission   Decimal(19, 4),
  @ExchangeComission   Decimal(19, 4),
  @TechCenterComission Decimal(19, 4),
  @Account             VarChar(12),
  @BrokerRef           VarChar(20),
  @ClientCode          VarChar(12),
  @SettleCode          VarChar(16),
  @UserId              VarChar(32),
  @ExchangeCode        VarChar(64),
  @Type                VarChar(30),
  @FirmId              VarChar(12),
  @FirmName            VarChar(30),
  @CPFirmId            VarChar(12),
  @CPFirmName          VarChar(30),
  @Margin              Decimal(19, 6),
  @ClassName           VarChar(255),
  @SecName             VarChar(255),
  @SettleDate          DateTime,
  @SettleCurrency      VarChar(64),
  @TradeCurrency       VarChar(64),
  @StationId           VarChar(64),
  @Period              VarChar(16),
  @TradeTimeMs         Decimal(19, 0),
  @Kind                VarChar(64),
  @BankAccId           VarChar(12),
  @LinkedTrade         Decimal(19, 0),
  @Source_Id           TinyInt,
  @Id                  Int = NULL OUTPUT
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Ignore                     Bit,
    @TradeParticipant_Id        Int,
    @TradeBoard_Id              Int,
    @TradeAccount_Id            Int,
    @Instrument_Id              Int,
    @Order_Id                   Int,
    @PartnerTradeParticipant_Id Int,
    @LinkedDeal_Id              Int,
    @BuySell                    Char(1),
    @SessionPeriod              Char(1)

  BEGIN TRY
    IF @TradeDate IS NULL
      RaisError('   @TradeDate', 16, 2)  

    IF @TradeTime IS NULL
      RaisError('   @TradeTime', 16, 2)  

    IF @TradeNum IS NULL
      RaisError('   @TradeNum', 16, 2)  

    IF @ClassCode IS NULL
      RaisError('   @ClassCode', 16, 2)  
 
    IF @Source_Id IS NULL
      RaisError('   ', 16, 2)        

    SET @SessionPeriod = [Quik].[Order::Value::To Period](@Period)
        
    SET @BuySell       = [Quik].[Order::Value::To BuySell](@Operation)

    IF @Operation IS NOT NULL AND @BuySell IS NULL
      RaisError('   @Operation', 16, 2)

    SELECT
      @TradeBoard_Id = [TradeBoard_Id],
      @Ignore        = [Ignore]
    FROM [Quik].[Dic:Places:Trade Boards]
    WHERE [Code] = @ClassCode
      AND [Source_Id] = @Source_Id

    IF @Ignore = 1 --     
      RETURN 1

    SELECT
      @TradeParticipant_Id = QT.[TradeParticipant_Id]
    FROM [Quik].[Places:Trade Participants] QT
    INNER JOIN [Gate].[Places:Trade Participants] GT ON GT.[Id] = QT.[TradeParticipant_Id]
    INNER JOIN [Gate].[Dic:Places:Trade Boards] GB ON GB.[Place_Id] = GT.[Place_Id]
    WHERE QT.[Code] = @FirmId    
      AND QT.[Source_Id] = @Source_Id
      AND GB.[Id] = @TradeBoard_Id

    SELECT
      @PartnerTradeParticipant_Id = QT.[TradeParticipant_Id]
    FROM [Quik].[Places:Trade Participants] QT
    INNER JOIN [Gate].[Places:Trade Participants] GT ON GT.[Id] = QT.[TradeParticipant_Id]
    INNER JOIN [Gate].[Dic:Places:Trade Boards] GB ON GB.[Place_Id] = GT.[Place_Id]
    WHERE QT.[Code] = @CPFirmId    
      AND QT.[Source_Id] = @Source_Id
      AND GB.[Id] = @TradeBoard_Id

    SELECT
      @TradeAccount_Id = [Id]
    FROM [Gate].[Trade Accounts]
    WHERE [Code] = @Account
      AND [Source_Id] = @Source_Id
      AND [TradeParticipant_Id] = @TradeParticipant_Id

    SELECT
      @Instrument_Id = [Id]
    FROM [Gate].[Instruments]
    WHERE [Code] = @SecCode
      AND [Source_Id] = @Source_Id

    SELECT
      @Order_Id = [Id]
    FROM [Gate].[Orders]
    WHERE [Number] = @OrderNum
      AND [Source_Id] = @Source_Id
      AND ([TradeBoard_Id] = @TradeBoard_Id OR [TradeBoardCode] = @ClassCode)

    SELECT TOP 1
      @LinkedDeal_Id = [Id]
    FROM [Gate].[Deals]
    WHERE [Number] = @LinkedTrade
      AND [Source_Id] = @Source_Id
      AND ([TradeBoard_Id] = @TradeBoard_Id OR [TradeBoardCode] = @ClassCode)     

    MERGE [Gate].[Deals] T
    USING
    (
      SELECT
        @Source_Id,
        @TradeNum,
        @TradeDate + @TradeTime,
        @TradeBoard_Id,
        CASE WHEN @TradeBoard_Id IS NULL THEN @ClassCode END,
        @BuySell,                 
        @Instrument_Id,
        CASE WHEN @Instrument_Id IS NULL THEN @SecCode END,
        @Accruedint,
        @Accruedint2,
        @Order_Id,
        CASE WHEN @Order_Id IS NULL THEN @OrderNum END,
        @Price,
        @Price2,
        @TradeCurrency,
        @RepoRate,
        @RepoTerm,
        @RepoValue, 
        @Repo2Value,
        @StartDiscount,
        @LowerDiscount,
        @UpperDiscount,
        @TSCommission,
        @ClearingComission,
        @ExchangeComission,
        @TechCenterComission,
        @Value,
        @Yield,
        @Qty,
        [Quik].[Value::To Bit](@BlockSecurities),
        @TradeAccount_Id,
        CASE WHEN @TradeAccount_Id IS NULL THEN @Account END,
        @BrokerRef,
        @ClientCode,
        @SettleCode,
        @Type,
        CASE WHEN @TradeParticipant_Id IS NULL THEN @FirmId END,  
        @PartnerTradeParticipant_Id,
        CASE WHEN @PartnerTradeParticipant_Id IS NULL THEN @CPFirmId END,  
        @Margin,
        @SettleDate,
        @SettleCurrency,
        @SessionPeriod,
        @TradeTimeMs,
        @Kind,
        @BankAccId,
        @LinkedDeal_Id,
        CASE WHEN @LinkedDeal_Id IS NULL THEN @LinkedTrade END
    ) AS S ([Source_Id], [Number], [TradeDateTime], [TradeBoard_Id], [TradeBoardCode], [BuySell], [Instrument_Id], [InstrumentCode],
            [Accruedint], [AccruedintRate], [Order_Id], [OrderNumber], [Price], [Price2], [Currency], [RepoRate], [RepoDays],
            [RepoValue], [Repo2Value], [DiscountStart], [DiscountLower], [DiscountUpper], [TradeSystemCommission], [ClearingCommission],
            [ExchangeComission], [TechCenterComission], [Value], [Yield], [Quantity], [BlockSecurities], [TradeAccount_Id],
            [TradeAccountCode], [BrokerRef], [ClientCode], [SettleCode], [Type], [TradeParticipantCode], [PartnerTradeParticipant_Id],
            [PartnerTradeParticipantCode], [Margin], [SettleDate], [SettleCurrency], [Period], [TradeTimeMcs], [Kind], [BankAccount],
            [LinkedDeal_Id], [LinkedDealNumber])
    ON T.[Number] = S.[Number] AND T.[Source_Id] = S.[Source_Id] AND T.[TradeDateTime] = S.[TradeDateTime] AND (T.[TradeBoard_Id] = S.[TradeBoard_Id] OR T.[TradeBoardCode] = S.[TradeBoardCode])
    WHEN MATCHED THEN
      UPDATE SET
        @Id                           = T.[Id],
        [Source_Id]                   = S.[Source_Id],
        [Number]                      = S.[Number],
        [TradeDateTime]               = S.[TradeDateTime],
        [TradeBoard_Id]               = S.[TradeBoard_Id],
        [TradeBoardCode]              = S.[TradeBoardCode],
        [BuySell]                     = S.[BuySell],
        [Instrument_Id]               = S.[Instrument_Id],
        [InstrumentCode]              = S.[InstrumentCode],
        [Accruedint]                  = S.[Accruedint],
        [AccruedintRate]              = S.[AccruedintRate],
        [Order_Id]                    = S.[Order_Id],
        [OrderNumber]                 = S.[OrderNumber],
        [Price]                       = S.[Price],
        [Price2]                      = S.[Price2],
        [Currency]                    = S.[Currency],
        [RepoRate]                    = S.[RepoRate],
        [RepoDays]                    = S.[RepoDays],
        [RepoValue]                   = S.[RepoValue],
        [Repo2Value]                  = S.[Repo2Value],
        [DiscountStart]               = S.[DiscountStart],
        [DiscountLower]               = S.[DiscountLower],
        [DiscountUpper]               = S.[DiscountUpper],
        [TradeSystemCommission]       = S.[TradeSystemCommission],
        [ClearingCommission]          = S.[ClearingCommission],
        [ExchangeComission]           = S.[ExchangeComission],
        [TechCenterComission]         = S.[TechCenterComission],
        [Value]                       = S.[Value],
        [Yield]                       = S.[Yield],
        [Quantity]                    = S.[Quantity],
        [BlockSecurities]             = S.[BlockSecurities],
        [TradeAccount_Id]             = S.[TradeAccount_Id],
        [TradeAccountCode]            = S.[TradeAccountCode],
        [BrokerRef]                   = S.[BrokerRef],
        [ClientCode]                  = S.[ClientCode],
        [SettleCode]                  = S.[SettleCode],
        [Type]                        = S.[Type],
        [TradeParticipantCode]        = S.[TradeParticipantCode],
        [PartnerTradeParticipant_Id]  = S.[PartnerTradeParticipant_Id],
        [PartnerTradeParticipantCode] = S.[PartnerTradeParticipantCode],
        [Margin]                      = S.[Margin],
        [SettleDate]                  = S.[SettleDate],
        [SettleCurrency]              = S.[SettleCurrency],
        [Period]                      = S.[Period],
        [TradeTimeMcs]                = S.[TradeTimeMcs],
        [Kind]                        = S.[Kind],
        [BankAccount]                 = S.[BankAccount],
        [LinkedDeal_Id]               = S.[LinkedDeal_Id],
        [LinkedDealNumber]            = S.[LinkedDealNumber]
    WHEN NOT MATCHED THEN 
      INSERT ([Source_Id], [Number], [TradeDateTime], [TradeBoard_Id], [TradeBoardCode], [BuySell], [Instrument_Id], [InstrumentCode],
              [Accruedint], [AccruedintRate], [Order_Id], [OrderNumber], [Price], [Price2], [Currency], [RepoRate], [RepoDays],
              [RepoValue], [Repo2Value], [DiscountStart], [DiscountLower], [DiscountUpper], [TradeSystemCommission], [ClearingCommission],
              [ExchangeComission], [TechCenterComission], [Value], [Yield], [Quantity], [BlockSecurities], [TradeAccount_Id],
              [TradeAccountCode], [BrokerRef], [ClientCode], [SettleCode], [Type], [TradeParticipantCode], [PartnerTradeParticipant_Id],
              [PartnerTradeParticipantCode], [Margin], [SettleDate], [SettleCurrency], [Period], [TradeTimeMcs], [Kind], [BankAccount],
              [LinkedDeal_Id], [LinkedDealNumber])
      VALUES (S.[Source_Id], S.[Number], S.[TradeDateTime], S.[TradeBoard_Id], S.[TradeBoardCode], S.[BuySell], S.[Instrument_Id], S.[InstrumentCode],
              S.[Accruedint], S.[AccruedintRate], S.[Order_Id], S.[OrderNumber], S.[Price], S.[Price2], S.[Currency], S.[RepoRate], S.[RepoDays],
              S.[RepoValue], S.[Repo2Value], S.[DiscountStart], S.[DiscountLower], S.[DiscountUpper], S.[TradeSystemCommission], S.[ClearingCommission],
              S.[ExchangeComission], S.[TechCenterComission], S.[Value], S.[Yield], S.[Quantity], S.[BlockSecurities], S.[TradeAccount_Id],
              S.[TradeAccountCode], S.[BrokerRef], S.[ClientCode], S.[SettleCode], S.[Type], S.[TradeParticipantCode], S.[PartnerTradeParticipant_Id],
              S.[PartnerTradeParticipantCode], S.[Margin], S.[SettleDate], S.[SettleCurrency], S.[Period], S.[TradeTimeMcs], S.[Kind], S.[BankAccount],
              S.[LinkedDeal_Id], S.[LinkedDealNumber]);

    SET @Id = IsNull(@Id, Scope_Identity())

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID      
  END CATCH

GO
/****** Object:  StoredProcedure [Quik].[Deals::Modify#Aton]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Deals::Modify#Aton]
  @TradeNum            Decimal(19, 0),
  @Operation           VarChar(16),
  @ClassCode           VarChar(12),
  @TradeDate           DateTime,
  @SecCode             VarChar(12),
  @Accruedint          Decimal(19, 4),
  @Accruedint2         Decimal(19, 4),
  @LowerDiscount       Decimal(19, 4),
  @OrderNum            Decimal(19, 0),
  @Price               Decimal(19, 6),
  @Price2              Decimal(19, 6),
  @RepoRate            Decimal(19, 4),
  @RepoValue           Decimal(19, 4),
  @Repo2Value          Decimal(19, 4),
  @StartDiscount       Decimal(19, 4),
  @TSCommission        Decimal(19, 4),
  @UpperDiscount       Decimal(19, 4),
  @Value               Decimal(19, 4),
  @Yield               Decimal(19, 4),
  @Qty                 Decimal(19, 0),
  @TradeTime           DateTime,
  @BlockSecurities     VarChar(3),
  @RepoTerm            SmallInt,
  @ClearingComission   Decimal(19, 4),
  @ExchangeComission   Decimal(19, 4),
  @TechCenterComission Decimal(19, 4),
  @Account             VarChar(12),
  @BrokerRef           VarChar(20),
  @ClientCode          VarChar(12),
  @SettleCode          VarChar(16),
  @UserId              VarChar(32),
  @ExchangeCode        VarChar(64),
  @Type                VarChar(30),
  @FirmId              VarChar(12),
  @FirmName            VarChar(30),
  @CPFirmId            VarChar(12),
  @CPFirmName          VarChar(30),
  @Margin              Decimal(19, 6),
  @ClassName           VarChar(255),
  @SecName             VarChar(255),
  @SettleDate          DateTime,
  @SettleCurrency      VarChar(64),
  @TradeCurrency       VarChar(64),
  @StationId           VarChar(64),
  @Period              VarChar(16),
  @TradeTimeMs         Decimal(19, 0),
  @Kind                VarChar(64),
  @BankAccId           VarChar(12),
  @LinkedTrade         Decimal(19, 0)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 1 -- Aton

  EXEC [Quik].[Deals::Modify]
    @TradeNum            = @TradeNum,
    @Operation           = @Operation,
    @ClassCode           = @ClassCode,
    @TradeDate           = @TradeDate,
    @SecCode             = @SecCode,
    @Accruedint          = @Accruedint,
    @Accruedint2         = @Accruedint2,
    @LowerDiscount       = @LowerDiscount,
    @OrderNum            = @OrderNum,
    @Price               = @Price,
    @Price2              = @Price2,
    @RepoRate            = @RepoRate,
    @RepoValue           = @RepoValue,
    @Repo2Value          = @Repo2Value,
    @StartDiscount       = @StartDiscount,
    @TSCommission        = @TSCommission,
    @UpperDiscount       = @UpperDiscount,
    @Value               = @Value,
    @Yield               = @Yield,
    @Qty                 = @Qty,
    @TradeTime           = @TradeTime,
    @BlockSecurities     = @BlockSecurities,
    @RepoTerm            = @RepoTerm,
    @ClearingComission   = @ClearingComission,
    @ExchangeComission   = @ExchangeComission,
    @TechCenterComission = @TechCenterComission,
    @Account             = @Account,
    @BrokerRef           = @BrokerRef,
    @ClientCode          = @ClientCode,
    @SettleCode          = @SettleCode,
    @UserId              = @UserId,
    @ExchangeCode        = @ExchangeCode,
    @Type                = @Type,
    @FirmId              = @FirmId,
    @FirmName            = @FirmName,
    @CPFirmId            = @CPFirmId,
    @CPFirmName          = @CPFirmName,
    @Margin              = @Margin,
    @ClassName           = @ClassName,
    @SecName             = @SecName,
    @SettleDate          = @SettleDate,
    @SettleCurrency      = @SettleCurrency,
    @TradeCurrency       = @TradeCurrency,
    @StationId           = @StationId,
    @Period              = @Period,
    @TradeTimeMs         = @TradeTimeMs,
    @Kind                = @Kind,
    @BankAccId           = @BankAccId,
    @LinkedTrade         = @LinkedTrade,
    @Source_Id           = @Source_Id

  RETURN 1  

GO
/****** Object:  StoredProcedure [Quik].[Deals::Modify#OSL]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Deals::Modify#OSL]
  @TradeNum            Decimal(19, 0),
  @Operation           VarChar(16),
  @ClassCode           VarChar(12),
  @TradeDate           DateTime,
  @SecCode             VarChar(12),
  @Accruedint          Decimal(19, 4),
  @Accruedint2         Decimal(19, 4),
  @LowerDiscount       Decimal(19, 4),
  @OrderNum            Decimal(19, 0),
  @Price               Decimal(19, 6),
  @Price2              Decimal(19, 6),
  @RepoRate            Decimal(19, 4),
  @RepoValue           Decimal(19, 4),
  @Repo2Value          Decimal(19, 4),
  @StartDiscount       Decimal(19, 4),
  @TSCommission        Decimal(19, 4),
  @UpperDiscount       Decimal(19, 4),
  @Value               Decimal(19, 4),
  @Yield               Decimal(19, 4),
  @Qty                 Decimal(19, 0),
  @TradeTime           DateTime,
  @BlockSecurities     VarChar(3),
  @RepoTerm            SmallInt,
  @ClearingComission   Decimal(19, 4),
  @ExchangeComission   Decimal(19, 4),
  @TechCenterComission Decimal(19, 4),
  @Account             VarChar(12),
  @BrokerRef           VarChar(20),
  @ClientCode          VarChar(12),
  @SettleCode          VarChar(16),
  @UserId              VarChar(32),
  @ExchangeCode        VarChar(64),
  @Type                VarChar(30),
  @FirmId              VarChar(12),
  @FirmName            VarChar(30),
  @CPFirmId            VarChar(12),
  @CPFirmName          VarChar(30),
  @Margin              Decimal(19, 6),
  @ClassName           VarChar(255),
  @SecName             VarChar(255),
  @SettleDate          DateTime,
  @SettleCurrency      VarChar(64),
  @TradeCurrency       VarChar(64),
  @StationId           VarChar(64),
  @Period              VarChar(16),
  @TradeTimeMs         Decimal(19, 0),
  @Kind                VarChar(64),
  @BankAccId           VarChar(12),
  @LinkedTrade         Decimal(19, 0)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 3 -- 

  EXEC [Quik].[Deals::Modify]
    @TradeNum            = @TradeNum,
    @Operation           = @Operation,
    @ClassCode           = @ClassCode,
    @TradeDate           = @TradeDate,
    @SecCode             = @SecCode,
    @Accruedint          = @Accruedint,
    @Accruedint2         = @Accruedint2,
    @LowerDiscount       = @LowerDiscount,
    @OrderNum            = @OrderNum,
    @Price               = @Price,
    @Price2              = @Price2,
    @RepoRate            = @RepoRate,
    @RepoValue           = @RepoValue,
    @Repo2Value          = @Repo2Value,
    @StartDiscount       = @StartDiscount,
    @TSCommission        = @TSCommission,
    @UpperDiscount       = @UpperDiscount,
    @Value               = @Value,
    @Yield               = @Yield,
    @Qty                 = @Qty,
    @TradeTime           = @TradeTime,
    @BlockSecurities     = @BlockSecurities,
    @RepoTerm            = @RepoTerm,
    @ClearingComission   = @ClearingComission,
    @ExchangeComission   = @ExchangeComission,
    @TechCenterComission = @TechCenterComission,
    @Account             = @Account,
    @BrokerRef           = @BrokerRef,
    @ClientCode          = @ClientCode,
    @SettleCode          = @SettleCode,
    @UserId              = @UserId,
    @ExchangeCode        = @ExchangeCode,
    @Type                = @Type,
    @FirmId              = @FirmId,
    @FirmName            = @FirmName,
    @CPFirmId            = @CPFirmId,
    @CPFirmName          = @CPFirmName,
    @Margin              = @Margin,
    @ClassName           = @ClassName,
    @SecName             = @SecName,
    @SettleDate          = @SettleDate,
    @SettleCurrency      = @SettleCurrency,
    @TradeCurrency       = @TradeCurrency,
    @StationId           = @StationId,
    @Period              = @Period,
    @TradeTimeMs         = @TradeTimeMs,
    @Kind                = @Kind,
    @BankAccId           = @BankAccId,
    @LinkedTrade         = @LinkedTrade,
    @Source_Id           = @Source_Id

  RETURN 1  

GO
/****** Object:  StoredProcedure [Quik].[Instruments::Instrument Dates::Modify]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Instruments::Instrument Dates::Modify]
  @TradeDate           Date,
  @ClassCode           VarChar(12),
  @SecCode             VarChar(12),
  @ClassName           VarChar(255),
  @FirmId              VarChar(12),
  @Flags               Int,
  @RFlags              Int,
  @FaceValue           Decimal(19, 4),
  @OptionStrike        Decimal(19, 4),
  @OptionType          VarChar(12),
  @OptionBaseSecCode   VarChar(12),
  @OptionBase          VarChar(12),
  @OptionBaseClassCode VarChar(12),
  @LotSize             Decimal(19, 4),
  @PriceStep           Decimal(19, 6),
  @MatDate             DateTime,
  @DaysToMatDate       Decimal(19, 0),
  @MinStep             Decimal(19, 6),
  @Scale               Decimal(19, 0),
  @FaceUnit            VarChar(5),
  @SecShortName        VarChar(16),
  @SecFullName         VarChar(32),
  @SecName             VarChar(256), 
  @ISINCode            VarChar(12),
  @RegNumber           VarChar(32),
  @SecMarginType       VarChar(4),
  @Source_Id           TinyInt
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Ignore                  Bit,
    @TradeParticipant_Id     SmallInt,
    @TradeBoard_Id           SmallInt,
    @Instrument_Id           Int,
    @OptionBaseInstrument_Id Int,
    @OptionBaseTradeBoard_Id SmallInt

  BEGIN TRY
    IF @TradeDate IS NULL
      RaisError('   @TradeDate', 16, 2) 

    IF @SecCode IS NULL
      RaisError('   @SecCode', 16, 2) 

    IF @ClassCode IS NULL
      RaisError('   @ClassCode', 16, 2) 

    IF @Source_Id IS NULL
      RaisError('   ', 16, 2) 

    SELECT
      @TradeBoard_Id = [TradeBoard_Id],
      @Ignore        = [Ignore]
    FROM [Quik].[Dic:Places:Trade Boards]
    WHERE [Code] = @ClassCode
      AND [Source_Id] = @Source_Id

    IF @Ignore = 1 --     
      RETURN 1

    SELECT
      @TradeParticipant_Id = QT.[TradeParticipant_Id]
    FROM [Quik].[Places:Trade Participants] QT
    INNER JOIN [Gate].[Places:Trade Participants] GT ON GT.[Id] = QT.[TradeParticipant_Id]
    INNER JOIN [Gate].[Dic:Places:Trade Boards] GB ON GB.[Place_Id] = GT.[Place_Id]
    WHERE QT.[Code] = @FirmId    
      AND QT.[Source_Id] = @Source_Id
      AND GB.[Id] = @TradeBoard_Id

    SELECT
      @OptionBaseTradeBoard_Id = [TradeBoard_Id]
    FROM [Quik].[Dic:Places:Trade Boards]
    WHERE [Code] = @OptionBaseClassCode
      AND [Source_Id] = @Source_Id

    SELECT
      @Instrument_Id = [Id]
    FROM [Gate].[Instruments]
    WHERE [Code] = @SecCode
      AND [Source_Id] = @Source_Id
  
    IF @Instrument_Id IS NULL BEGIN
      MERGE [Gate].[Instruments] T
      USING
      (
        SELECT
          @SecCode,
          @Source_Id
      ) AS S ([Code], [Source_Id])
      ON T.[Code] = S.[Code] AND T.[Source_Id] =  S.[Source_Id]
      WHEN MATCHED THEN
        UPDATE SET
          @Instrument_Id = T.[Id]
      WHEN NOT MATCHED THEN
        INSERT ([Source_Id], [Code])
        VALUES (S.[Source_Id], S.[Code]);

      SET @Instrument_Id = IsNull(@Instrument_Id, Scope_Identity())
    END
    
    SELECT
      @OptionBaseInstrument_Id = [Id]
    FROM [Gate].[Instruments]
    WHERE [Code] = @OptionBaseSecCode
      AND [Source_Id] = @Source_Id
 
    MERGE [Gate].[Instruments:Instrument Dates] T
    USING
    (
      SELECT
        @TradeDate,
        @TradeBoard_Id,
        CASE WHEN @TradeBoard_Id IS NULL THEN @ClassCode END,
        @Instrument_Id,
        @TradeParticipant_Id,
        CASE WHEN @TradeParticipant_Id IS NULL THEN @FirmId END,
        @FaceValue,
        @FaceUnit,
        @OptionStrike,
        @OptionType,
        @OptionBaseInstrument_Id,
        CASE WHEN @OptionBaseInstrument_Id IS NULL THEN @OptionBaseSecCode END,
        @OptionBaseTradeBoard_Id,
        CASE WHEN @OptionBaseTradeBoard_Id IS NULL THEN @OptionBaseClassCode END,
        @LotSize,
        @PriceStep,
        @MatDate,
        @MinStep,
        @Scale,
        @SecShortName,
        @SecFullName,
        @SecName,
        @ISINCode,
        @RegNumber,
        @SecMarginType
    ) AS S ([TradeDate], [TradeBoard_Id], [TradeBoardCode], [Instrument_Id], [TradeParticipant_Id], [TradeParticipantCode], [FaceValue], [FaceCurrency], [OptionStrike], [OptionType], [OptionBaseInstrument_Id], [OptionBaseInstrumentCode], [OptionBaseTradeBoard_Id], [OptionBaseTradeBoardCode], [LotSize], [PriceStep], [MaturityDate], [MinStep], [Scale], [ShortName], [FullName], [Name], [ISINCode], [RegNumberCode], [MarginTypes])
    ON T.[TradeDate] = S.[TradeDate] AND T.[Instrument_Id] = S.[Instrument_Id] AND (T.[TradeBoard_Id] = S.[TradeBoard_Id] OR T.[TradeBoardCode] = S.[TradeBoardCode])
    WHEN MATCHED THEN
      UPDATE SET
        [TradeParticipant_Id]      = S.[TradeParticipant_Id],
        [TradeParticipantCode]     = S.[TradeParticipantCode],
        [FaceValue]                = S.[FaceValue],
        [FaceCurrency]             = S.[FaceCurrency],
        [OptionStrike]             = S.[OptionStrike],
        [OptionType]               = S.[OptionType],
        [OptionBaseInstrument_Id]  = S.[OptionBaseInstrument_Id],
        [OptionBaseInstrumentCode] = S.[OptionBaseInstrumentCode],
        [OptionBaseTradeBoard_Id]  = S.[OptionBaseTradeBoard_Id],
        [OptionBaseTradeBoardCode] = S.[OptionBaseTradeBoardCode],
        [LotSize]                  = S.[LotSize],
        [PriceStep]                = S.[PriceStep],
        [MaturityDate]             = S.[MaturityDate],
        [MinStep]                  = S.[MinStep],
        [Scale]                    = S.[Scale],
        [ShortName]                = S.[ShortName],
        [FullName]                 = S.[FullName],
        [Name]                     = S.[Name],
        [ISINCode]                 = S.[ISINCode],
        [RegNumberCode]            = S.[RegNumberCode],
        [MarginTypes]              = S.[MarginTypes]
    WHEN NOT MATCHED THEN 
      INSERT ([TradeDate], [TradeBoard_Id], [TradeBoardCode], [Instrument_Id], [TradeParticipant_Id], [TradeParticipantCode], [FaceValue], [FaceCurrency], [OptionStrike], [OptionType], [OptionBaseInstrument_Id], [OptionBaseInstrumentCode], [OptionBaseTradeBoard_Id], [OptionBaseTradeBoardCode], [LotSize], [PriceStep], [MaturityDate], [MinStep], [Scale], [ShortName], [FullName], [Name], [ISINCode], [RegNumberCode], [MarginTypes])
      VALUES (S.[TradeDate], S.[TradeBoard_Id], S.[TradeBoardCode], S.[Instrument_Id], S.[TradeParticipant_Id], S.[TradeParticipantCode], S.[FaceValue], S.[FaceCurrency], S.[OptionStrike], S.[OptionType], S.[OptionBaseInstrument_Id], S.[OptionBaseInstrumentCode], S.[OptionBaseTradeBoard_Id], S.[OptionBaseTradeBoardCode], S.[LotSize], S.[PriceStep], S.[MaturityDate], S.[MinStep], S.[Scale], S.[ShortName], S.[FullName], S.[Name], S.[ISINCode], S.[RegNumberCode], S.[MarginTypes]);

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [Quik].[Instruments::Instrument Dates::Modify#Aton]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Instruments::Instrument Dates::Modify#Aton]
  @TradeDate           Date,
  @ClassCode           VarChar(12),
  @SecCode             VarChar(12),
  @ClassName           VarChar(255),
  @FirmId              VarChar(12),
  @Flags               Int,
  @RFlags              Int,
  @FaceValue           Decimal(19, 4),
  @OptionStrike        Decimal(19, 4),
  @OptionType          VarChar(12),
  @OptionBaseSecCode   VarChar(12),
  @OptionBase          VarChar(12),
  @OptionBaseClassCode VarChar(12),
  @LotSize             Decimal(19, 4),
  @PriceStep           Decimal(19, 6),
  @MatDate             DateTime,
  @DaysToMatDate       Decimal(19, 0),
  @MinStep             Decimal(19, 6),
  @Scale               Decimal(19, 0),
  @FaceUnit            VarChar(5),
  @SecShortName        VarChar(16),
  @SecFullName         VarChar(32),
  @SecName             VarChar(256), 
  @ISINCode            VarChar(12),
  @RegNumber           VarChar(32),
  @SecMarginType       VarChar(4)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 1 -- Aton

  EXEC [Quik].[Instruments::Instrument Dates::Modify]
    @TradeDate           = @TradeDate,
    @ClassCode           = @ClassCode,
    @SecCode             = @SecCode,
    @ClassName           = @ClassName,
    @FirmId              = @FirmId,
    @Flags               = @Flags,
    @RFlags              = @RFlags,
    @FaceValue           = @FaceValue,
    @OptionStrike        = @OptionStrike,
    @OptionType          = @OptionType,
    @OptionBaseSecCode   = @OptionBaseSecCode,
    @OptionBase          = @OptionBase,
    @OptionBaseClassCode = @OptionBaseClassCode,
    @LotSize             = @LotSize,
    @PriceStep           = @PriceStep,
    @MatDate             = @MatDate,
    @DaysToMatDate       = @DaysToMatDate,
    @MinStep             = @MinStep,
    @Scale               = @Scale,
    @FaceUnit            = @FaceUnit,
    @SecShortName        = @SecShortName,
    @SecFullName         = @SecFullName,
    @SecName             = @SecName,
    @ISINCode            = @ISINCode,
    @RegNumber           = @RegNumber,
    @SecMarginType       = @SecMarginType,
    @Source_Id           = @Source_Id

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Instruments::Instrument Dates::Modify#OSL]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Instruments::Instrument Dates::Modify#OSL]
  @TradeDate           Date,
  @ClassCode           VarChar(12),
  @SecCode             VarChar(12),
  @ClassName           VarChar(255),
  @FirmId              VarChar(12),
  @Flags               Int,
  @RFlags              Int,
  @FaceValue           Decimal(19, 4),
  @OptionStrike        Decimal(19, 4),
  @OptionType          VarChar(12),
  @OptionBaseSecCode   VarChar(12),
  @OptionBase          VarChar(12),
  @OptionBaseClassCode VarChar(12),
  @LotSize             Decimal(19, 4),
  @PriceStep           Decimal(19, 6),
  @MatDate             DateTime,
  @DaysToMatDate       Decimal(19, 0),
  @MinStep             Decimal(19, 6),
  @Scale               Decimal(19, 0),
  @FaceUnit            VarChar(5),
  @SecShortName        VarChar(16),
  @SecFullName         VarChar(32),
  @SecName             VarChar(256), 
  @ISINCode            VarChar(12),
  @RegNumber           VarChar(32),
  @SecMarginType       VarChar(4)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 3 -- 

  EXEC [Quik].[Instruments::Instrument Dates::Modify]
    @TradeDate           = @TradeDate,
    @ClassCode           = @ClassCode,
    @SecCode             = @SecCode,
    @ClassName           = @ClassName,
    @FirmId              = @FirmId,
    @Flags               = @Flags,
    @RFlags              = @RFlags,
    @FaceValue           = @FaceValue,
    @OptionStrike        = @OptionStrike,
    @OptionType          = @OptionType,
    @OptionBaseSecCode   = @OptionBaseSecCode,
    @OptionBase          = @OptionBase,
    @OptionBaseClassCode = @OptionBaseClassCode,
    @LotSize             = @LotSize,
    @PriceStep           = @PriceStep,
    @MatDate             = @MatDate,
    @DaysToMatDate       = @DaysToMatDate,
    @MinStep             = @MinStep,
    @Scale               = @Scale,
    @FaceUnit            = @FaceUnit,
    @SecShortName        = @SecShortName,
    @SecFullName         = @SecFullName,
    @SecName             = @SecName,
    @ISINCode            = @ISINCode,
    @RegNumber           = @RegNumber,
    @SecMarginType       = @SecMarginType,
    @Source_Id           = @Source_Id

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Instruments::Quotes::Modify]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Instruments::Quotes::Modify]
  @ClassCode        VarChar(12),
  @SecCode          VarChar(12),
  @TradeDate        DateTime,
  @MatDate          DateTime,
  @accruedint       Numeric(19, 4),
  @bid              Numeric(19, 6),
  @biddepth         Numeric(19, 0),
  @biddeptht        Numeric(19, 0),
  @buydepo          Numeric(19, 4),
  @buyprofit        Numeric(19, 4),
  @change           Numeric(19, 6),
  @changetime       DateTime,
  @chngclose        Numeric(19, 4),
  @chngopen         Numeric(19, 4),
  @closeprice       Numeric(19, 6),
  @closetime        DateTime,
  @closeval         Numeric(19, 4),
  @closeyield       Numeric(19, 4),
  @couponvalue      Numeric(19, 4),
  @currentvalue     Numeric(19, 4),
  @curval           Numeric(19, 4),
  @facevalue        Numeric(19, 6),
  @high             Numeric(19, 6),
  @highbid          Numeric(19, 6),
  @last             Numeric(19, 6),
  @lastchange       Numeric(19, 4),
  @lasttoprevstlprc Numeric(19, 6),
  @lastvalue        Numeric(19, 6),
  @lotsize          Numeric(19, 0),
  @low              Numeric(19, 6),
  @lowoffer         Numeric(19, 6),
  @marketprice      Numeric(19, 6),
  @marketpricetoday Numeric(19, 6),
  @maxoutvolume     Numeric(19, 0),
  @negnumtrades     Numeric(19, 0),
  @negvaltoday      Numeric(19, 4),
  @numbids          Numeric(19, 0),
  @numcontracts     Numeric(19, 0),
  @numoffers        Numeric(19, 0),
  @numtrades        Numeric(19, 0),
  @offer            Numeric(19, 6),
  @offerdepth       Numeric(19, 0),
  @offerdeptht      Numeric(19, 0),
  @open             Numeric(19, 6),
  @openval          Numeric(19, 4),
  @optionbase       VarChar(255),
  @optiontype       VarChar(255),
  @prevprice        Numeric(19, 6),
  @prevsettlprice   Numeric(19, 6),
  @prevwaprice      Numeric(19, 6),
  @pricemax         Numeric(19, 6),
  @pricemin         Numeric(19, 6),
  @priceminusprevwa Numeric(19, 6),
  @pricemvtlimit    Numeric(19, 6),
  @pricemvtlimitt1  Numeric(19, 6),
  @primarydist      VarChar(128),
  @qty              Numeric(19, 0),
  @qty_pcs          Numeric(19, 0),
  @selldepo         Numeric(19, 4),
  @sellprofit       Numeric(19, 4),
  @status           VarChar(128),
  @steppricet       Numeric(19, 6),
  @stepprice        Numeric(19, 6),
  @time             DateTime,
  @theorprice       Numeric(19, 6),
  @tradechange      Numeric(19, 6),
  @tradingstatus    VarChar(128),
  @valtoday         Numeric(19, 4),
  @value            Numeric(19, 4),
  @volatility       Numeric(19, 4),
  @voltoday         Numeric(19, 0),
  @waprice          Numeric(19, 6),
  @yield            Numeric(19, 4),
  @yieldatprevwapri Numeric(19, 4),
  @yieldatwaprice   Numeric(19, 4),
  @bgonp            Numeric(19, 4),
  @bgop             Numeric(19, 4),
  @highval          Numeric(19, 4),
  @ichange          Numeric(19, 4),
  @iopen            Numeric(19, 4),
  @lowval           Numeric(19, 4),
  @pchange          Numeric(19, 4),
  @quantity         Numeric(19, 4),
  @settleprice      Numeric(19, 6),
  @strike           Numeric(19, 6),
  @Scale            Int,
  @DaysToMatDate    Int,
  @nextcoupon       DateTime,
  @FaceUnit         VarChar(12),
  @admittedquote    Numeric(19, 6),
  @issuesize        Numeric(19, 0),
  @prevdate         DateTime,
  @lopenprice       Numeric(19, 6),
  @lcurrentprice    Numeric(19, 6),
  @quotebasis       VarChar(255),
  @couponperiod     Numeric(19, 0),
  @buybackprice     Numeric(19, 6),
  @buybackdate      DateTime,
  @duration         Numeric(19, 4),
  @baseprice        Numeric(19, 4),
  @clprice          Numeric(19, 4),
  @clstate          VarChar(32),
  @counterprice     Numeric(19, 6),
  @crossrate        Numeric(19, 4),
  @curstepprice     VarChar(32),
  @endtime          DateTime,
  @evnendtime       DateTime,
  @evnstarttime     DateTime,
  @expdate          DateTime,
  @ispercent        VarChar(32),
  @lastbid          Numeric(19, 6),
  @lastoffer        Numeric(19, 6),
  @lcloseprice      Numeric(19, 6),
  @marg             VarChar(32),
  @marketprice2     Numeric(19, 6),
  @min_curr_last    Numeric(19, 6),
  @monendtime       DateTime,
  @monstarttime     DateTime,
  @openperiodprice  Numeric(19, 6),
  @percentrate      Numeric(19, 4),
  @prevadmittedquot Numeric(19, 6),
  @prevlegalclosepr Numeric(19, 6),
  @realvmprice      Numeric(19, 6),
  @sectype          VarChar(32),
  @starttime        DateTime,
  @settlecode       VarChar(16),
  @steppricecl      Numeric(19, 6),
  @steppriceprcl    Numeric(19, 6),
  @min_curr_last_ti DateTime,
  @prevlotsize      Numeric(19, 4),
  @lotsizechangedat DateTime,
  @Source_Id        TinyInt,
  @StepDelay        Int             = 1 --  ,     
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Ignore          Bit,
    @TradeBoard_Id   Int,
    @Instrument_Id   Int,
    @TradeDateTime   DateTime

  DECLARE @Quotes Table
  (
    [TradeBoard_Id]  SmallInt                                      NULL,
    [Instrument_Id]  Int                                           NULL,
    [QuoteType_Id]   TinyInt                                   NOT NULL,
    [Currency]       VarChar(5)  COLLATE Cyrillic_General_BIN      NULL,
    [Value]          Numeric(19, 6)                                NULL,
    [LastUpdateTime] Time                                      NOT NULL
  )

  BEGIN TRY
    IF @TradeDate IS NULL
      RaisError('   @TradeDate', 16, 2)  

    IF @ClassCode IS NULL
      RaisError('   @ClassCode', 16, 2)  

    IF @SecCode IS NULL
      RaisError('   @SecCode', 16, 2) 
 
    IF @Source_Id IS NULL
      RaisError('   ', 16, 2)

    IF @StepDelay IS NULL
      RaisError('   ', 16, 2) 

    SET @TradeDateTime = DateAdd(Minute, IsNull(DateDiff(Minute, 0, @time) / @StepDelay * @StepDelay, 0), @TradeDate) 

    SELECT
      @TradeBoard_Id = [TradeBoard_Id],
      @Ignore        = [Ignore]
    FROM [Quik].[Dic:Places:Trade Boards]
    WHERE [Code] = @ClassCode
      AND [Source_Id] = @Source_Id

    IF @Ignore = 1 --     
      RETURN 1
      
    SELECT
      @Instrument_Id = [Id]
    FROM [Gate].[Instruments]
    WHERE [Code] = @SecCode
      AND [Source_Id] = @Source_Id 

    IF @TradeBoard_Id IS NULL OR @Instrument_Id IS NULL --      
      RETURN 1   

    INSERT INTO @Quotes ([TradeBoard_Id], [Instrument_Id], [QuoteType_Id], [Currency], [Value], [LastUpdateTime])
    SELECT
      [TradeBoard_Id]  = CASE WHEN @Instrument_Id IS NOT NULL THEN @TradeBoard_Id END,
      [Instrument_Id]  = CASE WHEN @TradeBoard_Id IS NOT NULL THEN @Instrument_Id END,
      [QuoteType_Id]   = [Id],
      [Currency]       = @FaceUnit,
      [Value]          = CASE [Code]
                           WHEN 'Ask'          THEN NullIf(@bid, 0)
                           WHEN 'Bid'          THEN NullIf(@offer, 0)
                           WHEN 'Last'         THEN NullIf(@last, 0)
                           WHEN 'Average'      THEN NullIf(@waprice, 0)
                           WHEN 'Min'          THEN NullIf(@pricemin, 0)
                           WHEN 'Max'          THEN NullIf(@pricemax, 0)
                           WHEN 'Market1'      THEN NullIf(@marketpricetoday, 0)
                           WHEN 'Market2'      THEN NullIf(@marketprice2, 0)
                           --WHEN 'Market3'      THEN NULL
                           WHEN 'Acknowledged' THEN NullIf(@admittedquote, 0)
                           WHEN 'Closed'       THEN NullIf(@lcloseprice, 0)
                         END,
      [LastUpdateTime] = IsNull(Cast(@time AS Time), '00:00:00')
    FROM [Gate].[Dic:Instruments:Quotes:Types]

    -- [Gate].[Instruments:Quotes] -- ""
    --   
    MERGE [Gate].[Instruments:Quotes] T
    USING
    (
      SELECT
        @TradeDateTime,
        V.[TradeBoard_Id],
        V.[Instrument_Id],
        V.[QuoteType_Id],
        V.[Currency],
        V.[Value],
        V.[LastUpdateTime]
      FROM @Quotes V
    ) AS S ([TradeDateTime], [TradeBoard_Id], [Instrument_Id], [QuoteType_Id], [Currency], [Value], [LastUpdateTime])
    ON T.[TradeDateTime] = S.[TradeDateTime] AND T.[Instrument_Id] = S.[Instrument_Id] AND T.[TradeBoard_Id] = S.[TradeBoard_Id] AND T.[QuoteType_Id] = S.[QuoteType_Id]     
    WHEN MATCHED AND S.[LastUpdateTime] >= T.[LastUpdateTime] THEN
      UPDATE SET
        [TradeDateTime]  = S.[TradeDateTime],
        [TradeBoard_Id]  = S.[TradeBoard_Id],
        [Instrument_Id]  = S.[Instrument_Id],
        [QuoteType_Id]   = S.[QuoteType_Id],
        [Currency]       = S.[Currency],
        [Value]          = S.[Value],
        [LastUpdateTime] = S.[LastUpdateTime]
    WHEN NOT MATCHED THEN 
      INSERT ([TradeDateTime], [TradeBoard_Id], [Instrument_Id], [QuoteType_Id], [Currency], [Value], [LastUpdateTime])
      VALUES (S.[TradeDateTime], S.[TradeBoard_Id], S.[Instrument_Id], S.[QuoteType_Id], S.[Currency], S.[Value], S.[LastUpdateTime]);

    -- [Gate].[Instruments:Quotes:Trade Dates] --  
    --   
    MERGE [Gate].[Instruments:Quotes:Trade Dates] T
    USING
    (
      SELECT
        @TradeDate,
        V.[TradeBoard_Id],
        V.[Instrument_Id],
        V.[QuoteType_Id],
        V.[Currency],
        V.[Value],
        V.[LastUpdateTime]
      FROM @Quotes V
      WHERE V.[Instrument_Id] IS NOT NULL
    ) AS S ([TradeDate], [TradeBoard_Id], [Instrument_Id], [QuoteType_Id], [Currency], [Value], [LastUpdateTime])
    ON T.[Instrument_Id] = S.[Instrument_Id] AND T.[TradeDate] = S.[TradeDate] AND T.[TradeBoard_Id] = S.[TradeBoard_Id] AND T.[QuoteType_Id] = S.[QuoteType_Id]
    WHEN MATCHED AND S.[LastUpdateTime] >= T.[LastUpdateTime] AND S.[Value] IS NOT NULL THEN
      UPDATE SET
        [TradeDate]      = S.[TradeDate],
        [TradeBoard_Id]  = S.[TradeBoard_Id],
        [Instrument_Id]  = S.[Instrument_Id],
        [QuoteType_Id]   = S.[QuoteType_Id],
        [Currency]       = S.[Currency],
        [Value]          = S.[Value],
        [LastUpdateTime] = S.[LastUpdateTime]
    WHEN MATCHED AND S.[LastUpdateTime] >= T.[LastUpdateTime] AND S.[Value] IS NULL THEN
      DELETE
    WHEN NOT MATCHED AND S.[Value] IS NOT NULL THEN 
      INSERT ([TradeDate], [TradeBoard_Id], [Instrument_Id], [QuoteType_Id], [Currency], [Value], [LastUpdateTime])
      VALUES (S.[TradeDate], S.[TradeBoard_Id], S.[Instrument_Id], S.[QuoteType_Id], S.[Currency], S.[Value], S.[LastUpdateTime]);
    
    -- [Gate].[Instruments:Current Quotes] -- 
    --   
    MERGE [Gate].[Instruments:Current Quotes] T
    USING
    (
      SELECT
        V.[TradeBoard_Id],
        V.[Instrument_Id],
        V.[QuoteType_Id],
        V.[Currency],
        V.[Value],
        @TradeDate + Cast(V.[LastUpdateTime] AS DateTime)
      FROM @Quotes V        
      WHERE V.[Instrument_Id] IS NOT NULL
    ) AS S ([TradeBoard_Id], [Instrument_Id], [QuoteType_Id], [Currency], [Value], [LastUpdateDateTime])
    ON T.[Instrument_Id] = S.[Instrument_Id] AND T.[TradeBoard_Id] = S.[TradeBoard_Id] AND T.[QuoteType_Id] = S.[QuoteType_Id] 
    WHEN MATCHED AND S.[LastUpdateDateTime] >= T.[LastUpdateDateTime] AND S.[Value] IS NOT NULL THEN
      UPDATE SET
        [TradeBoard_Id]      = S.[TradeBoard_Id],
        [Instrument_Id]      = S.[Instrument_Id],
        [QuoteType_Id]       = S.[QuoteType_Id],
        [Currency]           = S.[Currency],
        [Value]              = S.[Value],
        [LastUpdateDateTime] = S.[LastUpdateDateTime]
    WHEN MATCHED AND S.[LastUpdateDateTime] >= T.[LastUpdateDateTime] AND S.[Value] IS NULL THEN
      DELETE
    WHEN NOT MATCHED AND S.[Value] IS NOT NULL THEN 
      INSERT ([TradeBoard_Id], [Instrument_Id], [QuoteType_Id], [Currency], [Value], [LastUpdateDateTime])
      VALUES (S.[TradeBoard_Id], S.[Instrument_Id], S.[QuoteType_Id], S.[Currency], S.[Value], S.[LastUpdateDateTime]);

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [Quik].[Instruments::Quotes::Modify#Aton]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Instruments::Quotes::Modify#Aton]
  @ClassCode        VarChar(12),
  @SecCode          VarChar(12),
  @TradeDate        DateTime,
  @MatDate          DateTime,
  @accruedint       Numeric(19, 4),
  @bid              Numeric(19, 6),
  @biddepth         Numeric(19, 0),
  @biddeptht        Numeric(19, 0),
  @buydepo          Numeric(19, 4),
  @buyprofit        Numeric(19, 4),
  @change           Numeric(19, 6),
  @changetime       DateTime,
  @chngclose        Numeric(19, 4),
  @chngopen         Numeric(19, 4),
  @closeprice       Numeric(19, 6),
  @closetime        DateTime,
  @closeval         Numeric(19, 4),
  @closeyield       Numeric(19, 4),
  @couponvalue      Numeric(19, 4),
  @currentvalue     Numeric(19, 4),
  @curval           Numeric(19, 4),
  @facevalue        Numeric(19, 6),
  @high             Numeric(19, 6),
  @highbid          Numeric(19, 6),
  @last             Numeric(19, 6),
  @lastchange       Numeric(19, 4),
  @lasttoprevstlprc Numeric(19, 6),
  @lastvalue        Numeric(19, 6),
  @lotsize          Numeric(19, 0),
  @low              Numeric(19, 6),
  @lowoffer         Numeric(19, 6),
  @marketprice      Numeric(19, 6),
  @marketpricetoday Numeric(19, 6),
  @maxoutvolume     Numeric(19, 0),
  @negnumtrades     Numeric(19, 0),
  @negvaltoday      Numeric(19, 4),
  @numbids          Numeric(19, 0),
  @numcontracts     Numeric(19, 0),
  @numoffers        Numeric(19, 0),
  @numtrades        Numeric(19, 0),
  @offer            Numeric(19, 6),
  @offerdepth       Numeric(19, 0),
  @offerdeptht      Numeric(19, 0),
  @open             Numeric(19, 6),
  @openval          Numeric(19, 4),
  @optionbase       VarChar(255),
  @optiontype       VarChar(255),
  @prevprice        Numeric(19, 6),
  @prevsettlprice   Numeric(19, 6),
  @prevwaprice      Numeric(19, 6),
  @pricemax         Numeric(19, 6),
  @pricemin         Numeric(19, 6),
  @priceminusprevwa Numeric(19, 6),
  @pricemvtlimit    Numeric(19, 6),
  @pricemvtlimitt1  Numeric(19, 6),
  @primarydist      VarChar(128),
  @qty              Numeric(19, 0),
  @qty_pcs          Numeric(19, 0),
  @selldepo         Numeric(19, 4),
  @sellprofit       Numeric(19, 4),
  @status           VarChar(128),
  @steppricet       Numeric(19, 6),
  @stepprice        Numeric(19, 6),
  @time             DateTime,
  @theorprice       Numeric(19, 6),
  @tradechange      Numeric(19, 6),
  @tradingstatus    VarChar(128),
  @valtoday         Numeric(19, 4),
  @value            Numeric(19, 4),
  @volatility       Numeric(19, 4),
  @voltoday         Numeric(19, 0),
  @waprice          Numeric(19, 6),
  @yield            Numeric(19, 4),
  @yieldatprevwapri Numeric(19, 4),
  @yieldatwaprice   Numeric(19, 4),
  @bgonp            Numeric(19, 4),
  @bgop             Numeric(19, 4),
  @highval          Numeric(19, 4),
  @ichange          Numeric(19, 4),
  @iopen            Numeric(19, 4),
  @lowval           Numeric(19, 4),
  @pchange          Numeric(19, 4),
  @quantity         Numeric(19, 4),
  @settleprice      Numeric(19, 6),
  @strike           Numeric(19, 6),
  @Scale            Int,
  @DaysToMatDate    Int,
  @nextcoupon       DateTime,
  @FaceUnit         VarChar(12),
  @admittedquote    Numeric(19, 6),
  @issuesize        Numeric(19, 0),
  @prevdate         DateTime,
  @lopenprice       Numeric(19, 6),
  @lcurrentprice    Numeric(19, 6),
  @quotebasis       VarChar(255),
  @couponperiod     Numeric(19, 0),
  @buybackprice     Numeric(19, 6),
  @buybackdate      DateTime,
  @duration         Numeric(19, 4),
  @baseprice        Numeric(19, 4),
  @clprice          Numeric(19, 4),
  @clstate          VarChar(32),
  @counterprice     Numeric(19, 6),
  @crossrate        Numeric(19, 4),
  @curstepprice     VarChar(32),
  @endtime          DateTime,
  @evnendtime       DateTime,
  @evnstarttime     DateTime,
  @expdate          DateTime,
  @ispercent        VarChar(32),
  @lastbid          Numeric(19, 6),
  @lastoffer        Numeric(19, 6),
  @lcloseprice      Numeric(19, 6),
  @marg             VarChar(32),
  @marketprice2     Numeric(19, 6),
  @min_curr_last    Numeric(19, 6),
  @monendtime       DateTime,
  @monstarttime     DateTime,
  @openperiodprice  Numeric(19, 6),
  @percentrate      Numeric(19, 4),
  @prevadmittedquot Numeric(19, 6),
  @prevlegalclosepr Numeric(19, 6),
  @realvmprice      Numeric(19, 6),
  @sectype          VarChar(32),
  @starttime        DateTime,
  @settlecode       VarChar(16),
  @steppricecl      Numeric(19, 6),
  @steppriceprcl    Numeric(19, 6),
  @min_curr_last_ti DateTime,
  @prevlotsize      Numeric(19, 4),
  @lotsizechangedat DateTime
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 1 -- Aton

  EXEC [Quik].[Instruments::Quotes::Modify]
    @ClassCode        = @ClassCode,
    @SecCode          = @SecCode,
    @TradeDate        = @TradeDate,
    @MatDate          = @MatDate,
    @accruedint       = @accruedint,
    @bid              = @bid,
    @biddepth         = @biddepth,
    @biddeptht        = @biddeptht,
    @buydepo          = @buydepo,
    @buyprofit        = @buyprofit,
    @change           = @change,
    @changetime       = @changetime,
    @chngclose        = @chngclose,
    @chngopen         = @chngopen,
    @closeprice       = @closeprice,
    @closetime        = @closetime,
    @closeval         = @closeval,
    @closeyield       = @closeyield,
    @couponvalue      = @couponvalue,
    @currentvalue     = @currentvalue,
    @curval           = @curval,
    @facevalue        = @facevalue,
    @high             = @high,
    @highbid          = @highbid,
    @last             = @last,
    @lastchange       = @lastchange,
    @lasttoprevstlprc = @lasttoprevstlprc,
    @lastvalue        = @lastvalue,
    @lotsize          = @lotsize,
    @low              = @low,
    @lowoffer         = @lowoffer,
    @marketprice      = @marketprice,
    @marketpricetoday = @marketpricetoday,
    @maxoutvolume     = @maxoutvolume,
    @negnumtrades     = @negnumtrades,
    @negvaltoday      = @negvaltoday,
    @numbids          = @numbids,
    @numcontracts     = @numcontracts,
    @numoffers        = @numoffers,
    @numtrades        = @numtrades,
    @offer            = @offer,
    @offerdepth       = @offerdepth,
    @offerdeptht      = @offerdeptht,
    @open             = @open,
    @openval          = @openval,
    @optionbase       = @optionbase,
    @optiontype       = @optiontype,
    @prevprice        = @prevprice,
    @prevsettlprice   = @prevsettlprice,
    @prevwaprice      = @prevwaprice,
    @pricemax         = @pricemax,
    @pricemin         = @pricemin,
    @priceminusprevwa = @priceminusprevwa,
    @pricemvtlimit    = @pricemvtlimit,
    @pricemvtlimitt1  = @pricemvtlimitt1,
    @primarydist      = @primarydist,
    @qty              = @qty,
    @qty_pcs          = @qty_pcs,
    @selldepo         = @selldepo,
    @sellprofit       = @sellprofit,
    @status           = @status,
    @steppricet       = @steppricet,
    @stepprice        = @stepprice,
    @time             = @time,
    @theorprice       = @theorprice,
    @tradechange      = @tradechange,
    @tradingstatus    = @tradingstatus,
    @valtoday         = @valtoday,
    @value            = @value,
    @volatility       = @volatility,
    @voltoday         = @voltoday,
    @waprice          = @waprice,
    @yield            = @yield,
    @yieldatprevwapri = @yieldatprevwapri,
    @yieldatwaprice   = @yieldatwaprice,
    @bgonp            = @bgonp,
    @bgop             = @bgop,
    @highval          = @highval,
    @ichange          = @ichange,
    @iopen            = @iopen,
    @lowval           = @lowval,
    @pchange          = @pchange,
    @quantity         = @quantity,
    @settleprice      = @settleprice,
    @strike           = @strike,
    @Scale            = @Scale,
    @DaysToMatDate    = @DaysToMatDate,
    @nextcoupon       = @nextcoupon,
    @FaceUnit         = @FaceUnit,
    @admittedquote    = @admittedquote,
    @issuesize        = @issuesize,
    @prevdate         = @prevdate,
    @lopenprice       = @lopenprice,
    @lcurrentprice    = @lcurrentprice,
    @quotebasis       = @quotebasis,
    @couponperiod     = @couponperiod,
    @buybackprice     = @buybackprice,
    @buybackdate      = @buybackdate,
    @duration         = @duration,
    @baseprice        = @baseprice,
    @clprice          = @clprice,
    @clstate          = @clstate,
    @counterprice     = @counterprice,
    @crossrate        = @crossrate,
    @curstepprice     = @curstepprice,
    @endtime          = @endtime,
    @evnendtime       = @evnendtime,
    @evnstarttime     = @evnstarttime,
    @expdate          = @expdate,
    @ispercent        = @ispercent,
    @lastbid          = @lastbid,
    @lastoffer        = @lastoffer,
    @lcloseprice      = @lcloseprice,
    @marg             = @marg,
    @marketprice2     = @marketprice2,
    @min_curr_last    = @min_curr_last,
    @monendtime       = @monendtime,
    @monstarttime     = @monstarttime,
    @openperiodprice  = @openperiodprice,
    @percentrate      = @percentrate,
    @prevadmittedquot = @prevadmittedquot,
    @prevlegalclosepr = @prevlegalclosepr,
    @realvmprice      = @realvmprice,
    @sectype          = @sectype,
    @starttime        = @starttime,
    @settlecode       = @settlecode,
    @steppricecl      = @steppricecl,
    @steppriceprcl    = @steppriceprcl,
    @min_curr_last_ti = @min_curr_last_ti,
    @prevlotsize      = @prevlotsize,
    @lotsizechangedat = @lotsizechangedat,
    @Source_Id        = @Source_Id,
    @StepDelay        = 1

  RETURN 1  

GO
/****** Object:  StoredProcedure [Quik].[Instruments::Quotes::Modify#OSL]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Instruments::Quotes::Modify#OSL]
  @ClassCode        VarChar(12),
  @SecCode          VarChar(12),
  @TradeDate        DateTime,
  @MatDate          DateTime,
  @accruedint       Numeric(19, 4),
  @bid              Numeric(19, 6),
  @biddepth         Numeric(19, 0),
  @biddeptht        Numeric(19, 0),
  @buydepo          Numeric(19, 4),
  @buyprofit        Numeric(19, 4),
  @change           Numeric(19, 6),
  @changetime       DateTime,
  @chngclose        Numeric(19, 4),
  @chngopen         Numeric(19, 4),
  @closeprice       Numeric(19, 6),
  @closetime        DateTime,
  @closeval         Numeric(19, 4),
  @closeyield       Numeric(19, 4),
  @couponvalue      Numeric(19, 4),
  @currentvalue     Numeric(19, 4),
  @curval           Numeric(19, 4),
  @facevalue        Numeric(19, 6),
  @high             Numeric(19, 6),
  @highbid          Numeric(19, 6),
  @last             Numeric(19, 6),
  @lastchange       Numeric(19, 4),
  @lasttoprevstlprc Numeric(19, 6),
  @lastvalue        Numeric(19, 6),
  @lotsize          Numeric(19, 0),
  @low              Numeric(19, 6),
  @lowoffer         Numeric(19, 6),
  @marketprice      Numeric(19, 6),
  @marketpricetoday Numeric(19, 6),
  @maxoutvolume     Numeric(19, 0),
  @negnumtrades     Numeric(19, 0),
  @negvaltoday      Numeric(19, 4),
  @numbids          Numeric(19, 0),
  @numcontracts     Numeric(19, 0),
  @numoffers        Numeric(19, 0),
  @numtrades        Numeric(19, 0),
  @offer            Numeric(19, 6),
  @offerdepth       Numeric(19, 0),
  @offerdeptht      Numeric(19, 0),
  @open             Numeric(19, 6),
  @openval          Numeric(19, 4),
  @optionbase       VarChar(255),
  @optiontype       VarChar(255),
  @prevprice        Numeric(19, 6),
  @prevsettlprice   Numeric(19, 6),
  @prevwaprice      Numeric(19, 6),
  @pricemax         Numeric(19, 6),
  @pricemin         Numeric(19, 6),
  @priceminusprevwa Numeric(19, 6),
  @pricemvtlimit    Numeric(19, 6),
  @pricemvtlimitt1  Numeric(19, 6),
  @primarydist      VarChar(128),
  @qty              Numeric(19, 0),
  @qty_pcs          Numeric(19, 0),
  @selldepo         Numeric(19, 4),
  @sellprofit       Numeric(19, 4),
  @status           VarChar(128),
  @steppricet       Numeric(19, 6),
  @stepprice        Numeric(19, 6),
  @time             DateTime,
  @theorprice       Numeric(19, 6),
  @tradechange      Numeric(19, 6),
  @tradingstatus    VarChar(128),
  @valtoday         Numeric(19, 4),
  @value            Numeric(19, 4),
  @volatility       Numeric(19, 4),
  @voltoday         Numeric(19, 0),
  @waprice          Numeric(19, 6),
  @yield            Numeric(19, 4),
  @yieldatprevwapri Numeric(19, 4),
  @yieldatwaprice   Numeric(19, 4),
  @bgonp            Numeric(19, 4),
  @bgop             Numeric(19, 4),
  @highval          Numeric(19, 4),
  @ichange          Numeric(19, 4),
  @iopen            Numeric(19, 4),
  @lowval           Numeric(19, 4),
  @pchange          Numeric(19, 4),
  @quantity         Numeric(19, 4),
  @settleprice      Numeric(19, 6),
  @strike           Numeric(19, 6),
  @Scale            Int,
  @DaysToMatDate    Int,
  @nextcoupon       DateTime,
  @FaceUnit         VarChar(12),
  @admittedquote    Numeric(19, 6),
  @issuesize        Numeric(19, 0),
  @prevdate         DateTime,
  @lopenprice       Numeric(19, 6),
  @lcurrentprice    Numeric(19, 6),
  @quotebasis       VarChar(255),
  @couponperiod     Numeric(19, 0),
  @buybackprice     Numeric(19, 6),
  @buybackdate      DateTime,
  @duration         Numeric(19, 4),
  @baseprice        Numeric(19, 4),
  @clprice          Numeric(19, 4),
  @clstate          VarChar(32),
  @counterprice     Numeric(19, 6),
  @crossrate        Numeric(19, 4),
  @curstepprice     VarChar(32),
  @endtime          DateTime,
  @evnendtime       DateTime,
  @evnstarttime     DateTime,
  @expdate          DateTime,
  @ispercent        VarChar(32),
  @lastbid          Numeric(19, 6),
  @lastoffer        Numeric(19, 6),
  @lcloseprice      Numeric(19, 6),
  @marg             VarChar(32),
  @marketprice2     Numeric(19, 6),
  @min_curr_last    Numeric(19, 6),
  @monendtime       DateTime,
  @monstarttime     DateTime,
  @openperiodprice  Numeric(19, 6),
  @percentrate      Numeric(19, 4),
  @prevadmittedquot Numeric(19, 6),
  @prevlegalclosepr Numeric(19, 6),
  @realvmprice      Numeric(19, 6),
  @sectype          VarChar(32),
  @starttime        DateTime,
  @settlecode       VarChar(16),
  @steppricecl      Numeric(19, 6),
  @steppriceprcl    Numeric(19, 6),
  @min_curr_last_ti DateTime,
  @prevlotsize      Numeric(19, 4),
  @lotsizechangedat DateTime
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 3 -- 

  EXEC [Quik].[Instruments::Quotes::Modify]
    @ClassCode        = @ClassCode,
    @SecCode          = @SecCode,
    @TradeDate        = @TradeDate,
    @MatDate          = @MatDate,
    @accruedint       = @accruedint,
    @bid              = @bid,
    @biddepth         = @biddepth,
    @biddeptht        = @biddeptht,
    @buydepo          = @buydepo,
    @buyprofit        = @buyprofit,
    @change           = @change,
    @changetime       = @changetime,
    @chngclose        = @chngclose,
    @chngopen         = @chngopen,
    @closeprice       = @closeprice,
    @closetime        = @closetime,
    @closeval         = @closeval,
    @closeyield       = @closeyield,
    @couponvalue      = @couponvalue,
    @currentvalue     = @currentvalue,
    @curval           = @curval,
    @facevalue        = @facevalue,
    @high             = @high,
    @highbid          = @highbid,
    @last             = @last,
    @lastchange       = @lastchange,
    @lasttoprevstlprc = @lasttoprevstlprc,
    @lastvalue        = @lastvalue,
    @lotsize          = @lotsize,
    @low              = @low,
    @lowoffer         = @lowoffer,
    @marketprice      = @marketprice,
    @marketpricetoday = @marketpricetoday,
    @maxoutvolume     = @maxoutvolume,
    @negnumtrades     = @negnumtrades,
    @negvaltoday      = @negvaltoday,
    @numbids          = @numbids,
    @numcontracts     = @numcontracts,
    @numoffers        = @numoffers,
    @numtrades        = @numtrades,
    @offer            = @offer,
    @offerdepth       = @offerdepth,
    @offerdeptht      = @offerdeptht,
    @open             = @open,
    @openval          = @openval,
    @optionbase       = @optionbase,
    @optiontype       = @optiontype,
    @prevprice        = @prevprice,
    @prevsettlprice   = @prevsettlprice,
    @prevwaprice      = @prevwaprice,
    @pricemax         = @pricemax,
    @pricemin         = @pricemin,
    @priceminusprevwa = @priceminusprevwa,
    @pricemvtlimit    = @pricemvtlimit,
    @pricemvtlimitt1  = @pricemvtlimitt1,
    @primarydist      = @primarydist,
    @qty              = @qty,
    @qty_pcs          = @qty_pcs,
    @selldepo         = @selldepo,
    @sellprofit       = @sellprofit,
    @status           = @status,
    @steppricet       = @steppricet,
    @stepprice        = @stepprice,
    @time             = @time,
    @theorprice       = @theorprice,
    @tradechange      = @tradechange,
    @tradingstatus    = @tradingstatus,
    @valtoday         = @valtoday,
    @value            = @value,
    @volatility       = @volatility,
    @voltoday         = @voltoday,
    @waprice          = @waprice,
    @yield            = @yield,
    @yieldatprevwapri = @yieldatprevwapri,
    @yieldatwaprice   = @yieldatwaprice,
    @bgonp            = @bgonp,
    @bgop             = @bgop,
    @highval          = @highval,
    @ichange          = @ichange,
    @iopen            = @iopen,
    @lowval           = @lowval,
    @pchange          = @pchange,
    @quantity         = @quantity,
    @settleprice      = @settleprice,
    @strike           = @strike,
    @Scale            = @Scale,
    @DaysToMatDate    = @DaysToMatDate,
    @nextcoupon       = @nextcoupon,
    @FaceUnit         = @FaceUnit,
    @admittedquote    = @admittedquote,
    @issuesize        = @issuesize,
    @prevdate         = @prevdate,
    @lopenprice       = @lopenprice,
    @lcurrentprice    = @lcurrentprice,
    @quotebasis       = @quotebasis,
    @couponperiod     = @couponperiod,
    @buybackprice     = @buybackprice,
    @buybackdate      = @buybackdate,
    @duration         = @duration,
    @baseprice        = @baseprice,
    @clprice          = @clprice,
    @clstate          = @clstate,
    @counterprice     = @counterprice,
    @crossrate        = @crossrate,
    @curstepprice     = @curstepprice,
    @endtime          = @endtime,
    @evnendtime       = @evnendtime,
    @evnstarttime     = @evnstarttime,
    @expdate          = @expdate,
    @ispercent        = @ispercent,
    @lastbid          = @lastbid,
    @lastoffer        = @lastoffer,
    @lcloseprice      = @lcloseprice,
    @marg             = @marg,
    @marketprice2     = @marketprice2,
    @min_curr_last    = @min_curr_last,
    @monendtime       = @monendtime,
    @monstarttime     = @monstarttime,
    @openperiodprice  = @openperiodprice,
    @percentrate      = @percentrate,
    @prevadmittedquot = @prevadmittedquot,
    @prevlegalclosepr = @prevlegalclosepr,
    @realvmprice      = @realvmprice,
    @sectype          = @sectype,
    @starttime        = @starttime,
    @settlecode       = @settlecode,
    @steppricecl      = @steppricecl,
    @steppriceprcl    = @steppriceprcl,
    @min_curr_last_ti = @min_curr_last_ti,
    @prevlotsize      = @prevlotsize,
    @lotsizechangedat = @lotsizechangedat,
    @Source_Id        = @Source_Id,
    @StepDelay        = 1

  RETURN 1  

GO
/****** Object:  StoredProcedure [Quik].[Limits::Derivatives::Modify]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Limits::Derivatives::Modify]
  @FirmId               VarChar(12),
  @TrdAccId             VarChar(12),
  @Type                 VarChar(40),
  @LoadDate             DateTime,
  @Accruedint           Decimal(19, 4),
  @CbpLimit             Decimal(19, 4),
  @CbplPlanned          Decimal(19, 4),
  @CbplUsed             Decimal(19, 4),
  @CbpPrevLimit         Decimal(19, 4),
  @LiquidityCoeff       Decimal(19, 4),
  @Varmargin            Decimal(19, 4),
  @CbplusedForOrders    Decimal(19, 4),
  @CbplusedForPositions Decimal(19, 4),
  @OptionsPremium       Decimal(19, 6),
  @TsComission          Decimal(19, 6),
  @Kgo                  Decimal(19, 6),
  @FirmName             VarChar(30),
  @CurrCode             VarChar(4),
  @RealVarMargin        Decimal(19, 6),
  @Source_Id            TinyInt
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @TradeParticipant_Id Int,
    @TradeAccount_Id     Int
    
  BEGIN TRY
    IF @TrdAccId IS NULL
      RaisError('   @TrdAccId', 16, 2)  

    IF @FirmId IS NULL
      RaisError('   @FirmId', 16, 2)  

    IF @Type IS NULL
      RaisError('   @Type', 16, 2) 

    IF @LoadDate IS NULL
      RaisError('   @LoadDate', 16, 2) 
 
    IF @Source_Id IS NULL
      RaisError('   ', 16, 2)        
        
    SELECT TOP 1
      @TradeParticipant_Id = QT.[TradeParticipant_Id]
    FROM [Quik].[Places:Trade Participants] QT
    WHERE QT.[Code] = @FirmId    
      AND QT.[Source_Id] = @Source_Id --     ,   
        
    IF @TradeParticipant_Id IS NOT NULL
      SELECT
        @TradeAccount_Id = [Id]
      FROM [Gate].[Trade Accounts]
      WHERE [Code] = @TrdAccId
        AND [Source_Id] = @Source_Id
        AND [TradeParticipant_Id] = @TradeParticipant_Id

    MERGE [Gate].[Limits:Derivatives] T
    USING
    (
      SELECT
        @Source_Id,
        @TradeAccount_Id,
        NULL,
        NULL,
        @Type,
        @LoadDate,
        @Accruedint,
        @CbpLimit,
        @CbplPlanned,
        @CbplUsed,
        @CbpPrevLimit,
        @LiquidityCoeff,
        @Varmargin,
        @CbplusedForOrders,
        @CbplusedForPositions,
        @OptionsPremium,
        @TsComission,
        @Kgo,
        @CurrCode,
        @RealVarMargin
      WHERE @TradeAccount_Id IS NOT NULL
    ) AS S ([Source_Id], [TradeAccount_Id], [TradeAccountCode], [TradeParticipantCode], [Type], [TradeDate], [Accruedint], [OpenPositionsLimit],
            [NetPositionsPlanned], [NetPositionsUsed], [OpenPositionsPreviosLimit], [LiquidityRate], [VarMargin], [OrdersWarrantyProvision],
            [PositionsWarrantyProvision], [OptionsPremium], [TradeSystemComission], [WarrantyProvisionRate], [Currency], [RealVarMargin])
    ON T.[TradeAccount_Id] = S.[TradeAccount_Id] AND T.[TradeAccountCode] IS NULL AND T.[TradeParticipantCode] IS NULL AND T.[TradeDate] = S.[TradeDate] AND T.[Type] = S.[Type]
    WHEN MATCHED THEN
      UPDATE SET
        [Source_Id]                  = S.[Source_Id],
        [TradeAccount_Id]            = S.[TradeAccount_Id],
        [TradeAccountCode]           = S.[TradeAccountCode],
        [TradeParticipantCode]       = S.[TradeParticipantCode],
        [Type]                       = S.[Type],
        [TradeDate]                  = S.[TradeDate],
        [Accruedint]                 = S.[Accruedint],
        [OpenPositionsLimit]         = S.[OpenPositionsLimit],
        [NetPositionsPlanned]        = S.[NetPositionsPlanned],
        [NetPositionsUsed]           = S.[NetPositionsUsed],
        [OpenPositionsPreviosLimit]  = S.[OpenPositionsPreviosLimit],
        [LiquidityRate]              = S.[LiquidityRate],
        [VarMargin]                  = S.[VarMargin],
        [OrdersWarrantyProvision]    = S.[OrdersWarrantyProvision],
        [PositionsWarrantyProvision] = S.[PositionsWarrantyProvision],
        [OptionsPremium]             = S.[OptionsPremium],
        [TradeSystemComission]       = S.[TradeSystemComission],
        [WarrantyProvisionRate]      = S.[WarrantyProvisionRate],
        [Currency]                   = S.[Currency],
        [RealVarMargin]              = S.[RealVarMargin]
    WHEN NOT MATCHED THEN 
      INSERT ([Source_Id], [TradeAccount_Id], [TradeAccountCode], [TradeParticipantCode], [Type], [TradeDate], [Accruedint], [OpenPositionsLimit],
              [NetPositionsPlanned], [NetPositionsUsed], [OpenPositionsPreviosLimit], [LiquidityRate], [VarMargin], [OrdersWarrantyProvision],
              [PositionsWarrantyProvision], [OptionsPremium], [TradeSystemComission], [WarrantyProvisionRate], [Currency], [RealVarMargin])
      VALUES (S.[Source_Id], S.[TradeAccount_Id], S.[TradeAccountCode], S.[TradeParticipantCode], S.[Type], S.[TradeDate], S.[Accruedint], S.[OpenPositionsLimit],
              S.[NetPositionsPlanned], S.[NetPositionsUsed], S.[OpenPositionsPreviosLimit], S.[LiquidityRate], S.[VarMargin], S.[OrdersWarrantyProvision],
              S.[PositionsWarrantyProvision], S.[OptionsPremium], S.[TradeSystemComission], S.[WarrantyProvisionRate], S.[Currency], S.[RealVarMargin]);

    MERGE [Gate].[Limits:Derivatives] T
    USING
    (
      SELECT
        @Source_Id,
        NULL,
        @TrdAccId,
        @FirmId,
        @Type,
        @LoadDate,
        @Accruedint,
        @CbpLimit,
        @CbplPlanned,
        @CbplUsed,
        @CbpPrevLimit,
        @LiquidityCoeff,
        @Varmargin,
        @CbplusedForOrders,
        @CbplusedForPositions,
        @OptionsPremium,
        @TsComission,
        @Kgo,
        @CurrCode,
        @RealVarMargin
      WHERE @TradeAccount_Id IS NULL
    ) AS S ([Source_Id], [TradeAccount_Id], [TradeAccountCode], [TradeParticipantCode], [Type], [TradeDate], [Accruedint], [OpenPositionsLimit],
            [NetPositionsPlanned], [NetPositionsUsed], [OpenPositionsPreviosLimit], [LiquidityRate], [VarMargin], [OrdersWarrantyProvision],
            [PositionsWarrantyProvision], [OptionsPremium], [TradeSystemComission], [WarrantyProvisionRate], [Currency], [RealVarMargin])
    ON T.[TradeAccount_Id] IS NULL AND T.[TradeAccountCode] = S.[TradeAccountCode] AND T.[TradeParticipantCode] = S.[TradeParticipantCode] AND T.[TradeDate] = S.[TradeDate] AND T.[Type] = S.[Type]
    WHEN MATCHED THEN
      UPDATE SET
        [Source_Id]                  = S.[Source_Id],
        [TradeAccount_Id]            = S.[TradeAccount_Id],
        [TradeAccountCode]           = S.[TradeAccountCode],
        [TradeParticipantCode]       = S.[TradeParticipantCode],
        [Type]                       = S.[Type],
        [TradeDate]                  = S.[TradeDate],
        [Accruedint]                 = S.[Accruedint],
        [OpenPositionsLimit]         = S.[OpenPositionsLimit],
        [NetPositionsPlanned]        = S.[NetPositionsPlanned],
        [NetPositionsUsed]           = S.[NetPositionsUsed],
        [OpenPositionsPreviosLimit]  = S.[OpenPositionsPreviosLimit],
        [LiquidityRate]              = S.[LiquidityRate],
        [VarMargin]                  = S.[VarMargin],
        [OrdersWarrantyProvision]    = S.[OrdersWarrantyProvision],
        [PositionsWarrantyProvision] = S.[PositionsWarrantyProvision],
        [OptionsPremium]             = S.[OptionsPremium],
        [TradeSystemComission]       = S.[TradeSystemComission],
        [WarrantyProvisionRate]      = S.[WarrantyProvisionRate],
        [Currency]                   = S.[Currency],
        [RealVarMargin]              = S.[RealVarMargin]
    WHEN NOT MATCHED THEN 
      INSERT ([Source_Id], [TradeAccount_Id], [TradeAccountCode], [TradeParticipantCode], [Type], [TradeDate], [Accruedint], [OpenPositionsLimit],
              [NetPositionsPlanned], [NetPositionsUsed], [OpenPositionsPreviosLimit], [LiquidityRate], [VarMargin], [OrdersWarrantyProvision],
              [PositionsWarrantyProvision], [OptionsPremium], [TradeSystemComission], [WarrantyProvisionRate], [Currency], [RealVarMargin])
      VALUES (S.[Source_Id], S.[TradeAccount_Id], S.[TradeAccountCode], S.[TradeParticipantCode], S.[Type], S.[TradeDate], S.[Accruedint], S.[OpenPositionsLimit],
              S.[NetPositionsPlanned], S.[NetPositionsUsed], S.[OpenPositionsPreviosLimit], S.[LiquidityRate], S.[VarMargin], S.[OrdersWarrantyProvision],
              S.[PositionsWarrantyProvision], S.[OptionsPremium], S.[TradeSystemComission], S.[WarrantyProvisionRate], S.[Currency], S.[RealVarMargin]);

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [Quik].[Limits::Derivatives::Modify#Aton]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Limits::Derivatives::Modify#Aton]
  @FirmId               VarChar(12),
  @TrdAccId             VarChar(12),
  @Type                 VarChar(40),
  @LoadDate             DateTime,
  @Accruedint           Decimal(19, 4),
  @CbpLimit             Decimal(19, 4),
  @CbplPlanned          Decimal(19, 4),
  @CbplUsed             Decimal(19, 4),
  @CbpPrevLimit         Decimal(19, 4),
  @LiquidityCoeff       Decimal(19, 4),
  @Varmargin            Decimal(19, 4),
  @CbplusedForOrders    Decimal(19, 4),
  @CbplusedForPositions Decimal(19, 4),
  @OptionsPremium       Decimal(19, 6),
  @TsComission          Decimal(19, 6),
  @Kgo                  Decimal(19, 6),
  @FirmName             VarChar(30),
  @CurrCode             VarChar(4),
  @RealVarMargin        Decimal(19, 6)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 1 -- Aton

  EXEC [Quik].[Limits::Derivatives::Modify]
    @FirmId               = @FirmId,
    @TrdAccId             = @TrdAccId,
    @Type                 = @Type,
    @LoadDate             = @LoadDate,
    @Accruedint           = @Accruedint,
    @CbpLimit             = @CbpLimit,
    @CbplPlanned          = @CbplPlanned,
    @CbplUsed             = @CbplUsed,
    @CbpPrevLimit         = @CbpPrevLimit,
    @LiquidityCoeff       = @LiquidityCoeff,
    @Varmargin            = @Varmargin,
    @CbplusedForOrders    = @CbplusedForOrders,
    @CbplusedForPositions = @CbplusedForPositions,
    @OptionsPremium       = @OptionsPremium,
    @TsComission          = @TsComission,
    @Kgo                  = @Kgo,
    @FirmName             = @FirmName,
    @CurrCode             = @CurrCode,
    @RealVarMargin        = @RealVarMargin,
    @Source_Id            = @Source_Id 

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Limits::Derivatives::Modify#OSL]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Limits::Derivatives::Modify#OSL]
  @FirmId               VarChar(12),
  @TrdAccId             VarChar(12),
  @Type                 VarChar(40),
  @LoadDate             DateTime,
  @Accruedint           Decimal(19, 4),
  @CbpLimit             Decimal(19, 4),
  @CbplPlanned          Decimal(19, 4),
  @CbplUsed             Decimal(19, 4),
  @CbpPrevLimit         Decimal(19, 4),
  @LiquidityCoeff       Decimal(19, 4),
  @Varmargin            Decimal(19, 4),
  @CbplusedForOrders    Decimal(19, 4),
  @CbplusedForPositions Decimal(19, 4),
  @OptionsPremium       Decimal(19, 6),
  @TsComission          Decimal(19, 6),
  @Kgo                  Decimal(19, 6),
  @FirmName             VarChar(30),
  @CurrCode             VarChar(4),
  @RealVarMargin        Decimal(19, 6)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 3 -- 

  EXEC [Quik].[Limits::Derivatives::Modify]
    @FirmId               = @FirmId,
    @TrdAccId             = @TrdAccId,
    @Type                 = @Type,
    @LoadDate             = @LoadDate,
    @Accruedint           = @Accruedint,
    @CbpLimit             = @CbpLimit,
    @CbplPlanned          = @CbplPlanned,
    @CbplUsed             = @CbplUsed,
    @CbpPrevLimit         = @CbpPrevLimit,
    @LiquidityCoeff       = @LiquidityCoeff,
    @Varmargin            = @Varmargin,
    @CbplusedForOrders    = @CbplusedForOrders,
    @CbplusedForPositions = @CbplusedForPositions,
    @OptionsPremium       = @OptionsPremium,
    @TsComission          = @TsComission,
    @Kgo                  = @Kgo,
    @FirmName             = @FirmName,
    @CurrCode             = @CurrCode,
    @RealVarMargin        = @RealVarMargin,
    @Source_Id            = @Source_Id 

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Limits::Money::Modify]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Limits::Money::Modify]
  @LoadDate        DateTime,
  @ClientCode      VarChar(12),
  @CurrCode        VarChar(4),
  @FirmId          VarChar(12),
  @Tag             VarChar(4),
  @LimitKind       VarChar(3),
  @Leverage        Decimal(19, 4),
  @LockedValueCoef Decimal(19, 4),
  @CurrentBal      Decimal(19, 2),
  @CurrentLimit    Decimal(19, 2),
  @Locked          Decimal(19, 2),
  @OpenBal         Decimal(19, 2),
  @OpenLimit       Decimal(19, 2),
  @FirmName        VarChar(30),
  @Source_Id       TinyInt
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @TradeParticipant_Id Int
    
  BEGIN TRY
    IF @ClientCode IS NULL
      RaisError('   @ClientCode', 16, 2)  

    IF @FirmId IS NULL
      RaisError('   @FirmId', 16, 2)  

    IF @CurrCode IS NULL
      RaisError('   @CurrCode', 16, 2) 

    IF @LoadDate IS NULL
      RaisError('   @LoadDate', 16, 2) 

    IF @Tag IS NULL
      RaisError('   @Tag', 16, 2) 

    IF @LimitKind IS NULL
      RaisError('   @LimitKind', 16, 2) 
 
    IF @Source_Id IS NULL
      RaisError('   ', 16, 2)        
        
    SELECT TOP 1
      @TradeParticipant_Id = QT.[TradeParticipant_Id]
    FROM [Quik].[Places:Trade Participants] QT
    WHERE QT.[Code] = @FirmId    
      AND QT.[Source_Id] = @Source_Id --     ,   

    MERGE [Gate].[Limits:Money] T
    USING
    (
      SELECT
        @Source_Id,
        @TradeParticipant_Id,
        NULL,
        @ClientCode,
        @CurrCode,
        @Tag,
        @LimitKind,
        @LoadDate,
        @Leverage,
        @LockedValueCoef,
        @CurrentBal,
        @CurrentLimit,
        @Locked,
        @OpenBal,
        @OpenLimit
      WHERE @TradeParticipant_Id IS NOT NULL
    ) AS S ([Source_Id], [TradeParticipant_Id], [TradeParticipantCode], [ClientCode], [Currency], [Tag], [Kind], [TradeDate],
            [Leverage], [LockedValueRate], [CurrentBalance], [CurrentLimit], [Locked], [OpenBalance], [OpenLimit])
    ON T.[TradeParticipant_Id] = S.[TradeParticipant_Id] AND T.[TradeParticipantCode] IS NULL AND T.[TradeDate] = S.[TradeDate] AND T.[Currency] = S.[Currency] AND T.[Tag] = S.[Tag] AND T.[Kind] = S.[Kind]
    WHEN MATCHED THEN
      UPDATE SET
        [Source_Id]            = S.[Source_Id],
        [TradeParticipant_Id]  = S.[TradeParticipant_Id],
        [TradeParticipantCode] = S.[TradeParticipantCode],
        [ClientCode]           = S.[ClientCode],
        [Currency]             = S.[Currency],
        [Tag]                  = S.[Tag],
        [Kind]                 = S.[Kind],
        [TradeDate]            = S.[TradeDate],
        [Leverage]             = S.[Leverage],
        [LockedValueRate]      = S.[LockedValueRate],
        [CurrentBalance]       = S.[CurrentBalance],
        [CurrentLimit]         = S.[CurrentLimit],
        [Locked]               = S.[Locked],
        [OpenBalance]          = S.[OpenBalance],
        [OpenLimit]            = S.[OpenLimit]
    WHEN NOT MATCHED THEN 
      INSERT ([Source_Id], [TradeParticipant_Id], [TradeParticipantCode], [ClientCode], [Currency], [Tag], [Kind], [TradeDate],
              [Leverage], [LockedValueRate], [CurrentBalance], [CurrentLimit], [Locked], [OpenBalance], [OpenLimit])
      VALUES (S.[Source_Id], S.[TradeParticipant_Id], S.[TradeParticipantCode], S.[ClientCode], S.[Currency], S.[Tag], S.[Kind], S.[TradeDate],
              S.[Leverage], S.[LockedValueRate], S.[CurrentBalance], S.[CurrentLimit], S.[Locked], S.[OpenBalance], S.[OpenLimit]);

    MERGE [Gate].[Limits:Money] T
    USING
    (
      SELECT
        @Source_Id,
        NULL,
        @FirmId,
        @ClientCode,
        @CurrCode,
        @Tag,
        @LimitKind,
        @LoadDate,
        @Leverage,
        @LockedValueCoef,
        @CurrentBal,
        @CurrentLimit,
        @Locked,
        @OpenBal,
        @OpenLimit
      WHERE @TradeParticipant_Id IS NULL
    ) AS S ([Source_Id], [TradeParticipant_Id], [TradeParticipantCode], [ClientCode], [Currency], [Tag], [Kind], [TradeDate],
            [Leverage], [LockedValueRate], [CurrentBalance], [CurrentLimit], [Locked], [OpenBalance], [OpenLimit])
    ON T.[TradeParticipant_Id] IS NULL AND T.[TradeParticipantCode] = S.[TradeParticipantCode] AND T.[TradeDate] = S.[TradeDate] AND T.[Currency] = S.[Currency] AND T.[Tag] = S.[Tag] AND T.[Kind] = S.[Kind]
    WHEN MATCHED THEN
      UPDATE SET
        [Source_Id]            = S.[Source_Id],
        [TradeParticipant_Id]  = S.[TradeParticipant_Id],
        [TradeParticipantCode] = S.[TradeParticipantCode],
        [ClientCode]           = S.[ClientCode],
        [Currency]             = S.[Currency],
        [Tag]                  = S.[Tag],
        [Kind]                 = S.[Kind],
        [TradeDate]            = S.[TradeDate],
        [Leverage]             = S.[Leverage],
        [LockedValueRate]      = S.[LockedValueRate],
        [CurrentBalance]       = S.[CurrentBalance],
        [CurrentLimit]         = S.[CurrentLimit],
        [Locked]               = S.[Locked],
        [OpenBalance]          = S.[OpenBalance],
        [OpenLimit]            = S.[OpenLimit]
    WHEN NOT MATCHED THEN 
      INSERT ([Source_Id], [TradeParticipant_Id], [TradeParticipantCode], [ClientCode], [Currency], [Tag], [Kind], [TradeDate],
              [Leverage], [LockedValueRate], [CurrentBalance], [CurrentLimit], [Locked], [OpenBalance], [OpenLimit])
      VALUES (S.[Source_Id], S.[TradeParticipant_Id], S.[TradeParticipantCode], S.[ClientCode], S.[Currency], S.[Tag], S.[Kind], S.[TradeDate],
              S.[Leverage], S.[LockedValueRate], S.[CurrentBalance], S.[CurrentLimit], S.[Locked], S.[OpenBalance], S.[OpenLimit]);

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [Quik].[Limits::Money::Modify#Aton]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Limits::Money::Modify#Aton]
  @LoadDate        DateTime,
  @ClientCode      VarChar(12),
  @CurrCode        VarChar(4),
  @FirmId          VarChar(12),
  @Tag             VarChar(4),
  @LimitKind       VarChar(3),
  @Leverage        Decimal(19, 4),
  @LockedValueCoef Decimal(19, 4),
  @CurrentBal      Decimal(19, 2),
  @CurrentLimit    Decimal(19, 2),
  @Locked          Decimal(19, 2),
  @OpenBal         Decimal(19, 2),
  @OpenLimit       Decimal(19, 2),
  @FirmName        VarChar(30)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 1 -- Aton

  EXEC [Quik].[Limits::Money::Modify]
    @LoadDate        = @LoadDate,
    @ClientCode      = @ClientCode,
    @CurrCode        = @CurrCode,
    @FirmId          = @FirmId,
    @Tag             = @Tag,
    @LimitKind       = @LimitKind,
    @Leverage        = @Leverage,
    @LockedValueCoef = @LockedValueCoef,
    @CurrentBal      = @CurrentBal,
    @CurrentLimit    = @CurrentLimit,
    @Locked          = @Locked,
    @OpenBal         = @OpenBal,
    @OpenLimit       = @OpenLimit,
    @FirmName        = @FirmName,
    @Source_Id       = @Source_Id 

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Limits::Money::Modify#OSL]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Limits::Money::Modify#OSL]
  @LoadDate        DateTime,
  @ClientCode      VarChar(12),
  @CurrCode        VarChar(4),
  @FirmId          VarChar(12),
  @Tag             VarChar(4),
  @LimitKind       VarChar(3),
  @Leverage        Decimal(19, 4),
  @LockedValueCoef Decimal(19, 4),
  @CurrentBal      Decimal(19, 2),
  @CurrentLimit    Decimal(19, 2),
  @Locked          Decimal(19, 2),
  @OpenBal         Decimal(19, 2),
  @OpenLimit       Decimal(19, 2),
  @FirmName        VarChar(30)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 3 -- 

  EXEC [Quik].[Limits::Money::Modify]
    @LoadDate        = @LoadDate,
    @ClientCode      = @ClientCode,
    @CurrCode        = @CurrCode,
    @FirmId          = @FirmId,
    @Tag             = @Tag,
    @LimitKind       = @LimitKind,
    @Leverage        = @Leverage,
    @LockedValueCoef = @LockedValueCoef,
    @CurrentBal      = @CurrentBal,
    @CurrentLimit    = @CurrentLimit,
    @Locked          = @Locked,
    @OpenBal         = @OpenBal,
    @OpenLimit       = @OpenLimit,
    @FirmName        = @FirmName,
    @Source_Id       = @Source_Id 

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Limits::Securities::Modify]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Limits::Securities::Modify]
  @ClientCode       VarChar(12),
  @SecCode          VarChar(12),
  @FirmId           VarChar(12),
  @Trdacc           VarChar(12),
  @LoadDate         DateTime,
  @LimitKind        VarChar(3),
  @LockedSellValue  Decimal(19, 2),
  @LockedBuy        Decimal(19, 2),
  @LockedBuyValue   Decimal(19, 4),
  @CurrentBal       Decimal(19, 2),
  @CurrentLimit     Decimal(19, 2),
  @LockedSell       Decimal(19, 2),
  @OpenBal          Decimal(19, 2),
  @OpenLimit        Decimal(19, 2),
  @FirmName         VarChar(30),
  @SecName          VarChar(64),
  @AwgPositionPrice Decimal(19, 6),
  @Source_Id        TinyInt
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @TradeParticipant_Id Int,
    @TradeAccount_Id     Int,
    @Instrument_Id       Int
    
  BEGIN TRY
    IF @ClientCode IS NULL
      RaisError('   @ClientCode', 16, 2)  

    IF @FirmId IS NULL
      RaisError('   @FirmId', 16, 2)  

    IF @SecCode IS NULL
      RaisError('   @SecCode', 16, 2) 

    IF @LoadDate IS NULL
      RaisError('   @LoadDate', 16, 2) 

    IF @Trdacc IS NULL
      RaisError('   @Trdacc', 16, 2) 

    IF @LimitKind IS NULL
      RaisError('   @LimitKind', 16, 2) 
 
    IF @Source_Id IS NULL
      RaisError('   ', 16, 2)        
        
    SELECT TOP 1
      @TradeParticipant_Id = QT.[TradeParticipant_Id]
    FROM [Quik].[Places:Trade Participants] QT
    WHERE QT.[Code] = @FirmId    
      AND QT.[Source_Id] = @Source_Id --     ,   

    IF @TradeParticipant_Id IS NOT NULL
      SELECT
        @TradeAccount_Id = [Id]
      FROM [Gate].[Trade Accounts]
      WHERE [Code] = @Trdacc
        AND [Source_Id] = @Source_Id
        AND [TradeParticipant_Id] = @TradeParticipant_Id

    IF @TradeAccount_Id IS NOT NULL
      SELECT
        @Instrument_Id = [Id]
      FROM [Gate].[Instruments]
      WHERE [Code] = @SecCode
        AND [Source_Id] = @Source_Id

    MERGE [Gate].[Limits:Securities] T
    USING
    (
      SELECT
        @Source_Id,
        @TradeAccount_Id,
        NULL,
        NULL,
        @Instrument_Id,
        NULL,
        @ClientCode,
        @LimitKind,
        @LoadDate,
        @LockedSell,
        @LockedSellValue,
        @LockedBuy,
        @LockedBuyValue,
        @CurrentBal,
        @CurrentLimit,
        @OpenBal,
        @OpenLimit,
        @AwgPositionPrice
      WHERE @TradeAccount_Id IS NOT NULL
        AND @Instrument_Id IS NOT NULL
    ) AS S ([Source_Id], [TradeAccount_Id], [TradeAccountCode], [TradeParticipantCode], [Instrument_Id], [InstrumentCode],
            [ClientCode], [Kind], [TradeDate], [LockedSell], [LockedSellValue], [LockedBuy], [LockedBuyValue],
            [CurrentBalance], [CurrentLimit], [OpenBalance], [OpenLimit], [AvgPositionPrice])
    ON T.[TradeAccount_Id] = S.[TradeAccount_Id] AND T.[TradeAccountCode] IS NULL AND T.[TradeParticipantCode] IS NULL AND T.[Instrument_Id] = S.[Instrument_Id] AND T.[InstrumentCode] IS NULL AND T.[TradeDate] = S.[TradeDate] AND T.[ClientCode] = S.[ClientCode] AND T.[Kind] = S.[Kind]
    WHEN MATCHED THEN
      UPDATE SET
        [Source_Id]            = S.[Source_Id],
        [TradeAccount_Id]      = S.[TradeAccount_Id],
        [TradeAccountCode]     = S.[TradeAccountCode],
        [TradeParticipantCode] = S.[TradeParticipantCode],
        [Instrument_Id]        = S.[Instrument_Id],
        [InstrumentCode]       = S.[InstrumentCode],
        [ClientCode]           = S.[ClientCode],
        [Kind]                 = S.[Kind],
        [TradeDate]            = S.[TradeDate],
        [LockedSell]           = S.[LockedSell],
        [LockedSellValue]      = S.[LockedSellValue],
        [LockedBuy]            = S.[LockedBuy],
        [LockedBuyValue]       = S.[LockedBuyValue],
        [CurrentBalance]       = S.[CurrentBalance],
        [CurrentLimit]         = S.[CurrentLimit],
        [OpenBalance]          = S.[OpenBalance],
        [OpenLimit]            = S.[OpenLimit],
        [AvgPositionPrice]     = S.[AvgPositionPrice]
    WHEN NOT MATCHED THEN 
      INSERT ([Source_Id], [TradeAccount_Id], [TradeAccountCode], [TradeParticipantCode], [Instrument_Id], [InstrumentCode],
              [ClientCode], [Kind], [TradeDate], [LockedSell], [LockedSellValue], [LockedBuy], [LockedBuyValue],
              [CurrentBalance], [CurrentLimit], [OpenBalance], [OpenLimit], [AvgPositionPrice])
      VALUES (S.[Source_Id], S.[TradeAccount_Id], S.[TradeAccountCode], S.[TradeParticipantCode], S.[Instrument_Id], S.[InstrumentCode],
              S.[ClientCode], S.[Kind], S.[TradeDate], S.[LockedSell], S.[LockedSellValue], S.[LockedBuy], S.[LockedBuyValue],
              S.[CurrentBalance], S.[CurrentLimit], S.[OpenBalance], S.[OpenLimit], S.[AvgPositionPrice]);

    MERGE [Gate].[Limits:Securities] T
    USING
    (
      SELECT
        @Source_Id,
        NULL,
        @Trdacc,
        @FirmId,
        NULL,
        @SecCode,
        @ClientCode,
        @LimitKind,
        @LoadDate,
        @LockedSell,
        @LockedSellValue,
        @LockedBuy,
        @LockedBuyValue,
        @CurrentBal,
        @CurrentLimit,
        @OpenBal,
        @OpenLimit,
        @AwgPositionPrice
      WHERE @TradeAccount_Id IS NULL
         OR @Instrument_Id IS NULL
    ) AS S ([Source_Id], [TradeAccount_Id], [TradeAccountCode], [TradeParticipantCode], [Instrument_Id], [InstrumentCode],
            [ClientCode], [Kind], [TradeDate], [LockedSell], [LockedSellValue], [LockedBuy], [LockedBuyValue],
            [CurrentBalance], [CurrentLimit], [OpenBalance], [OpenLimit], [AvgPositionPrice])
    ON T.[TradeAccount_Id] IS NULL AND T.[TradeAccountCode] = S.[TradeAccountCode] AND T.[TradeParticipantCode] = S.[TradeParticipantCode] AND T.[Instrument_Id] IS NULL AND T.[InstrumentCode] = S.[InstrumentCode] AND T.[TradeDate] = S.[TradeDate] AND T.[ClientCode] = S.[ClientCode] AND T.[Kind] = S.[Kind]
    WHEN MATCHED THEN
      UPDATE SET
        [Source_Id]            = S.[Source_Id],
        [TradeAccount_Id]      = S.[TradeAccount_Id],
        [TradeAccountCode]     = S.[TradeAccountCode],
        [TradeParticipantCode] = S.[TradeParticipantCode],
        [Instrument_Id]        = S.[Instrument_Id],
        [InstrumentCode]       = S.[InstrumentCode],
        [ClientCode]           = S.[ClientCode],
        [Kind]                 = S.[Kind],
        [TradeDate]            = S.[TradeDate],
        [LockedSell]           = S.[LockedSell],
        [LockedSellValue]      = S.[LockedSellValue],
        [LockedBuy]            = S.[LockedBuy],
        [LockedBuyValue]       = S.[LockedBuyValue],
        [CurrentBalance]       = S.[CurrentBalance],
        [CurrentLimit]         = S.[CurrentLimit],
        [OpenBalance]          = S.[OpenBalance],
        [OpenLimit]            = S.[OpenLimit],
        [AvgPositionPrice]     = S.[AvgPositionPrice]
    WHEN NOT MATCHED THEN 
      INSERT ([Source_Id], [TradeAccount_Id], [TradeAccountCode], [TradeParticipantCode], [Instrument_Id], [InstrumentCode],
              [ClientCode], [Kind], [TradeDate], [LockedSell], [LockedSellValue], [LockedBuy], [LockedBuyValue],
              [CurrentBalance], [CurrentLimit], [OpenBalance], [OpenLimit], [AvgPositionPrice])
      VALUES (S.[Source_Id], S.[TradeAccount_Id], S.[TradeAccountCode], S.[TradeParticipantCode], S.[Instrument_Id], S.[InstrumentCode],
              S.[ClientCode], S.[Kind], S.[TradeDate], S.[LockedSell], S.[LockedSellValue], S.[LockedBuy], S.[LockedBuyValue],
              S.[CurrentBalance], S.[CurrentLimit], S.[OpenBalance], S.[OpenLimit], S.[AvgPositionPrice]);

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [Quik].[Limits::Securities::Modify#Aton]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Limits::Securities::Modify#Aton]
  @ClientCode       VarChar(12),
  @SecCode          VarChar(12),
  @FirmId           VarChar(12),
  @Trdacc           VarChar(12),
  @LoadDate         DateTime,
  @LimitKind        VarChar(3),
  @LockedSellValue  Decimal(19, 2),
  @LockedBuy        Decimal(19, 2),
  @LockedBuyValue   Decimal(19, 4),
  @CurrentBal       Decimal(19, 2),
  @CurrentLimit     Decimal(19, 2),
  @LockedSell       Decimal(19, 2),
  @OpenBal          Decimal(19, 2),
  @OpenLimit        Decimal(19, 2),
  @FirmName         VarChar(30),
  @SecName          VarChar(64),
  @AwgPositionPrice Decimal(19, 6)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 1 -- Aton

  EXEC [Quik].[Limits::Securities::Modify]
    @ClientCode       = @ClientCode,
    @SecCode          = @SecCode,
    @FirmId           = @FirmId,
    @Trdacc           = @Trdacc,
    @LoadDate         = @LoadDate,
    @LimitKind        = @LimitKind,
    @LockedSellValue  = @LockedSellValue,
    @LockedBuy        = @LockedBuy,
    @LockedBuyValue   = @LockedBuyValue,
    @CurrentBal       = @CurrentBal,
    @CurrentLimit     = @CurrentLimit,
    @LockedSell       = @LockedSell,
    @OpenBal          = @OpenBal,
    @OpenLimit        = @OpenLimit,
    @FirmName         = @FirmName,
    @SecName          = @SecName,
    @AwgPositionPrice = @AwgPositionPrice,
    @Source_Id        = @Source_Id 

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Limits::Securities::Modify#OSL]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Limits::Securities::Modify#OSL]
  @ClientCode       VarChar(12),
  @SecCode          VarChar(12),
  @FirmId           VarChar(12),
  @Trdacc           VarChar(12),
  @LoadDate         DateTime,
  @LimitKind        VarChar(3),
  @LockedSellValue  Decimal(19, 2),
  @LockedBuy        Decimal(19, 2),
  @LockedBuyValue   Decimal(19, 4),
  @CurrentBal       Decimal(19, 2),
  @CurrentLimit     Decimal(19, 2),
  @LockedSell       Decimal(19, 2),
  @OpenBal          Decimal(19, 2),
  @OpenLimit        Decimal(19, 2),
  @FirmName         VarChar(30),
  @SecName          VarChar(64),
  @AwgPositionPrice Decimal(19, 6)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 3 -- 

  EXEC [Quik].[Limits::Securities::Modify]
    @ClientCode       = @ClientCode,
    @SecCode          = @SecCode,
    @FirmId           = @FirmId,
    @Trdacc           = @Trdacc,
    @LoadDate         = @LoadDate,
    @LimitKind        = @LimitKind,
    @LockedSellValue  = @LockedSellValue,
    @LockedBuy        = @LockedBuy,
    @LockedBuyValue   = @LockedBuyValue,
    @CurrentBal       = @CurrentBal,
    @CurrentLimit     = @CurrentLimit,
    @LockedSell       = @LockedSell,
    @OpenBal          = @OpenBal,
    @OpenLimit        = @OpenLimit,
    @FirmName         = @FirmName,
    @SecName          = @SecName,
    @AwgPositionPrice = @AwgPositionPrice,
    @Source_Id        = @Source_Id 

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Orders::Modify]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Orders::Modify]
  @OrderNum         Decimal(19, 0),
  @ClassCode        VarChar(12),
  @TradeDate        DateTime,
  @Accruedint       Decimal(19, 4), 
  @Price            Decimal(19, 6), 
  @Value            Decimal(19, 4), 
  @Yield            Decimal(19, 4), 
  @Price2           Decimal(19, 6), 
  @Balance          Decimal(10, 0), 
  @OrderTime        DateTime, 
  @Qty              Decimal(19, 0), 
  @UID              Decimal(10, 0), 
  @WithdrawTime     DateTime, 
  @OrderDate        DateTime, 
  @Account          VarChar(12), 
  @BrokerRef        VarChar(20), 
  @ClientCode       VarChar(12), 
  @UserId           VarChar(32), 
  @SettleCode       VarChar(12), 
  @Operation        VarChar(12),
  @State            VarChar(12), 
  @Type             VarChar(12), 
  @FirmId           VarChar(12), 
  @FirmName         VarChar(30), 
  @ExchangeCode     VarChar(64), 
  @SecName          VarChar(255), 
  @SecCode          VarChar(12), 
  @ClassName        VarChar(255), 
  @ActivationTime   DateTime, 
  @LinkedOrder      Decimal(19, 0), 
  @Expiry           VarChar(20), 
  @IsMarketMaker    VarChar(8), 
  @Period           VarChar(16),
  @Visible          Decimal(19, 0), 
  @OrderTimeMs      Decimal(19, 0), 
  @WithdrawTimeMs   Decimal(19, 0), 
  @BankAccId        VarChar(12), 
  @ValueEntryType   VarChar(16), 
  @RepoTerm         SmallInt, 
  @RepoValue        Decimal(19, 4), 
  @Repo2Value       Decimal(19, 4), 
  @RepoValueBalance Decimal(19, 4), 
  @StartDiscount    Decimal(19, 6), 
  @RejectReason     VarChar(128), 
  @ExtOrderFlags    Int, 
  @MinQty           Decimal(19, 0), 
  @ExecType         VarChar(32), 
  @SideQualifier    SmallInt, 
  @AcntType         SmallInt, 
  @Capacity         SmallInt, 
  @PassiveOnlyOrder SmallInt,
  @Source_Id        TinyInt
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Ignore              Bit,
    @TradeParticipant_Id Int,
    @TradeBoard_Id       Int,
    @TradeAccount_Id     Int,
    @Instrument_Id       Int,
    @BuySell             Char(1),
    @Status              Char(1),
    @PriceKind           Char(1),
    @SignDisableSplit    Char(1),
    @ExecuteMethod       Char(1),
    @ActivationType      Char(1),
    @ExpireDate          Date,
    @SignMarketMaker     Bit,
    @SessionPeriod       Char(1),
    @PriceEntryType      Char(1)
    --@DealType            Char(1),

  BEGIN TRY
    IF @TradeDate IS NULL
      RaisError('   @TradeDate', 16, 2)  

    IF @OrderNum IS NULL
      RaisError('   @OrderNum', 16, 2)  

    IF @ClassCode IS NULL
      RaisError('   @ClassCode', 16, 2) 

    IF @OrderTime IS NULL
      RaisError('   @OrderTime', 16, 2)  

    IF @OrderDate IS NULL
      RaisError('   @OrderDate', 16, 2) 
 
    IF @Source_Id IS NULL
      RaisError('   ', 16, 2)        

    SET @PriceKind        = [Quik].[Order::Value::To PriceKind](@Type)
    SET @SignDisableSplit = [Quik].[Order::Value::To SignDisableSplit](@Type)                  
    SET @ExecuteMethod    = [Quik].[Order::Value::To ExecuteMethod](@Type)     
    SET @ActivationType   = [Quik].[Order::Value::To ActivationType](@ActivationTime)                           
    SET @ExpireDate       = [Quik].[Order::Value::To ExpireDate](@Expiry, @TradeDate)
    SET @SessionPeriod    = [Quik].[Order::Value::To Period](@Period)
    SET @PriceEntryType   = [Quik].[Order::Value::To PriceEntryType](@ValueEntryType)
        
    SET @BuySell          = [Quik].[Order::Value::To BuySell](@Operation)

    IF @Operation IS NOT NULL AND @BuySell IS NULL
      RaisError('   @Operation', 16, 2)

    SET @Status = [Quik].[Order::Value::To Status](@State)

    IF @State IS NOT NULL AND @Status IS NULL
      RaisError('   @State', 16, 2)

    SET @SignMarketMaker  = [Quik].[Order::Value::To SignMarketMaker](@IsMarketMaker)

    IF @IsMarketMaker IS NOT NULL AND @SignMarketMaker IS NULL       --   ,       ,  
      RaisError('   @IsMarketMaker', 16, 2) --    , 

    SELECT
      @TradeBoard_Id = [TradeBoard_Id],
      @Ignore        = [Ignore]
    FROM [Quik].[Dic:Places:Trade Boards]
    WHERE [Code] = @ClassCode
      AND [Source_Id] = @Source_Id

    IF @Ignore = 1 --     
      RETURN 1

    SELECT
      @TradeParticipant_Id = QT.[TradeParticipant_Id]
    FROM [Quik].[Places:Trade Participants] QT
    INNER JOIN [Gate].[Places:Trade Participants] GT ON GT.[Id] = QT.[TradeParticipant_Id]
    INNER JOIN [Gate].[Dic:Places:Trade Boards] GB ON GB.[Place_Id] = GT.[Place_Id]
    WHERE QT.[Code] = @FirmId    
      AND QT.[Source_Id] = @Source_Id
      AND GB.[Id] = @TradeBoard_Id

    SELECT
      @TradeAccount_Id = [Id]
    FROM [Gate].[Trade Accounts]
    WHERE [Code] = @Account
      AND [Source_Id] = @Source_Id
      AND [TradeParticipant_Id] = @TradeParticipant_Id

    SELECT
      @Instrument_Id = [Id]
    FROM [Gate].[Instruments]
    WHERE [Code] = @SecCode
      AND [Source_Id] = @Source_Id

    MERGE [Gate].[Orders] T
    USING
    (
      SELECT
        @Source_Id,
        @OrderNum,
        @TradeDate,
        NULL,
        @TradeBoard_Id,
        CASE WHEN @TradeBoard_Id IS NULL THEN @ClassCode END,
        @Accruedint,
        @Price,
        @Value,
        @Yield,
        @Price2,
        @Qty,
        @OrderDate + @OrderTime,
        @WithdrawTime,
        @TradeAccount_Id,
        CASE WHEN @TradeAccount_Id IS NULL THEN @Account END,
        @BrokerRef,
        NULL,
        @ClientCode,
        @SettleCode,
        @BuySell,
        @Status,
        @PriceKind,
        @SignDisableSplit,
        @ExecuteMethod,
        CASE WHEN @TradeParticipant_Id IS NULL THEN @FirmId END,                   
        @Instrument_Id,
        CASE WHEN @Instrument_Id IS NULL THEN @SecCode END,
        @ActivationTime,
        @ActivationType,
        @ExpireDate,
        @SignMarketMaker,
        @SessionPeriod,
        @Visible,
        @OrderTimeMs,
        @WithdrawTimeMs,
        @BankAccId,
        @PriceEntryType,
        @RepoTerm,
        @StartDiscount,
        @RejectReason,    
        NULL
    ) AS S ([Source_Id], [Number], [SessionDate], [SessionId], [TradeBoard_Id], [TradeBoardCode], [Accruedint], [Price], [Value], [Yield], [Price2], [Quantity], [CreateDateTime],
            [CancelDateTime], [TradeAccount_Id], [TradeAccountCode], [BrokerRef], [ExternalRef], [ClientCode], [SettleCode], [BuySell], [Status], [PriceKind], [SignDisableSplit],
            [ExecuteMethod], [TradeParticipantCode], [Instrument_Id], [InstrumentCode], [ActivationDateTime], [ActivationType], [ExpireDate], [SignMarketMaker], [Period],
            [QuantityVisible], [CreateTimeMcs], [CancelTimeMcs], [BankAccount], [PriceEntryType], [RepoDays], [DiscountStart], [RejectReason], [DealType])
    ON T.[Number] = S.[Number] AND T.[Source_Id] = S.[Source_Id] AND T.[SessionDate] = S.[SessionDate] AND (T.[TradeBoard_Id] = S.[TradeBoard_Id] OR T.[TradeBoardCode] = S.[TradeBoardCode])
    WHEN MATCHED THEN
      UPDATE SET
        [SessionId]            = S.[SessionId],
        [Accruedint]           = S.[Accruedint],
        [Price]                = S.[Price],
        [Value]                = S.[Value],
        [Yield]                = S.[Yield],
        [Price2]               = S.[Price2],
        [Quantity]             = S.[Quantity],
        [CreateDateTime]       = S.[CreateDateTime],
        [CancelDateTime]       = S.[CancelDateTime],
        [TradeAccount_Id]      = S.[TradeAccount_Id],
        [TradeAccountCode]     = S.[TradeAccountCode],
        [BrokerRef]            = S.[BrokerRef],
        [ExternalRef]          = S.[ExternalRef],
        [ClientCode]           = S.[ClientCode],
        [SettleCode]           = S.[SettleCode],
        [BuySell]              = S.[BuySell],
        [Status]               = S.[Status],
        [PriceKind]            = S.[PriceKind],
        [SignDisableSplit]     = S.[SignDisableSplit],
        [ExecuteMethod]        = S.[ExecuteMethod],
        [TradeParticipantCode] = S.[TradeParticipantCode],
        [Instrument_Id]        = S.[Instrument_Id],
        [InstrumentCode]       = S.[InstrumentCode],
        [ActivationDateTime]   = S.[ActivationDateTime],
        [ActivationType]       = S.[ActivationType],
        [ExpireDate]           = S.[ExpireDate],
        [SignMarketMaker]      = S.[SignMarketMaker],
        [Period]               = S.[Period],
        [QuantityVisible]      = S.[QuantityVisible],
        [CreateTimeMcs]        = S.[CreateTimeMcs],
        [CancelTimeMcs]        = S.[CancelTimeMcs],
        [BankAccount]          = S.[BankAccount],
        [PriceEntryType]       = S.[PriceEntryType],
        [RepoDays]             = S.[RepoDays],
        [DiscountStart]        = S.[DiscountStart],
        [RejectReason]         = S.[RejectReason],
        [DealType]             = S.[DealType]
    WHEN NOT MATCHED THEN 
      INSERT ([Source_Id], [Number], [SessionDate], [SessionId], [TradeBoard_Id], [TradeBoardCode], [Accruedint], [Price], [Value], [Yield], [Price2], [Quantity], [CreateDateTime],
              [CancelDateTime], [TradeAccount_Id], [TradeAccountCode], [BrokerRef], [ExternalRef], [ClientCode], [SettleCode], [BuySell], [Status], [PriceKind], [SignDisableSplit],
              [ExecuteMethod], [TradeParticipantCode], [Instrument_Id], [InstrumentCode], [ActivationDateTime], [ActivationType], [ExpireDate], [SignMarketMaker], [Period],
              [QuantityVisible], [CreateTimeMcs], [CancelTimeMcs], [BankAccount], [PriceEntryType], [RepoDays], [DiscountStart], [RejectReason], [DealType])
      VALUES (S.[Source_Id], S.[Number], S.[SessionDate], S.[SessionId], S.[TradeBoard_Id], S.[TradeBoardCode], S.[Accruedint], S.[Price], S.[Value], S.[Yield], S.[Price2], S.[Quantity], S.[CreateDateTime],
              S.[CancelDateTime], S.[TradeAccount_Id], S.[TradeAccountCode], S.[BrokerRef], S.[ExternalRef], S.[ClientCode], S.[SettleCode], S.[BuySell], S.[Status], S.[PriceKind], S.[SignDisableSplit],
              S.[ExecuteMethod], S.[TradeParticipantCode], S.[Instrument_Id], S.[InstrumentCode], S.[ActivationDateTime], S.[ActivationType], S.[ExpireDate], S.[SignMarketMaker], S.[Period],
              S.[QuantityVisible], S.[CreateTimeMcs], S.[CancelTimeMcs], S.[BankAccount], S.[PriceEntryType], S.[RepoDays], S.[DiscountStart], S.[RejectReason], S.[DealType]);

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [Quik].[Orders::Modify#Aton]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Orders::Modify#Aton]
  @OrderNum         Decimal(19, 0),
  @ClassCode        VarChar(12),
  @TradeDate        DateTime,
  @Accruedint       Decimal(19, 4), 
  @Price            Decimal(19, 6), 
  @Value            Decimal(19, 4), 
  @Yield            Decimal(19, 4), 
  @Price2           Decimal(19, 6), 
  @Balance          Decimal(10, 0), 
  @OrderTime        DateTime, 
  @Qty              Decimal(19, 0), 
  @UID              Decimal(10, 0), 
  @WithdrawTime     DateTime, 
  @OrderDate        DateTime, 
  @Account          VarChar(12), 
  @BrokerRef        VarChar(20), 
  @ClientCode       VarChar(12), 
  @UserId           VarChar(32), 
  @SettleCode       VarChar(12), 
  @Operation        VarChar(12),
  @State            VarChar(12), 
  @Type             VarChar(12), 
  @FirmId           VarChar(12), 
  @FirmName         VarChar(30), 
  @ExchangeCode     VarChar(64), 
  @SecName          VarChar(255), 
  @SecCode          VarChar(12), 
  @ClassName        VarChar(255), 
  @ActivationTime   DateTime, 
  @LinkedOrder      Decimal(19, 0), 
  @Expiry           VarChar(20), 
  @IsMarketMaker    VarChar(8), 
  @Period           VarChar(16),
  @Visible          Decimal(19, 0), 
  @OrderTimeMs      Decimal(19, 0), 
  @WithdrawTimeMs   Decimal(19, 0), 
  @BankAccId        VarChar(12), 
  @ValueEntryType   VarChar(16), 
  @RepoTerm         SmallInt, 
  @RepoValue        Decimal(19, 4), 
  @Repo2Value       Decimal(19, 4), 
  @RepoValueBalance Decimal(19, 4), 
  @StartDiscount    Decimal(19, 6), 
  @RejectReason     VarChar(128), 
  @ExtOrderFlags    Int, 
  @MinQty           Decimal(19, 0), 
  @ExecType         VarChar(32), 
  @SideQualifier    SmallInt, 
  @AcntType         SmallInt, 
  @Capacity         SmallInt, 
  @PassiveOnlyOrder SmallInt
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 1 -- Aton

  EXEC [Quik].[Orders::Modify]
    @OrderNum         = @OrderNum,
    @ClassCode        = @ClassCode,
    @TradeDate        = @TradeDate,
    @Accruedint       = @Accruedint,
    @Price            = @Price,
    @Value            = @Value,
    @Yield            = @Yield,
    @Price2           = @Price2,
    @Balance          = @Balance,
    @OrderTime        = @OrderTime,
    @Qty              = @Qty,
    @UID              = @UID,
    @WithdrawTime     = @WithdrawTime,
    @OrderDate        = @OrderDate,
    @Account          = @Account,
    @BrokerRef        = @BrokerRef,
    @ClientCode       = @ClientCode,
    @UserId           = @UserId,
    @SettleCode       = @SettleCode,
    @Operation        = @Operation,
    @State            = @State,
    @Type             = @Type,
    @FirmId           = @FirmId,
    @FirmName         = @FirmName,
    @ExchangeCode     = @ExchangeCode,
    @SecName          = @SecName,
    @SecCode          = @SecCode,
    @ClassName        = @ClassName,
    @ActivationTime   = @ActivationTime,
    @LinkedOrder      = @LinkedOrder,
    @Expiry           = @Expiry,
    @IsMarketMaker    = @IsMarketMaker,
    @Period           = @Period,
    @Visible          = @Visible,
    @OrderTimeMs      = @OrderTimeMs,
    @WithdrawTimeMs   = @WithdrawTimeMs,
    @BankAccId        = @BankAccId,
    @ValueEntryType   = @ValueEntryType,
    @RepoTerm         = @RepoTerm,
    @RepoValue        = @RepoValue,
    @Repo2Value       = @Repo2Value,
    @RepoValueBalance = @RepoValueBalance,
    @StartDiscount    = @StartDiscount,
    @RejectReason     = @RejectReason,
    @ExtOrderFlags    = @ExtOrderFlags,
    @MinQty           = @MinQty,
    @ExecType         = @ExecType,
    @SideQualifier    = @SideQualifier,
    @AcntType         = @AcntType,
    @Capacity         = @Capacity,
    @PassiveOnlyOrder = @PassiveOnlyOrder,
    @Source_Id        = @Source_Id

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Orders::Modify#OSL]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Orders::Modify#OSL]
  @OrderNum         Decimal(19, 0),
  @ClassCode        VarChar(12),
  @TradeDate        DateTime,
  @Accruedint       Decimal(19, 4), 
  @Price            Decimal(19, 6), 
  @Value            Decimal(19, 4), 
  @Yield            Decimal(19, 4), 
  @Price2           Decimal(19, 6), 
  @Balance          Decimal(10, 0), 
  @OrderTime        DateTime, 
  @Qty              Decimal(19, 0), 
  @UID              Decimal(10, 0), 
  @WithdrawTime     DateTime, 
  @OrderDate        DateTime, 
  @Account          VarChar(12), 
  @BrokerRef        VarChar(20), 
  @ClientCode       VarChar(12), 
  @UserId           VarChar(32), 
  @SettleCode       VarChar(12), 
  @Operation        VarChar(12),
  @State            VarChar(12), 
  @Type             VarChar(12), 
  @FirmId           VarChar(12), 
  @FirmName         VarChar(30), 
  @ExchangeCode     VarChar(64), 
  @SecName          VarChar(255), 
  @SecCode          VarChar(12), 
  @ClassName        VarChar(255), 
  @ActivationTime   DateTime, 
  @LinkedOrder      Decimal(19, 0), 
  @Expiry           VarChar(20), 
  @IsMarketMaker    VarChar(8), 
  @Period           VarChar(16),
  @Visible          Decimal(19, 0), 
  @OrderTimeMs      Decimal(19, 0), 
  @WithdrawTimeMs   Decimal(19, 0), 
  @BankAccId        VarChar(12), 
  @ValueEntryType   VarChar(16), 
  @RepoTerm         SmallInt, 
  @RepoValue        Decimal(19, 4), 
  @Repo2Value       Decimal(19, 4), 
  @RepoValueBalance Decimal(19, 4), 
  @StartDiscount    Decimal(19, 6), 
  @RejectReason     VarChar(128), 
  @ExtOrderFlags    Int, 
  @MinQty           Decimal(19, 0), 
  @ExecType         VarChar(32), 
  @SideQualifier    SmallInt, 
  @AcntType         SmallInt, 
  @Capacity         SmallInt, 
  @PassiveOnlyOrder SmallInt
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 3 -- 

  EXEC [Quik].[Orders::Modify]
    @OrderNum         = @OrderNum,
    @ClassCode        = @ClassCode,
    @TradeDate        = @TradeDate,
    @Accruedint       = @Accruedint,
    @Price            = @Price,
    @Value            = @Value,
    @Yield            = @Yield,
    @Price2           = @Price2,
    @Balance          = @Balance,
    @OrderTime        = @OrderTime,
    @Qty              = @Qty,
    @UID              = @UID,
    @WithdrawTime     = @WithdrawTime,
    @OrderDate        = @OrderDate,
    @Account          = @Account,
    @BrokerRef        = @BrokerRef,
    @ClientCode       = @ClientCode,
    @UserId           = @UserId,
    @SettleCode       = @SettleCode,
    @Operation        = @Operation,
    @State            = @State,
    @Type             = @Type,
    @FirmId           = @FirmId,
    @FirmName         = @FirmName,
    @ExchangeCode     = @ExchangeCode,
    @SecName          = @SecName,
    @SecCode          = @SecCode,
    @ClassName        = @ClassName,
    @ActivationTime   = @ActivationTime,
    @LinkedOrder      = @LinkedOrder,
    @Expiry           = @Expiry,
    @IsMarketMaker    = @IsMarketMaker,
    @Period           = @Period,
    @Visible          = @Visible,
    @OrderTimeMs      = @OrderTimeMs,
    @WithdrawTimeMs   = @WithdrawTimeMs,
    @BankAccId        = @BankAccId,
    @ValueEntryType   = @ValueEntryType,
    @RepoTerm         = @RepoTerm,
    @RepoValue        = @RepoValue,
    @Repo2Value       = @Repo2Value,
    @RepoValueBalance = @RepoValueBalance,
    @StartDiscount    = @StartDiscount,
    @RejectReason     = @RejectReason,
    @ExtOrderFlags    = @ExtOrderFlags,
    @MinQty           = @MinQty,
    @ExecType         = @ExecType,
    @SideQualifier    = @SideQualifier,
    @AcntType         = @AcntType,
    @Capacity         = @Capacity,
    @PassiveOnlyOrder = @PassiveOnlyOrder,
    @Source_Id        = @Source_Id

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Orders::Stop::Modify]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Orders::Stop::Modify]
  @StopOrderNum       Decimal(19, 0),
  @TradeDate          DateTime,
  @ConditionPrice     Decimal(19, 6),
  @LinkedOrder        Decimal(19, 0),
  @Price              Decimal(19, 6),
  @AllTradeNum        Decimal(19, 0),
  @CoOrderNum         Decimal(19, 0),
  @BaseOrderNum       Decimal(19, 0),
  @CoOrderPrice       Decimal(19, 6),
  @Offset             Decimal(19, 6),
  @Spread             Decimal(19, 6),
  @Qty                Decimal(19, 0),
  @ClassCode          VarChar(12),
  @StopOrderTime      DateTime,
  @Balance            Decimal(10, 0),
  @Condition          VarChar(12),
  @Expiry             VarChar(20),
  @FilledQty          Decimal(10, 0),
  @StopOrderDate      DateTime,
  @UID                Int,
  @Account            VarChar(12),
  @BrokerRef          VarChar(20),
  @ClientCode         VarChar(12),
  @FirmId             VarChar(12),
  @FirmName           VarChar(30),
  @State              VarChar(12),
  @StateDesc          VarChar(40),
  @OrderKind          VarChar(40),
  @Type               VarChar(40),
  @Mode               VarChar(20),
  @Operation          VarChar(12),
  @ConditionSecCode   VarChar(12),
  @ConditionSecName   VarChar(255),
  @ConditionClassCode VarChar(12),
  @ConditionClassName VarChar(255),
  @TransId            Decimal(10, 0),
  @OffsetUnits        VarChar(2),
  @SpreadUnits        VarChar(2),
  @ActiveFromTime     DateTime,
  @ActiveToTime       DateTime,
  @WithdrawTime       DateTime,
  @ConditionPrice2    Decimal(19, 6),
  @ActiveFromToTime   VarChar(2),
  @MarketStopLimit    VarChar(2),
  @MarketTakeProfit   VarChar(4),
  @OwnerServer        VarChar(16),
  @Source_Id          TinyInt
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Ignore                 Bit,
    @TradeParticipant_Id    Int,
    @TradeBoard_Id          Int,
    @TradeAccount_Id        Int,
    @ConditionInstrument_Id Int,
    @ConditionTradeBoard_Id Int,
    @LinkedOrder_Id         Int,
    @CoOrder_Id             Int,
    @BaseOrder_Id           Int,
    @ConditionDeal_Id       Int,
    @ConditionValue         TinyInt,
    @ExpireDate             Date,
    @Status                 Char(1),
    @PriceKind              Char(1),
    @SignDisableSplit       Char(1),
    @ExecuteMethod          Char(1),
    @BuySell                Char(1)

  BEGIN TRY
    IF @TradeDate IS NULL
      RaisError('   @TradeDate', 16, 2)  

    IF @StopOrderNum IS NULL
      RaisError('   @StopOrderNum', 16, 2)  

    IF @ClassCode IS NULL
      RaisError('   @ClassCode', 16, 2) 
 
    IF @Source_Id IS NULL
      RaisError('   ', 16, 2)   
                              
    SET @ExpireDate       = [Quik].[Order::Value::To ExpireDate](@Expiry, @TradeDate)
    SET @PriceKind        = [Quik].[Order::Value::To PriceKind](@Type)
    SET @SignDisableSplit = [Quik].[Order::Value::To SignDisableSplit](@Type)                  
    SET @ExecuteMethod    = [Quik].[Order::Value::To ExecuteMethod](@Type) 
       
    SET @BuySell          = [Quik].[Order::Value::To BuySell](@Operation)

    IF @Operation IS NOT NULL AND @BuySell IS NULL
      RaisError('   @Operation', 16, 2)

    SET @Status = [Quik].[Order::Value::To Status](@State)

    IF @State IS NOT NULL AND @Status IS NULL
      RaisError('   @State', 16, 2)

    SET @ConditionValue = [Quik].[Order::Value::To Condition](@Condition)

    IF @Condition IS NOT NULL AND @ConditionValue IS NULL
      RaisError('   @Condition', 16, 2)

    SELECT
      @TradeBoard_Id = [TradeBoard_Id],
      @Ignore        = [Ignore]
    FROM [Quik].[Dic:Places:Trade Boards]
    WHERE [Code] = @ClassCode
      AND [Source_Id] = @Source_Id

    IF @Ignore = 1 --     
      RETURN 1

    SELECT
      @TradeParticipant_Id = QT.[TradeParticipant_Id]
    FROM [Quik].[Places:Trade Participants] QT
    INNER JOIN [Gate].[Places:Trade Participants] GT ON GT.[Id] = QT.[TradeParticipant_Id]
    INNER JOIN [Gate].[Dic:Places:Trade Boards] GB ON GB.[Place_Id] = GT.[Place_Id]
    WHERE QT.[Code] = @FirmId    
      AND QT.[Source_Id] = @Source_Id
      AND GB.[Id] = @TradeBoard_Id

    SELECT
      @ConditionTradeBoard_Id = [TradeBoard_Id]
    FROM [Quik].[Dic:Places:Trade Boards]
    WHERE [Code] = @ConditionClassCode
      AND [Source_Id] = @Source_Id

    SELECT
      @TradeAccount_Id = [Id]
    FROM [Gate].[Trade Accounts]
    WHERE [Code] = @Account
      AND [Source_Id] = @Source_Id
      AND [TradeParticipant_Id] = @TradeParticipant_Id

    SELECT
      @ConditionInstrument_Id = [Id]
    FROM [Gate].[Instruments]
    WHERE [Code] = @ConditionSecCode
      AND [Source_Id] = @Source_Id
      
    SELECT
      @LinkedOrder_Id = [Id]
    FROM [Gate].[Orders]
    WHERE [Number] = @LinkedOrder
      AND [Source_Id] = @Source_Id
      AND ([TradeBoard_Id] = @TradeBoard_Id OR [TradeBoardCode] = @ClassCode)
      
    SELECT
      @BaseOrder_Id = [Id]
    FROM [Gate].[Orders]
    WHERE [Number] = @BaseOrderNum
      AND [Source_Id] = @Source_Id
      AND ([TradeBoard_Id] = @TradeBoard_Id OR [TradeBoardCode] = @ClassCode)
      
    SELECT
      @CoOrder_Id = [Id]
    FROM [Gate].[Orders]
    WHERE [Number] = @CoOrderNum
      AND [Source_Id] = @Source_Id
      AND ([TradeBoard_Id] = @TradeBoard_Id OR [TradeBoardCode] = @ClassCode)
      
    SELECT
      @ConditionDeal_Id = [Id]
    FROM [Gate].[Deals]
    WHERE [Number] = @AllTradeNum
      AND [Source_Id] = @Source_Id
      AND ([TradeBoard_Id] = @TradeBoard_Id OR [TradeBoardCode] = @ClassCode)        

    MERGE [Quik].[Orders:Stop] T
    USING
    (
      SELECT
        @Source_Id,
        @StopOrderNum,
        @TradeDate,
        @TradeBoard_Id,
        CASE WHEN @TradeBoard_Id IS NULL THEN @ClassCode END,
        @ConditionPrice,
        @LinkedOrder_Id,
        CASE WHEN @LinkedOrder_Id IS NULL THEN @LinkedOrder END,
        @Price,
        @ConditionDeal_Id,
        CASE WHEN @ConditionDeal_Id IS NULL THEN @AllTradeNum END,
        @CoOrder_Id,
        CASE WHEN @CoOrder_Id IS NULL THEN @CoOrderNum END,
        @BaseOrder_Id,
        CASE WHEN @BaseOrder_Id IS NULL THEN @BaseOrderNum END,
        @Offset,
        @Spread,
        @Qty,
        IsNull(@StopOrderDate, '19000101') + IsNull(@StopOrderTime, '00:00:00'),
        @Balance,
        @ConditionValue,
        @ExpireDate,
        @FilledQty,
        @TradeAccount_Id,
        CASE WHEN @TradeAccount_Id IS NULL THEN @Account END,
        @BrokerRef,
        @ClientCode,
        CASE WHEN @TradeParticipant_Id IS NULL THEN @FirmId END,
        @Status,
        @StateDesc,
        @OrderKind,
        @PriceKind,
        @SignDisableSplit,
        @ExecuteMethod,
        @Mode,
        @BuySell,
        @ConditionInstrument_Id,
        CASE WHEN @ConditionInstrument_Id IS NULL THEN @ConditionSecCode END,
        @ConditionTradeBoard_Id,
        CASE WHEN @ConditionTradeBoard_Id IS NULL THEN @ConditionClassCode END,
        @TransId,
        @OffsetUnits,
        @SpreadUnits,
        @ActiveFromTime,
        @ActiveToTime,
        @WithdrawTime,
        @ConditionPrice2,
        @MarketStopLimit,
        @MarketTakeProfit
    ) AS S ([Source_Id], [Number], [SessionDate], [TradeBoard_Id], [TradeBoardCode], [ConditionPrice], [LinkedOrder_Id], [LinkedOrderNumber],
            [Price], [ConditionDeal_Id], [ConditionDealNumber], [CoOrder_Id], [CoOrderNumber], [BaseOrder_Id], [BaseOrderNumber], [TakeProfitOffset],
            [TakeProfitSpread], [Quantity], [CreateDateTime], [Balance], [Condition], [ExpireDate], [FilledQuantity], [TradeAccount_Id], [TradeAccountCode],
            [BrokerRef], [ClientCode], [TradeParticipantCode], [Status], [StatusDescription], [Kind], [PriceKind], [SignDisableSplit], [ExecuteMethod],
            [Mode], [BuySell], [ConditionInstrument_Id], [ConditionInstrumentCode], [ConditionTradeBoard_Id], [ConditionTradeBoardCode], [TransactionId],
            [OffsetUnit], [SpreadUnit], [ActiveTimeStart], [ActiveTimeFinish], [CancelDateTime], [ConditionPrice2], [MarketStopLimit], [MarketTakeProfit])
    ON T.[Number] = S.[Number] AND T.[Source_Id] = S.[Source_Id] AND T.[SessionDate] = S.[SessionDate] AND (T.[TradeBoard_Id] = S.[TradeBoard_Id] OR T.[TradeBoardCode] = S.[TradeBoardCode])
    WHEN MATCHED THEN
      UPDATE SET
        [Source_Id]               = S.[Source_Id],
        [Number]                  = S.[Number],
        [SessionDate]             = S.[SessionDate],
        [TradeBoard_Id]           = S.[TradeBoard_Id],
        [TradeBoardCode]          = S.[TradeBoardCode],
        [ConditionPrice]          = S.[ConditionPrice],
        [LinkedOrder_Id]          = S.[LinkedOrder_Id],
        [LinkedOrderNumber]       = S.[LinkedOrderNumber],
        [Price]                   = S.[Price],
        [ConditionDeal_Id]        = S.[ConditionDeal_Id],
        [ConditionDealNumber]     = S.[ConditionDealNumber],
        [CoOrder_Id]              = S.[CoOrder_Id],
        [CoOrderNumber]           = S.[CoOrderNumber],
        [BaseOrder_Id]            = S.[BaseOrder_Id],
        [BaseOrderNumber]         = S.[BaseOrderNumber],
        [TakeProfitOffset]        = S.[TakeProfitOffset],
        [TakeProfitSpread]        = S.[TakeProfitSpread],
        [Quantity]                = S.[Quantity],
        [CreateDateTime]          = S.[CreateDateTime],
        [Balance]                 = S.[Balance],
        [Condition]               = S.[Condition],
        [ExpireDate]              = S.[ExpireDate],
        [FilledQuantity]          = S.[FilledQuantity],
        [TradeAccount_Id]         = S.[TradeAccount_Id],
        [TradeAccountCode]        = S.[TradeAccountCode],
        [BrokerRef]               = S.[BrokerRef],
        [ClientCode]              = S.[ClientCode],
        [TradeParticipantCode]    = S.[TradeParticipantCode],
        [Status]                  = S.[Status],
        [StatusDescription]       = S.[StatusDescription],
        [Kind]                    = S.[Kind],
        [PriceKind]               = S.[PriceKind],
        [SignDisableSplit]        = S.[SignDisableSplit],
        [ExecuteMethod]           = S.[ExecuteMethod],
        [Mode]                    = S.[Mode],
        [BuySell]                 = S.[BuySell],
        [ConditionInstrument_Id]  = S.[ConditionInstrument_Id],
        [ConditionInstrumentCode] = S.[ConditionInstrumentCode],
        [ConditionTradeBoard_Id]  = S.[ConditionTradeBoard_Id],
        [ConditionTradeBoardCode] = S.[ConditionTradeBoardCode],
        [TransactionId]           = S.[TransactionId],
        [OffsetUnit]              = S.[OffsetUnit],
        [SpreadUnit]              = S.[SpreadUnit],
        [ActiveTimeStart]         = S.[ActiveTimeStart],
        [ActiveTimeFinish]        = S.[ActiveTimeFinish],
        [CancelDateTime]          = S.[CancelDateTime],
        [ConditionPrice2]         = S.[ConditionPrice2],
        [MarketStopLimit]         = S.[MarketStopLimit],
        [MarketTakeProfit]        = S.[MarketTakeProfit]
    WHEN NOT MATCHED THEN 
      INSERT ([Source_Id], [Number], [SessionDate], [TradeBoard_Id], [TradeBoardCode], [ConditionPrice], [LinkedOrder_Id], [LinkedOrderNumber],
              [Price], [ConditionDeal_Id], [ConditionDealNumber], [CoOrder_Id], [CoOrderNumber], [BaseOrder_Id], [BaseOrderNumber], [TakeProfitOffset],
              [TakeProfitSpread], [Quantity], [CreateDateTime], [Balance], [Condition], [ExpireDate], [FilledQuantity], [TradeAccount_Id], [TradeAccountCode],
              [BrokerRef], [ClientCode], [TradeParticipantCode], [Status], [StatusDescription], [Kind], [PriceKind], [SignDisableSplit], [ExecuteMethod],
              [Mode], [BuySell], [ConditionInstrument_Id], [ConditionInstrumentCode], [ConditionTradeBoard_Id], [ConditionTradeBoardCode], [TransactionId],
              [OffsetUnit], [SpreadUnit], [ActiveTimeStart], [ActiveTimeFinish], [CancelDateTime], [ConditionPrice2], [MarketStopLimit], [MarketTakeProfit])
      VALUES (S.[Source_Id], S.[Number], S.[SessionDate], S.[TradeBoard_Id], S.[TradeBoardCode], S.[ConditionPrice], S.[LinkedOrder_Id], S.[LinkedOrderNumber],
              S.[Price], S.[ConditionDeal_Id], S.[ConditionDealNumber], S.[CoOrder_Id], S.[CoOrderNumber], S.[BaseOrder_Id], S.[BaseOrderNumber], S.[TakeProfitOffset],
              S.[TakeProfitSpread], S.[Quantity], S.[CreateDateTime], S.[Balance], S.[Condition], S.[ExpireDate], S.[FilledQuantity], S.[TradeAccount_Id], S.[TradeAccountCode],
              S.[BrokerRef], S.[ClientCode], S.[TradeParticipantCode], S.[Status], S.[StatusDescription], S.[Kind], S.[PriceKind], S.[SignDisableSplit], S.[ExecuteMethod],
              S.[Mode], S.[BuySell], S.[ConditionInstrument_Id], S.[ConditionInstrumentCode], S.[ConditionTradeBoard_Id], S.[ConditionTradeBoardCode], S.[TransactionId],
              S.[OffsetUnit], S.[SpreadUnit], S.[ActiveTimeStart], S.[ActiveTimeFinish], S.[CancelDateTime], S.[ConditionPrice2], S.[MarketStopLimit], S.[MarketTakeProfit]);

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [Quik].[Orders::Stop::Modify#Aton]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Orders::Stop::Modify#Aton]
  @StopOrderNum       Decimal(19, 0),
  @TradeDate          DateTime,
  @ConditionPrice     Decimal(19, 6),
  @LinkedOrder        Decimal(19, 0),
  @Price              Decimal(19, 6),
  @AllTradeNum        Decimal(19, 0),
  @CoOrderNum         Decimal(19, 0),
  @BaseOrderNum       Decimal(19, 0),
  @CoOrderPrice       Decimal(19, 6),
  @Offset             Decimal(19, 6),
  @Spread             Decimal(19, 6),
  @Qty                Decimal(19, 0),
  @ClassCode          VarChar(12),
  @StopOrderTime      DateTime,
  @Balance            Decimal(10, 0),
  @Condition          VarChar(12),
  @Expiry             VarChar(20),
  @FilledQty          Decimal(10, 0),
  @StopOrderDate      DateTime,
  @UID                Int,
  @Account            VarChar(12),
  @BrokerRef          VarChar(20),
  @ClientCode         VarChar(12),
  @FirmId             VarChar(12),
  @FirmName           VarChar(30),
  @State              VarChar(12),
  @StateDesc          VarChar(40),
  @OrderKind          VarChar(40),
  @Type               VarChar(40),
  @Mode               VarChar(20),
  @Operation          VarChar(12),
  @ConditionSecCode   VarChar(12),
  @ConditionSecName   VarChar(255),
  @ConditionClassCode VarChar(12),
  @ConditionClassName VarChar(255),
  @TransId            Decimal(10, 0),
  @OffsetUnits        VarChar(2),
  @SpreadUnits        VarChar(2),
  @ActiveFromTime     DateTime,
  @ActiveToTime       DateTime,
  @WithdrawTime       DateTime,
  @ConditionPrice2    Decimal(19, 6),
  @ActiveFromToTime   VarChar(2),
  @MarketStopLimit    VarChar(2),
  @MarketTakeProfit   VarChar(4),
  @OwnerServer        VarChar(16)
  ---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 1 -- Aton

  EXEC [Quik].[Orders::Stop::Modify]
    @StopOrderNum       = @StopOrderNum,
    @TradeDate          = @TradeDate,
    @ConditionPrice     = @ConditionPrice,
    @LinkedOrder        = @LinkedOrder,
    @Price              = @Price,
    @AllTradeNum        = @AllTradeNum,
    @CoOrderNum         = @CoOrderNum,
    @BaseOrderNum       = @BaseOrderNum,
    @CoOrderPrice       = @CoOrderPrice,
    @Offset             = @Offset,
    @Spread             = @Spread,
    @Qty                = @Qty,
    @ClassCode          = @ClassCode,
    @StopOrderTime      = @StopOrderTime,
    @Balance            = @Balance,
    @Condition          = @Condition,
    @Expiry             = @Expiry,
    @FilledQty          = @FilledQty,
    @StopOrderDate      = @StopOrderDate,
    @UID                = @UID,
    @Account            = @Account,
    @BrokerRef          = @BrokerRef,
    @ClientCode         = @ClientCode,
    @FirmId             = @FirmId,
    @FirmName           = @FirmName,
    @State              = @State,
    @StateDesc          = @StateDesc,
    @OrderKind          = @OrderKind,
    @Type               = @Type,
    @Mode               = @Mode,
    @Operation          = @Operation,
    @ConditionSecCode   = @ConditionSecCode,
    @ConditionSecName   = @ConditionSecName,
    @ConditionClassCode = @ConditionClassCode,
    @ConditionClassName = @ConditionClassName,
    @TransId            = @TransId,
    @OffsetUnits        = @OffsetUnits,
    @SpreadUnits        = @SpreadUnits,
    @ActiveFromTime     = @ActiveFromTime,
    @ActiveToTime       = @ActiveToTime,
    @WithdrawTime       = @WithdrawTime,
    @ConditionPrice2    = @ConditionPrice2,
    @ActiveFromToTime   = @ActiveFromToTime,
    @MarketStopLimit    = @MarketStopLimit,
    @MarketTakeProfit   = @MarketTakeProfit,
    @OwnerServer        = @OwnerServer,
    @Source_Id          = @Source_Id

  RETURN 1  

GO
/****** Object:  StoredProcedure [Quik].[Orders::Stop::Modify#OSL]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Orders::Stop::Modify#OSL]
  @StopOrderNum       Decimal(19, 0),
  @TradeDate          DateTime,
  @ConditionPrice     Decimal(19, 6),
  @LinkedOrder        Decimal(19, 0),
  @Price              Decimal(19, 6),
  @AllTradeNum        Decimal(19, 0),
  @CoOrderNum         Decimal(19, 0),
  @BaseOrderNum       Decimal(19, 0),
  @CoOrderPrice       Decimal(19, 6),
  @Offset             Decimal(19, 6),
  @Spread             Decimal(19, 6),
  @Qty                Decimal(19, 0),
  @ClassCode          VarChar(12),
  @StopOrderTime      DateTime,
  @Balance            Decimal(10, 0),
  @Condition          VarChar(12),
  @Expiry             VarChar(20),
  @FilledQty          Decimal(10, 0),
  @StopOrderDate      DateTime,
  @UID                Int,
  @Account            VarChar(12),
  @BrokerRef          VarChar(20),
  @ClientCode         VarChar(12),
  @FirmId             VarChar(12),
  @FirmName           VarChar(30),
  @State              VarChar(12),
  @StateDesc          VarChar(40),
  @OrderKind          VarChar(40),
  @Type               VarChar(40),
  @Mode               VarChar(20),
  @Operation          VarChar(12),
  @ConditionSecCode   VarChar(12),
  @ConditionSecName   VarChar(255),
  @ConditionClassCode VarChar(12),
  @ConditionClassName VarChar(255),
  @TransId            Decimal(10, 0),
  @OffsetUnits        VarChar(2),
  @SpreadUnits        VarChar(2),
  @ActiveFromTime     DateTime,
  @ActiveToTime       DateTime,
  @WithdrawTime       DateTime,
  @ConditionPrice2    Decimal(19, 6),
  @ActiveFromToTime   VarChar(2),
  @MarketStopLimit    VarChar(2),
  @MarketTakeProfit   VarChar(4),
  @OwnerServer        VarChar(16)
  ---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 3 -- 

  EXEC [Quik].[Orders::Stop::Modify]
    @StopOrderNum       = @StopOrderNum,
    @TradeDate          = @TradeDate,
    @ConditionPrice     = @ConditionPrice,
    @LinkedOrder        = @LinkedOrder,
    @Price              = @Price,
    @AllTradeNum        = @AllTradeNum,
    @CoOrderNum         = @CoOrderNum,
    @BaseOrderNum       = @BaseOrderNum,
    @CoOrderPrice       = @CoOrderPrice,
    @Offset             = @Offset,
    @Spread             = @Spread,
    @Qty                = @Qty,
    @ClassCode          = @ClassCode,
    @StopOrderTime      = @StopOrderTime,
    @Balance            = @Balance,
    @Condition          = @Condition,
    @Expiry             = @Expiry,
    @FilledQty          = @FilledQty,
    @StopOrderDate      = @StopOrderDate,
    @UID                = @UID,
    @Account            = @Account,
    @BrokerRef          = @BrokerRef,
    @ClientCode         = @ClientCode,
    @FirmId             = @FirmId,
    @FirmName           = @FirmName,
    @State              = @State,
    @StateDesc          = @StateDesc,
    @OrderKind          = @OrderKind,
    @Type               = @Type,
    @Mode               = @Mode,
    @Operation          = @Operation,
    @ConditionSecCode   = @ConditionSecCode,
    @ConditionSecName   = @ConditionSecName,
    @ConditionClassCode = @ConditionClassCode,
    @ConditionClassName = @ConditionClassName,
    @TransId            = @TransId,
    @OffsetUnits        = @OffsetUnits,
    @SpreadUnits        = @SpreadUnits,
    @ActiveFromTime     = @ActiveFromTime,
    @ActiveToTime       = @ActiveToTime,
    @WithdrawTime       = @WithdrawTime,
    @ConditionPrice2    = @ConditionPrice2,
    @ActiveFromToTime   = @ActiveFromToTime,
    @MarketStopLimit    = @MarketStopLimit,
    @MarketTakeProfit   = @MarketTakeProfit,
    @OwnerServer        = @OwnerServer,
    @Source_Id          = @Source_Id

  RETURN 1  

GO
/****** Object:  StoredProcedure [Quik].[Places::Trade Boards::Trade Dates::Modify]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Places::Trade Boards::Trade Dates::Modify]
  @TradeDate DateTime,
  @ClassCode VarChar(12),
  @ClassName VarChar(255),
  @FirmId    VarChar(12),
  @Flags     Int,
  @RFlags    Int,
  @Source_Id TinyInt
--- 
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Ignore              Bit,
    @TradeParticipant_Id SmallInt,
    @TradeBoard_Id       SmallInt

  BEGIN TRY
    IF @TradeDate IS NULL
      RaisError('   @TradeDate', 16, 2) 

    IF @ClassCode IS NULL
      RaisError('   @ClassCode', 16, 2) 

    IF @Source_Id IS NULL
      RaisError('   ', 16, 2)

    SELECT
      @TradeBoard_Id = [Id],
      @Ignore        = [Ignore]
    FROM [Quik].[Dic:Places:Trade Boards]
    WHERE [Code] = @ClassCode
      AND [Source_Id] = @Source_Id

    IF @Ignore = 1 --     
      RETURN 1

    SELECT
      @TradeParticipant_Id = QT.[TradeParticipant_Id]
    FROM [Quik].[Places:Trade Participants] QT
    INNER JOIN [Gate].[Places:Trade Participants] GT ON GT.[Id] = QT.[TradeParticipant_Id]
    INNER JOIN [Gate].[Dic:Places:Trade Boards] GB ON GB.[Place_Id] = GT.[Place_Id]
    WHERE QT.[Code] = @FirmId    
      AND QT.[Source_Id] = @Source_Id
      AND GB.[Id] = @TradeBoard_Id
    
    IF @TradeBoard_Id IS NULL BEGIN
      MERGE [Quik].[Dic:Places:Trade Boards] T
      USING
      (
        SELECT
          @ClassCode,
          @Source_Id,
          NULL
      ) AS S ([Code], [Source_Id], [TradeBoard_Id])
      ON T.[Code] = S.[Code] AND T.[Source_Id] =  S.[Source_Id]
      WHEN MATCHED THEN
        UPDATE SET
          @TradeBoard_Id = T.[Id]
      WHEN NOT MATCHED THEN
        INSERT ([Source_Id], [Code], [TradeBoard_Id])
        VALUES (S.[Source_Id], S.[Code], S.[TradeBoard_Id]);

      SET @TradeBoard_Id = IsNull(@TradeBoard_Id, Scope_Identity())
    END

    MERGE [Quik].[Places:Trade Boards:Trade Dates] T
    USING
    (
      SELECT
        ( 
          SELECT TOP 1
            T.[TradeDate]
          FROM
          (
            SELECT TOP 1
              [TradeDate]            = D.[TradeDate],
              [TradeParticipantCode] = IsNull(D.[TradeParticipantCode], QT.[Code]),
              [Name]                 = D.[Name],
              [Flags]                = D.[Flags],
              [RFlags]               = D.[RFlags]
            FROM [Quik].[Places:Trade Boards:Trade Dates] D 
            LEFT JOIN [Quik].[Places:Trade Participants] QT ON QT.[TradeParticipant_Id] = D.[TradeParticipant_Id] AND QT.[Code] = @FirmId AND QT.[Source_Id] = @Source_Id
            WHERE D.[TradeBoard_Id] = @TradeBoard_Id
              AND D.[TradeDate] <= @TradeDate
            ORDER BY D.[TradeDate] DESC
          ) T
          WHERE (T.[TradeParticipantCode] = @FirmId OR T.[TradeParticipantCode] IS NULL AND @FirmId IS NULL)
            AND (T.[Name]   = @ClassName OR T.[Name]   IS NULL AND @ClassName IS NULL)
            AND (T.[Flags]  = @Flags     OR T.[Flags]  IS NULL AND @Flags IS NULL)
            AND (T.[RFlags] = @RFlags    OR T.[RFlags] IS NULL AND @RFlags IS NULL)
        ),
        @TradeBoard_Id,
        @TradeParticipant_Id,
        CASE WHEN @TradeParticipant_Id IS NULL THEN @FirmId END,
        @ClassName,
        @Flags,
        @RFlags        
    ) AS S ([TradeDate], [TradeBoard_Id], [TradeParticipant_Id], [TradeParticipantCode], [Name], [Flags], [RFlags])
    ON T.[TradeDate] = @TradeDate AND T.[TradeBoard_Id] = S.[TradeBoard_Id]
    WHEN MATCHED AND S.[TradeDate] IS NULL THEN 
      UPDATE SET
        [TradeParticipant_Id]  = S.[TradeParticipant_Id],
        [TradeParticipantCode] = S.[TradeParticipantCode],
        [Name]                 = S.[Name],
        [Flags]                = S.[Flags],
        [RFlags]               = S.[RFlags]
    WHEN NOT MATCHED AND S.[TradeDate] IS NULL THEN 
      INSERT ([TradeDate], [TradeBoard_Id], [TradeParticipant_Id], [TradeParticipantCode], [Name], [Flags], [RFlags])
      VALUES (@TradeDate, S.[TradeBoard_Id], S.[TradeParticipant_Id], S.[TradeParticipantCode], S.[Name], S.[Flags], S.[RFlags]);

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [Quik].[Places::Trade Boards::Trade Dates::Modify#Aton]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Places::Trade Boards::Trade Dates::Modify#Aton]
  @TradeDate DateTime,
  @ClassCode VarChar(12),
  @ClassName VarChar(255),
  @FirmId    VarChar(12),
  @Flags     Int,
  @RFlags    Int
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 1 -- Aton

  EXEC [Quik].[Places::Trade Boards::Trade Dates::Modify]
    @TradeDate = @TradeDate,
    @ClassCode = @ClassCode,
    @ClassName = @ClassName,
    @FirmId    = @FirmId,
    @Flags     = @Flags,
    @RFlags    = @RFlags,
    @Source_Id = @Source_Id

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Places::Trade Boards::Trade Dates::Modify#OSL]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Places::Trade Boards::Trade Dates::Modify#OSL]
  @TradeDate DateTime,
  @ClassCode VarChar(12),
  @ClassName VarChar(255),
  @FirmId    VarChar(12),
  @Flags     Int,
  @RFlags    Int
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 3 -- 

  EXEC [Quik].[Places::Trade Boards::Trade Dates::Modify]
    @TradeDate = @TradeDate,
    @ClassCode = @ClassCode,
    @ClassName = @ClassName,
    @FirmId    = @FirmId,
    @Flags     = @Flags,
    @RFlags    = @RFlags,
    @Source_Id = @Source_Id

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Places::Trade Participants::Modify]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Places::Trade Participants::Modify]
  @Status     VarChar(20),
  @StatusFlag Int,
  @Exchange   VarChar(12),
  @FirmId     VarChar(12),
  @FirmName   VarChar(30),
  @Source_Id  TinyInt
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  BEGIN TRY
    IF @Source_Id IS NULL
      RaisError('   ', 16, 2)

    MERGE [Places:Trade Participants] T
    USING
    (
      SELECT
        [Source_Id]           = @Source_Id,
        [Code]                = @FirmId,
        [ExchangeCode]        = @Exchange,
        [Active]              = @StatusFlag,
        [TradeParticipant_Id] =
        (
          SELECT
            QT.[TradeParticipant_Id]
          FROM [Quik].[Places:Trade Participants] QT
          INNER JOIN [Gate].[Places:Trade Participants] GT ON GT.[Id] = QT.[TradeParticipant_Id]
          INNER JOIN [Quik].[Dic:Places] QP ON QP.[Place_Id] = GT.[Place_Id]
          WHERE QT.[Source_Id] = @Source_Id
            AND QT.[Code]      = @FirmId
            AND QP.[Source_Id] = @Source_Id
            AND QP.[Code]      = @Exchange
      )
    ) AS S ([Source_Id], [Code], [ExchangeCode], [Active], [TradeParticipant_Id])
    ON T.[Code] = S.[Code] AND T.[Source_Id] = S.[Source_Id] AND (T.[TradeParticipant_Id] = S.[TradeParticipant_Id] OR T.[ExchangeCode] = S.[ExchangeCode])
    WHEN MATCHED THEN 
      UPDATE SET
        [Active]  = S.[Active]
    WHEN NOT MATCHED THEN 
      INSERT ([Source_Id], [Code], [TradeParticipant_Id], [ExchangeCode], [Active])
      VALUES (S.[Source_Id], S.[Code], NULL, S.[ExchangeCode], S.[Active]);

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [Quik].[Places::Trade Participants::Modify#Aton]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Places::Trade Participants::Modify#Aton]
  @Status     VarChar(20),
  @StatusFlag Int,
  @Exchange   VarChar(12),
  @FirmId     VarChar(12),
  @FirmName   VarChar(30)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 1 -- Aton

  EXEC [Quik].[Places::Trade Participants::Modify]
    @Status     = @Status,
    @StatusFlag = @StatusFlag,
    @Exchange   = @Exchange,
    @FirmId     = @FirmId,
    @FirmName   = @FirmName,
    @Source_Id  = @Source_Id

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Places::Trade Participants::Modify#OSL]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Places::Trade Participants::Modify#OSL]
  @Status     VarChar(20),
  @StatusFlag Int,
  @Exchange   VarChar(12),
  @FirmId     VarChar(12),
  @FirmName   VarChar(30)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 3 -- 

  EXEC [Quik].[Places::Trade Participants::Modify]
    @Status     = @Status,
    @StatusFlag = @StatusFlag,
    @Exchange   = @Exchange,
    @FirmId     = @FirmId,
    @FirmName   = @FirmName,
    @Source_Id  = @Source_Id

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Reports::Modify]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Reports::Modify]
  @ReportNum    Decimal(19, 0),
  @ClassCode    VarChar(12),
  @TradeDate    DateTime,
  @Value        Decimal(19, 4),
  @Qty          Decimal(19, 0),
  @ReportDate   DateTime,
  @ReportTime   DateTime,
  @WithdrawTime DateTime,
  @Account      VarChar(12),
  @CPAccount    VarChar(12),
  @CPFirmId     VarChar(12),
  @CPFirmName   VarChar(30),
  @FirmId       VarChar(12),
  @FirmName     VarChar(30),
  @UserId       VarChar(32),
  @Direction    VarChar(30),
  @ReportState  VarChar(30),
  @SecName      VarChar(255),
  @SecCode      VarChar(12),
  @ClassName    VarChar(255),
  @Commission   Decimal(19, 4),
  @ReportKind   VarChar(32),
  @Source_Id    TinyInt
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Ignore                     Bit,
    @TradeParticipant_Id        Int,
    @PartnerTradeParticipant_Id Int,
    @TradeBoard_Id              Int,
    @TradeAccount_Id            Int,
    @PartnerTradeAccount_Id     Int,
    @Instrument_Id              Int,
    @SentReceived               Char(1),
    @Status                     Char(1),
    @Kind                       Char(1)
    
  BEGIN TRY
    IF @TradeDate IS NULL
      RaisError('   @TradeDate', 16, 2)  

    IF @ReportNum IS NULL
      RaisError('   @ReportNum', 16, 2)  

    IF @ClassCode IS NULL
      RaisError('   @ClassCode', 16, 2) 
 
    IF @Source_Id IS NULL
      RaisError('   ', 16, 2)        
        
    SET @SentReceived = [Quik].[Report::Value::To SentReceived](@Direction)

    IF @Direction IS NOT NULL AND @SentReceived IS NULL
      RaisError('   @Direction', 16, 2)

    SET @Status = [Quik].[Report::Value::To Status](@ReportState)

    IF @ReportState IS NOT NULL AND @Status IS NULL
      RaisError('   @ReportState', 16, 2)

    SET @Kind = [Quik].[Report::Value::To Kind](@ReportKind)

    IF @ReportKind IS NOT NULL AND @Kind IS NULL      
      RaisError('   @ReportKind', 16, 2)

    SELECT
      @TradeBoard_Id = [TradeBoard_Id],
      @Ignore        = [Ignore]
    FROM [Quik].[Dic:Places:Trade Boards]
    WHERE [Code] = @ClassCode
      AND [Source_Id] = @Source_Id

    IF @Ignore = 1 --     
      RETURN 1

    SELECT
      @TradeParticipant_Id = QT.[TradeParticipant_Id]
    FROM [Quik].[Places:Trade Participants] QT
    INNER JOIN [Gate].[Places:Trade Participants] GT ON GT.[Id] = QT.[TradeParticipant_Id]
    INNER JOIN [Gate].[Dic:Places:Trade Boards] GB ON GB.[Place_Id] = GT.[Place_Id]
    WHERE QT.[Code] = @FirmId    
      AND QT.[Source_Id] = @Source_Id
      AND GB.[Id] = @TradeBoard_Id
    
    SELECT
      @PartnerTradeParticipant_Id = QT.[TradeParticipant_Id]
    FROM [Quik].[Places:Trade Participants] QT
    INNER JOIN [Gate].[Places:Trade Participants] GT ON GT.[Id] = QT.[TradeParticipant_Id]
    INNER JOIN [Gate].[Dic:Places:Trade Boards] GB ON GB.[Place_Id] = GT.[Place_Id]
    WHERE QT.[Code] = @CPFirmId    
      AND QT.[Source_Id] = @Source_Id
      AND GB.[Id] = @TradeBoard_Id

    SELECT
      @TradeAccount_Id = [Id]
    FROM [Gate].[Trade Accounts]
    WHERE [Code] = @Account
      AND [Source_Id] = @Source_Id
      AND [TradeParticipant_Id] = @TradeParticipant_Id

    SELECT
      @PartnerTradeAccount_Id = [Id]
    FROM [Gate].[Trade Accounts]
    WHERE [Code] = @CPAccount
      AND [Source_Id] = @Source_Id
      AND [TradeParticipant_Id] = @PartnerTradeParticipant_Id

    SELECT
      @Instrument_Id = [Id]
    FROM [Gate].[Instruments]
    WHERE [Code] = @SecCode
      AND [Source_Id] = @Source_Id

    MERGE [Gate].[Reports] T
    USING
    (
      SELECT
        @Source_Id,
        @ReportNum,
        @TradeBoard_Id,
        CASE WHEN @TradeBoard_Id IS NULL THEN @ClassCode END,
        @TradeDate,
        @Value,
        @Qty,
        @ReportDate + @ReportTime,
        @WithdrawTime,
        @TradeAccount_Id,
        CASE WHEN @TradeAccount_Id IS NULL THEN @Account END,
        @PartnerTradeAccount_Id,
        CASE WHEN @PartnerTradeAccount_Id IS NULL THEN @CPAccount END,
        CASE WHEN @TradeParticipant_Id IS NULL THEN @FirmId END,
        CASE WHEN @PartnerTradeParticipant_Id IS NULL THEN @CPFirmId END,
        @SentReceived,
        @Status,
        @Instrument_Id,
        CASE WHEN @Instrument_Id IS NULL THEN @SecCode END,
        @Commission,
        @Kind
    ) AS S ([Source_Id], [Number], [TradeBoard_Id], [TradeBoardCode], [SessionDate], [Value], [Quantity], [CreateDateTime],
            [OrderCancelTime], [TradeAccount_Id], [TradeAccountCode], [PartnerTradeAccount_Id], [PartnerTradeAccountCode],
            [TradeParticipantCode], [PartnerTradeParticipantCode], [SentReceived], [Status], [Instrument_Id], [InstrumentCode],
            [Commission], [Kind])
    ON T.[Number] = S.[Number] AND T.[Source_Id] = S.[Source_Id] AND T.[SessionDate] = S.[SessionDate] AND (T.[TradeBoard_Id] = S.[TradeBoard_Id] OR T.[TradeBoardCode] = S.[TradeBoardCode])
    WHEN MATCHED THEN
      UPDATE SET
        [Source_Id]                   = S.[Source_Id],
        [Number]                      = S.[Number],
        [TradeBoard_Id]               = S.[TradeBoard_Id],
        [TradeBoardCode]              = S.[TradeBoardCode],
        [SessionDate]                 = S.[SessionDate],
        [Value]                       = S.[Value],
        [Quantity]                    = S.[Quantity],
        [CreateDateTime]              = S.[CreateDateTime],
        [OrderCancelTime]             = S.[OrderCancelTime],
        [TradeAccount_Id]             = S.[TradeAccount_Id],
        [TradeAccountCode]            = S.[TradeAccountCode],
        [PartnerTradeAccount_Id]      = S.[PartnerTradeAccount_Id],
        [PartnerTradeAccountCode]     = S.[PartnerTradeAccountCode],
        [TradeParticipantCode]        = S.[TradeParticipantCode],
        [PartnerTradeParticipantCode] = S.[PartnerTradeParticipantCode],
        [SentReceived]                = S.[SentReceived],
        [Status]                      = S.[Status],
        [Instrument_Id]               = S.[Instrument_Id],
        [InstrumentCode]              = S.[InstrumentCode],
        [Commission]                  = S.[Commission],
        [Kind]                        = S.[Kind]
    WHEN NOT MATCHED THEN 
      INSERT ([Source_Id], [Number], [TradeBoard_Id], [TradeBoardCode], [SessionDate], [Value], [Quantity], [CreateDateTime],
              [OrderCancelTime], [TradeAccount_Id], [TradeAccountCode], [PartnerTradeAccount_Id], [PartnerTradeAccountCode],
              [TradeParticipantCode], [PartnerTradeParticipantCode], [SentReceived], [Status], [Instrument_Id], [InstrumentCode],
              [Commission], [Kind])
      VALUES (S.[Source_Id], S.[Number], S.[TradeBoard_Id], S.[TradeBoardCode], S.[SessionDate], S.[Value], S.[Quantity], S.[CreateDateTime],
              S.[OrderCancelTime], S.[TradeAccount_Id], S.[TradeAccountCode], S.[PartnerTradeAccount_Id], S.[PartnerTradeAccountCode],
              S.[TradeParticipantCode], S.[PartnerTradeParticipantCode], S.[SentReceived], S.[Status], S.[Instrument_Id], S.[InstrumentCode],
              S.[Commission], S.[Kind]);

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [Quik].[Reports::Modify#Aton]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Reports::Modify#Aton]
  @ReportNum    Decimal(19, 0),
  @ClassCode    VarChar(12),
  @TradeDate    DateTime,
  @Value        Decimal(19, 4),
  @Qty          Decimal(19, 0),
  @ReportDate   DateTime,
  @ReportTime   DateTime,
  @WithdrawTime DateTime,
  @Account      VarChar(12),
  @CPAccount    VarChar(12),
  @CPFirmId     VarChar(12),
  @CPFirmName   VarChar(30),
  @FirmId       VarChar(12),
  @FirmName     VarChar(30),
  @UserId       VarChar(32),
  @Direction    VarChar(30),
  @ReportState  VarChar(30),
  @SecName      VarChar(255),
  @SecCode      VarChar(12),
  @ClassName    VarChar(255),
  @Commission   Decimal(19, 4),
  @ReportKind   VarChar(32)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 1 -- Aton

  EXEC [Quik].[Reports::Modify]
    @ReportNum    = @ReportNum, 
    @ClassCode    = @ClassCode, 
    @TradeDate    = @TradeDate, 
    @Value        = @Value, 
    @Qty          = @Qty, 
    @ReportDate   = @ReportDate, 
    @ReportTime   = @ReportTime, 
    @WithdrawTime = @WithdrawTime, 
    @Account      = @Account, 
    @CPAccount    = @CPAccount, 
    @CPFirmId     = @CPFirmId, 
    @CPFirmName   = @CPFirmName, 
    @FirmId       = @FirmId, 
    @FirmName     = @FirmName, 
    @UserId       = @UserId, 
    @Direction    = @Direction, 
    @ReportState  = @ReportState, 
    @SecName      = @SecName, 
    @SecCode      = @SecCode, 
    @ClassName    = @ClassName, 
    @Commission   = @Commission, 
    @ReportKind   = @ReportKind, 
    @Source_Id    = @Source_Id  

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Reports::Modify#OSL]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Reports::Modify#OSL]
  @ReportNum    Decimal(19, 0),
  @ClassCode    VarChar(12),
  @TradeDate    DateTime,
  @Value        Decimal(19, 4),
  @Qty          Decimal(19, 0),
  @ReportDate   DateTime,
  @ReportTime   DateTime,
  @WithdrawTime DateTime,
  @Account      VarChar(12),
  @CPAccount    VarChar(12),
  @CPFirmId     VarChar(12),
  @CPFirmName   VarChar(30),
  @FirmId       VarChar(12),
  @FirmName     VarChar(30),
  @UserId       VarChar(32),
  @Direction    VarChar(30),
  @ReportState  VarChar(30),
  @SecName      VarChar(255),
  @SecCode      VarChar(12),
  @ClassName    VarChar(255),
  @Commission   Decimal(19, 4),
  @ReportKind   VarChar(32)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 3 -- 

  EXEC [Quik].[Reports::Modify]
    @ReportNum    = @ReportNum, 
    @ClassCode    = @ClassCode, 
    @TradeDate    = @TradeDate, 
    @Value        = @Value, 
    @Qty          = @Qty, 
    @ReportDate   = @ReportDate, 
    @ReportTime   = @ReportTime, 
    @WithdrawTime = @WithdrawTime, 
    @Account      = @Account, 
    @CPAccount    = @CPAccount, 
    @CPFirmId     = @CPFirmId, 
    @CPFirmName   = @CPFirmName, 
    @FirmId       = @FirmId, 
    @FirmName     = @FirmName, 
    @UserId       = @UserId, 
    @Direction    = @Direction, 
    @ReportState  = @ReportState, 
    @SecName      = @SecName, 
    @SecCode      = @SecCode, 
    @ClassName    = @ClassName, 
    @Commission   = @Commission, 
    @ReportKind   = @ReportKind, 
    @Source_Id    = @Source_Id  

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Trade Accounts::Trade Dates::Modify]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Trade Accounts::Trade Dates::Modify]
  @TrdAccId     VarChar(12),
  @Type         VarChar(32),
  @LoadDate     DateTime,
  @FirmId       VarChar(12),
  @Description  VarChar(30),
  @BankAccId    VarChar(12),
  @Status       VarChar(32),
  @DepAccId     VarChar(12),
  @TrdAccType   VarChar(64),
  @MainTrdAccId VarChar(12),
  @Source_Id    TinyInt
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @TradeParticipant_Id SmallInt, --    /       
    @TradeAccount_Id     Int,
    @DepoType            TinyInt,
    @ActiveStatus        Bit

  BEGIN TRY  
    IF @LoadDate IS NULL
      RaisError('   @LoadDate', 16, 2) 

    IF @TrdAccId IS NULL
      RaisError('   @TrdAccId', 16, 2) 

    IF @Type IS NULL
      RaisError('   @Type', 16, 2) 
 
    IF @Source_Id IS NULL
      RaisError('   ', 16, 2)    

    SET @DepoType = CASE
                      WHEN IsNumeric(@Type) = 1             THEN Cast(@Type AS TinyInt)
                      WHEN @Type = ' '           THEN Cast(0 AS TinyInt)
                      WHEN @Type = 'C '         THEN Cast(1 AS TinyInt)
                      WHEN @Type = ' ' THEN Cast(2 AS TinyInt)
                      WHEN @Type = 'C '                THEN Cast(3 AS TinyInt)
                      WHEN @Type = ' '       THEN Cast(4 AS TinyInt)
                    END
    
    IF @DepoType IS NULL
      RaisError('   @Type', 16, 2)

    SET @ActiveStatus = CASE
                          WHEN IsNumeric(@Status) = 1 THEN Cast(@Status AS Bit)
                          WHEN @Status = ' ' THEN Cast(0 AS Bit)
                          WHEN @Status = ' ' THEN Cast(1 AS Bit)
                        END
    
    IF @Status IS NOT NULL AND @ActiveStatus IS NULL
      RaisError('   @Status', 16, 2)
         
    SELECT TOP 1
      @TradeParticipant_Id = QT.[TradeParticipant_Id]
    FROM [Quik].[Places:Trade Participants] QT
    WHERE QT.[Code] = @FirmId    
      AND QT.[Source_Id] = @Source_Id --     ,   

    SELECT
      @TradeAccount_Id = [Id]
    FROM [Gate].[Trade Accounts]
    WHERE [Code] = @TrdAccId
      AND [Source_Id] = @Source_Id
      AND ([TradeParticipantCode] = @FirmId OR [TradeParticipant_Id] = @TradeParticipant_Id)
    
    IF @TradeAccount_Id IS NULL BEGIN
      MERGE [Gate].[Trade Accounts] T
      USING
      (
        SELECT
          @TrdAccId,
          @Source_Id,
          @TradeParticipant_Id,
          @FirmId
      ) AS S ([Code], [Source_Id], [TradeParticipant_Id], [TradeParticipantCode])
      ON T.[Code] = S.[Code] AND T.[Source_Id] =  S.[Source_Id] AND (T.[TradeParticipantCode] = S.[TradeParticipantCode] OR T.[TradeParticipant_Id] = S.[TradeParticipant_Id])
      WHEN MATCHED THEN
        UPDATE SET
          @TradeAccount_Id = T.[Id]
      WHEN NOT MATCHED THEN
        INSERT ([Source_Id], [Code], [TradeParticipant_Id], [TradeParticipantCode])
        VALUES (S.[Source_Id], S.[Code], S.[TradeParticipant_Id], S.[TradeParticipantCode]);

      SET @TradeAccount_Id = IsNull(@TradeAccount_Id, Scope_Identity())
    END

    MERGE [Gate].[Trade Accounts:Trade Dates] T
    USING
    (
      SELECT
        ( 
          SELECT TOP 1
            T.[TradeDate]
          FROM
          (
            SELECT TOP 1
              D.[TradeDate],
              D.[DepoType],
              D.[Description],
              D.[BankAccount],
              D.[Status],
              D.[DepoAccount],
              D.[Type],
              D.[MainTradeAccount] 
            FROM [Gate].[Trade Accounts:Trade Dates] D 
            WHERE D.[TradeAccount_Id] = @TradeAccount_Id
              AND D.[TradeDate] <= @LoadDate
            ORDER BY D.[TradeDate] DESC
          ) T
          WHERE  T.[DepoType]         = @DepoType
            AND (T.[Description]      = @Description  OR T.[Description]      IS NULL AND @Description  IS NULL)
            AND (T.[BankAccount]      = @BankAccId    OR T.[BankAccount]      IS NULL AND @BankAccId    IS NULL)
            AND (T.[Status]           = @ActiveStatus OR T.[Status]           IS NULL AND @ActiveStatus IS NULL)
            AND (T.[DepoAccount]      = @DepAccId     OR T.[DepoAccount]      IS NULL AND @DepAccId     IS NULL)
            AND (T.[Type]             = @TrdAccType   OR T.[Type]             IS NULL AND @TrdAccType   IS NULL)
            AND (T.[MainTradeAccount] = @MainTrdAccId OR T.[MainTradeAccount] IS NULL AND @MainTrdAccId IS NULL)
        ),
        @TradeAccount_Id,
        @DepoType,
        @Description,
        @BankAccId,
        @ActiveStatus,
        @DepAccId,
        @TrdAccType,
        @MainTrdAccId
    ) AS S ([TradeDate], [TradeAccount_Id], [DepoType], [Description], [BankAccount], [Status], [DepoAccount], [Type], [MainTradeAccount])
    ON T.[TradeDate] = @LoadDate AND T.[TradeAccount_Id] = S.[TradeAccount_Id]
    WHEN MATCHED AND S.[TradeDate] IS NULL THEN 
      UPDATE SET
        [DepoType]         = S.[DepoType],
        [Description]      = S.[Description],
        [BankAccount]      = S.[BankAccount],
        [Status]           = S.[Status],
        [DepoAccount]      = S.[DepoAccount],
        [Type]             = S.[Type], 
        [MainTradeAccount] = S.[MainTradeAccount]
    WHEN NOT MATCHED AND S.[TradeDate] IS NULL THEN 
      INSERT ([TradeDate], [TradeAccount_Id], [DepoType], [Description], [BankAccount], [Status], [DepoAccount], [Type], [MainTradeAccount])
      VALUES (@LoadDate, S.[TradeAccount_Id], S.[DepoType], S.[Description], S.[BankAccount], S.[Status], S.[DepoAccount], S.[Type], S.[MainTradeAccount]);

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [Quik].[Trade Accounts::Trade Dates::Modify#Aton]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Trade Accounts::Trade Dates::Modify#Aton]
  @TrdAccId     VarChar(12),
  @Type         VarChar(32),
  @LoadDate     DateTime,
  @FirmId       VarChar(12),
  @Description  VarChar(30),
  @BankAccId    VarChar(12),
  @Status       VarChar(32),
  @DepAccId     VarChar(12),
  @TrdAccType   VarChar(64),
  @MainTrdAccId VarChar(12)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 1

  EXEC [Quik].[Trade Accounts::Trade Dates::Modify]
    @TrdAccId     = @TrdAccId,
    @Type         = @Type,
    @LoadDate     = @LoadDate,
    @FirmId       = @FirmId,
    @Description  = @Description,
    @BankAccId    = @BankAccId,
    @Status       = @Status,
    @DepAccId     = @DepAccId,
    @TrdAccType   = @TrdAccType,
    @MainTrdAccId = @MainTrdAccId,
    @Source_Id    = @Source_Id

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Trade Accounts::Trade Dates::Modify#OSL]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Trade Accounts::Trade Dates::Modify#OSL]
  @TrdAccId     VarChar(12),
  @Type         VarChar(32),
  @LoadDate     DateTime,
  @FirmId       VarChar(12),
  @Description  VarChar(30),
  @BankAccId    VarChar(12),
  @Status       VarChar(32),
  @DepAccId     VarChar(12),
  @TrdAccType   VarChar(64),
  @MainTrdAccId VarChar(12)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 3

  EXEC [Quik].[Trade Accounts::Trade Dates::Modify]
    @TrdAccId     = @TrdAccId,
    @Type         = @Type,
    @LoadDate     = @LoadDate,
    @FirmId       = @FirmId,
    @Description  = @Description,
    @BankAccId    = @BankAccId,
    @Status       = @Status,
    @DepAccId     = @DepAccId,
    @TrdAccType   = @TrdAccType,
    @MainTrdAccId = @MainTrdAccId,
    @Source_Id    = @Source_Id

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Trade Participant Rests::Accounts::Modify]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Trade Participant Rests::Accounts::Modify]
  @SecCode        VarChar(12),
  @FirmId         VarChar(12),
  @DepAccId       VarChar(12),
  @TrdAccId       VarChar(12),
  @LoadDate       DateTime,
  @CurrentPos     Decimal(19, 4),
  @OpenBal        Decimal(19, 4),
  @PlannedPosBuy  Decimal(19, 4),
  @PlannedPosSell Decimal(19, 4),
  @SecName        VarChar(64),
  @PlanBal        Decimal(19, 4),
  @UsQtyB         Decimal(19, 4),
  @UsQtyS         Decimal(19, 4),
  @Planned        Decimal(19, 4),
  @BankAccId      VarChar(12),
  @FirmUse        VarChar(16),
  @SettleBal      Decimal(19, 4),
  @Source_Id      TinyInt
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @TradeParticipant_Id Int,
    @Instrument_Id       Int,
    @TradeAccount_Id     Int
    
  BEGIN TRY
    IF @SecCode IS NULL
      RaisError('   @SecCode', 16, 2)  

    IF @FirmId IS NULL
      RaisError('   @FirmId', 16, 2)   

    IF @DepAccId IS NULL
      RaisError('   @DepAccId', 16, 2)  

    IF @TrdAccId IS NULL
      RaisError('   @TrdAccId', 16, 2)  

    IF @LoadDate IS NULL
      RaisError('   @LoadDate', 16, 2) 
 
    IF @Source_Id IS NULL
      RaisError('   ', 16, 2)        
        
    SELECT TOP 1
      @TradeParticipant_Id = QT.[TradeParticipant_Id]
    FROM [Quik].[Places:Trade Participants] QT
    WHERE QT.[Code] = @FirmId    
      AND QT.[Source_Id] = @Source_Id --     ,   

    IF @TradeParticipant_Id IS NOT NULL
      SELECT
        @TradeAccount_Id = [Id]
      FROM [Gate].[Trade Accounts]
      WHERE [Code] = @TrdAccId
        AND [Source_Id] = @Source_Id
        AND [TradeParticipant_Id] = @TradeParticipant_Id

    IF @TradeAccount_Id IS NOT NULL
      SELECT
        @Instrument_Id = [Id]
      FROM [Gate].[Instruments]
      WHERE [Code] = @SecCode
        AND [Source_Id] = @Source_Id

    MERGE [Gate].[Trade Participant Rests:Accounts] T
    USING
    (
      SELECT
        @Source_Id,
        @Instrument_Id,
        NULL,
        @TradeAccount_Id,
        NULL,
        NULL,
        @DepAccId,
        @LoadDate,
        @CurrentPos,
        @OpenBal,
        @PlannedPosBuy,
        @PlannedPosSell,
        @PlanBal,
        @UsQtyB,
        @UsQtyS,
        @Planned,
        @BankAccId,
        @FirmUse,
        @SettleBal
      WHERE @TradeAccount_Id IS NOT NULL
        AND @Instrument_Id IS NOT NULL
    ) AS S ([Source_Id], [Instrument_Id], [InstrumentCode], [TradeAccount_Id], [TradeAccountCode], [TradeParticipantCode], [DepoAccount],
            [TradeDate], [CurrentPosition], [OpenBalance], [PlannedPositionBuy], [PlannedPositionSell], [PlannedBalance], [QuantityBuy],
            [QuantitySell], [Planned], [BankAccount], [SignUse], [SettleBalance])
    ON T.[Instrument_Id] = S.[Instrument_Id] AND T.[InstrumentCode] IS NULL AND T.[TradeAccount_Id] = S.[TradeAccount_Id] AND T.[TradeAccountCode] IS NULL AND T.[TradeParticipantCode] IS NULL AND T.[DepoAccount] = S.[DepoAccount] AND T.[TradeDate] = S.[TradeDate]
    WHEN MATCHED THEN
      UPDATE SET
        [Source_Id]            = S.[Source_Id],
        [Instrument_Id]        = S.[Instrument_Id],
        [InstrumentCode]       = S.[InstrumentCode],
        [TradeAccount_Id]      = S.[TradeAccount_Id],
        [TradeAccountCode]     = S.[TradeAccountCode],
        [TradeParticipantCode] = S.[TradeParticipantCode],
        [DepoAccount]          = S.[DepoAccount],
        [TradeDate]            = S.[TradeDate],
        [CurrentPosition]      = S.[CurrentPosition],
        [OpenBalance]          = S.[OpenBalance],
        [PlannedPositionBuy]   = S.[PlannedPositionBuy],
        [PlannedPositionSell]  = S.[PlannedPositionSell],
        [PlannedBalance]       = S.[PlannedBalance],
        [QuantityBuy]          = S.[QuantityBuy],
        [QuantitySell]         = S.[QuantitySell],
        [Planned]              = S.[Planned],
        [BankAccount]          = S.[BankAccount],
        [SignUse]              = S.[SignUse],
        [SettleBalance]        = S.[SettleBalance]
    WHEN NOT MATCHED THEN 
      INSERT ([Source_Id], [Instrument_Id], [InstrumentCode], [TradeAccount_Id], [TradeAccountCode], [TradeParticipantCode], [DepoAccount],
              [TradeDate], [CurrentPosition], [OpenBalance], [PlannedPositionBuy], [PlannedPositionSell], [PlannedBalance], [QuantityBuy],
              [QuantitySell], [Planned], [BankAccount], [SignUse], [SettleBalance])
      VALUES (S.[Source_Id], S.[Instrument_Id], S.[InstrumentCode], S.[TradeAccount_Id], S.[TradeAccountCode], S.[TradeParticipantCode], S.[DepoAccount],
              S.[TradeDate], S.[CurrentPosition], S.[OpenBalance], S.[PlannedPositionBuy], S.[PlannedPositionSell], S.[PlannedBalance], S.[QuantityBuy],
              S.[QuantitySell], S.[Planned], S.[BankAccount], S.[SignUse], S.[SettleBalance]);

    MERGE [Gate].[Trade Participant Rests:Accounts] T
    USING
    (
      SELECT
        @Source_Id,
        NULL,
        @SecCode,
        NULL,
        @TrdAccId,
        @FirmId,
        @DepAccId,
        @LoadDate,
        @CurrentPos,
        @OpenBal,
        @PlannedPosBuy,
        @PlannedPosSell,
        @PlanBal,
        @UsQtyB,
        @UsQtyS,
        @Planned,
        @BankAccId,
        @FirmUse,
        @SettleBal
      WHERE @TradeAccount_Id IS NULL
         OR @Instrument_Id IS NULL
    ) AS S ([Source_Id], [Instrument_Id], [InstrumentCode], [TradeAccount_Id], [TradeAccountCode], [TradeParticipantCode], [DepoAccount],
            [TradeDate], [CurrentPosition], [OpenBalance], [PlannedPositionBuy], [PlannedPositionSell], [PlannedBalance], [QuantityBuy],
            [QuantitySell], [Planned], [BankAccount], [SignUse], [SettleBalance])
    ON T.[Instrument_Id] IS NULL AND T.[InstrumentCode] = S.[InstrumentCode] AND T.[TradeAccount_Id] IS NULL AND T.[TradeAccountCode] = S.[TradeAccountCode] AND T.[TradeParticipantCode] = S.[TradeParticipantCode] AND T.[DepoAccount] = S.[DepoAccount] AND T.[TradeDate] = S.[TradeDate]
    WHEN MATCHED THEN
      UPDATE SET
        [Source_Id]            = S.[Source_Id],
        [Instrument_Id]        = S.[Instrument_Id],
        [InstrumentCode]       = S.[InstrumentCode],
        [TradeAccount_Id]      = S.[TradeAccount_Id],
        [TradeAccountCode]     = S.[TradeAccountCode],
        [TradeParticipantCode] = S.[TradeParticipantCode],
        [DepoAccount]          = S.[DepoAccount],
        [TradeDate]            = S.[TradeDate],
        [CurrentPosition]      = S.[CurrentPosition],
        [OpenBalance]          = S.[OpenBalance],
        [PlannedPositionBuy]   = S.[PlannedPositionBuy],
        [PlannedPositionSell]  = S.[PlannedPositionSell],
        [PlannedBalance]       = S.[PlannedBalance],
        [QuantityBuy]          = S.[QuantityBuy],
        [QuantitySell]         = S.[QuantitySell],
        [Planned]              = S.[Planned],
        [BankAccount]          = S.[BankAccount],
        [SignUse]              = S.[SignUse],
        [SettleBalance]        = S.[SettleBalance]
    WHEN NOT MATCHED THEN 
      INSERT ([Source_Id], [Instrument_Id], [InstrumentCode], [TradeAccount_Id], [TradeAccountCode], [TradeParticipantCode], [DepoAccount],
              [TradeDate], [CurrentPosition], [OpenBalance], [PlannedPositionBuy], [PlannedPositionSell], [PlannedBalance], [QuantityBuy],
              [QuantitySell], [Planned], [BankAccount], [SignUse], [SettleBalance])
      VALUES (S.[Source_Id], S.[Instrument_Id], S.[InstrumentCode], S.[TradeAccount_Id], S.[TradeAccountCode], S.[TradeParticipantCode], S.[DepoAccount],
              S.[TradeDate], S.[CurrentPosition], S.[OpenBalance], S.[PlannedPositionBuy], S.[PlannedPositionSell], S.[PlannedBalance], S.[QuantityBuy],
              S.[QuantitySell], S.[Planned], S.[BankAccount], S.[SignUse], S.[SettleBalance]);

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [Quik].[Trade Participant Rests::Accounts::Modify#Aton]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Trade Participant Rests::Accounts::Modify#Aton]
  @SecCode        VarChar(12),
  @FirmId         VarChar(12),
  @DepAccId       VarChar(12),
  @TrdAccId       VarChar(12),
  @LoadDate       DateTime,
  @CurrentPos     Decimal(19, 4),
  @OpenBal        Decimal(19, 4),
  @PlannedPosBuy  Decimal(19, 4),
  @PlannedPosSell Decimal(19, 4),
  @SecName        VarChar(64),
  @PlanBal        Decimal(19, 4),
  @UsQtyB         Decimal(19, 4),
  @UsQtyS         Decimal(19, 4),
  @Planned        Decimal(19, 4),
  @BankAccId      VarChar(12),
  @FirmUse        VarChar(16),
  @SettleBal      Decimal(19, 4)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 1 -- Aton

  EXEC [Quik].[Trade Participant Rests::Accounts::Modify]
    @SecCode        = @SecCode,
    @FirmId         = @FirmId,
    @DepAccId       = @DepAccId,
    @TrdAccId       = @TrdAccId,
    @LoadDate       = @LoadDate,
    @CurrentPos     = @CurrentPos,
    @OpenBal        = @OpenBal,
    @PlannedPosBuy  = @PlannedPosBuy,
    @PlannedPosSell = @PlannedPosSell,
    @SecName        = @SecName,
    @PlanBal        = @PlanBal,
    @UsQtyB         = @UsQtyB,
    @UsQtyS         = @UsQtyS,
    @Planned        = @Planned,
    @BankAccId      = @BankAccId,
    @FirmUse        = @FirmUse,
    @SettleBal      = @SettleBal,
    @Source_Id      = @Source_Id 

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Trade Participant Rests::Accounts::Modify#OSL]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Trade Participant Rests::Accounts::Modify#OSL]
  @SecCode        VarChar(12),
  @FirmId         VarChar(12),
  @DepAccId       VarChar(12),
  @TrdAccId       VarChar(12),
  @LoadDate       DateTime,
  @CurrentPos     Decimal(19, 4),
  @OpenBal        Decimal(19, 4),
  @PlannedPosBuy  Decimal(19, 4),
  @PlannedPosSell Decimal(19, 4),
  @SecName        VarChar(64),
  @PlanBal        Decimal(19, 4),
  @UsQtyB         Decimal(19, 4),
  @UsQtyS         Decimal(19, 4),
  @Planned        Decimal(19, 4),
  @BankAccId      VarChar(12),
  @FirmUse        VarChar(16),
  @SettleBal      Decimal(19, 4)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 3 -- 

  EXEC [Quik].[Trade Participant Rests::Accounts::Modify]
    @SecCode        = @SecCode,
    @FirmId         = @FirmId,
    @DepAccId       = @DepAccId,
    @TrdAccId       = @TrdAccId,
    @LoadDate       = @LoadDate,
    @CurrentPos     = @CurrentPos,
    @OpenBal        = @OpenBal,
    @PlannedPosBuy  = @PlannedPosBuy,
    @PlannedPosSell = @PlannedPosSell,
    @SecName        = @SecName,
    @PlanBal        = @PlanBal,
    @UsQtyB         = @UsQtyB,
    @UsQtyS         = @UsQtyS,
    @Planned        = @Planned,
    @BankAccId      = @BankAccId,
    @FirmUse        = @FirmUse,
    @SettleBal      = @SettleBal,
    @Source_Id      = @Source_Id 

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Trade Participant Rests::Derivatives::Modify]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Trade Participant Rests::Derivatives::Modify]
  @FirmId         VarChar(12),
  @SecCode        VarChar(12),
  @TrdAccId       VarChar(12),
  @Type           VarChar(40),
  @TradeDate      DateTime,
  @AvrPosnPrice   Decimal(19, 6),
  @CbplPlanned    Decimal(19, 4),
  @CbplUsed       Decimal(19, 4),
  @Varmargin      Decimal(19, 4),
  @PositionValue  Decimal(19, 4),
  @OpenBuys       Decimal(10, 0),
  @OpenSells      Decimal(10, 0),
  @StartBuy       Decimal(10, 0),
  @StartNet       Decimal(10, 0),
  @StartSell      Decimal(10, 0),
  @TodayBuy       Decimal(10, 0),
  @TodaySell      Decimal(10, 0),
  @TotalNet       Decimal(10, 0),
  @FirmName       VarChar(30),
  @SecName        VarChar(64),
  @MatDate        DateTime,
  @TotalVarMargin Decimal(19, 6),
  @RealVarMargin  Decimal(19, 6),
  @Source_Id      TinyInt
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @TradeParticipant_Id Int,
    @Instrument_Id       Int,
    @TradeAccount_Id     Int
    
  BEGIN TRY
    IF @SecCode IS NULL
      RaisError('   @SecCode', 16, 2)  

    IF @FirmId IS NULL
      RaisError('   @FirmId', 16, 2)   

    IF @Type IS NULL
      RaisError('   @Type', 16, 2)  

    IF @TrdAccId IS NULL
      RaisError('   @TrdAccId', 16, 2)  

    IF @TradeDate IS NULL
      RaisError('   @TradeDate', 16, 2) 
 
    IF @Source_Id IS NULL
      RaisError('   ', 16, 2)        
        
    SELECT TOP 1
      @TradeParticipant_Id = QT.[TradeParticipant_Id]
    FROM [Quik].[Places:Trade Participants] QT
    WHERE QT.[Code] = @FirmId    
      AND QT.[Source_Id] = @Source_Id --     ,   

    IF @TradeParticipant_Id IS NOT NULL
      SELECT
        @TradeAccount_Id = [Id]
      FROM [Gate].[Trade Accounts]
      WHERE [Code] = @TrdAccId
        AND [Source_Id] = @Source_Id
        AND [TradeParticipant_Id] = @TradeParticipant_Id

    IF @TradeAccount_Id IS NOT NULL
      SELECT
        @Instrument_Id = [Id]
      FROM [Gate].[Instruments]
      WHERE [Code] = @SecCode
        AND [Source_Id] = @Source_Id

    MERGE [Gate].[Trade Participant Rests:Derivatives] T
    USING
    (
      SELECT
        @Source_Id,
        @TradeAccount_Id,
        NULL,
        NULL,
        @Instrument_Id,
        NULL,
        @Type,
        @TradeDate,
        @AvrPosnPrice,
        @CbplPlanned,
        @CbplUsed,
        @Varmargin,
        @PositionValue,
        @OpenBuys,
        @OpenSells,
        @StartBuy,
        @StartSell,
        @StartNet,
        @TodayBuy,
        @TodaySell,
        @TotalNet,
        @MatDate,
        @TotalVarMargin,
        @RealVarMargin
      WHERE @TradeAccount_Id IS NOT NULL
        AND @Instrument_Id IS NOT NULL
    ) AS S ([Source_Id], [TradeAccount_Id], [TradeAccountCode], [TradeParticipantCode], [Instrument_Id], [InstrumentCode], [Type],
            [TradeDate], [AvgPositionPrice], [ValuationPlanned], [ValuationUsed], [VarMargin], [Value], [OpenOrderBuys], [OpenOrderSells],
            [StartBuy], [StartSell], [StartNet], [TodayBuy], [TodaySell], [TotalNet], [MaturityDate], [TotalVarMargin], [RealVarMargin])
    ON T.[Instrument_Id] = S.[Instrument_Id] AND T.[InstrumentCode] IS NULL AND T.[TradeAccount_Id] = S.[TradeAccount_Id] AND T.[TradeAccountCode] IS NULL AND T.[TradeParticipantCode] IS NULL AND T.[Type] = S.[Type] AND T.[TradeDate] = S.[TradeDate]
    WHEN MATCHED THEN
      UPDATE SET
        [Source_Id]            = S.[Source_Id],
        [TradeAccount_Id]      = S.[TradeAccount_Id],
        [TradeAccountCode]     = S.[TradeAccountCode],
        [TradeParticipantCode] = S.[TradeParticipantCode],
        [Instrument_Id]        = S.[Instrument_Id],
        [InstrumentCode]       = S.[InstrumentCode],
        [Type]                 = S.[Type],
        [TradeDate]            = S.[TradeDate],
        [AvgPositionPrice]     = S.[AvgPositionPrice],
        [ValuationPlanned]     = S.[ValuationPlanned],
        [ValuationUsed]        = S.[ValuationUsed],
        [VarMargin]            = S.[VarMargin],
        [Value]                = S.[Value],
        [OpenOrderBuys]        = S.[OpenOrderBuys],
        [OpenOrderSells]       = S.[OpenOrderSells],
        [StartBuy]             = S.[StartBuy],
        [StartSell]            = S.[StartSell],
        [StartNet]             = S.[StartNet],
        [TodayBuy]             = S.[TodayBuy],
        [TodaySell]            = S.[TodaySell],
        [TotalNet]             = S.[TotalNet],
        [MaturityDate]         = S.[MaturityDate],
        [TotalVarMargin]       = S.[TotalVarMargin],
        [RealVarMargin]        = S.[RealVarMargin]
    WHEN NOT MATCHED THEN 
      INSERT ([Source_Id], [TradeAccount_Id], [TradeAccountCode], [TradeParticipantCode], [Instrument_Id], [InstrumentCode], [Type],
              [TradeDate], [AvgPositionPrice], [ValuationPlanned], [ValuationUsed], [VarMargin], [Value], [OpenOrderBuys], [OpenOrderSells],
              [StartBuy], [StartSell], [StartNet], [TodayBuy], [TodaySell], [TotalNet], [MaturityDate], [TotalVarMargin], [RealVarMargin])
      VALUES (S.[Source_Id], S.[TradeAccount_Id], S.[TradeAccountCode], S.[TradeParticipantCode], S.[Instrument_Id], S.[InstrumentCode], S.[Type],
              S.[TradeDate], S.[AvgPositionPrice], S.[ValuationPlanned], S.[ValuationUsed], S.[VarMargin], S.[Value], S.[OpenOrderBuys], S.[OpenOrderSells],
              S.[StartBuy], S.[StartSell], S.[StartNet], S.[TodayBuy], S.[TodaySell], S.[TotalNet], S.[MaturityDate], S.[TotalVarMargin], S.[RealVarMargin]);

    MERGE [Gate].[Trade Participant Rests:Derivatives] T
    USING
    (
      SELECT
        @Source_Id,
        NULL,
        @TrdAccId,
        @FirmId,
        NULL,
        @SecCode,
        @Type,
        @TradeDate,
        @AvrPosnPrice,
        @CbplPlanned,
        @CbplUsed,
        @Varmargin,
        @PositionValue,
        @OpenBuys,
        @OpenSells,
        @StartBuy,
        @StartSell,
        @StartNet,
        @TodayBuy,
        @TodaySell,
        @TotalNet,
        @MatDate,
        @TotalVarMargin,
        @RealVarMargin
      WHERE @TradeAccount_Id IS NULL
         OR @Instrument_Id IS NULL
    ) AS S ([Source_Id], [TradeAccount_Id], [TradeAccountCode], [TradeParticipantCode], [Instrument_Id], [InstrumentCode], [Type],
            [TradeDate], [AvgPositionPrice], [ValuationPlanned], [ValuationUsed], [VarMargin], [Value], [OpenOrderBuys], [OpenOrderSells],
            [StartBuy], [StartSell], [StartNet], [TodayBuy], [TodaySell], [TotalNet], [MaturityDate], [TotalVarMargin], [RealVarMargin])
    ON T.[Instrument_Id] IS NULL AND T.[InstrumentCode] = S.[InstrumentCode] AND T.[TradeAccount_Id] IS NULL AND T.[TradeAccountCode] = S.[TradeAccountCode] AND T.[TradeParticipantCode] = S.[TradeParticipantCode] AND T.[Type] = S.[Type] AND T.[TradeDate] = S.[TradeDate]
    WHEN MATCHED THEN
      UPDATE SET
        [Source_Id]            = S.[Source_Id],
        [TradeAccount_Id]      = S.[TradeAccount_Id],
        [TradeAccountCode]     = S.[TradeAccountCode],
        [TradeParticipantCode] = S.[TradeParticipantCode],
        [Instrument_Id]        = S.[Instrument_Id],
        [InstrumentCode]       = S.[InstrumentCode],
        [Type]                 = S.[Type],
        [TradeDate]            = S.[TradeDate],
        [AvgPositionPrice]     = S.[AvgPositionPrice],
        [ValuationPlanned]     = S.[ValuationPlanned],
        [ValuationUsed]        = S.[ValuationUsed],
        [VarMargin]            = S.[VarMargin],
        [Value]                = S.[Value],
        [OpenOrderBuys]        = S.[OpenOrderBuys],
        [OpenOrderSells]       = S.[OpenOrderSells],
        [StartBuy]             = S.[StartBuy],
        [StartSell]            = S.[StartSell],
        [StartNet]             = S.[StartNet],
        [TodayBuy]             = S.[TodayBuy],
        [TodaySell]            = S.[TodaySell],
        [TotalNet]             = S.[TotalNet],
        [MaturityDate]         = S.[MaturityDate],
        [TotalVarMargin]       = S.[TotalVarMargin],
        [RealVarMargin]        = S.[RealVarMargin]
    WHEN NOT MATCHED THEN 
      INSERT ([Source_Id], [TradeAccount_Id], [TradeAccountCode], [TradeParticipantCode], [Instrument_Id], [InstrumentCode], [Type],
              [TradeDate], [AvgPositionPrice], [ValuationPlanned], [ValuationUsed], [VarMargin], [Value], [OpenOrderBuys], [OpenOrderSells],
              [StartBuy], [StartSell], [StartNet], [TodayBuy], [TodaySell], [TotalNet], [MaturityDate], [TotalVarMargin], [RealVarMargin])
      VALUES (S.[Source_Id], S.[TradeAccount_Id], S.[TradeAccountCode], S.[TradeParticipantCode], S.[Instrument_Id], S.[InstrumentCode], S.[Type],
              S.[TradeDate], S.[AvgPositionPrice], S.[ValuationPlanned], S.[ValuationUsed], S.[VarMargin], S.[Value], S.[OpenOrderBuys], S.[OpenOrderSells],
              S.[StartBuy], S.[StartSell], S.[StartNet], S.[TodayBuy], S.[TodaySell], S.[TotalNet], S.[MaturityDate], S.[TotalVarMargin], S.[RealVarMargin]);

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [Quik].[Trade Participant Rests::Derivatives::Modify#Aton]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Trade Participant Rests::Derivatives::Modify#Aton]
  @FirmId         VarChar(12),
  @SecCode        VarChar(12),
  @TrdAccId       VarChar(12),
  @Type           VarChar(40),
  @TradeDate      DateTime,
  @AvrPosnPrice   Decimal(19, 6),
  @CbplPlanned    Decimal(19, 4),
  @CbplUsed       Decimal(19, 4),
  @Varmargin      Decimal(19, 4),
  @PositionValue  Decimal(19, 4),
  @OpenBuys       Decimal(10, 0),
  @OpenSells      Decimal(10, 0),
  @StartBuy       Decimal(10, 0),
  @StartNet       Decimal(10, 0),
  @StartSell      Decimal(10, 0),
  @TodayBuy       Decimal(10, 0),
  @TodaySell      Decimal(10, 0),
  @TotalNet       Decimal(10, 0),
  @FirmName       VarChar(30),
  @SecName        VarChar(64),
  @MatDate        DateTime,
  @TotalVarMargin Decimal(19, 6),
  @RealVarMargin  Decimal(19, 6)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 1 -- Aton

  EXEC [Quik].[Trade Participant Rests::Derivatives::Modify]
    @FirmId         = @FirmId,
    @SecCode        = @SecCode,
    @TrdAccId       = @TrdAccId,
    @Type           = @Type,
    @TradeDate      = @TradeDate,
    @AvrPosnPrice   = @AvrPosnPrice,
    @CbplPlanned    = @CbplPlanned,
    @CbplUsed       = @CbplUsed,
    @Varmargin      = @Varmargin,
    @PositionValue  = @PositionValue,
    @OpenBuys       = @OpenBuys,
    @OpenSells      = @OpenSells,
    @StartBuy       = @StartBuy,
    @StartNet       = @StartNet,
    @StartSell      = @StartSell,
    @TodayBuy       = @TodayBuy,
    @TodaySell      = @TodaySell,
    @TotalNet       = @TotalNet,
    @FirmName       = @FirmName,
    @SecName        = @SecName,
    @MatDate        = @MatDate,
    @TotalVarMargin = @TotalVarMargin,
    @RealVarMargin  = @RealVarMargin,
    @Source_Id      = @Source_Id 

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Trade Participant Rests::Derivatives::Modify#OSL]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Trade Participant Rests::Derivatives::Modify#OSL]
  @FirmId         VarChar(12),
  @SecCode        VarChar(12),
  @TrdAccId       VarChar(12),
  @Type           VarChar(40),
  @TradeDate      DateTime,
  @AvrPosnPrice   Decimal(19, 6),
  @CbplPlanned    Decimal(19, 4),
  @CbplUsed       Decimal(19, 4),
  @Varmargin      Decimal(19, 4),
  @PositionValue  Decimal(19, 4),
  @OpenBuys       Decimal(10, 0),
  @OpenSells      Decimal(10, 0),
  @StartBuy       Decimal(10, 0),
  @StartNet       Decimal(10, 0),
  @StartSell      Decimal(10, 0),
  @TodayBuy       Decimal(10, 0),
  @TodaySell      Decimal(10, 0),
  @TotalNet       Decimal(10, 0),
  @FirmName       VarChar(30),
  @SecName        VarChar(64),
  @MatDate        DateTime,
  @TotalVarMargin Decimal(19, 6),
  @RealVarMargin  Decimal(19, 6)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 3 -- 

  EXEC [Quik].[Trade Participant Rests::Derivatives::Modify]
    @FirmId         = @FirmId,
    @SecCode        = @SecCode,
    @TrdAccId       = @TrdAccId,
    @Type           = @Type,
    @TradeDate      = @TradeDate,
    @AvrPosnPrice   = @AvrPosnPrice,
    @CbplPlanned    = @CbplPlanned,
    @CbplUsed       = @CbplUsed,
    @Varmargin      = @Varmargin,
    @PositionValue  = @PositionValue,
    @OpenBuys       = @OpenBuys,
    @OpenSells      = @OpenSells,
    @StartBuy       = @StartBuy,
    @StartNet       = @StartNet,
    @StartSell      = @StartSell,
    @TodayBuy       = @TodayBuy,
    @TodaySell      = @TodaySell,
    @TotalNet       = @TotalNet,
    @FirmName       = @FirmName,
    @SecName        = @SecName,
    @MatDate        = @MatDate,
    @TotalVarMargin = @TotalVarMargin,
    @RealVarMargin  = @RealVarMargin,
    @Source_Id      = @Source_Id 

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Trade Participant Rests::Execution Dates::Modify]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Trade Participant Rests::Execution Dates::Modify]
  @CurrCode    VarChar(4),
  @FirmId      VarChar(12),
  @SettleDate  DateTime,
  @SettleCode  VarChar(12),
  @LoadDate    DateTime,
  @PositionTag VarChar(4),
  @Margincall  Decimal(19, 2),
  @Debit       Decimal(19, 2),
  @Credit      Decimal(19, 2),
  @PosnGroup   VarChar(64),
  @Source_Id   TinyInt
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @TradeParticipant_Id Int,
    @PositionGroup       Char(1)
    
  BEGIN TRY
    IF @CurrCode IS NULL
      RaisError('   @CurrCode', 16, 2)  

    IF @FirmId IS NULL
      RaisError('   @FirmId', 16, 2)   

    IF @SettleDate IS NULL
      RaisError('   @SettleDate', 16, 2)  

    IF @SettleCode IS NULL
      RaisError('   @SettleCode', 16, 2)  

    IF @LoadDate IS NULL
      RaisError('   @LoadDate', 16, 2) 
 
    IF @Source_Id IS NULL
      RaisError('   ', 16, 2)        
        
    SET @PositionGroup = [Quik].[Position::Value::To PositionGroup](@PosnGroup)

    IF @PosnGroup IS NOT NULL AND @PositionGroup IS NULL
      RaisError('   @PosnGroup', 16, 2)      

    SELECT TOP 1
      @TradeParticipant_Id = QT.[TradeParticipant_Id]
    FROM [Quik].[Places:Trade Participants] QT
    WHERE QT.[Code] = @FirmId    
      AND QT.[Source_Id] = @Source_Id --     ,   

    MERGE [Gate].[Trade Participant Rests:Execution Dates] T
    USING
    (
      SELECT
        @Source_Id,
        @TradeParticipant_Id,
        NULL,
        @CurrCode,
        @SettleDate,
        @SettleCode,
        @LoadDate,
        @PositionTag,
        @Margincall,
        @Debit,
        @Credit,
        @PositionGroup
      WHERE @TradeParticipant_Id IS NOT NULL
    ) AS S ([Source_Id], [TradeParticipant_Id], [TradeParticipantCode], [Currency], [SettleDate], [SettleCode], [TradeDate],
            [PositionTag], [MarginCall], [Debit], [Credit], [PositionGroup])
    ON T.[TradeParticipant_Id] = S.[TradeParticipant_Id] AND T.[TradeParticipantCode] IS NULL AND T.[Currency] = S.[Currency] AND T.[SettleDate] = S.[SettleDate]  AND T.[SettleCode] = S.[SettleCode] AND T.[TradeDate] = S.[TradeDate]
    WHEN MATCHED THEN
      UPDATE SET
        [Source_Id]            = S.[Source_Id],
        [TradeParticipant_Id]  = S.[TradeParticipant_Id],
        [TradeParticipantCode] = S.[TradeParticipantCode],
        [Currency]             = S.[Currency],
        [SettleDate]           = S.[SettleDate],
        [SettleCode]           = S.[SettleCode],
        [TradeDate]            = S.[TradeDate],
        [PositionTag]          = S.[PositionTag],
        [MarginCall]           = S.[MarginCall],
        [Debit]                = S.[Debit],
        [Credit]               = S.[Credit],
        [PositionGroup]        = S.[PositionGroup]
    WHEN NOT MATCHED THEN 
      INSERT ([Source_Id], [TradeParticipant_Id], [TradeParticipantCode], [Currency], [SettleDate], [SettleCode], [TradeDate],
              [PositionTag], [MarginCall], [Debit], [Credit], [PositionGroup])
      VALUES (S.[Source_Id], S.[TradeParticipant_Id], S.[TradeParticipantCode], S.[Currency], S.[SettleDate], S.[SettleCode], S.[TradeDate],
              S.[PositionTag], S.[MarginCall], S.[Debit], S.[Credit], S.[PositionGroup]);

        MERGE [Gate].[Trade Participant Rests:Execution Dates] T
    USING
    (
      SELECT
        @Source_Id,
        NULL,
        @FirmId,
        @CurrCode,
        @SettleDate,
        @SettleCode,
        @LoadDate,
        @PositionTag,
        @Margincall,
        @Debit,
        @Credit,
        @PositionGroup
      WHERE @TradeParticipant_Id IS NULL
    ) AS S ([Source_Id], [TradeParticipant_Id], [TradeParticipantCode], [Currency], [SettleDate], [SettleCode], [TradeDate],
            [PositionTag], [MarginCall], [Debit], [Credit], [PositionGroup])
    ON T.[TradeParticipant_Id] IS NULL AND T.[TradeParticipantCode] = S.[TradeParticipantCode] AND T.[Currency] = S.[Currency] AND T.[SettleDate] = S.[SettleDate]  AND T.[SettleCode] = S.[SettleCode] AND T.[TradeDate] = S.[TradeDate]
    WHEN MATCHED THEN
      UPDATE SET
        [Source_Id]            = S.[Source_Id],
        [TradeParticipant_Id]  = S.[TradeParticipant_Id],
        [TradeParticipantCode] = S.[TradeParticipantCode],
        [Currency]             = S.[Currency],
        [SettleDate]           = S.[SettleDate],
        [SettleCode]           = S.[SettleCode],
        [TradeDate]            = S.[TradeDate],
        [PositionTag]          = S.[PositionTag],
        [MarginCall]           = S.[MarginCall],
        [Debit]                = S.[Debit],
        [Credit]               = S.[Credit],
        [PositionGroup]        = S.[PositionGroup]
    WHEN NOT MATCHED THEN 
      INSERT ([Source_Id], [TradeParticipant_Id], [TradeParticipantCode], [Currency], [SettleDate], [SettleCode], [TradeDate],
              [PositionTag], [MarginCall], [Debit], [Credit], [PositionGroup])
      VALUES (S.[Source_Id], S.[TradeParticipant_Id], S.[TradeParticipantCode], S.[Currency], S.[SettleDate], S.[SettleCode], S.[TradeDate],
              S.[PositionTag], S.[MarginCall], S.[Debit], S.[Credit], S.[PositionGroup]);

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [Quik].[Trade Participant Rests::Execution Dates::Modify#Aton]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Trade Participant Rests::Execution Dates::Modify#Aton]
  @CurrCode    VarChar(4),
  @FirmId      VarChar(12),
  @SettleDate  DateTime,
  @SettleCode  VarChar(12),
  @LoadDate    DateTime,
  @PositionTag VarChar(4),
  @Margincall  Decimal(19, 2),
  @Debit       Decimal(19, 2),
  @Credit      Decimal(19, 2),
  @PosnGroup   VarChar(64)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 1 -- Aton

  EXEC [Quik].[Trade Participant Rests::Execution Dates::Modify]
    @CurrCode    = @CurrCode,
    @FirmId      = @FirmId,
    @SettleDate  = @SettleDate,
    @SettleCode  = @SettleCode,
    @LoadDate    = @LoadDate,
    @PositionTag = @PositionTag,
    @Margincall  = @Margincall,
    @Debit       = @Debit,
    @Credit      = @Credit,
    @PosnGroup   = @PosnGroup,
    @Source_Id   = @Source_Id 

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Trade Participant Rests::Execution Dates::Modify#OSL]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Trade Participant Rests::Execution Dates::Modify#OSL]
  @CurrCode    VarChar(4),
  @FirmId      VarChar(12),
  @SettleDate  DateTime,
  @SettleCode  VarChar(12),
  @LoadDate    DateTime,
  @PositionTag VarChar(4),
  @Margincall  Decimal(19, 2),
  @Debit       Decimal(19, 2),
  @Credit      Decimal(19, 2),
  @PosnGroup   VarChar(64)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 3 -- 

  EXEC [Quik].[Trade Participant Rests::Execution Dates::Modify]
    @CurrCode    = @CurrCode,
    @FirmId      = @FirmId,
    @SettleDate  = @SettleDate,
    @SettleCode  = @SettleCode,
    @LoadDate    = @LoadDate,
    @PositionTag = @PositionTag,
    @Margincall  = @Margincall,
    @Debit       = @Debit,
    @Credit      = @Credit,
    @PosnGroup   = @PosnGroup,
    @Source_Id   = @Source_Id 

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Trade Participant Rests::Money::Modify]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Trade Participant Rests::Money::Modify]
  @CurrCode    VarChar(4),
  @Description VarChar(30),
  @FirmId      VarChar(12),
  @Tag         VarChar(4),
  @LoadDate    DateTime,
  @BankAccId   VarChar(12),
  @CurrentPos  Decimal(19, 4),
  @OpenBal     Decimal(19, 4),
  @PlannedPos  Decimal(19, 4),
  @OrderBuy    Decimal(19, 4),
  @OrderSell   Decimal(19, 4),
  @Netto       Decimal(19, 4),
  @PlannedBal  Decimal(19, 4),
  @MarginCall  Decimal(19, 4),
  @SettleBal   Decimal(19, 4),
  @Source_Id   TinyInt
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @TradeParticipant_Id Int
    
  BEGIN TRY
    IF @CurrCode IS NULL
      RaisError('   @CurrCode', 16, 2)  

    IF @FirmId IS NULL
      RaisError('   @FirmId', 16, 2)  

    IF @Tag IS NULL
      RaisError('   @Tag', 16, 2) 

    IF @LoadDate IS NULL
      RaisError('   @LoadDate', 16, 2) 

    IF @BankAccId IS NULL
      RaisError('   @BankAccId', 16, 2) 
 
    IF @Source_Id IS NULL
      RaisError('   ', 16, 2)        
        
    SELECT TOP 1
      @TradeParticipant_Id = QT.[TradeParticipant_Id]
    FROM [Quik].[Places:Trade Participants] QT
    WHERE QT.[Code] = @FirmId    
      AND QT.[Source_Id] = @Source_Id --     ,   

    MERGE [Gate].[Trade Participant Rests:Money] T
    USING
    (
      SELECT
        @Source_Id,
        @TradeParticipant_Id,
        NULL,
        @CurrCode,
        @Tag,
        @BankAccId,
        @LoadDate,
        @Description,
        @CurrentPos,
        @OpenBal,
        @PlannedPos,
        @OrderBuy,
        @OrderSell,
        @Netto,
        @PlannedBal,
        @MarginCall,
        @SettleBal
      WHERE @TradeParticipant_Id IS NOT NULL
    ) AS S ([Source_Id], [TradeParticipant_Id], [TradeParticipantCode], [Currency], [Tag], [BankAccount], [TradeDate], [Description],
            [CurrentPosition], [OpenBalance], [PlannedPosition], [OrderBuy], [OrderSell], [Netto], [PlannedBalance], [MarginCall], [SettleBalance])
    ON T.[TradeParticipant_Id] = S.[TradeParticipant_Id] AND T.[TradeParticipantCode] IS NULL AND T.[Currency] = S.[Currency] AND T.[Tag] = S.[Tag] AND T.[BankAccount] = S.[BankAccount] AND T.[TradeDate] = S.[TradeDate]
    WHEN MATCHED THEN
      UPDATE SET
        [Source_Id]            = S.[Source_Id],
        [TradeParticipant_Id]  = S.[TradeParticipant_Id],
        [TradeParticipantCode] = S.[TradeParticipantCode],
        [Currency]             = S.[Currency],
        [Tag]                  = S.[Tag],
        [BankAccount]          = S.[BankAccount],
        [TradeDate]            = S.[TradeDate],
        [Description]          = S.[Description],
        [CurrentPosition]      = S.[CurrentPosition],
        [OpenBalance]          = S.[OpenBalance],
        [PlannedPosition]      = S.[PlannedPosition],
        [OrderBuy]             = S.[OrderBuy],
        [OrderSell]            = S.[OrderSell],
        [Netto]                = S.[Netto],
        [PlannedBalance]       = S.[PlannedBalance],
        [MarginCall]           = S.[MarginCall],
        [SettleBalance]        = S.[SettleBalance]
    WHEN NOT MATCHED THEN 
      INSERT ([Source_Id], [TradeParticipant_Id], [TradeParticipantCode], [Currency], [Tag], [BankAccount], [TradeDate], [Description],
              [CurrentPosition], [OpenBalance], [PlannedPosition], [OrderBuy], [OrderSell], [Netto], [PlannedBalance], [MarginCall], [SettleBalance])
      VALUES (S.[Source_Id], S.[TradeParticipant_Id], S.[TradeParticipantCode], S.[Currency], S.[Tag], S.[BankAccount], S.[TradeDate], S.[Description],
              S.[CurrentPosition], S.[OpenBalance], S.[PlannedPosition], S.[OrderBuy], S.[OrderSell], S.[Netto], S.[PlannedBalance], S.[MarginCall], S.[SettleBalance]);

    MERGE [Gate].[Trade Participant Rests:Money] T
    USING
    (
      SELECT
        @Source_Id,
        @TradeParticipant_Id,
        @FirmId,
        @CurrCode,
        @Tag,
        @BankAccId,
        @LoadDate,
        @Description,
        @CurrentPos,
        @OpenBal,
        @PlannedPos,
        @OrderBuy,
        @OrderSell,
        @Netto,
        @PlannedBal,
        @MarginCall,
        @SettleBal
      WHERE @TradeParticipant_Id IS NULL
    ) AS S ([Source_Id], [TradeParticipant_Id], [TradeParticipantCode], [Currency], [Tag], [BankAccount], [TradeDate], [Description],
            [CurrentPosition], [OpenBalance], [PlannedPosition], [OrderBuy], [OrderSell], [Netto], [PlannedBalance], [MarginCall], [SettleBalance])
    ON T.[TradeParticipant_Id] IS NULL AND T.[TradeParticipantCode] = S.[TradeParticipantCode] AND T.[Currency] = S.[Currency] AND T.[Tag] = S.[Tag] AND T.[BankAccount] = S.[BankAccount] AND T.[TradeDate] = S.[TradeDate]
    WHEN MATCHED THEN
      UPDATE SET
        [Source_Id]            = S.[Source_Id],
        [TradeParticipant_Id]  = S.[TradeParticipant_Id],
        [TradeParticipantCode] = S.[TradeParticipantCode],
        [Currency]             = S.[Currency],
        [Tag]                  = S.[Tag],
        [BankAccount]          = S.[BankAccount],
        [TradeDate]            = S.[TradeDate],
        [Description]          = S.[Description],
        [CurrentPosition]      = S.[CurrentPosition],
        [OpenBalance]          = S.[OpenBalance],
        [PlannedPosition]      = S.[PlannedPosition],
        [OrderBuy]             = S.[OrderBuy],
        [OrderSell]            = S.[OrderSell],
        [Netto]                = S.[Netto],
        [PlannedBalance]       = S.[PlannedBalance],
        [MarginCall]           = S.[MarginCall],
        [SettleBalance]        = S.[SettleBalance]
    WHEN NOT MATCHED THEN 
      INSERT ([Source_Id], [TradeParticipant_Id], [TradeParticipantCode], [Currency], [Tag], [BankAccount], [TradeDate], [Description],
              [CurrentPosition], [OpenBalance], [PlannedPosition], [OrderBuy], [OrderSell], [Netto], [PlannedBalance], [MarginCall], [SettleBalance])
      VALUES (S.[Source_Id], S.[TradeParticipant_Id], S.[TradeParticipantCode], S.[Currency], S.[Tag], S.[BankAccount], S.[TradeDate], S.[Description],
              S.[CurrentPosition], S.[OpenBalance], S.[PlannedPosition], S.[OrderBuy], S.[OrderSell], S.[Netto], S.[PlannedBalance], S.[MarginCall], S.[SettleBalance]);

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [Quik].[Trade Participant Rests::Money::Modify#Aton]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Trade Participant Rests::Money::Modify#Aton]
  @CurrCode    VarChar(4),
  @Description VarChar(30),
  @FirmId      VarChar(12),
  @Tag         VarChar(4),
  @LoadDate    DateTime,
  @BankAccId   VarChar(12),
  @CurrentPos  Decimal(19, 4),
  @OpenBal     Decimal(19, 4),
  @PlannedPos  Decimal(19, 4),
  @OrderBuy    Decimal(19, 4),
  @OrderSell   Decimal(19, 4),
  @Netto       Decimal(19, 4),
  @PlannedBal  Decimal(19, 4),
  @MarginCall  Decimal(19, 4),
  @SettleBal   Decimal(19, 4)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 1 -- Aton

  EXEC [Quik].[Trade Participant Rests::Money::Modify]
    @CurrCode    = @CurrCode,
    @Description = @Description,
    @FirmId      = @FirmId,
    @Tag         = @Tag,
    @LoadDate    = @LoadDate,
    @BankAccId   = @BankAccId,
    @CurrentPos  = @CurrentPos,
    @OpenBal     = @OpenBal,
    @PlannedPos  = @PlannedPos,
    @OrderBuy    = @OrderBuy,
    @OrderSell   = @OrderSell,
    @Netto       = @Netto,
    @PlannedBal  = @PlannedBal,
    @MarginCall  = @MarginCall,
    @SettleBal   = @SettleBal,
    @Source_Id   = @Source_Id 

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Trade Participant Rests::Money::Modify#OSL]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Trade Participant Rests::Money::Modify#OSL]
  @CurrCode    VarChar(4),
  @Description VarChar(30),
  @FirmId      VarChar(12),
  @Tag         VarChar(4),
  @LoadDate    DateTime,
  @BankAccId   VarChar(12),
  @CurrentPos  Decimal(19, 4),
  @OpenBal     Decimal(19, 4),
  @PlannedPos  Decimal(19, 4),
  @OrderBuy    Decimal(19, 4),
  @OrderSell   Decimal(19, 4),
  @Netto       Decimal(19, 4),
  @PlannedBal  Decimal(19, 4),
  @MarginCall  Decimal(19, 4),
  @SettleBal   Decimal(19, 4)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 3 -- 

  EXEC [Quik].[Trade Participant Rests::Money::Modify]
    @CurrCode    = @CurrCode,
    @Description = @Description,
    @FirmId      = @FirmId,
    @Tag         = @Tag,
    @LoadDate    = @LoadDate,
    @BankAccId   = @BankAccId,
    @CurrentPos  = @CurrentPos,
    @OpenBal     = @OpenBal,
    @PlannedPos  = @PlannedPos,
    @OrderBuy    = @OrderBuy,
    @OrderSell   = @OrderSell,
    @Netto       = @Netto,
    @PlannedBal  = @PlannedBal,
    @MarginCall  = @MarginCall,
    @SettleBal   = @SettleBal,
    @Source_Id   = @Source_Id 

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Trade Participant Rests::Securities::Modify]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Trade Participant Rests::Securities::Modify]
  @SecCode        VarChar(12),
  @FirmId         VarChar(12),
  @LoadDate       DateTime,
  @CurrentPos     Decimal(19, 4), 
  @OpenBal        Decimal(19, 4), 
  @PlannedPosBuy  Decimal(19, 4), 
  @PlannedPosSell Decimal(19, 4), 
  @SecName        VarChar(64),
  @UsQtyB         Decimal(19, 4), 
  @UsQtyS         Decimal(19, 4),
  @Source_Id      TinyInt
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @TradeParticipant_Id Int,
    @Instrument_Id       Int
    
  BEGIN TRY
    IF @SecCode IS NULL
      RaisError('   @SecCode', 16, 2)  

    IF @FirmId IS NULL
      RaisError('   @FirmId', 16, 2)  

    IF @LoadDate IS NULL
      RaisError('   @LoadDate', 16, 2) 
 
    IF @Source_Id IS NULL
      RaisError('   ', 16, 2)        
        
    SELECT TOP 1
      @TradeParticipant_Id = QT.[TradeParticipant_Id]
    FROM [Quik].[Places:Trade Participants] QT
    WHERE QT.[Code] = @FirmId    
      AND QT.[Source_Id] = @Source_Id --     ,   

    IF @TradeParticipant_Id IS NOT NULL
      SELECT
        @Instrument_Id = [Id]
      FROM [Gate].[Instruments]
      WHERE [Code] = @SecCode
        AND [Source_Id] = @Source_Id

    MERGE [Gate].[Trade Participant Rests:Securities] T
    USING
    (
      SELECT
        @Source_Id,
        @TradeParticipant_Id,
        NULL,
        @Instrument_Id,
        NULL,
        @LoadDate,
        @CurrentPos,
        @OpenBal,
        @PlannedPosBuy,
        @PlannedPosSell,
        @UsQtyB,
        @UsQtyS
      WHERE @TradeParticipant_Id IS NOT NULL
        AND @Instrument_Id IS NOT NULL
    ) AS S ([Source_Id], [TradeParticipant_Id], [TradeParticipantCode], [Instrument_Id], [InstrumentCode], [TradeDate],
            [CurrentPosition], [OpenBalance], [PlannedPositionBuy], [PlannedPositionSell], [QuantityBuy], [QuantitySell])
    ON T.[Instrument_Id] = S.[Instrument_Id] AND T.[InstrumentCode] IS NULL AND T.[TradeParticipant_Id] = S.[TradeParticipant_Id] AND T.[TradeParticipantCode] IS NULL AND T.[TradeDate] = S.[TradeDate]
    WHEN MATCHED THEN
      UPDATE SET
        [Source_Id]            = S.[Source_Id],
        [TradeParticipant_Id]  = S.[TradeParticipant_Id],
        [TradeParticipantCode] = S.[TradeParticipantCode],
        [Instrument_Id]        = S.[Instrument_Id],
        [InstrumentCode]       = S.[InstrumentCode],
        [TradeDate]            = S.[TradeDate],
        [CurrentPosition]      = S.[CurrentPosition],
        [OpenBalance]          = S.[OpenBalance],
        [PlannedPositionBuy]   = S.[PlannedPositionBuy],
        [PlannedPositionSell]  = S.[PlannedPositionSell],
        [QuantityBuy]          = S.[QuantityBuy],
        [QuantitySell]         = S.[QuantitySell]
    WHEN NOT MATCHED THEN 
      INSERT ([Source_Id], [TradeParticipant_Id], [TradeParticipantCode], [Instrument_Id], [InstrumentCode], [TradeDate],
              [CurrentPosition], [OpenBalance], [PlannedPositionBuy], [PlannedPositionSell], [QuantityBuy], [QuantitySell])
      VALUES (S.[Source_Id], S.[TradeParticipant_Id], S.[TradeParticipantCode], S.[Instrument_Id], S.[InstrumentCode], S.[TradeDate],
              S.[CurrentPosition], S.[OpenBalance], S.[PlannedPositionBuy], S.[PlannedPositionSell], S.[QuantityBuy], S.[QuantitySell]);

    MERGE [Gate].[Trade Participant Rests:Securities] T
    USING
    (
      SELECT
        @Source_Id,
        NULL,
        @FirmId,
        NULL,
        @SecCode,
        @LoadDate,
        @CurrentPos,
        @OpenBal,
        @PlannedPosBuy,
        @PlannedPosSell,
        @UsQtyB,
        @UsQtyS
      WHERE @TradeParticipant_Id IS NULL
         OR @Instrument_Id IS NULL
    ) AS S ([Source_Id], [TradeParticipant_Id], [TradeParticipantCode], [Instrument_Id], [InstrumentCode], [TradeDate],
            [CurrentPosition], [OpenBalance], [PlannedPositionBuy], [PlannedPositionSell], [QuantityBuy], [QuantitySell])
    ON T.[Instrument_Id] IS NULL AND T.[InstrumentCode] = S.[InstrumentCode] AND T.[TradeParticipant_Id] IS NULL AND T.[TradeParticipantCode] = S.[TradeParticipantCode] AND T.[TradeDate] = S.[TradeDate]
    WHEN MATCHED THEN
      UPDATE SET
        [Source_Id]            = S.[Source_Id],
        [TradeParticipant_Id]  = S.[TradeParticipant_Id],
        [TradeParticipantCode] = S.[TradeParticipantCode],
        [Instrument_Id]        = S.[Instrument_Id],
        [InstrumentCode]       = S.[InstrumentCode],
        [TradeDate]            = S.[TradeDate],
        [CurrentPosition]      = S.[CurrentPosition],
        [OpenBalance]          = S.[OpenBalance],
        [PlannedPositionBuy]   = S.[PlannedPositionBuy],
        [PlannedPositionSell]  = S.[PlannedPositionSell],
        [QuantityBuy]          = S.[QuantityBuy],
        [QuantitySell]         = S.[QuantitySell]
    WHEN NOT MATCHED THEN 
      INSERT ([Source_Id], [TradeParticipant_Id], [TradeParticipantCode], [Instrument_Id], [InstrumentCode], [TradeDate],
              [CurrentPosition], [OpenBalance], [PlannedPositionBuy], [PlannedPositionSell], [QuantityBuy], [QuantitySell])
      VALUES (S.[Source_Id], S.[TradeParticipant_Id], S.[TradeParticipantCode], S.[Instrument_Id], S.[InstrumentCode], S.[TradeDate],
              S.[CurrentPosition], S.[OpenBalance], S.[PlannedPositionBuy], S.[PlannedPositionSell], S.[QuantityBuy], S.[QuantitySell]);

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [Quik].[Trade Participant Rests::Securities::Modify#Aton]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Trade Participant Rests::Securities::Modify#Aton]
  @SecCode        VarChar(12),
  @FirmId         VarChar(12),
  @LoadDate       DateTime,
  @CurrentPos     Decimal(19, 4), 
  @OpenBal        Decimal(19, 4), 
  @PlannedPosBuy  Decimal(19, 4), 
  @PlannedPosSell Decimal(19, 4), 
  @SecName        VarChar(64),
  @UsQtyB         Decimal(19, 4), 
  @UsQtyS         Decimal(19, 4)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 1 -- Aton

  EXEC [Quik].[Trade Participant Rests::Securities::Modify]
    @SecCode        = @SecCode,
    @FirmId         = @FirmId,
    @LoadDate       = @LoadDate,
    @CurrentPos     = @CurrentPos,
    @OpenBal        = @OpenBal,
    @PlannedPosBuy  = @PlannedPosBuy,
    @PlannedPosSell = @PlannedPosSell,
    @SecName        = @SecName,
    @UsQtyB         = @UsQtyB,
    @UsQtyS         = @UsQtyS,
    @Source_Id      = @Source_Id 

  RETURN 1

GO
/****** Object:  StoredProcedure [Quik].[Trade Participant Rests::Securities::Modify#OSL]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [Quik].[Trade Participant Rests::Securities::Modify#OSL]
  @SecCode        VarChar(12),
  @FirmId         VarChar(12),
  @LoadDate       DateTime,
  @CurrentPos     Decimal(19, 4), 
  @OpenBal        Decimal(19, 4), 
  @PlannedPosBuy  Decimal(19, 4), 
  @PlannedPosSell Decimal(19, 4), 
  @SecName        VarChar(64),
  @UsQtyB         Decimal(19, 4), 
  @UsQtyS         Decimal(19, 4)
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Source_Id TinyInt = 3 -- 

  EXEC [Quik].[Trade Participant Rests::Securities::Modify]
    @SecCode        = @SecCode,
    @FirmId         = @FirmId,
    @LoadDate       = @LoadDate,
    @CurrentPos     = @CurrentPos,
    @OpenBal        = @OpenBal,
    @PlannedPosBuy  = @PlannedPosBuy,
    @PlannedPosSell = @PlannedPosSell,
    @SecName        = @SecName,
    @UsQtyB         = @UsQtyB,
    @UsQtyS         = @UsQtyS,
    @Source_Id      = @Source_Id 

  RETURN 1

GO
/****** Object:  StoredProcedure [SQL].[Extract Object Path]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [SQL].[Extract Object Path]
  @Path           sysname,
  @Server         sysname   = NULL out,
  @DataBase       sysname   = NULL out,
  @Schema         sysname   = NULL out,
  @Name           sysname   = NULL out,
  @Version        smallint  = NULL out
AS
  SET NOCOUNT ON

  DECLARE
    @OpenBorder   char(1)
  , @CloseBorder  char(1)
  , @L            smallint
  , @I            smallint
  , @V            VarChar(32)
  , @PI           smallint
  , @SI           smallint
  , @VI           smallint

  SELECT
    @Server    = NULL,
    @DataBase  = NULL,
    @Schema    = NULL,
    @Name      = NULL,
    @Version   = NULL

  BEGIN TRY
    SET @Path = LTrim(RTrim(@Path))
    IF @Path is null or @Path = '' RETURN @Path

    WHILE 1 = 1 BEGIN
      SET @L = LEN(@Path)
      SET @OpenBorder = Left(@Path, 1)

      IF @OpenBorder in ('[', '"') BEGIN
        SET @CloseBorder = CASE WHEN @OpenBorder = '[' THEN ']' ELSE @OpenBorder END

        SET @I = CHARINDEX(@CloseBorder, @Path, 2)
        IF @I = 0 BREAK

        SET @V = SUBSTRING(@Path, @I + 1, 1)
        IF @I = @L OR @V <> '.' BEGIN
          IF @V = ';' BEGIN
            SET @SI = @I + 2 
            WHILE @SI <= @L AND SUBSTRING(@Path, @SI, 1) BETWEEN '0' AND '9' 
              SET @SI = @SI + 1

            SET @V = SUBSTRING(@Path, @I + 2, @SI - @I - 1)
          END ELSE
            SET @V = ''

          SET @Name = SUBSTRING(@Path, 2, @I - 2)
          IF @V <> ''
            SET @Version = @V

          BREAK
        END

        SET @Server     = @DataBase
        SET @DataBase   = @Schema
        SET @Schema     = CASE WHEN @I > 2 THEN SUBSTRING(@Path, 2, @I - 2) END
        SET @Path = RIGHT(@Path, @L - @I - 1)
      END ELSE BEGIN
        SET @PI = CHARINDEX('.', @Path)
        SET @SI = CHARINDEX(' ', @Path)
        SET @VI = CHARINDEX(';', @Path)

        IF @PI = 0 AND @SI = 0 AND @VI = 0 BEGIN
          SET @Name = @Path
          BREAK
        END ELSE IF @PI > 0 AND (@SI = 0 OR @SI > @PI) AND (@VI = 0 OR @VI > @PI) BEGIN
          SET @Server     = @DataBase
          SET @DataBase   = @Schema
          SET @Schema     = CASE WHEN @PI > 1 THEN LEFT(@Path, @PI - 1) END
          SET @Path = RIGHT(@Path, @L - @PI)
        END ELSE IF @VI > 0 AND (@SI = 0 OR @SI > @VI) BEGIN
          SET @SI = @VI + 1 
          WHILE @SI <= @L AND SUBSTRING(@Path, @SI, 1) BETWEEN '0' AND '9' 
            SET @SI = @SI + 1

          SET @Name = LEFT(@Path, @VI - 1)
          IF @SI > @VI + 1
            SET @Version = SUBSTRING(@Path, @VI + 1, @SI - @VI -1)
          BREAK
        END ELSE BEGIN
          SET @Name = LEFT(@Path, @SI - 1)
          BREAK
        END
      END
    END

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [SQL].[Generate DML]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--===============================================================================================================
-- <>:        :
--                      -  , ,   DML ;
--                      -   -  EXEC;
-- <>:              ;
-- < >:       ;
-- <>:              ..;
-- < >:     24.10.2011;
-- <>:          Ctrl+0;
-----------------------------------------------------------------------------------------------------------------
-- <>:          ;
-- < >:    ;
-- < >: ;
-- <>:       ;
-----------------------------------------------------------------------------------------------------------------
-- <>:
/*
  EXEC [SQL].[Generate DML] '[Base].[Instruments:Securities:Issues]'
  EXEC [SQL].[Generate DML] '[Base].[Securities:Issues(Translate)]'
  EXEC [SQL].[Generate DML] '[Base].[Instruments:Securities:Issues(Periodic Update)]'
  EXEC [SQL].[Generate DML] '[Base].[Security::Issue::Modify(Execute)#Bond]'
*/
--===============================================================================================================
CREATE PROCEDURE [SQL].[Generate DML]
  @SqlObjectName    Sysname,

  @GetSelect        Bit     = 1, -- SELECT <Alias(i)> = <Field(i)>, ... FROM <SqlObject>
  @GetSelectVars    Bit     = 1, -- SELECT TOP 1 @Var(i) = <Field(i)>, ... FROM <SqlObject>
  @GetSelectXml     Bit     = 1,
  @GetSelectXml2    Bit     = 1,
  @GetInsert        Bit     = 1, -- INSERT INTO <SqlObject> ( <Fields> ) VALUES ( @Vars )
  @GetInsertShort   Bit     = 1, -- INSERT INTO <SqlObject> ( <Fields> ) VALUES ( @Vars )
  @GetUpdate        Bit     = 1, -- UPDATE O SET <Field(i)> = @Var(i), ... FROM <SqlObject> AS O
  @GetDeclare       Bit     = 1, -- DECLARE <@Var(i) Type(i) NULL/NOT NULL>
  @GetDeclareTable  Bit     = 1, -- DECLARE @Table TABLE (<Fields>)

  @GetExec          Bit     = 1, -- EXEC <SqlObject> @Param(i) = @Param(i)

  @Debug            Bit     = 0
AS
  SET NOCOUNT ON

  DECLARE
    @Err                  Int,
    @ErrMsg               Sysname,

    @ObjectID             Int,
    @ObjectType           Char(2),

    @Syn                  Sysname,
    @ShiftConst           Int           = 27,
    @ShiftValue           Int,

    @SQL_Select           NVarChar(Max),
    @SQL_Select_List      NVarChar(Max),

    @SQL_SelectVars       NVarChar(Max),
    @SQL_SelectVars_List  NVarChar(Max),

    @SQL_SelectXml        NVarChar(Max),
    @SQL_SelectXml_List   NVarChar(Max),

    @SQL_SelectXml2       NVarChar(Max),
    @SQL_SelectXml2_List  NVarChar(Max),

    @SQL_Insert           NVarChar(Max),
    @SQL_Insert_Fields    NVarChar(Max),
    @SQL_Insert_Vars      NVarChar(Max),

    @SQL_InsSht           NVarChar(Max),
    @SQL_InsSht_Fields    NVarChar(Max),
    @SQL_InsSht_Vars      NVarChar(Max),

    @SQL_Update           NVarChar(Max),
    @SQL_Update_List      NVarChar(Max),

    @SQL_Declare          NVarChar(Max),
    @SQL_Declare_List     NVarChar(Max),

    @SQL_Table            NVarChar(Max),
    @SQL_Table_List       NVarChar(Max),

    @SQL_Exec             NVarChar(Max),
    @SQL_Exec_Params      NVarChar(Max),

    @SchemaName           Sysname,
    @SchemaNameQ          Sysname,
    @ObjectName           Sysname,
    @ObjectNameQ          Sysname,

    @Table_Id             Int,  --    ( SCHEMA.[Periodic::Table::Id])

    @EL                   NChar(2)      = Char(13) + Char(10),
    @GO                   NVarChar(32)  = 'GO',
    @TypeRenames          NVarChar(Max) = 'int=Int;tinyint=TinyInt;smallint=SmallInt;bigint=BigInt;char=Char;varchar=VarChar;nchar=NChar;nvarchar=NVarChar;date=Date;datetime=DateTime;time=Time;bit=Bit;uniqueidentifier=UniqueIdentifier;numeric=Numeric;text=Text;ntext=NText',
    @VarTypes             NVarChar(Max) = 'varchar,nvarchar,varbinary',
    @NumTypes             NVarChar(Max) = 'numeric'

  BEGIN TRY

    SET @ObjectID       = OBJECT_ID(@SqlObjectName)
    IF @ObjectID IS NULL
      RAISERROR ('SQL-  ! @SqlObjectName = %s', 16, 2, @SqlObjectName)

    SET @SchemaName     = OBJECT_SCHEMA_NAME(@ObjectID)
    SET @SchemaNameQ    = QUOTENAME(@SchemaName)
    SET @ObjectName     = OBJECT_NAME(@ObjectID)
    SET @Syn            = [SQL].[Generate Alias](@ObjectName)
    SET @ObjectNameQ    = QUOTENAME(@ObjectName)
    SET @SqlObjectName  = @SchemaNameQ + '.' + @ObjectNameQ

    SET @ObjectType     = CAST(OBJECTPROPERTYEX(@ObjectID, N'BaseType') AS Char(2))

    IF @Debug = 1
      SELECT [@ObjectID] = @ObjectID, [@SqlObjectName] = @SqlObjectName, [@ObjectType] = @ObjectType

    ----------------------------------------------
    IF @ObjectType IN ('U', 'V', 'TF', 'IF') BEGIN
      --    
      SELECT @ShiftValue = MAX(LEN(QUOTENAME(AC.[name])))
      FROM sys.all_columns AS AC
      LEFT JOIN sys.types AS T ON T.[user_type_id] = AC.[user_type_id]
      WHERE [object_id] = @ObjectID

      SET @ShiftValue = CASE WHEN @ShiftValue < @ShiftConst THEN @ShiftConst ELSE @ShiftValue END


      SELECT
        @SQL_Select_List      = ISNULL(@SQL_Select_List + ',' + @EL, '') +
                              '  ' + [SQL].[Shift](QUOTENAME(AC.[name]), @ShiftValue) + ' = ' + @Syn + '.' + QUOTENAME(AC.[name]),
        @SQL_SelectVars_List  = ISNULL(@SQL_SelectVars_List + ',' + @EL, '') +
                              '  ' + [SQL].[Shift]('@' + AC.[name], @ShiftValue) + ' = ' + @Syn + '.' + QUOTENAME(AC.[name]),
        @SQL_SelectXml_List   = ISNULL(@SQL_SelectXml_List + ',' + @EL, CAST('' AS VArChar(Max))) +
                              '  ' + [SQL].[Shift](QUOTENAME(AC.[name]), @ShiftValue) + ' = CASE WHEN FIELDS.' + QUOTENAME(AC.[name]) + ' = 1 THEN @' + AC.[name] + ' END',
        @SQL_SelectXml2_List  = ISNULL(@SQL_SelectXml2_List + ',' + @EL, CAST('' AS VArChar(Max))) +
                              '    ' + [SQL].[Shift](QUOTENAME(AC.[name]), @ShiftValue) + ' = Data.Record.value(''@' + AC.[name] + ''', '''
                              + [Pub].[Array Alias](T.[name], @TypeRenames, ',', ';', 0)
                              + CASE WHEN [Pub].[In Array](@VarTypes, T.[Name], ',') = 1 THEN '(' + REPLACE(CAST(AC.[max_length] AS VarChar(32)), '-1', 'Max') + ')' ELSE '' END
                              + CASE WHEN [Pub].[In Array](@NumTypes, T.[Name], ',') = 1 THEN '(' + CAST(AC.[precision] AS VarChar(32)) + ',' + CAST(AC.[scale] AS VarChar(32)) + ')' ELSE '' END
                              + ''')',
        @SQL_Insert_Fields    = ISNULL(@SQL_Insert_Fields + ',' + @EL, '') +
                              '  ' + QUOTENAME(AC.[name]),
        @SQL_InsSht_Fields    = ISNULL(@SQL_InsSht_Fields + ', ', '')
                              + CASE WHEN LEN(@SQL_InsSht_Fields + ', ' + QUOTENAME(AC.[name])) > 1000 THEN @EL ELSE '' END
                              + QUOTENAME(AC.[name]),
        @SQL_Insert_Vars      = ISNULL(@SQL_Insert_Vars + ',' + @EL, '') +
                              '  @' + AC.[name],
        @SQL_InsSht_Vars      = ISNULL(@SQL_InsSht_Vars + ',', '')
                              + CASE WHEN LEN(@SQL_InsSht_Vars + ', @' + AC.[name]) > 1000 THEN @EL ELSE '' END
                              + '  @' + AC.[name],
        @SQL_Update_List      = ISNULL(@SQL_Update_List + ',' + @EL, '') +
                              '  ' + [SQL].[Shift](QUOTENAME(AC.[name]), @ShiftValue) + ' = @' + AC.[name],
        @SQL_Declare_List     = ISNULL(@SQL_Declare_List + ',' + @EL, '') +
                              '  ' + [SQL].[Shift]('@' + AC.[name], @ShiftValue) + ' ' + [Pub].[Array Alias](T.[name], @TypeRenames, ',', ';', 0)
                              + CASE WHEN [Pub].[In Array](@VarTypes, T.[Name], ',') = 1 THEN '(' + REPLACE(CAST(AC.[max_length] AS VarChar(32)), '-1', 'Max') + ')' ELSE '' END
                              + CASE WHEN [Pub].[In Array](@NumTypes, T.[Name], ',') = 1 THEN '(' + CAST(AC.[precision] AS VarChar(32)) + ',' + CAST(AC.[scale] AS VarChar(32)) + ')' ELSE '' END,
        @SQL_Table_List       = ISNULL(@SQL_Table_List + ',' + @EL, '') +
                              '    '  + [SQL].[Shift](QUOTENAME(AC.[name]), @ShiftValue) + ' '
                                      + [SQL].[Shift]
                                        (
                                              [Pub].[Array Alias](T.[name], @TypeRenames, ',', ';', 0)
                                            + CASE WHEN [Pub].[In Array](@VarTypes, T.[Name], ',') = 1 THEN '(' + REPLACE(CAST(AC.[max_length] AS VarChar(32)), '-1', 'Max') + ')' ELSE '' END
                                            + CASE WHEN [Pub].[In Array](@NumTypes, T.[Name], ',') = 1 THEN '(' + CAST(AC.[precision] AS VarChar(32)) + ',' + CAST(AC.[scale] AS VarChar(32)) + ')' ELSE '' END
                                            + CASE WHEN AC.[collation_name] IS NULL OR AC.[collation_name] = 'Cyrillic_General_CI_AS' THEN '' ELSE ' COLLATE ' + AC.[collation_name] END,
                                            44
                                        )
                                      + CASE WHEN AC.[is_nullable] = 1 THEN '     NULL' ELSE ' NOT NULL' END
      FROM sys.all_columns AS AC
      LEFT JOIN sys.types AS T ON T.[user_type_id] = AC.[user_type_id]
      WHERE [object_id] = @ObjectID
      ORDER BY AC.[column_id]

      SET @SQL_Select =
        'SELECT' + @EL +
        @SQL_Select_List + @EL +
        'FROM ' + @SqlObjectName + ' AS ' + @Syn + @EL

      SET @SQL_SelectVars =
        'SELECT TOP 1' + @EL +
        @SQL_SelectVars_List + @EL +
        'FROM ' + @SqlObjectName + ' AS ' + @Syn + @EL +
        'WHERE ...' + @EL

      SET @SQL_SelectXml =
        'SET @Data = ' + @EL +
        '(' + @EL +
        @SQL_SelectXml_List + @EL +
        ')' + @EL +
        'FOR XML RAW(''RECORD'')' + @EL

      SET @SQL_SelectXml2 =
        'FROM @Data.nodes(''RECORD'') AS Data(Record)' + @EL +
        'CROSS APPLY' + @EL +
        '(' + @EL +
        '  SELECT' + @EL +
        @SQL_SelectXml2_List + @EL +
        ') Fields' + @EL

      SET @SQL_Insert =
        'INSERT INTO ' + @SqlObjectName + @EL +
        '(' + @EL +
        @SQL_Insert_Fields + @EL +
        ')' + @EL +
        'VALUES' + @EL +
        '(' + @EL +
        @SQL_Insert_Vars + @EL +
        ')' + @EL

      SET @SQL_InsSht =
        'INSERT INTO ' + @SqlObjectName + @EL +
        '(' + @EL +
        @SQL_InsSht_Fields + @EL +
        ')' + @EL +
        'VALUES' + @EL +
        '(' + @EL +
        @SQL_InsSht_Vars + @EL +
        ')' + @EL

      SET @SQL_Update =
        'UPDATE ' + @Syn + ' SET' + @EL +
        @SQL_Update_List + @EL +
        'FROM ' + @SqlObjectName + ' AS ' + @Syn + @EL

      SET @SQL_Declare =
        'DECALRE' + @EL +
        @SQL_Declare_List + @EL

      SET @SQL_Table =
        'DECALRE @Table Table' + @EL +
        '(' + @EL +
        @SQL_Table_List + @EL +
        ')' + @EL


      IF @GetSelect = 1 BEGIN
        EXEC [SQL].[Print] @SQL_Select
        EXEC [SQL].[Print] '----------------------------------------------'
      END
      IF @GetSelectVars = 1 BEGIN
        EXEC [SQL].[Print] @SQL_SelectVars
        EXEC [SQL].[Print] '----------------------------------------------'
      END
      IF @GetSelectXml = 1 BEGIN
        EXEC [SQL].[Print] @SQL_SelectXml
        EXEC [SQL].[Print] '----------------------------------------------'
      END
      IF @GetSelectXml2 = 1 BEGIN
        EXEC [SQL].[Print] @SQL_SelectXml2
        EXEC [SQL].[Print] '----------------------------------------------'
      END
      IF @GetInsert = 1 BEGIN
        EXEC [SQL].[Print] @SQL_Insert
        EXEC [SQL].[Print] '----------------------------------------------'
      END
      IF @GetInsertShort = 1 BEGIN
        EXEC [SQL].[Print] @SQL_InsSht
        EXEC [SQL].[Print] '----------------------------------------------'
      END
      IF @GetUpdate = 1 BEGIN
        EXEC [SQL].[Print] @SQL_Update
        EXEC [SQL].[Print] '----------------------------------------------'
      END
      IF @GetDeclare = 1 BEGIN
        EXEC [SQL].[Print] @SQL_Declare
        EXEC [SQL].[Print] '----------------------------------------------'
      END
      IF @GetDeclareTable = 1 BEGIN
        EXEC [SQL].[Print] @SQL_Table
        EXEC [SQL].[Print] '----------------------------------------------'
      END

    ----------------------------------------------
    END ELSE IF @ObjectType IN ('P') BEGIN

      SELECT @ShiftValue = MAX(LEN(QUOTENAME(AC.[name]))) + 1
      FROM sys.all_parameters AS AC
      WHERE [object_id] = @ObjectID

      SET @ShiftValue = CASE WHEN @ShiftValue < @ShiftConst THEN @ShiftConst ELSE @ShiftValue END

      SET @SQL_Exec_Params = NULL
      SELECT
        @SQL_Exec_Params = ISNULL(@SQL_Exec_Params + ',' + @EL, '') +
                           '  ' + LEFT(AP.[name] + SPACE(@ShiftValue), @ShiftValue) + ' = ' + AP.[name]
      FROM sys.all_parameters AS AP
      WHERE [object_id] = @ObjectID
      ORDER BY AP.[parameter_id]

      SET @SQL_Exec =
        'EXEC ' + @SqlObjectName + @EL +
        @SQL_Exec_Params + @EL

      IF @GetExec = 1 BEGIN
        EXEC [SQL].[Print] @SQL_Exec
        EXEC [SQL].[Print] '----------------------------------------------'
      END

    ----------------------------------------------
    END ELSE
      RAISERROR (' SQL-  ! @SqlObjectName = %s; Type = %s', 16, 2, @SqlObjectName, @ObjectType)


    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@ProcId
  END CATCH

GO
/****** Object:  StoredProcedure [SQL].[Generate FieldTest]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--===============================================================================================================
-- <>:        :
-- < >:       ;
-- <>:              ..;
-- < >:     13.01.2014;
-- <>:          Ctrl+9;
-----------------------------------------------------------------------------------------------------------------
-- <>:          ;
-- < >:    ;
-- < >: ;
-- <>:       ;
-----------------------------------------------------------------------------------------------------------------
-- <>:
/*
  EXEC [SQL].[Generate FieldTest] '[GUId], [Firm_Id], [CancelStatus_Id], [DateTime], [Type_Id], [UpperOrganization_Id], [Place_Id], [TradeBoard_Id], [Comments], [Attributes_IDs],
                [CalendarPlace_Id], [CostCurrency_Id], [TransactionCurrency_Id], [RepoDirect], [RepoPercents], [RepoPercentsBasis], [PlaceDealNo], [UpperDealNumber],
                [PARTS], [REQUISITES], [DATES], [EVIDENCE], [REGISTRATION], [NOTE], [ITEMS]'
*/
--===============================================================================================================
CREATE PROCEDURE [SQL].[Generate FieldTest]
  @SqlFieldsArray   NVarChar(Max)
AS
  SET NOCOUNT ON

  DECLARE
    @ObjectID             Int,
    @SQL                  NVarChar(Max),
    @EL                   NChar(2)      = Char(13) + Char(10)

  BEGIN TRY

    SET @ObjectID = OBJECT_ID(@SqlFieldsArray)
    IF @ObjectID IS NOT NULL BEGIN
      -- ,  @SqlFieldsArray -  SQL-
      SET @SqlFieldsArray = ''

      SELECT
        @SqlFieldsArray = [Pub].[Concat](F.[FieldName], ',')
      FROM
      (
        SELECT TOP 1000
          [FieldName]  = AC.[name]
        FROM sys.all_columns AS AC
        WHERE AC.[object_id] = @ObjectID
          AND AC.[name] NOT LIKE '%:%'
        ORDER BY AC.[column_id]
      ) F
    END

    IF @SqlFieldsArray IS NULL OR @SqlFieldsArray = ''  
      RAISERROR('   !', 16, 1)

    SELECT
      @SqlFieldsArray = [Pub].[Concat](F.[FieldName], ',')
    FROM
    (
      SELECT TOP 63
        [FieldName] = [Pub].[UnQuote]([Pub].[Trim](AR.[Value], ''), '[')
      FROM [Pub].[Array To RowSet Of Values](@SqlFieldsArray, ',') AR
      ORDER BY AR.[Index]
    ) F

    SET @SQL = N''

    SELECT
      @SQL  += N'
    ' + [SQL].[Shift](QUOTENAME(F.[FieldName]), 36) + ' = CASE WHEN F.[Value] & ' + F.[Mask] + N' <> 0 THEN 1 ELSE 0 END'
      + CASE WHEN F.[Index] < F.[MaxIndex] THEN N',' ELSE N'' END
    FROM
    (
      SELECT TOP 63
        [FieldName] = AR.[Value],
        [Mask]      = CASE
                        WHEN AR.[Index] < 56
                          THEN CONVERT(NVarChar(32), CAST(CAST(POWER(2.0, AR.[Index]-1) AS BigInt) AS Binary(8)), 1)
                        ELSE CONVERT(NVarChar(32), CAST(CAST(POWER(2.0, AR.[Index]-56) AS BigInt) AS Binary(1)), 1) + '00000000000000'
                      END,
        [Index]     = AR.[Index],
        [MaxIndex]  = MAX(AR.[Index]) OVER ()
      FROM [Pub].[Array To RowSet Of Values](@SqlFieldsArray, ',') AR
      ORDER BY [Index]
    ) F

    SET @SQL = N'
(
  SELECT' + @SQL + N'
  FROM
  (
    SELECT
      [Value] = [Pub].[Array Test](I.[Row:Fields], ' + [Pub].[Quote String](@SqlFieldsArray) + N', '','')
  ) F
) FIELDS'

    EXEC [SQL].[Print] @SQL

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@ProcId
  END CATCH

GO
/****** Object:  StoredProcedure [SQL].[Generate Object Text]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
--===============================================================================================================
-- <>:         sql-  SQL-
-- <>:              ;
-- < >:       ;
-- <>:              ..;
-- < >:     02.11.2011;
-- <>:          Ctrl+3 (  sp_helptext);
-----------------------------------------------------------------------------------------------------------------
-- <>:          ;
-- < >:    ;
-- < >: ;
-- <>:       ;
-----------------------------------------------------------------------------------------------------------------
-- <>:
/*
  EXEC [SQL].[Generate Object Text] '[Base].[Securities:Issues(Translate)]'
  EXEC [SQL].[Generate Object Text] '[Base].[Instruments:Securities:Issues(Periodic Update)]'
  EXEC [SQL].[Generate Object Text] '[Base].[Security::Issue::Modify(Execute)#Bond]', null, 'PRINT'
  EXEC [SQL].[Generate Object Text] '[Base].[Security::Issue::Modify(Execute)#Bond]', null, 'SELECT'
  EXEC [SQL].[Generate Object Text] '[Base].[Money Active::View(Delphi)]'

  -- EXEC [SQL].[Generate Object Text] '[Base].[Instruments:Securities:Issues]'
  -- EXEC [SQL].[Generate Object Text] '[BackOffice].[Account::View(Delphi::Internal)#Trade]', @Debug = 1
*/
--===============================================================================================================
CREATE PROCEDURE [SQL].[Generate Object Text]
  @SqlObjectName    SysName,
  @SqlObjectVersion Int     = NULL,     -- NULL = 
  @ResMode          SysName = 'PRINT', -- 'PRINT' / 'SELECT
  @GenerateFileName Bit     = 1,
  @GenerateDropProc Bit     = 0,
  @Debug            Bit     = 0
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @Err                  Int,
    @ErrMsg               Sysname,
    @RowsCount            Int,
    @CharStart            Int,
    @CharEnd              Int,
    @LenSQL               Int,

    @ObjectID             Int,
    @ObjectType           NVarChar(2),
    @Trigger_Type         NVarChar(512),

    @ParentObjectID       Int,
    @ParentObjectName     Sysname,

    @SchemaName           Sysname,
    @SchemaNameQ          Sysname,
    @ObjectName           Sysname,
    @ObjectNameQ          Sysname,

    @SQL                  NVarChar(Max) = '',
    @HeaderSQL            NVarChar(Max),
    @NewHeaderSQL         NVarChar(Max),

    @EL                   NChar(2)      = Char(13) + Char(10),
    @GO                   NVarChar(32)  = 'G' + 'O',
    @ObjectTypesForSOE    NVarChar(Max) = 'V=VW;TF=FT;IF=FI',
    @TypeRenames          NVarChar(Max) = 'int=Int;tinyint=TinyInt;smallint=SmallInt;bigint=BigInt;char=Char;varchar=VarChar;nchar=NChar;nvarchar=NVarChar;date=Date;datetime=DateTime;time=Time;bit=Bit;uniqueidentifier=UniqueIdentifier;numeric=Numeric;text=Text;ntext=NText',
    @VarTypes             NVarChar(Max) = 'varchar,nvarchar,varbinary',
    @NumTypes             NVarChar(Max) = 'numeric',

    @Line                 NVarChar(Max),
    @PrintLines           NVarChar(Max)

  BEGIN TRY

    SET @ObjectID       = OBJECT_ID(@SqlObjectName)
    IF @ObjectID IS NULL
      RAISERROR ('SQL-  ! @SqlObjectName = %s', 16, 2, @SqlObjectName)

    IF @ResMode IS NULL
      RAISERROR('   @ResMode!', 16, 2)
    IF @ResMode NOT IN ('PRINT', 'SELECT')
      RAISERROR('     @ResMode = %s!', 16, 2, @ResMode)

    SET @SchemaName     = OBJECT_SCHEMA_NAME(@ObjectID)
    SET @SchemaNameQ    = QUOTENAME(@SchemaName)
    SET @ObjectName     = OBJECT_NAME(@ObjectID)
    SET @ObjectNameQ    = QUOTENAME(@ObjectName)
    SET @SqlObjectName  = @SchemaNameQ + '.' + @ObjectNameQ

    SET @ObjectType     = [Pub].[Trim](CAST(OBJECTPROPERTYEX(@ObjectID, N'BaseType') AS NVarChar(2)), ' ')

    IF @Debug = 1
      SELECT [@ObjectID] = @ObjectID, [@SqlObjectName] = @SqlObjectName, [@ObjectType] = @ObjectType

    ----------------------------------------------
    IF @ObjectType IN ('P', 'V', 'TF', 'IF', 'FN', 'TR') BEGIN

      IF @ObjectType = 'TR' BEGIN
        SELECT TOP 1
          @ParentObjectID = [parent_object_id]
        FROM sys.all_objects
        WHERE [object_id] = @ObjectID

        SET @ParentObjectName = QUOTENAME(OBJECT_SCHEMA_NAME(@ParentObjectID)) + '.' + QUOTENAME(OBJECT_NAME(@ParentObjectID))

        SET @Trigger_Type = ''
        SET @Trigger_Type = CASE
                              WHEN OBJECTPROPERTYEX(@ObjectID, N'ExecIsInsertTrigger') = 1
                                THEN [Pub].[Arrays Merge](@Trigger_Type, 'INSERT', ',')
                              ELSE @Trigger_Type
                            END
        SET @Trigger_Type = CASE
                              WHEN OBJECTPROPERTYEX(@ObjectID, N'ExecIsUpdateTrigger') = 1
                                THEN [Pub].[Arrays Merge](@Trigger_Type, 'UPDATE', ',')
                              ELSE @Trigger_Type
                            END
        SET @Trigger_Type = CASE
                              WHEN OBJECTPROPERTYEX(@ObjectID, N'ExecIsDeleteTrigger') = 1
                                THEN [Pub].[Arrays Merge](@Trigger_Type, 'DELETE', ',')
                              ELSE @Trigger_Type
                            END

        SET @Trigger_Type = CASE
                              WHEN OBJECTPROPERTYEX(@ObjectID, N'ExecIsInsteadOfTrigger') = 1
                                THEN 'INSTEAD OF '
                                ELSE 'AFTER '
                            END
                          + @Trigger_Type
      END

      --  SQL-  
      IF (@SqlObjectVersion IS NULL) OR (@SqlObjectVersion = 1) BEGIN
        SET @SQL = CASE WHEN @ObjectType = 'P' THEN OBJECT_DEFINITION(@ObjectID, 1) ELSE OBJECT_DEFINITION(@ObjectID) END
        --SELECT TOP 1
        --  @SQL = [Pub].[Trim](m.[definition], ' ')
        --FROM [sys].[all_sql_modules] AS m
        --WHERE m.[object_id] = @ObjectID

        IF @Debug = 1
          SELECT [@SQL] = @SQL

        SET @HeaderSQL = 'CREATE ' +
          CASE
            WHEN @ObjectType = 'P' THEN 'PROCEDURE'
            WHEN @ObjectType = 'V' THEN 'VIEW'
            WHEN @ObjectType = 'TF' THEN 'FUNCTION'
            WHEN @ObjectType = 'IF' THEN 'FUNCTION'
            WHEN @ObjectType = 'FN' THEN 'FUNCTION'
            WHEN @ObjectType = 'TR' THEN 'TRIGGER'
          END + ' ' + @SqlObjectName

        SET @NewHeaderSQL = 'ALTER ' +
          CASE
            WHEN @ObjectType = 'P' THEN 'PROCEDURE'
            WHEN @ObjectType = 'V' THEN 'VIEW'
            WHEN @ObjectType = 'TF' THEN 'FUNCTION'
            WHEN @ObjectType = 'IF' THEN 'FUNCTION'
            WHEN @ObjectType = 'FN' THEN 'FUNCTION'
            WHEN @ObjectType = 'TR' THEN 'TRIGGER'
          END + ' ' + @SqlObjectName

        IF CHARINDEX(@HeaderSQL, @SQL) <= 0
          RAISERROR ('   ! %s', 16, 2, @SqlObjectName)
      END

      IF @ObjectType IN ('P') BEGIN
        SET @SQL = [Pub].[Trim](@SQL, ' ')

        SELECT
          @SQL += @EL
                + @GO + @EL
                + @EL
                + 'EXEC [SQL].[Object Exists] @Object_Name = ' + [Pub].[Quote String](@SqlObjectName + ';' + CAST(NP.[procedure_number] AS VarChar(32))) + ', @Type = ' + [Pub].[Quote String]( [Pub].[Array Alias](@ObjectType, @ObjectTypesForSOE, ',', ';', 0) ) + ', @Force_Create = 1' + @EL
                + @GO + @EL
                + [Pub].[Trim](NP.[definition], ' ')
        FROM [sys].[numbered_procedures] AS NP
        WHERE NP.[object_id] = @ObjectID
          AND ( @SqlObjectVersion IS NULL OR NP.[procedure_number] = @SqlObjectVersion )
          AND [System].[Raise Error](
                @@PROCID,
                CASE
                  WHEN CHARINDEX(@HeaderSQL, [definition]) < 0 THEN '    ' + [Pub].[Quote String](@SqlObjectName) + '   (' + CAST(NP.[procedure_number] AS VarChar(32)) + ')!'
                END
              ) IS NULL

        IF EXISTS (SELECT * FROM [sys].[numbered_procedures] AS NP WHERE NP.[object_id] = @ObjectID AND CHARINDEX(@HeaderSQL, NP.[definition]) <= 0)
          RAISERROR ('   ! %s', 16, 2, @SqlObjectName)
      END

      SET @SQL = REPLACE(@SQL, @HeaderSQL, @NewHeaderSQL)

      SET @SQL =  '-- ' + @SchemaName + '.' + REPLACE(REPLACE(REPLACE(@ObjectName, '::', '.'), ':', '.'), '/', '_') + '.sql' + @EL
                + 'SET NOCOUNT ON' + @EL
                + 'SET ANSI_NULLS ON' + @EL
                + 'SET QUOTED_IDENTIFIER ON' + @EL
                + @GO + @EL
                + CASE
                    WHEN @GenerateDropProc = 1
                      THEN 'EXEC [SQL].[Drop Procedure] @Object_Name = ' + [Pub].[Quote String](@SqlObjectName) + @EL + @GO + @EL
                    ELSE ''
                  END
                + CASE
                    WHEN @ObjectType = 'TR'
                      THEN 'EXEC [SQL].[Object Exists]' + @EL
                         + '  @Object_Name    = ' + [Pub].[Quote String](@SqlObjectName) + ',' + @EL
                         + '  @Type           = ' + [Pub].[Quote String]( [Pub].[Array Alias](@ObjectType, @ObjectTypesForSOE, ',', ';', 0) ) + ',' + @EL
                         + '  @Trigger_Type   = ' + [Pub].[Quote String]( @Trigger_Type ) + ',' + @EL
                         + '  @OnObject_Name  = ' + [Pub].[Quote String](@ParentObjectName) + ',' + @EL
                         + '  @Force_Create   = 1' + @EL
                      ELSE 'EXEC [SQL].[Object Exists] @Object_Name = ' + [Pub].[Quote String](@SqlObjectName) + ', @Type = ' + [Pub].[Quote String]( [Pub].[Array Alias](@ObjectType, @ObjectTypesForSOE, ',', ';', 0) ) + ', @Force_Create = 1' + @EL
                  END
                + @GO + @EL
                + [Pub].[Trim](@SQL, ' ') + @EL
                + @GO + @EL

      SELECT
        @SQL += @EL
              + DP.[state_desc] + ' ' + DP.[permission_name] + ' ON ' + @SqlObjectName + ' TO ' + QUOTENAME(P.name)
      FROM [sys].[database_permissions] AS DP
      INNER JOIN [sys].[database_principals] AS P ON P.[principal_id] = DP.[grantee_principal_id]
      WHERE DP.[major_id] = @ObjectID

      SET @SQL += @EL + @GO + @EL

      DECLARE @Lines TABLE
      (
        [Id]      Int           NOT NULL IDENTITY(1,1),
        [--SQL:]  NVarChar(1024)    NULL,
        PRIMARY KEY CLUSTERED([Id])
      )

      SET @PrintLines = NULL
      SET @CharStart = -1
      SET @CharEnd = CHARINDEX(@EL, @SQL)
      SET @LenSQL = LEN(@SQL)
      WHILE @CharEnd > 0 BEGIN
        SET @Line = [Pub].[Trim Right](SUBSTRING(@SQL, @CharStart + 2, @CharEnd - @CharStart - 2), ' ')

        INSERT INTO @Lines ([--SQL:])
        VALUES ( @Line )

        SET @CharStart = CHARINDEX(@EL, @SQL, @CharEnd)
        SET @CharEnd = CHARINDEX(@EL, @SQL, @CharStart + 1)

        IF @ResMode = 'PRINT' BEGIN
          SET @PrintLines = ISNULL(@PrintLines + @EL, '') + @Line
          IF @PrintLines <> N'' BEGIN
            EXEC [SQL].[Print] @Text = @PrintLines, @TrimRight = 0
            SET @PrintLines = NULL
          END
        END
      END

      IF @ResMode = 'SELECT'
        SELECT [--SQL:] FROM @Lines ORDER BY [Id]

    ----------------------------------------------
    END ELSE
      RAISERROR (' SQL-  ! @SqlObjectName = %s; Type = %s', 16, 2, @SqlObjectName, @ObjectType)

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@ProcId
  END CATCH

GO
/****** Object:  StoredProcedure [SQL].[Object Exists]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*****************************************************************************************************
* Generated By Fess
*  : 09.04.2009.
*       (.  )
* : EXEC [SQL].[Object Exists] @Object_Name = '[dbo].[Test]', @Force_Create = 1, @Type = 'P'
*  : 07.09.2009.
*****************************************************************************************************/
CREATE PROCEDURE [SQL].[Object Exists]
  @Object_Name    SysName,              --  (     )
  @Type           VarChar(2)  = 'P',    --   : P -  ,
                                        -- FN -  ,
                                        -- FT -  ,
                                        -- FI - Inline-,
                                        -- TR -  (    @OnObject_Name),
                                        -- VW - 
  @OnObject_Name  SysName     = NULL,   --  (Ex. [Base].[Securities])
  @Trigger_Type   SysName     = NULL,   --  
  @Force_Create   Bit         = 1       --    

AS
  SET NOCOUNT ON

  SET @Object_Name   = LTRIM(RTRIM(ISNULL(@Object_Name, '')))
  SET @OnObject_Name = LTRIM(RTRIM(ISNULL(@OnObject_Name, '')))

  IF @Object_Name = '' BEGIN
    PRINT ' [SQL].[Object Exists] (    ), : @Object_Name < > , @Force_Create < >]'
    RETURN(-100)
  END

  SET @Force_Create = ISNULL(@Force_Create, 0)
  SET @Type         = UPPER(ISNULL(@Type, 'P'))

  DECLARE
    @ProcID      Int,
    @Name        SysName,
    @Proc        SysName,
    @Schema      SysName,
    @Version     SmallInt,
    @CreateProc  VarChar(Max),
    @CreateFN    VarChar(Max),
    @CreateFT    VarChar(Max),
    @CreateFI    VarChar(Max),
    @CreateTR    VarChar(Max),
    @CreateVW    VarChar(Max),
    @Exec        VarChar(Max),
    @ErrV        VarChar(Max),
    @ErrNo       VarChar(Max),
    @ErrN        VarChar(Max),
    @ErrT        VarChar(Max),
    @ErrF        VarChar(Max),
    @ErrTR       VarChar(Max),
    @ErrVW       VarChar(Max),
    @ErrNoParam  VarChar(Max)

  BEGIN TRY

    EXEC [SQL].[Extract Object Path]
      @Path       = @Object_Name,
      @Schema     = @Schema    OUT,
      @Name       = @Name      OUT,
      @Version    = @Version   OUT

    IF @Schema IS NULL BEGIN
      PRINT '      ' + Char(171) + @Object_Name + Char(187) + '.'
      RETURN(-101)
    END

    SET @CreateProc = 'CREATE PROCEDURE %s AS'
    SET @CreateFN   = 'CREATE FUNCTION %s () RETURNS Int AS BEGIN RETURN 0 END'
    SET @CreateFT   = 'CREATE FUNCTION %s () RETURNS @R TABLE(I Int) AS BEGIN RETURN END'
    SET @CreateFI   = 'CREATE FUNCTION %s () RETURNS TABLE AS RETURN (SELECT NULL AS N)'
    SET @CreateTR   = 'CREATE TRIGGER %s ON %d ' + ISNULL(@Trigger_Type, 'AFTER INSERT') + ' AS IF @@ROWCOUNT = 0 RETURN'
    SET @CreateVW   = 'CREATE VIEW %s AS SELECT NULL [ColumnName] WHERE NULL=NULL'
    SET @ErrNoParam = '    %s'
    SET @ErrV       = '    %s   !'      -- -103
    SET @ErrNo      = ' %s    !'                           -- -104
    SET @ErrN       = '   %s   !'             -- -102
    SET @ErrT       = '  %s    @Type !'    -- -106
    SET @ErrF       = '   %s   !'               -- -107
    SET @ErrTR      = '   %s   !'              -- -108
    SET @ErrVW      = '   %s   !'         -- -109

    SET @Proc       = QUOTENAME(@Schema) + '.' + QUOTENAME(@Name)
    SET @ProcID     = OBJECT_ID(@Proc)

    IF @Type = 'P' BEGIN
      IF @Version = 1 SET @Version = NULL
      ELSE
      IF @Version = 0 BEGIN
        PRINT '     ' + Char(171) + @Object_Name + Char(187) + '.'
        RETURN(-105)
      END

      IF (@ProcID IS NOT NULL) AND (@Version IS NULL)
        RETURN(0)
      ELSE
      IF (@Version IS NOT NULL) AND
        EXISTS(SELECT NSP.procedure_number
               FROM sys.numbered_procedures NSP
               WHERE NSP.object_id = @ProcID AND NSP.procedure_number = @Version)
        RETURN(0)

      IF (@ProcID IS NULL) AND (@Force_Create = 1) BEGIN
        SET @Exec = REPLACE(@CreateProc, '%s', @Proc)
        EXEC(@Exec)
        IF OBJECT_ID(@Proc) IS NULL BEGIN
          PRINT REPLACE(@ErrN, '%s', Char(171) + @Proc + Char(187))
          RETURN(-102)
        END
        IF @Version IS NOT NULL BEGIN
          SET @Exec = REPLACE(@CreateProc, '%s', @Proc + ';' + cast(@Version AS VarChar(max)))
          EXEC(@Exec)
          IF NOT EXISTS(SELECT NSP.procedure_number
                        FROM sys.numbered_procedures NSP
                        WHERE NSP.object_id = object_id(@Proc) AND NSP.procedure_number = @Version)
          BEGIN
            PRINT replace(@ErrV, '%s', Char(171) + @Proc + Char(187))
            RETURN(-103)
          END
        END
        RETURN(0)
      END

      IF (@ProcID IS NULL) AND (@Force_Create = 0) BEGIN
        IF @Version IS NOT NULL SET @Proc = @Proc + ';' +  cast(@Version AS VarChar(max))
        PRINT REPLACE(@ErrNo, '%s', Char(171) + @Proc + Char(187))
        RETURN(-104)
      END

      IF (@ProcID IS NOT NULL) AND (@Version IS NOT NULL) BEGIN
        IF @Force_Create = 0 BEGIN
          SET @Proc = @Proc + ';' +  cast(@Version AS VarChar(max))
          PRINT REPLACE(@ErrNo, '%s', Char(171) + @Proc + Char(187))
          RETURN(-104)
        END
        SET @Proc = @Proc + ';' + cast(@Version AS VarChar(max))
        SET @Exec = REPLACE(@CreateProc, '%s', @Proc)
        EXEC(@Exec)
        IF NOT EXISTS(SELECT NSP.procedure_number
                      FROM sys.numbered_procedures NSP
                      WHERE NSP.object_id = @ProcID AND NSP.procedure_number = @Version)
        BEGIN
          PRINT replace(@ErrV, '%s', Char(171) + @Proc + Char(187))
          RETURN(-103)
        END
      END
    END ELSE BEGIN

      IF @ProcID IS NOT NULL RETURN(0)
      IF @Force_Create = 0 BEGIN
        PRINT REPLACE(@ErrNo, '%s', Char(171) + @Proc + Char(187))
        RETURN(-104)
      END

      --  
      IF @Type = 'FN' OR @Type = 'FT' OR @Type = 'FI' BEGIN
        IF @Type = 'FN' BEGIN
          SET @Exec = REPLACE(@CreateFN, '%s', @Proc)
          EXEC(@Exec)
          IF OBJECT_ID(@Proc) IS NULL BEGIN
            PRINT REPLACE(@ErrF, '%s', Char(171) + @Proc + Char(187))
            RETURN(-107)
          END
          RETURN(0)
        END
        IF @Type = 'FT' BEGIN
          SET @Exec = REPLACE(@CreateFT, '%s', @Proc)
          EXEC(@Exec)
          IF object_id(@Proc) IS NULL BEGIN
            PRINT replace(@ErrF, '%s', Char(171) + @Proc + Char(187))
            RETURN(-107)
          END
          RETURN(0)
        END
        --  @Type = 'FI'
        SET @Exec = REPLACE(@CreateFI, '%s', @Proc)
        EXEC(@Exec)
        IF OBJECT_ID(@Proc) IS NULL BEGIN
          PRINT REPLACE(@ErrF, '%s', Char(171) + @Proc + Char(187))
          RETURN(-107)
        END
        RETURN(0)
      END
      ELSE

      -- 
      IF @Type = 'TR' BEGIN
        IF @OnObject_Name = '' BEGIN
          PRINT REPLACE(@ErrNoParam, '%s', Char(171) + '@OnObject_Name' + Char(187))
          RETURN(-200)
        END
        SET @ProcID = OBJECT_ID(@OnObject_Name)
        IF @ProcID IS NULL BEGIN
          PRINT REPLACE(@ErrNo, '%s', Char(171) + @OnObject_Name + Char(187))
          RETURN(-104)
        END
        SET @Exec = REPLACE(REPLACE(@CreateTR, '%s', @Proc), '%d', @OnObject_Name)
        -- PRINT @Exec
        EXEC(@Exec)
        IF OBJECT_ID(@Proc) IS NULL BEGIN
          PRINT REPLACE(@ErrTR, '%s', Char(171) + @Proc + Char(187))
          RETURN(-108)
        END
        RETURN(0)
      END ELSE

      IF @Type = 'VW' BEGIN -- 
        SET @Exec = REPLACE(@CreateVW, '%s', @Proc)
        EXEC(@Exec)
        IF OBJECT_ID(@Proc) IS NULL BEGIN
          PRINT REPLACE(@ErrVW, '%s', Char(171) + @Proc + Char(187))
          RETURN(-109)
        END
        RETURN(0)
      END ELSE
      BEGIN
        PRINT REPLACE(@ErrT, '%s', Char(171) + @Type + Char(187))
        RETURN(-106)
      END
    END

    RETURN 1
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
  END CATCH

GO
/****** Object:  StoredProcedure [SQL].[Print]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [SQL].[Print]
  @Text         NVarChar(Max),
  @TrimRight    Bit = 1,
  @EndEllipses  Bit = 0
AS
  SET NOCOUNT ON

  DECLARE
    @Line NVarChar(2048)

  IF @Text IS NULL
    RETURN

  IF @TrimRight IS NULL OR @EndEllipses IS NULL
    RaisError('Abstract error', 16, 2)

  DECLARE
    @I      Int,
    @J      Int,
    @CR     NChar(1)      = NChar(13),
    @LR     NChar(1)      = NChar(10),
    @Buffer NVarChar(Max) = N''

  SET @Text = [Pub].[Trim Left](@Text, @LR)
  SET @J  = 0

  WHILE 1 = 1 
  BEGIN TRY
    SET @I = CharIndex(@CR, @Text, @J + 1)
    IF @I = 0
      SET @I = DataLength(@Text) + 1
    IF @J >= @I
      BREAK

    SET @Line = Replace(SubString(@Text, @J + 1, @I - @J - 1), '%', '%%')
    IF @TrimRight = 1
      SET @Line = [Pub].[Trim Right](@Line, ' ')

    IF @Line = N'' BEGIN
      SET @Buffer += @CR + @LR
      GOTO LB_CONTINUE
    END ELSE IF @Buffer <> N'' BEGIN
      SET @Line   = @Buffer + @Line
      SET @Buffer = N''
    END

    IF DataLength(@Line) > 2047
      IF @EndEllipses = 1
        SET @Line = [Pub].[Trim Right](SubString(@Line, 1, 2044), '%') + '...'
      ELSE BEGIN
        RaisError('       2047 ', 16, 1)
        RETURN 0
      END

    RaisError(@Line, 0, 0)

LB_CONTINUE:
    WHILE SubString(@Text, @I + 1, 1) = @LR COLLATE Cyrillic_General_BIN
      SET @I = @I + 1

    SET @J = @I
  END TRY
  BEGIN CATCH
    EXEC [System].[ReRaise Error] @ProcedureId = @@PROCID
    RETURN 1
  END CATCH

  IF @TrimRight = 0 AND @Buffer <> N''
    RaisError(@Buffer, 0, 0)

GO
/****** Object:  StoredProcedure [SQL].[Search]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- ============================================================
--    
--  : </>
-- : dbo (PIRYAZEV)
-- : 29 Jul 2009 12:20:39:343
-- : 1.0
-- : N/A
-- ============================================================
CREATE PROCEDURE [SQL].[Search]
  @SearchString     NVarChar(500),
  @NameLikeString   NVarChar(500)  = NULL
AS
  SET NOCOUNT ON

  SET @SearchString = REPLACE(@SearchString, '[', '@[')
  SET @SearchString = REPLACE(@SearchString, ']', '@]')
  SET @SearchString = REPLACE(@SearchString, '_', '@_')

  SELECT
    [Object_ID],
    [SchemaName],
    [Name],
    [Type],
    [FullName],
    [Line]      = LTRIM(T.[Value]),
    [HelpText]  = 'EXEC [SQL].[Generate Object Text] ' + [Pub].[Quote String](QuoteName([SchemaName]) + '.' + QuoteName([Name])) + ISNULL(', ' + CAST([number] AS VarChar(32)), '')
  FROM
  (
    SELECT
      [Object_ID],
      [SchemaName],
      [Name],
      [Type],
      [FullName],
      [number],
      [text]
    FROM
    (
      SELECT DISTINCT
        O.[Object_ID],
        [SchemaName]  = SCHEMA_NAME(SCHEMA_ID),
        O.[Name],
        [Type],
        FullName      = QUOTENAME(SCHEMA_NAME(SCHEMA_ID)) + '.' + QUOTENAME(O.[Name]) + ISNULL(';' + CAST([number] AS VarChar(32)), ''),
        [number],
        [text]        = REPLACE([definition], char(13)+char(10), char(13)) --     {char(13)  char(10))      : char(13)
      FROM
      (
        SELECT
          [object_id]   = C.[object_id],
          [definition]  = C.[definition],
          [number]      = CASE
                            WHEN o.[type] = 'P'
                             AND EXISTS(SELECT * FROM sys.numbered_procedures AS N WHERE N.[object_id] = C.[object_id])
                            THEN CAST(1 AS Int)
                            ELSE NULL
                          END
        FROM sys.sql_modules AS C
        INNER JOIN sys.all_objects AS O ON o.[object_id] = C.[object_id]

        UNION ALL

        SELECT [object_id], C.[definition], C.[procedure_number]
        FROM sys.numbered_procedures C
      ) C
      INNER JOIN sys.objects o ON o.[object_id] = c.[object_id]
      WHERE ( C.[definition] LIKE '%' + @SearchString + '%' ESCAPE '@' )
    ) R
  ) R
  OUTER APPLY [Pub].[Split](R.[Text], char(13)) T
  WHERE ( T.[Value] LIKE '%' + @SearchString + '%' ESCAPE '@' )
    AND ( @NameLikeString IS NULL OR R.FullName LIKE '%' + @NameLikeString + '%' )
  ------------
    UNION ALL
  ------------
  SELECT
    [Object_Id]     = NULL,
    [SchemaName]    = N'GUI',
    [Name]          = N'Dic:Forms',
    [Type]          = N'TABLE',
    [FullName]      = N'[GUI].[Dic:Forms]',
    [Line]          = '[ClassName]=' + ISNULL(F.[ClassName], 'NULL')
                    + '; [ClassNameParent]=' + ISNULL(F.[ClassNameParent], 'NULL')
                    + '; [ClassNameGUI]=' + ISNULL(F.[ClassNameGUI], 'NULL')
                    + '; [Name]=' + ISNULL(F.[Name], 'NULL')
                    + '; [ClassProcedure]=' + ISNULL(F.[ClassProcedure], 'NULL')
                    + '; [BeforeCreateProcedure]=' + ISNULL(F.[BeforeCreateProcedure], 'NULL')
                    + '; [SubClassProcedure]=' + ISNULL(F.[SubClassProcedure], 'NULL')
                    + '; [SubClassParams]=' + ISNULL(F.[SubClassParams], 'NULL')
                    + '; [InstanceProcedure]=' + ISNULL(F.[InstanceProcedure], 'NULL')
                    + '; [InstanceParams]=' + ISNULL(F.[InstanceParams], 'NULL')
                    + '; [DefaultsParams]=' + ISNULL(F.[DefaultsParams], 'NULL') + '.',
    [HelpText]      = 'SELECT * FROM [GUI].[Dic:Forms] F WHERE F.[ClassName] = ' + [Pub].[Quote String](F.[ClassName])
  FROM [GUI].[Dic:Forms] F
  WHERE F.[ClassName] LIKE '%' + @SearchString + '%' ESCAPE '@'
        OR F.[ClassNameParent] LIKE '%' + @SearchString + '%' ESCAPE '@'
        OR F.[ClassNameGUI] LIKE '%' + @SearchString + '%' ESCAPE '@'
        OR F.[Name] LIKE '%' + @SearchString + '%' ESCAPE '@'
        OR F.[ClassProcedure] LIKE '%' + @SearchString + '%' ESCAPE '@'
        OR F.[BeforeCreateProcedure] LIKE '%' + @SearchString + '%' ESCAPE '@'
        OR F.[SubClassParams] LIKE '%' + @SearchString + '%' ESCAPE '@'
        OR F.[SubClassProcedure] LIKE '%' + @SearchString + '%' ESCAPE '@'
        OR F.[InstanceProcedure] LIKE '%' + @SearchString + '%' ESCAPE '@'
        OR F.[InstanceParams] LIKE '%' + @SearchString + '%' ESCAPE '@'
        OR F.[DefaultsParams] LIKE '%' + @SearchString + '%' ESCAPE '@'
  ORDER BY [SchemaName], [Name]

GO
/****** Object:  StoredProcedure [System].[ReRaise Error]    Script Date: 16.01.2015 12:15:05 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [System].[ReRaise Error]
  @ProcedureName        SysName = NULL,
  @ProcedureId          Int     = NULL,
  @ProcedureVersion     Int     = NULL,
  @ErrorNumber          Int     = NULL,
  @CalledProcedureName  SysName = NULL
---
  WITH EXECUTE AS OWNER
---
AS
  SET NOCOUNT ON

  DECLARE
    @ErrorLine        Int,
    @ErrorMessage     NVarChar(Max),
    @ErrorSeverity    Int,
    @ErrorState       Int

  DECLARE
    @IB               Int,
    @IM               Int,
    @IE               Int,
    @DataBase         SysName,
    @Schema           SysName,
    @Object           NVarChar(256),
    @Object_Id        Int,
    @StatementType    SysName,

    @ConstraintType   SysName,
    @ConstraintName   NVarChar(256),
    @Constraint_Id    Int,
    @Key              NVarChar(256),
    @Debug            Bit

  IF @ProcedureName IS NULL
    IF @ProcedureId IS NOT NULL
      SET @ProcedureName = [SQL].[Object Name](@ProcedureId) + CASE WHEN @ProcedureVersion > 0 THEN ';' + CAST(@ProcedureVersion AS NVarChar) ELSE N'' END

  IF @ErrorNumber IS NULL SET @ErrorNumber = ERROR_NUMBER()
  SET @ErrorMessage   = ERROR_MESSAGE()
  SET @ErrorSeverity  = ERROR_SEVERITY()
  SET @ErrorState     = ERROR_STATE()
  SET @ErrorLine      = ERROR_LINE()

  SET @Debug = CAST([System].[Session Variable]('DEBUG') AS Bit)
  IF @Debug = 1
    PRINT FORMATMESSAGE('>> [ReRaise Error]: @@NESTLEVEL = %d, @ProcedureName = %s, @ErrorNumber = %d, XACT_STATE() = %d, @@TRANCOUNT = %d, @ErrorMessage = "%s"', @@NESTLEVEL, @ProcedureName, @ErrorNumber, XACT_STATE(), @@TRANCOUNT, @ErrorMessage)

  IF @ErrorSeverity > 18
    SET @ErrorSeverity = 18

  IF @ErrorNumber > 50000 BEGIN
    IF EXISTS(SELECT TOP 1 1 FROM sys.messages WHERE [message_id] = @ErrorNumber AND [text] <> '%s')
      RaisError(@ErrorMessage, 16, 1)
    ELSE
      RaisError(@ErrorNumber, @ErrorSeverity, @ErrorState, @ErrorMessage)
  END ELSE IF @ErrorNumber = 547 BEGIN
    SELECT
      @StatementType   = PVT.[1],
      @ConstraintType  = PVT.[2],
      @ConstraintName  = PVT.[3],
      @DataBase        = PVT.[4],
      @Object          = PVT.[5]
    FROM
    (
      SELECT
        [GroupIndex],
        [Match]
      FROM [Pub].[RegExp::Matches]
           (
            @ErrorMessage,
            '^The (.+?) statement conflicted with the (.+?) constraint "(.+?)"\. The conflict occurred in database "(.+?)", table "(.+?)"',
            DEFAULT
           )
      WHERE [MatchIndex] = 1 AND [GroupIndex] > 0
    ) D PIVOT (MAX ([Match]) FOR [GroupIndex] IN ([1], [2], [3], [4], [5])) PVT

    IF @@ROWCOUNT <> 1 OR @DataBase <> DB_NAME() GOTO LB_NOCONSTRAINT

    SET @Schema = PARSENAME(@Object, 2)
    SET @Object = QuoteName(@Schema) + N'.' + QuoteName(PARSENAME(@Object, 1))
    SET @Object_Id = OBJECT_ID(@Object)

    SELECT
      @Object = Cast([value] AS NVarChar(256))
    FROM sys.extended_properties
    WHERE [major_id] = @Object_Id AND [minor_id] = 0 AND [name] = 'Description'

    SELECT
      @Constraint_Id = [object_id]
    FROM sys.objects
    WHERE [schema_id] = SCHEMA_ID(@Schema) AND [name] = @ConstraintName
    IF @Constraint_Id IS NULL GOTO LB_NOCONSTRAINT

    SELECT
      @ConstraintName = Cast([value] AS NVarChar(256))
    FROM sys.extended_properties
    WHERE [major_id] = @Constraint_Id AND [minor_id] = 0 AND [name] = 'Description'

    RaisError(50547, 16, 1, @StatementType, @ConstraintType, @ConstraintName, @DataBase, @Object, N'')
    RETURN
LB_NOCONSTRAINT:
    RaisError(@ErrorMessage, 16, 1)
  END ELSE IF @ErrorNumber IN (2601, 2627) BEGIN
    SELECT
      @ConstraintType   = PVT.[1],
      @ConstraintName   = IsNull(PVT.[2], PVT.[6]),
      @Object           = IsNull(PVT.[3], PVT.[5]),
      @Key              = IsNull(PVT.[4], PVT.[7])
    FROM
    (
      SELECT
        [GroupIndex],
        [Match]
      FROM [Pub].[RegExp::Matches]
           (
            @ErrorMessage,
            '^Violation of (.+) constraint ''(.+?)''\. Cannot insert duplicate key in object ''(.+?)''\. The duplicate key value is (.+)\.$|^Cannot insert duplicate key row in object ''(.+)'' with unique index ''(.+)''\. The duplicate key value is (.+)\.$',
            DEFAULT
           )
      WHERE [MatchIndex] = 1 AND [GroupIndex] > 0 AND [Match] <> N''
    ) D PIVOT (MAX ([Match]) FOR [GroupIndex] IN ([1], [2], [3], [4], [5], [6], [7])) PVT

    IF @@ROWCOUNT <> 1 GOTO LB_NOCONSTRAINT2

    SET @Schema = PARSENAME(@Object, 2)
    SET @Object = QuoteName(@Schema) + N'.' + QuoteName(PARSENAME(@Object, 1))
    SET @Object_Id = OBJECT_ID(@Object)

    SELECT
      @Object = Cast([value] AS NVarChar(256))
    FROM sys.extended_properties
    WHERE [major_id] = @Object_Id AND [minor_id] = 0 AND [name] = 'Description'

    IF @ErrorNumber = 2601 BEGIN
      SELECT
        @Constraint_Id = [index_id]
      FROM sys.indexes
      WHERE [object_id] = @Object_Id AND [name] = @ConstraintName
      IF @Constraint_Id IS NULL GOTO LB_NOCONSTRAINT2

      SELECT
        @ConstraintName = Cast([value] AS NVarChar(256))
      FROM sys.extended_properties
      WHERE [major_id] = @Object_Id AND [class_desc] = N'INDEX' AND [minor_id] = @Constraint_Id AND [name] = 'Description'
    END ELSE BEGIN
      SELECT
        @Constraint_Id = [object_id]
      FROM sys.objects
      WHERE [schema_id] = SCHEMA_ID(@Schema) AND [name] = @ConstraintName
      IF @Constraint_Id IS NULL GOTO LB_NOCONSTRAINT2

      SELECT
        @ConstraintName = Cast([value] AS NVarChar(256))
      FROM sys.extended_properties
      WHERE [major_id] = @Constraint_Id AND [minor_id] = 0 AND [name] = 'Description'
    END

    IF @ErrorNumber = 2601
      RaisError(52601, 14, 1, @Object, @ConstraintName, @Key)
    ELSE
      RaisError(52627, 14, 1, @ConstraintType, @ConstraintName, @Object, @Key)
    RETURN
LB_NOCONSTRAINT2:
    RaisError(@ErrorMessage, 16, 1)
  END ELSE IF @ErrorNumber = 50000 AND @ErrorSeverity = 16 AND @ErrorState = 1 OR ERROR_PROCEDURE() = 'ReRaise Error' BEGIN
    SET @ErrorMessage = Replace(@ErrorMessage, '%', '%%')
    IF @CalledProcedureName IS NOT NULL AND CharIndex(@CalledProcedureName, @ErrorMessage) = 0 SET @ErrorMessage = N'CALL ' + @CalledProcedureName + N' failed: ' + @ErrorMessage
    RaisError(@ErrorMessage, @ErrorSeverity, @ErrorState)
  END ELSE BEGIN
    --     : <Conversion failed when converting the varchar value "" to data type int>
    IF @ErrorNumber in (6522, 6549, 245) AND @ErrorSeverity = 16 AND @ErrorState = 1 BEGIN
      SET @IB = CharIndex('<% RaisError:', @ErrorMessage)
      IF @IB > 0 BEGIN
        SET @IM = CharIndex(' %>', @ErrorMessage, @IB + 13)
        IF @IM > 0 BEGIN
          SET @Object_id = SubString(@ErrorMessage, @IB + 13, @IM - @IB - 13)
          SET @IE = CharIndex('<% /RaisError %>', @ErrorMessage, @IM + 3)
          IF @IE > 0 BEGIN
            SET @ErrorMessage = SubString(@ErrorMessage, @IM + 3, @IE - @IM - 3)

            SELECT
              @ProcedureName = QuoteName(SCHEMA_NAME([schema_id])) + '.' + QuoteName([name])
            FROM sys.objects WITH (NOLOCK)
            WHERE object_id = @Object_id
          END
        END
      END ELSE BEGIN
        SET @IB = CharIndex('System.SystemException: ', @ErrorMessage)
        IF @IB > 0 BEGIN
          SET @IM = CharIndex('System.SystemException: ', @ErrorMessage, @IB + 24)
          IF @IM > 0
            SET @ErrorMessage = [Pub].[Trim](SubString(@ErrorMessage, @IB + 24, @IM - @IB - 24), ' ')
        END
      END
    END

    IF @ProcedureName IS NULL
      SET @ProcedureName = ERROR_PROCEDURE()
    SET @ErrorMessage = Replace(IsNull('PROCEDURE ' + @ProcedureName + ', ', N'') + N'LINE ' + Cast(@ErrorLine AS NVarChar) + ': ' + @ErrorMessage, '%', '%%')

    IF @ErrorNumber > 50000
      RaisError(@ErrorNumber, @ErrorSeverity, @ErrorState, @ErrorMessage)
    ELSE
      RaisError(@ErrorMessage, @ErrorSeverity, @ErrorState)
  END

GO
USE [master]
GO
ALTER DATABASE [Gate.Dev] SET  READ_WRITE 
GO